import{$ as rn,$a as Tt,$b as am,A as Ge,Aa as Yo,Ba as rl,C as Vr,Ca as an,D as nn,Da as rt,F as Jc,Fa as Bg,Fb as cn,G as xr,Ga as Xo,Gb as nm,H as xg,Ha as qg,I as Ng,Ia as Qe,J as jn,K as wt,Ka as il,Kb as Yi,L as Zc,La as Jo,Lb as rm,M as Mg,Mb as Zo,N as Qo,Na as $g,Nb as im,O as Nr,Oa as Hi,Ob as ea,Pb as ta,Q as el,Qa as z,Qb as al,Ra as zg,Rb as na,Sb as ul,T as Mr,Tb as ra,U as ye,Ub as Xi,V as tl,Va as Gg,Vb as sm,W as kg,Wa as un,Wb as ia,Xa as Kg,Y as ve,Ya as le,Yb as om,Za as Wg,Zb as cl,_ as ne,_a as Hg,_b as kr,a as Ag,aa as sn,ab as Qg,ac as um,b as Cg,ba as $,bb as Yg,bc as cm,c as Zt,ca as Le,cb as sl,cc as Or,d as Qc,da as Og,db as Qi,e as Yc,ea as F,ec as lm,f as _t,fa as nl,fb as ol,fc as $n,g as nt,ga as S,gc as hm,h as Wo,ha as x,hb as Xg,hc as dm,i as Sg,ia as Gi,ic as Ye,j as en,ja as Fg,jc as fm,k as tn,ka as Ki,kc as Ji,l as Pr,la as Et,lc as pm,m as ee,ma as Lg,mb as Jg,mc as gm,n as P,na as Ue,nc as Zi,o as $i,oa as Pe,p as bg,pa as Wi,pb as jt,pc as sa,q as Rg,qa as Ug,r as O,ra as Bn,s as Ho,sa as It,t as He,ta as qn,tb as Zg,u as zi,uc as mm,v as Dg,vb as em,vc as ym,w as Xc,wb as tm,x as Pg,xc as zn,ya as on,yc as vm,z as Vg,za as jg,zc as oa}from"./chunk-5J3ZMGMD.js";import{G as ae,H as Gn,K as At,L as ua,M as ts,N as Tm,O as Am,P as ln,Q as je,c as _m,f as ll,g as wm,h as es,l as hl,m as aa,n as Em,o as Im,x as dl}from"./chunk-FNBMN5FH.js";import{a as D,b as se,c as Tg,e as Hc,f as m}from"./chunk-CQCHLVVT.js";var rs=class{},ha=class{},dn=class n{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?typeof e=="string"?this.lazyInit=()=>{this.headers=new Map,e.split(`
`).forEach(t=>{let r=t.indexOf(":");if(r>0){let i=t.slice(0,r),s=i.toLowerCase(),o=t.slice(r+1).trim();this.maybeSetNormalizedName(i,s),this.headers.has(s)?this.headers.get(s).push(o):this.headers.set(s,[o])}})}:typeof Headers<"u"&&e instanceof Headers?(this.headers=new Map,e.forEach((t,r)=>{this.setHeaderEntries(r,t)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(e).forEach(([t,r])=>{this.setHeaderEntries(t,r)})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();let t=this.headers.get(e.toLowerCase());return t&&t.length>0?t[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,t){return this.clone({name:e,value:t,op:"a"})}set(e,t){return this.clone({name:e,value:t,op:"s"})}delete(e,t){return this.clone({name:e,value:t,op:"d"})}maybeSetNormalizedName(e,t){this.normalizedNames.has(t)||this.normalizedNames.set(t,e)}init(){this.lazyInit&&(this.lazyInit instanceof n?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(t=>{this.headers.set(t,e.headers.get(t)),this.normalizedNames.set(t,e.normalizedNames.get(t))})}clone(e){let t=new n;return t.lazyInit=this.lazyInit&&this.lazyInit instanceof n?this.lazyInit:this,t.lazyUpdate=(this.lazyUpdate||[]).concat([e]),t}applyUpdate(e){let t=e.name.toLowerCase();switch(e.op){case"a":case"s":let r=e.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(e.name,t);let i=(e.op==="a"?this.headers.get(t):void 0)||[];i.push(...r),this.headers.set(t,i);break;case"d":let s=e.value;if(!s)this.headers.delete(t),this.normalizedNames.delete(t);else{let o=this.headers.get(t);if(!o)return;o=o.filter(a=>s.indexOf(a)===-1),o.length===0?(this.headers.delete(t),this.normalizedNames.delete(t)):this.headers.set(t,o)}break}}setHeaderEntries(e,t){let r=(Array.isArray(t)?t:[t]).map(s=>s.toString()),i=e.toLowerCase();this.headers.set(i,r),this.maybeSetNormalizedName(e,i)}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(t=>e(this.normalizedNames.get(t),this.headers.get(t)))}};var pl=class{encodeKey(e){return Cm(e)}encodeValue(e){return Cm(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}};function kT(n,e){let t=new Map;return n.length>0&&n.replace(/^\?/,"").split("&").forEach(i=>{let s=i.indexOf("="),[o,a]=s==-1?[e.decodeKey(i),""]:[e.decodeKey(i.slice(0,s)),e.decodeValue(i.slice(s+1))],u=t.get(o)||[];u.push(a),t.set(o,u)}),t}var OT=/%(\d[a-f0-9])/gi,FT={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function Cm(n){return encodeURIComponent(n).replace(OT,(e,t)=>FT[t]??e)}function ca(n){return`${n}`}var hn=class n{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new pl,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=kT(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(t=>{let r=e.fromObject[t],i=Array.isArray(r)?r.map(ca):[ca(r)];this.map.set(t,i)})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();let t=this.map.get(e);return t?t[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,t){return this.clone({param:e,value:t,op:"a"})}appendAll(e){let t=[];return Object.keys(e).forEach(r=>{let i=e[r];Array.isArray(i)?i.forEach(s=>{t.push({param:r,value:s,op:"a"})}):t.push({param:r,value:i,op:"a"})}),this.clone(t)}set(e,t){return this.clone({param:e,value:t,op:"s"})}delete(e,t){return this.clone({param:e,value:t,op:"d"})}toString(){return this.init(),this.keys().map(e=>{let t=this.encoder.encodeKey(e);return this.map.get(e).map(r=>t+"="+this.encoder.encodeValue(r)).join("&")}).filter(e=>e!=="").join("&")}clone(e){let t=new n({encoder:this.encoder});return t.cloneFrom=this.cloneFrom||this,t.updates=(this.updates||[]).concat(e),t}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":let t=(e.op==="a"?this.map.get(e.param):void 0)||[];t.push(ca(e.value)),this.map.set(e.param,t);break;case"d":if(e.value!==void 0){let r=this.map.get(e.param)||[],i=r.indexOf(ca(e.value));i!==-1&&r.splice(i,1),r.length>0?this.map.set(e.param,r):this.map.delete(e.param)}else{this.map.delete(e.param);break}}}),this.cloneFrom=this.updates=null)}};var gl=class{constructor(){this.map=new Map}set(e,t){return this.map.set(e,t),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}};function LT(n){switch(n){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function Sm(n){return typeof ArrayBuffer<"u"&&n instanceof ArrayBuffer}function bm(n){return typeof Blob<"u"&&n instanceof Blob}function Rm(n){return typeof FormData<"u"&&n instanceof FormData}function UT(n){return typeof URLSearchParams<"u"&&n instanceof URLSearchParams}var ns=class n{constructor(e,t,r,i){this.url=t,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase();let s;if(LT(this.method)||i?(this.body=r!==void 0?r:null,s=i):s=r,s&&(this.reportProgress=!!s.reportProgress,this.withCredentials=!!s.withCredentials,s.responseType&&(this.responseType=s.responseType),s.headers&&(this.headers=s.headers),s.context&&(this.context=s.context),s.params&&(this.params=s.params),this.transferCache=s.transferCache),this.headers??=new dn,this.context??=new gl,!this.params)this.params=new hn,this.urlWithParams=t;else{let o=this.params.toString();if(o.length===0)this.urlWithParams=t;else{let a=t.indexOf("?"),u=a===-1?"?":a<t.length-1?"&":"";this.urlWithParams=t+u+o}}}serializeBody(){return this.body===null?null:Sm(this.body)||bm(this.body)||Rm(this.body)||UT(this.body)||typeof this.body=="string"?this.body:this.body instanceof hn?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||Rm(this.body)?null:bm(this.body)?this.body.type||null:Sm(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof hn?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(e={}){let t=e.method||this.method,r=e.url||this.url,i=e.responseType||this.responseType,s=e.body!==void 0?e.body:this.body,o=e.withCredentials!==void 0?e.withCredentials:this.withCredentials,a=e.reportProgress!==void 0?e.reportProgress:this.reportProgress,u=e.headers||this.headers,c=e.params||this.params,l=e.context??this.context;return e.setHeaders!==void 0&&(u=Object.keys(e.setHeaders).reduce((h,d)=>h.set(d,e.setHeaders[d]),u)),e.setParams&&(c=Object.keys(e.setParams).reduce((h,d)=>h.set(d,e.setParams[d]),c)),new n(t,r,s,{params:c,headers:u,context:l,reportProgress:a,responseType:i,withCredentials:o})}},Fr=function(n){return n[n.Sent=0]="Sent",n[n.UploadProgress=1]="UploadProgress",n[n.ResponseHeader=2]="ResponseHeader",n[n.DownloadProgress=3]="DownloadProgress",n[n.Response=4]="Response",n[n.User=5]="User",n}(Fr||{}),is=class{constructor(e,t=fa.Ok,r="OK"){this.headers=e.headers||new dn,this.status=e.status!==void 0?e.status:t,this.statusText=e.statusText||r,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}},ml=class n extends is{constructor(e={}){super(e),this.type=Fr.ResponseHeader}clone(e={}){return new n({headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},Lr=class n extends is{constructor(e={}){super(e),this.type=Fr.Response,this.body=e.body!==void 0?e.body:null}clone(e={}){return new n({body:e.body!==void 0?e.body:this.body,headers:e.headers||this.headers,status:e.status!==void 0?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}},da=class extends is{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${e.url||"(unknown url)"}`:this.message=`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}},fa=function(n){return n[n.Continue=100]="Continue",n[n.SwitchingProtocols=101]="SwitchingProtocols",n[n.Processing=102]="Processing",n[n.EarlyHints=103]="EarlyHints",n[n.Ok=200]="Ok",n[n.Created=201]="Created",n[n.Accepted=202]="Accepted",n[n.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",n[n.NoContent=204]="NoContent",n[n.ResetContent=205]="ResetContent",n[n.PartialContent=206]="PartialContent",n[n.MultiStatus=207]="MultiStatus",n[n.AlreadyReported=208]="AlreadyReported",n[n.ImUsed=226]="ImUsed",n[n.MultipleChoices=300]="MultipleChoices",n[n.MovedPermanently=301]="MovedPermanently",n[n.Found=302]="Found",n[n.SeeOther=303]="SeeOther",n[n.NotModified=304]="NotModified",n[n.UseProxy=305]="UseProxy",n[n.Unused=306]="Unused",n[n.TemporaryRedirect=307]="TemporaryRedirect",n[n.PermanentRedirect=308]="PermanentRedirect",n[n.BadRequest=400]="BadRequest",n[n.Unauthorized=401]="Unauthorized",n[n.PaymentRequired=402]="PaymentRequired",n[n.Forbidden=403]="Forbidden",n[n.NotFound=404]="NotFound",n[n.MethodNotAllowed=405]="MethodNotAllowed",n[n.NotAcceptable=406]="NotAcceptable",n[n.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",n[n.RequestTimeout=408]="RequestTimeout",n[n.Conflict=409]="Conflict",n[n.Gone=410]="Gone",n[n.LengthRequired=411]="LengthRequired",n[n.PreconditionFailed=412]="PreconditionFailed",n[n.PayloadTooLarge=413]="PayloadTooLarge",n[n.UriTooLong=414]="UriTooLong",n[n.UnsupportedMediaType=415]="UnsupportedMediaType",n[n.RangeNotSatisfiable=416]="RangeNotSatisfiable",n[n.ExpectationFailed=417]="ExpectationFailed",n[n.ImATeapot=418]="ImATeapot",n[n.MisdirectedRequest=421]="MisdirectedRequest",n[n.UnprocessableEntity=422]="UnprocessableEntity",n[n.Locked=423]="Locked",n[n.FailedDependency=424]="FailedDependency",n[n.TooEarly=425]="TooEarly",n[n.UpgradeRequired=426]="UpgradeRequired",n[n.PreconditionRequired=428]="PreconditionRequired",n[n.TooManyRequests=429]="TooManyRequests",n[n.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",n[n.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",n[n.InternalServerError=500]="InternalServerError",n[n.NotImplemented=501]="NotImplemented",n[n.BadGateway=502]="BadGateway",n[n.ServiceUnavailable=503]="ServiceUnavailable",n[n.GatewayTimeout=504]="GatewayTimeout",n[n.HttpVersionNotSupported=505]="HttpVersionNotSupported",n[n.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",n[n.InsufficientStorage=507]="InsufficientStorage",n[n.LoopDetected=508]="LoopDetected",n[n.NotExtended=510]="NotExtended",n[n.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",n}(fa||{});function fl(n,e){return{body:e,headers:n.headers,context:n.context,observe:n.observe,params:n.params,reportProgress:n.reportProgress,responseType:n.responseType,withCredentials:n.withCredentials,transferCache:n.transferCache}}var jT=(()=>{let e=class e{constructor(r){this.handler=r}request(r,i,s={}){let o;if(r instanceof ns)o=r;else{let c;s.headers instanceof dn?c=s.headers:c=new dn(s.headers);let l;s.params&&(s.params instanceof hn?l=s.params:l=new hn({fromObject:s.params})),o=new ns(r,i,s.body!==void 0?s.body:null,{headers:c,context:s.context,params:l,reportProgress:s.reportProgress,responseType:s.responseType||"json",withCredentials:s.withCredentials,transferCache:s.transferCache})}let a=P(o).pipe(nn(c=>this.handler.handle(c)));if(r instanceof ns||s.observe==="events")return a;let u=a.pipe(Ge(c=>c instanceof Lr));switch(s.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":return u.pipe(O(c=>{if(c.body!==null&&!(c.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return c.body}));case"blob":return u.pipe(O(c=>{if(c.body!==null&&!(c.body instanceof Blob))throw new Error("Response is not a Blob.");return c.body}));case"text":return u.pipe(O(c=>{if(c.body!==null&&typeof c.body!="string")throw new Error("Response is not a string.");return c.body}));case"json":default:return u.pipe(O(c=>c.body))}case"response":return u;default:throw new Error(`Unreachable: unhandled observe type ${s.observe}}`)}}delete(r,i={}){return this.request("DELETE",r,i)}get(r,i={}){return this.request("GET",r,i)}head(r,i={}){return this.request("HEAD",r,i)}jsonp(r,i){return this.request("JSONP",r,{params:new hn().append(i,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(r,i={}){return this.request("OPTIONS",r,i)}patch(r,i,s={}){return this.request("PATCH",r,fl(s,i))}post(r,i,s={}){return this.request("POST",r,fl(s,i))}put(r,i,s={}){return this.request("PUT",r,fl(s,i))}};e.\u0275fac=function(i){return new(i||e)(S(rs))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})();function Lm(n,e){return e(n)}function BT(n,e){return(t,r)=>e.intercept(t,{handle:i=>n(i,r)})}function qT(n,e,t){return(r,i)=>It(t,()=>e(r,s=>n(s,i)))}var $T=new F(""),yl=new F(""),Um=new F(""),zT=new F("");function GT(){let n=null;return(e,t)=>{n===null&&(n=(x($T,{optional:!0})??[]).reduceRight(BT,Lm));let r=x(Qi),i=r.add();return n(e,t).pipe(jn(()=>r.remove(i)))}}var Dm=(()=>{let e=class e extends rs{constructor(r,i){super(),this.backend=r,this.injector=i,this.chain=null,this.pendingTasks=x(Qi);let s=x(zT,{optional:!0});this.backend=s??r}handle(r){if(this.chain===null){let s=Array.from(new Set([...this.injector.get(yl),...this.injector.get(Um,[])]));this.chain=s.reduceRight((o,a)=>qT(o,a,this.injector),Lm)}let i=this.pendingTasks.add();return this.chain(r,s=>this.backend.handle(s)).pipe(jn(()=>this.pendingTasks.remove(i)))}};e.\u0275fac=function(i){return new(i||e)(S(ha),S(Bn))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})();var KT=/^\)\]\}',?\n/;function WT(n){return"responseURL"in n&&n.responseURL?n.responseURL:/^X-Request-URL:/m.test(n.getAllResponseHeaders())?n.getResponseHeader("X-Request-URL"):null}var Pm=(()=>{let e=class e{constructor(r){this.xhrFactory=r}handle(r){if(r.method==="JSONP")throw new ne(-2800,!1);let i=this.xhrFactory;return(i.\u0275loadImpl?ee(i.\u0275loadImpl()):P(null)).pipe(ye(()=>new Zt(o=>{let a=i.build();if(a.open(r.method,r.urlWithParams),r.withCredentials&&(a.withCredentials=!0),r.headers.forEach((y,I)=>a.setRequestHeader(y,I.join(","))),r.headers.has("Accept")||a.setRequestHeader("Accept","application/json, text/plain, */*"),!r.headers.has("Content-Type")){let y=r.detectContentTypeHeader();y!==null&&a.setRequestHeader("Content-Type",y)}if(r.responseType){let y=r.responseType.toLowerCase();a.responseType=y!=="json"?y:"text"}let u=r.serializeBody(),c=null,l=()=>{if(c!==null)return c;let y=a.statusText||"OK",I=new dn(a.getAllResponseHeaders()),k=WT(a)||r.url;return c=new ml({headers:I,status:a.status,statusText:y,url:k}),c},h=()=>{let{headers:y,status:I,statusText:k,url:R}=l(),M=null;I!==fa.NoContent&&(M=typeof a.response>"u"?a.responseText:a.response),I===0&&(I=M?fa.Ok:0);let j=I>=200&&I<300;if(r.responseType==="json"&&typeof M=="string"){let K=M;M=M.replace(KT,"");try{M=M!==""?JSON.parse(M):null}catch(ce){M=K,j&&(j=!1,M={error:ce,text:M})}}j?(o.next(new Lr({body:M,headers:y,status:I,statusText:k,url:R||void 0})),o.complete()):o.error(new da({error:M,headers:y,status:I,statusText:k,url:R||void 0}))},d=y=>{let{url:I}=l(),k=new da({error:y,status:a.status||0,statusText:a.statusText||"Unknown Error",url:I||void 0});o.error(k)},f=!1,E=y=>{f||(o.next(l()),f=!0);let I={type:Fr.DownloadProgress,loaded:y.loaded};y.lengthComputable&&(I.total=y.total),r.responseType==="text"&&a.responseText&&(I.partialText=a.responseText),o.next(I)},w=y=>{let I={type:Fr.UploadProgress,loaded:y.loaded};y.lengthComputable&&(I.total=y.total),o.next(I)};return a.addEventListener("load",h),a.addEventListener("error",d),a.addEventListener("timeout",d),a.addEventListener("abort",d),r.reportProgress&&(a.addEventListener("progress",E),u!==null&&a.upload&&a.upload.addEventListener("progress",w)),a.send(u),o.next({type:Fr.Sent}),()=>{a.removeEventListener("error",d),a.removeEventListener("abort",d),a.removeEventListener("load",h),a.removeEventListener("timeout",d),r.reportProgress&&(a.removeEventListener("progress",E),u!==null&&a.upload&&a.upload.removeEventListener("progress",w)),a.readyState!==a.DONE&&a.abort()}})))}};e.\u0275fac=function(i){return new(i||e)(S(oa))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})(),jm=new F(""),HT="XSRF-TOKEN",QT=new F("",{providedIn:"root",factory:()=>HT}),YT="X-XSRF-TOKEN",XT=new F("",{providedIn:"root",factory:()=>YT}),pa=class{},JT=(()=>{let e=class e{constructor(r,i,s){this.doc=r,this.platform=i,this.cookieName=s,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let r=this.doc.cookie||"";return r!==this.lastCookieString&&(this.parseCount++,this.lastToken=sa(r,this.cookieName),this.lastCookieString=r),this.lastToken}};e.\u0275fac=function(i){return new(i||e)(S(Ye),S(Qe),S(QT))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})();function ZT(n,e){let t=n.url.toLowerCase();if(!x(jm)||n.method==="GET"||n.method==="HEAD"||t.startsWith("http://")||t.startsWith("https://"))return e(n);let r=x(pa).getToken(),i=x(XT);return r!=null&&!n.headers.has(i)&&(n=n.clone({headers:n.headers.set(i,r)})),e(n)}var Bm=function(n){return n[n.Interceptors=0]="Interceptors",n[n.LegacyInterceptors=1]="LegacyInterceptors",n[n.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",n[n.NoXsrfProtection=3]="NoXsrfProtection",n[n.JsonpSupport=4]="JsonpSupport",n[n.RequestsMadeViaParent=5]="RequestsMadeViaParent",n[n.Fetch=6]="Fetch",n}(Bm||{});function eA(n,e){return{\u0275kind:n,\u0275providers:e}}function tA(...n){let e=[jT,Pm,Dm,{provide:rs,useExisting:Dm},{provide:ha,useExisting:Pm},{provide:yl,useValue:ZT,multi:!0},{provide:jm,useValue:!0},{provide:pa,useClass:JT}];for(let t of n)e.push(...t.\u0275providers);return Wi(e)}var Vm=new F("");function nA(){return eA(Bm.LegacyInterceptors,[{provide:Vm,useFactory:GT},{provide:yl,useExisting:Vm,multi:!0}])}var _P=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Ue({type:e}),e.\u0275inj=Le({providers:[tA(nA())]});let n=e;return n})();var xm="b",Nm="h",Mm="s",km="st",Om="u",Fm="rt",la=new F(""),rA=["GET","HEAD"];function iA(n,e){let l=x(la),{isCacheActive:t}=l,r=Tg(l,["isCacheActive"]),{transferCache:i,method:s}=n;if(!t||s==="POST"&&!r.includePostRequests&&!i||s!=="POST"&&!rA.includes(s)||n.headers.has("authorization")||n.headers.has("proxy-authorization")||i===!1||r.filter?.(n)===!1)return e(n);let o=x(Jo),a=oA(n),u=o.get(a,null),c=r.includeHeaders;if(typeof i=="object"&&i.includeHeaders&&(c=i.includeHeaders),u){let{[xm]:h,[Fm]:d,[Nm]:f,[Mm]:E,[km]:w,[Om]:y}=u,I=h;switch(d){case"arraybuffer":I=new TextEncoder().encode(h).buffer;break;case"blob":I=new Blob([h]);break}let k=new dn(f);return P(new Lr({body:I,headers:k,status:E,statusText:w,url:y}))}return e(n).pipe(ve(h=>{h instanceof Lr&&o.set(a,{[xm]:h.body,[Nm]:sA(h.headers,c),[Mm]:h.status,[km]:h.statusText,[Om]:h.url||"",[Fm]:n.responseType})}))}function sA(n,e){if(!e)return{};let t={};for(let r of e){let i=n.getAll(r);i!==null&&(t[r]=i)}return t}function oA(n){let{params:e,method:t,responseType:r,url:i,body:s}=n,o=e.keys().sort().map(l=>`${l}=${e.getAll(l)}`).join("&"),u=[t,r,i,typeof s=="string"?s:"",o].join("|"),c=aA(u);return c}function aA(n){let e=0;for(let t of n)e=Math.imul(31,e)+t.charCodeAt(0)<<0;return e+=2147483648,e.toString()}function qm(n){return[{provide:la,useFactory:()=>(Kg("NgHttpTransferCache"),D({isCacheActive:!0},n))},{provide:Um,useValue:iA,multi:!0,deps:[Jo,la]},{provide:ra,multi:!0,useFactory:()=>{let e=x(Xi),t=x(la);return()=>{sm(e).then(()=>{t.isCacheActive=!1})}}}]}var wl=class extends dm{constructor(){super(...arguments),this.supportsDOMEvents=!0}},El=class n extends wl{static makeCurrent(){hm(new n)}onAndCancel(e,t,r){return e.addEventListener(t,r),()=>{e.removeEventListener(t,r)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return t=t||this.getDefaultDocument(),t.createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return t==="window"?window:t==="document"?e:t==="body"?e.body:null}getBaseHref(e){let t=cA();return t==null?null:lA(t)}resetBaseElement(){ss=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return sa(document.cookie,e)}},ss=null;function cA(){return ss=ss||document.querySelector("base"),ss?ss.getAttribute("href"):null}function lA(n){return new URL(n,document.baseURI).pathname}var Il=class{addToWindow(e){rn.getAngularTestability=(r,i=!0)=>{let s=e.findTestabilityInTree(r,i);if(s==null)throw new ne(5103,!1);return s},rn.getAllAngularTestabilities=()=>e.getAllTestabilities(),rn.getAllAngularRootElements=()=>e.getAllRootElements();let t=r=>{let i=rn.getAllAngularTestabilities(),s=i.length,o=function(){s--,s==0&&r()};i.forEach(a=>{a.whenStable(o)})};rn.frameworkStabilizers||(rn.frameworkStabilizers=[]),rn.frameworkStabilizers.push(t)}findTestabilityInTree(e,t,r){if(t==null)return null;let i=e.getTestability(t);return i??(r?$n().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},hA=(()=>{let e=class e{build(){return new XMLHttpRequest}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})(),Tl=new F(""),Km=(()=>{let e=class e{constructor(r,i){this._zone=i,this._eventNameToPlugin=new Map,r.forEach(s=>{s.manager=this}),this._plugins=r.slice().reverse()}addEventListener(r,i,s){return this._findPluginFor(i).addEventListener(r,i,s)}getZone(){return this._zone}_findPluginFor(r){let i=this._eventNameToPlugin.get(r);if(i)return i;if(i=this._plugins.find(o=>o.supports(r)),!i)throw new ne(5101,!1);return this._eventNameToPlugin.set(r,i),i}};e.\u0275fac=function(i){return new(i||e)(S(Tl),S(le))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})(),ga=class{constructor(e){this._doc=e}},vl="ng-app-id",Wm=(()=>{let e=class e{constructor(r,i,s,o={}){this.doc=r,this.appId=i,this.nonce=s,this.platformId=o,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=zn(o),this.resetHostNodes()}addStyles(r){for(let i of r)this.changeUsageCount(i,1)===1&&this.onStyleAdded(i)}removeStyles(r){for(let i of r)this.changeUsageCount(i,-1)<=0&&this.onStyleRemoved(i)}ngOnDestroy(){let r=this.styleNodesInDOM;r&&(r.forEach(i=>i.remove()),r.clear());for(let i of this.getAllStyles())this.onStyleRemoved(i);this.resetHostNodes()}addHost(r){this.hostNodes.add(r);for(let i of this.getAllStyles())this.addStyleToHost(r,i)}removeHost(r){this.hostNodes.delete(r)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(r){for(let i of this.hostNodes)this.addStyleToHost(i,r)}onStyleRemoved(r){let i=this.styleRef;i.get(r)?.elements?.forEach(s=>s.remove()),i.delete(r)}collectServerRenderedStyles(){let r=this.doc.head?.querySelectorAll(`style[${vl}="${this.appId}"]`);if(r?.length){let i=new Map;return r.forEach(s=>{s.textContent!=null&&i.set(s.textContent,s)}),i}return null}changeUsageCount(r,i){let s=this.styleRef;if(s.has(r)){let o=s.get(r);return o.usage+=i,o.usage}return s.set(r,{usage:i,elements:[]}),i}getStyleElement(r,i){let s=this.styleNodesInDOM,o=s?.get(i);if(o?.parentNode===r)return s.delete(i),o.removeAttribute(vl),o;{let a=this.doc.createElement("style");return this.nonce&&a.setAttribute("nonce",this.nonce),a.textContent=i,this.platformIsServer&&a.setAttribute(vl,this.appId),r.appendChild(a),a}}addStyleToHost(r,i){let s=this.getStyleElement(r,i),o=this.styleRef,a=o.get(i)?.elements;a?a.push(s):o.set(i,{elements:[s],usage:1})}resetHostNodes(){let r=this.hostNodes;r.clear(),r.add(this.doc.head)}};e.\u0275fac=function(i){return new(i||e)(S(Ye),S(Xo),S(il,8),S(Qe))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})(),_l={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Sl=/%COMP%/g,Hm="%COMP%",dA=`_nghost-${Hm}`,fA=`_ngcontent-${Hm}`,pA=!0,gA=new F("",{providedIn:"root",factory:()=>pA});function mA(n){return fA.replace(Sl,n)}function yA(n){return dA.replace(Sl,n)}function Qm(n,e){return e.map(t=>t.replace(Sl,n))}var $m=(()=>{let e=class e{constructor(r,i,s,o,a,u,c,l=null){this.eventManager=r,this.sharedStylesHost=i,this.appId=s,this.removeStylesOnCompDestroy=o,this.doc=a,this.platformId=u,this.ngZone=c,this.nonce=l,this.rendererByCompId=new Map,this.platformIsServer=zn(u),this.defaultRenderer=new os(r,a,c,this.platformIsServer)}createRenderer(r,i){if(!r||!i)return this.defaultRenderer;this.platformIsServer&&i.encapsulation===Ki.ShadowDom&&(i=se(D({},i),{encapsulation:Ki.Emulated}));let s=this.getOrCreateRenderer(r,i);return s instanceof ma?s.applyToHost(r):s instanceof as&&s.applyStyles(),s}getOrCreateRenderer(r,i){let s=this.rendererByCompId,o=s.get(i.id);if(!o){let a=this.doc,u=this.ngZone,c=this.eventManager,l=this.sharedStylesHost,h=this.removeStylesOnCompDestroy,d=this.platformIsServer;switch(i.encapsulation){case Ki.Emulated:o=new ma(c,l,i,this.appId,h,a,u,d);break;case Ki.ShadowDom:return new Al(c,l,r,i,a,u,this.nonce,d);default:o=new as(c,l,i,h,a,u,d);break}s.set(i.id,o)}return o}ngOnDestroy(){this.rendererByCompId.clear()}};e.\u0275fac=function(i){return new(i||e)(S(Km),S(Wm),S(Xo),S(gA),S(Ye),S(Qe),S(le),S(il))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})(),os=class{constructor(e,t,r,i){this.eventManager=e,this.doc=t,this.ngZone=r,this.platformIsServer=i,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(e,t){return t?this.doc.createElementNS(_l[t]||t,e):this.doc.createElement(e)}createComment(e){return this.doc.createComment(e)}createText(e){return this.doc.createTextNode(e)}appendChild(e,t){(zm(e)?e.content:e).appendChild(t)}insertBefore(e,t,r){e&&(zm(e)?e.content:e).insertBefore(t,r)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let r=typeof e=="string"?this.doc.querySelector(e):e;if(!r)throw new ne(-5104,!1);return t||(r.textContent=""),r}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,r,i){if(i){t=i+":"+t;let s=_l[i];s?e.setAttributeNS(s,t,r):e.setAttribute(t,r)}else e.setAttribute(t,r)}removeAttribute(e,t,r){if(r){let i=_l[r];i?e.removeAttributeNS(i,t):e.removeAttribute(`${r}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,r,i){i&(Hi.DashCase|Hi.Important)?e.style.setProperty(t,r,i&Hi.Important?"important":""):e.style[t]=r}removeStyle(e,t,r){r&Hi.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,r){e!=null&&(e[t]=r)}setValue(e,t){e.nodeValue=t}listen(e,t,r){if(typeof e=="string"&&(e=$n().getGlobalEventTarget(this.doc,e),!e))throw new Error(`Unsupported event target ${e} for event ${t}`);return this.eventManager.addEventListener(e,t,this.decoratePreventDefault(r))}decoratePreventDefault(e){return t=>{if(t==="__ngUnwrap__")return e;(this.platformIsServer?this.ngZone.runGuarded(()=>e(t)):e(t))===!1&&t.preventDefault()}}};function zm(n){return n.tagName==="TEMPLATE"&&n.content!==void 0}var Al=class extends os{constructor(e,t,r,i,s,o,a,u){super(e,s,o,u),this.sharedStylesHost=t,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let c=Qm(i.id,i.styles);for(let l of c){let h=document.createElement("style");a&&h.setAttribute("nonce",a),h.textContent=l,this.shadowRoot.appendChild(h)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,r){return super.insertBefore(this.nodeOrShadowRoot(e),t,r)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},as=class extends os{constructor(e,t,r,i,s,o,a,u){super(e,s,o,a),this.sharedStylesHost=t,this.removeStylesOnCompDestroy=i,this.styles=u?Qm(u,r.styles):r.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},ma=class extends as{constructor(e,t,r,i,s,o,a,u){let c=i+"-"+r.id;super(e,t,r,s,o,a,u,c),this.contentAttr=mA(c),this.hostAttr=yA(c)}applyToHost(e){this.applyStyles(),this.setAttribute(e,this.hostAttr,"")}createElement(e,t){let r=super.createElement(e,t);return super.setAttribute(r,this.contentAttr,""),r}},vA=(()=>{let e=class e extends ga{constructor(r){super(r)}supports(r){return!0}addEventListener(r,i,s){return r.addEventListener(i,s,!1),()=>this.removeEventListener(r,i,s)}removeEventListener(r,i,s){return r.removeEventListener(i,s)}};e.\u0275fac=function(i){return new(i||e)(S(Ye))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})(),Gm=["alt","control","meta","shift"],_A={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},wA={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey},EA=(()=>{let e=class e extends ga{constructor(r){super(r)}supports(r){return e.parseEventName(r)!=null}addEventListener(r,i,s){let o=e.parseEventName(i),a=e.eventCallback(o.fullKey,s,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>$n().onAndCancel(r,o.domEventName,a))}static parseEventName(r){let i=r.toLowerCase().split("."),s=i.shift();if(i.length===0||!(s==="keydown"||s==="keyup"))return null;let o=e._normalizeKey(i.pop()),a="",u=i.indexOf("code");if(u>-1&&(i.splice(u,1),a="code."),Gm.forEach(l=>{let h=i.indexOf(l);h>-1&&(i.splice(h,1),a+=l+".")}),a+=o,i.length!=0||o.length===0)return null;let c={};return c.domEventName=s,c.fullKey=a,c}static matchEventFullKeyCode(r,i){let s=_A[r.key]||r.key,o="";return i.indexOf("code.")>-1&&(s=r.code,o="code."),s==null||!s?!1:(s=s.toLowerCase(),s===" "?s="space":s==="."&&(s="dot"),Gm.forEach(a=>{if(a!==s){let u=wA[a];u(r)&&(o+=a+".")}}),o+=s,o===i)}static eventCallback(r,i,s){return o=>{e.matchEventFullKeyCode(o,r)&&s.runGuarded(()=>i(o))}}static _normalizeKey(r){return r==="esc"?"escape":r}};e.\u0275fac=function(i){return new(i||e)(S(Ye))},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})();function IA(){El.makeCurrent()}function TA(){return new rl}function AA(){return Bg(document),document}var CA=[{provide:Qe,useValue:ym},{provide:qg,useValue:IA,multi:!0},{provide:Ye,useFactory:AA,deps:[]}],qP=om(am,"browser",CA),SA=new F(""),bA=[{provide:ea,useClass:Il,deps:[]},{provide:im,useClass:ta,deps:[le,al,ea]},{provide:ta,useClass:ta,deps:[le,al,ea]}],RA=[{provide:Ug,useValue:"root"},{provide:rl,useFactory:TA,deps:[]},{provide:Tl,useClass:vA,multi:!0,deps:[Ye,le,Qe]},{provide:Tl,useClass:EA,multi:!0,deps:[Ye]},$m,Wm,Km,{provide:Gg,useExisting:$m},{provide:oa,useClass:hA,deps:[]},[]],$P=(()=>{let e=class e{constructor(r){}static withServerTransition(r){return{ngModule:e,providers:[{provide:Xo,useValue:r.appId}]}}};e.\u0275fac=function(i){return new(i||e)(S(SA,12))},e.\u0275mod=Ue({type:e}),e.\u0275inj=Le({providers:[...RA,...bA],imports:[mm,um]});let n=e;return n})();var Ym=(()=>{let e=class e{constructor(r){this._doc=r}getTitle(){return this._doc.title}setTitle(r){this._doc.title=r||""}};e.\u0275fac=function(i){return new(i||e)(S(Ye))},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var Cl=function(n){return n[n.NoHttpTransferCache=0]="NoHttpTransferCache",n[n.HttpTransferCacheOptions=1]="HttpTransferCacheOptions",n}(Cl||{});function zP(...n){let e=[],t=new Set,r=t.has(Cl.HttpTransferCacheOptions);for(let{\u0275providers:i,\u0275kind:s}of n)t.add(s),i.length&&e.push(i);return Wi([[],cm(),t.has(Cl.NoHttpTransferCache)||r?[]:qm({}),e])}var oy=(()=>{let e=class e{constructor(r,i){this._renderer=r,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(r,i){this._renderer.setProperty(this._elementRef.nativeElement,r,i)}registerOnTouched(r){this.onTouched=r}registerOnChange(r){this.onChange=r}setDisabledState(r){this.setProperty("disabled",r)}};e.\u0275fac=function(i){return new(i||e)(z(un),z(an))},e.\u0275dir=Pe({type:e});let n=e;return n})(),Ca=(()=>{let e=class e extends oy{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=on(e)))(s||e)}})(),e.\u0275dir=Pe({type:e,features:[Tt]});let n=e;return n})(),ds=new F(""),PA={provide:ds,useExisting:sn(()=>VA),multi:!0},VA=(()=>{let e=class e extends Ca{writeValue(r){this.setProperty("checked",r)}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=on(e)))(s||e)}})(),e.\u0275dir=Pe({type:e,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(i,s){i&1&&jt("change",function(a){return s.onChange(a.target.checked)})("blur",function(){return s.onTouched()})},features:[cn([PA]),Tt]});let n=e;return n})(),xA={provide:ds,useExisting:sn(()=>ay),multi:!0};function NA(){let n=$n()?$n().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var MA=new F(""),ay=(()=>{let e=class e extends oy{constructor(r,i,s){super(r,i),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!NA())}writeValue(r){let i=r??"";this.setProperty("value",i)}_handleInput(r){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(r)}_compositionStart(){this._composing=!0}_compositionEnd(r){this._composing=!1,this._compositionMode&&this.onChange(r)}};e.\u0275fac=function(i){return new(i||e)(z(un),z(an),z(MA,8))},e.\u0275dir=Pe({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&jt("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[cn([xA]),Tt]});let n=e;return n})();function fn(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function uy(n){return n!=null&&typeof n.length=="number"}var Dl=new F(""),Pl=new F(""),kA=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Xm=class{static min(e){return OA(e)}static max(e){return FA(e)}static required(e){return LA(e)}static requiredTrue(e){return UA(e)}static email(e){return jA(e)}static minLength(e){return BA(e)}static maxLength(e){return qA(e)}static pattern(e){return $A(e)}static nullValidator(e){return cy(e)}static compose(e){return gy(e)}static composeAsync(e){return my(e)}};function OA(n){return e=>{if(fn(e.value)||fn(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function FA(n){return e=>{if(fn(e.value)||fn(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}function LA(n){return fn(n.value)?{required:!0}:null}function UA(n){return n.value===!0?null:{required:!0}}function jA(n){return fn(n.value)||kA.test(n.value)?null:{email:!0}}function BA(n){return e=>fn(e.value)||!uy(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}function qA(n){return e=>uy(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}function $A(n){if(!n)return cy;let e,t;return typeof n=="string"?(t="",n.charAt(0)!=="^"&&(t+="^"),t+=n,n.charAt(n.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),r=>{if(fn(r.value))return null;let i=r.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}function cy(n){return null}function ly(n){return n!=null}function hy(n){return na(n)?ee(n):n}function dy(n){let e={};return n.forEach(t=>{e=t!=null?D(D({},e),t):e}),Object.keys(e).length===0?null:e}function fy(n,e){return e.map(t=>t(n))}function zA(n){return!n.validate}function py(n){return n.map(e=>zA(e)?e:t=>e.validate(t))}function gy(n){if(!n)return null;let e=n.filter(ly);return e.length==0?null:function(t){return dy(fy(t,e))}}function Vl(n){return n!=null?gy(py(n)):null}function my(n){if(!n)return null;let e=n.filter(ly);return e.length==0?null:function(t){let r=fy(t,e).map(hy);return Pg(r).pipe(O(dy))}}function xl(n){return n!=null?my(py(n)):null}function Jm(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function yy(n){return n._rawValidators}function vy(n){return n._rawAsyncValidators}function bl(n){return n?Array.isArray(n)?n:[n]:[]}function va(n,e){return Array.isArray(n)?n.includes(e):n===e}function Zm(n,e){let t=bl(e);return bl(n).forEach(i=>{va(t,i)||t.push(i)}),t}function ey(n,e){return bl(e).filter(t=>!va(n,t))}var _a=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Vl(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=xl(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},Wn=class extends _a{get formDirective(){return null}get path(){return null}},hs=class extends _a{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},Rl=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},GA={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},aV=se(D({},GA),{"[class.ng-submitted]":"isSubmitted"}),uV=(()=>{let e=class e extends Rl{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(z(hs,2))},e.\u0275dir=Pe({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&Xg("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[Tt]});let n=e;return n})();var us="VALID",ya="INVALID",Ur="PENDING",cs="DISABLED";function _y(n){return(Sa(n)?n.validators:n)||null}function KA(n){return Array.isArray(n)?Vl(n):n||null}function wy(n,e){return(Sa(e)?e.asyncValidators:n)||null}function WA(n){return Array.isArray(n)?xl(n):n||null}function Sa(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function HA(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new ne(1e3,"");if(!r[t])throw new ne(1001,"")}function QA(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new ne(1002,"")})}var wa=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===us}get invalid(){return this.status===ya}get pending(){return this.status==Ur}get disabled(){return this.status===cs}get enabled(){return this.status!==cs}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(Zm(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(Zm(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(ey(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(ey(e,this._rawAsyncValidators))}hasValidator(e){return va(this._rawValidators,e)}hasAsyncValidator(e){return va(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Ur,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=cs,this.errors=null,this._forEachChild(r=>{r.disable(se(D({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(se(D({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=us,this._forEachChild(r=>{r.enable(se(D({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(se(D({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===us||this.status===Ur)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?cs:us}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Ur,this._hasOwnPendingAsyncValidator=!0;let t=hy(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new rt,this.statusChanges=new rt}_calculateStatus(){return this._allControlsDisabled()?cs:this.errors?ya:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Ur)?Ur:this._anyControlsHaveStatus(ya)?ya:us}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Sa(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=KA(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=WA(this._rawAsyncValidators)}},Ea=class extends wa{constructor(e,t,r){super(_y(t),wy(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){QA(this,!0,e),Object.keys(e).forEach(r=>{HA(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var ba=new F("CallSetDisabledState",{providedIn:"root",factory:()=>Nl}),Nl="always";function YA(n,e){return[...e.path,n]}function Ia(n,e,t=Nl){Ml(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),JA(n,e),e0(n,e),ZA(n,e),XA(n,e)}function ty(n,e,t=!0){let r=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(r),e.valueAccessor.registerOnTouched(r)),Aa(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function Ta(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function XA(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function Ml(n,e){let t=yy(n);e.validator!==null?n.setValidators(Jm(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=vy(n);e.asyncValidator!==null?n.setAsyncValidators(Jm(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();Ta(e._rawValidators,i),Ta(e._rawAsyncValidators,i)}function Aa(n,e){let t=!1;if(n!==null){if(e.validator!==null){let i=yy(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.validator);s.length!==i.length&&(t=!0,n.setValidators(s))}}if(e.asyncValidator!==null){let i=vy(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.asyncValidator);s.length!==i.length&&(t=!0,n.setAsyncValidators(s))}}}let r=()=>{};return Ta(e._rawValidators,r),Ta(e._rawAsyncValidators,r),t}function JA(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&Ey(n,e)})}function ZA(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&Ey(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function Ey(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function e0(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function Iy(n,e){n==null,Ml(n,e)}function t0(n,e){return Aa(n,e)}function n0(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function r0(n){return Object.getPrototypeOf(n.constructor)===Ca}function Ty(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function i0(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===ay?t=s:r0(s)?r=s:i=s}),i||r||t||null}function s0(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}var o0={provide:Wn,useExisting:sn(()=>a0)},ls=Promise.resolve(),a0=(()=>{let e=class e extends Wn{constructor(r,i,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._directives=new Set,this.ngSubmit=new rt,this.form=new Ea({},Vl(r),xl(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(r){ls.then(()=>{let i=this._findContainer(r.path);r.control=i.registerControl(r.name,r.control),Ia(r.control,r,this.callSetDisabledState),r.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(r)})}getControl(r){return this.form.get(r.path)}removeControl(r){ls.then(()=>{let i=this._findContainer(r.path);i&&i.removeControl(r.name),this._directives.delete(r)})}addFormGroup(r){ls.then(()=>{let i=this._findContainer(r.path),s=new Ea({});Iy(s,r),i.registerControl(r.name,s),s.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(r){ls.then(()=>{let i=this._findContainer(r.path);i&&i.removeControl(r.name)})}getFormGroup(r){return this.form.get(r.path)}updateModel(r,i){ls.then(()=>{this.form.get(r.path).setValue(i)})}setValue(r){this.control.setValue(r)}onSubmit(r){return this.submitted=!0,Ty(this.form,this._directives),this.ngSubmit.emit(r),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(r){return r.pop(),r.length?this.form.get(r):this.form}};e.\u0275fac=function(i){return new(i||e)(z(Dl,10),z(Pl,10),z(ba,8))},e.\u0275dir=Pe({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,s){i&1&&jt("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{options:[Et.None,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[cn([o0]),Tt]});let n=e;return n})();function ny(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function ry(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var Ay=class extends wa{constructor(e=null,t,r){super(_y(t),wy(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Sa(t)&&(t.nonNullable||t.initialValueIsDefault)&&(ry(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){ny(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){ny(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){ry(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var u0=n=>n instanceof Ay;var c0={provide:hs,useExisting:sn(()=>l0)},iy=Promise.resolve(),l0=(()=>{let e=class e extends hs{constructor(r,i,s,o,a,u){super(),this._changeDetectorRef=a,this.callSetDisabledState=u,this.control=new Ay,this._registered=!1,this.name="",this.update=new rt,this._parent=r,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=i0(this,o)}ngOnChanges(r){if(this._checkForErrors(),!this._registered||"name"in r){if(this._registered&&(this._checkName(),this.formDirective)){let i=r.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in r&&this._updateDisabled(r),n0(r,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){Ia(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(r){iy.then(()=>{this.control.setValue(r,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(r){let i=r.isDisabled.currentValue,s=i!==0&&Or(i);iy.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(r){return this._parent?YA(r,this._parent):[r]}};e.\u0275fac=function(i){return new(i||e)(z(Wn,9),z(Dl,10),z(Pl,10),z(ds,10),z(kr,8),z(ba,8))},e.\u0275dir=Pe({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[Et.None,"disabled","isDisabled"],model:[Et.None,"ngModel","model"],options:[Et.None,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[cn([c0]),Tt,qn]});let n=e;return n})();var h0={provide:Wn,useExisting:sn(()=>d0)},d0=(()=>{let e=class e extends Wn{constructor(r,i,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new rt,this._setValidators(r),this._setAsyncValidators(i)}ngOnChanges(r){this._checkFormPresent(),r.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Aa(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(r){let i=this.form.get(r.path);return Ia(i,r,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(r),i}getControl(r){return this.form.get(r.path)}removeControl(r){ty(r.control||null,r,!1),s0(this.directives,r)}addFormGroup(r){this._setUpFormContainer(r)}removeFormGroup(r){this._cleanUpFormContainer(r)}getFormGroup(r){return this.form.get(r.path)}addFormArray(r){this._setUpFormContainer(r)}removeFormArray(r){this._cleanUpFormContainer(r)}getFormArray(r){return this.form.get(r.path)}updateModel(r,i){this.form.get(r.path).setValue(i)}onSubmit(r){return this.submitted=!0,Ty(this.form,this.directives),this.ngSubmit.emit(r),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1}_updateDomValue(){this.directives.forEach(r=>{let i=r.control,s=this.form.get(r.path);i!==s&&(ty(i||null,r),u0(s)&&(Ia(s,r,this.callSetDisabledState),r.control=s))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(r){let i=this.form.get(r.path);Iy(i,r),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(r){if(this.form){let i=this.form.get(r.path);i&&t0(i,r)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Ml(this.form,this),this._oldForm&&Aa(this._oldForm,this)}_checkFormPresent(){this.form}};e.\u0275fac=function(i){return new(i||e)(z(Dl,10),z(Pl,10),z(ba,8))},e.\u0275dir=Pe({type:e,selectors:[["","formGroup",""]],hostBindings:function(i,s){i&1&&jt("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{form:[Et.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[cn([h0]),Tt,qn]});let n=e;return n})();var f0={provide:ds,useExisting:sn(()=>Sy),multi:!0};function Cy(n,e){return n==null?`${e}`:(e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function p0(n){return n.split(":")[0]}var Sy=(()=>{let e=class e extends Ca{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(r){this._compareWith=r}writeValue(r){this.value=r;let i=this._getOptionId(r),s=Cy(i,r);this.setProperty("value",s)}registerOnChange(r){this.onChange=i=>{this.value=this._getOptionValue(i),r(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(r){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i),r))return i;return null}_getOptionValue(r){let i=p0(r);return this._optionMap.has(i)?this._optionMap.get(i):r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=on(e)))(s||e)}})(),e.\u0275dir=Pe({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(i,s){i&1&&jt("change",function(a){return s.onChange(a.target.value)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[cn([f0]),Tt]});let n=e;return n})(),lV=(()=>{let e=class e{constructor(r,i,s){this._element=r,this._renderer=i,this._select=s,this._select&&(this.id=this._select._registerOption())}set ngValue(r){this._select!=null&&(this._select._optionMap.set(this.id,r),this._setElementValue(Cy(this.id,r)),this._select.writeValue(this._select.value))}set value(r){this._setElementValue(r),this._select&&this._select.writeValue(this._select.value)}_setElementValue(r){this._renderer.setProperty(this._element.nativeElement,"value",r)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};e.\u0275fac=function(i){return new(i||e)(z(an),z(un),z(Sy,9))},e.\u0275dir=Pe({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let n=e;return n})(),g0={provide:ds,useExisting:sn(()=>by),multi:!0};function sy(n,e){return n==null?`${e}`:(typeof e=="string"&&(e=`'${e}'`),e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function m0(n){return n.split(":")[0]}var by=(()=>{let e=class e extends Ca{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(r){this._compareWith=r}writeValue(r){this.value=r;let i;if(Array.isArray(r)){let s=r.map(o=>this._getOptionId(o));i=(o,a)=>{o._setSelected(s.indexOf(a.toString())>-1)}}else i=(s,o)=>{s._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(r){this.onChange=i=>{let s=[],o=i.selectedOptions;if(o!==void 0){let a=o;for(let u=0;u<a.length;u++){let c=a[u],l=this._getOptionValue(c.value);s.push(l)}}else{let a=i.options;for(let u=0;u<a.length;u++){let c=a[u];if(c.selected){let l=this._getOptionValue(c.value);s.push(l)}}}this.value=s,r(s)}}_registerOption(r){let i=(this._idCounter++).toString();return this._optionMap.set(i,r),i}_getOptionId(r){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i)._value,r))return i;return null}_getOptionValue(r){let i=m0(r);return this._optionMap.has(i)?this._optionMap.get(i)._value:r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=on(e)))(s||e)}})(),e.\u0275dir=Pe({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(i,s){i&1&&jt("change",function(a){return s.onChange(a.target)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[cn([g0]),Tt]});let n=e;return n})(),hV=(()=>{let e=class e{constructor(r,i,s){this._element=r,this._renderer=i,this._select=s,this._select&&(this.id=this._select._registerOption(this))}set ngValue(r){this._select!=null&&(this._value=r,this._setElementValue(sy(this.id,r)),this._select.writeValue(this._select.value))}set value(r){this._select?(this._value=r,this._setElementValue(sy(this.id,r)),this._select.writeValue(this._select.value)):this._setElementValue(r)}_setElementValue(r){this._renderer.setProperty(this._element.nativeElement,"value",r)}_setSelected(r){this._renderer.setProperty(this._element.nativeElement,"selected",r)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};e.\u0275fac=function(i){return new(i||e)(z(an),z(un),z(by,9))},e.\u0275dir=Pe({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let n=e;return n})();var y0=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Ue({type:e}),e.\u0275inj=Le({});let n=e;return n})();var dV=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:[{provide:ba,useValue:r.callSetDisabledState??Nl}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=Ue({type:e}),e.\u0275inj=Le({imports:[y0]});let n=e;return n})();var q="primary",bs=Symbol("RouteTitle"),Ul=class{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){let t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}};function zr(n){return new Ul(n)}function v0(n,e,t){let r=t.path.split("/");if(r.length>n.length||t.pathMatch==="full"&&(e.hasChildren()||r.length<n.length))return null;let i={};for(let s=0;s<r.length;s++){let o=r[s],a=n[s];if(o.startsWith(":"))i[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,r.length),posParams:i}}function _0(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!Ct(n[t],e[t]))return!1;return!0}function Ct(n,e){let t=n?jl(n):void 0,r=e?jl(e):void 0;if(!t||!r||t.length!=r.length)return!1;let i;for(let s=0;s<t.length;s++)if(i=t[s],!Fy(n[i],e[i]))return!1;return!0}function jl(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}function Fy(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;let t=[...n].sort(),r=[...e].sort();return t.every((i,s)=>r[s]===i)}else return n===e}function Ly(n){return n.length>0?n[n.length-1]:null}function yn(n){return bg(n)?n:na(n)?ee(Promise.resolve(n)):P(n)}var w0={exact:jy,subset:By},Uy={exact:E0,subset:I0,ignored:()=>!0};function Ry(n,e,t){return w0[t.paths](n.root,e.root,t.matrixParams)&&Uy[t.queryParams](n.queryParams,e.queryParams)&&!(t.fragment==="exact"&&n.fragment!==e.fragment)}function E0(n,e){return Ct(n,e)}function jy(n,e,t){if(!Qn(n.segments,e.segments)||!Pa(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(let r in e.children)if(!n.children[r]||!jy(n.children[r],e.children[r],t))return!1;return!0}function I0(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>Fy(n[t],e[t]))}function By(n,e,t){return qy(n,e,e.segments,t)}function qy(n,e,t,r){if(n.segments.length>t.length){let i=n.segments.slice(0,t.length);return!(!Qn(i,t)||e.hasChildren()||!Pa(i,t,r))}else if(n.segments.length===t.length){if(!Qn(n.segments,t)||!Pa(n.segments,t,r))return!1;for(let i in e.children)if(!n.children[i]||!By(n.children[i],e.children[i],r))return!1;return!0}else{let i=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!Qn(n.segments,i)||!Pa(n.segments,i,r)||!n.children[q]?!1:qy(n.children[q],e,s,r)}}function Pa(n,e,t){return e.every((r,i)=>Uy[t](n[i].parameters,r.parameters))}var pn=class{constructor(e=new Y([],{}),t={},r=null){this.root=e,this.queryParams=t,this.fragment=r}get queryParamMap(){return this._queryParamMap??=zr(this.queryParams),this._queryParamMap}toString(){return C0.serialize(this)}},Y=class{constructor(e,t){this.segments=e,this.children=t,this.parent=null,Object.values(t).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Va(this)}},Hn=class{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap??=zr(this.parameters),this._parameterMap}toString(){return zy(this)}};function T0(n,e){return Qn(n,e)&&n.every((t,r)=>Ct(t.parameters,e[r].parameters))}function Qn(n,e){return n.length!==e.length?!1:n.every((t,r)=>t.path===e[r].path)}function A0(n,e){let t=[];return Object.entries(n.children).forEach(([r,i])=>{r===q&&(t=t.concat(e(i,r)))}),Object.entries(n.children).forEach(([r,i])=>{r!==q&&(t=t.concat(e(i,r)))}),t}var Rs=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:()=>new _s,providedIn:"root"});let n=e;return n})(),_s=class{parse(e){let t=new ql(e);return new pn(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){let t=`/${fs(e.root,!0)}`,r=R0(e.queryParams),i=typeof e.fragment=="string"?`#${S0(e.fragment)}`:"";return`${t}${r}${i}`}},C0=new _s;function Va(n){return n.segments.map(e=>zy(e)).join("/")}function fs(n,e){if(!n.hasChildren())return Va(n);if(e){let t=n.children[q]?fs(n.children[q],!1):"",r=[];return Object.entries(n.children).forEach(([i,s])=>{i!==q&&r.push(`${i}:${fs(s,!1)}`)}),r.length>0?`${t}(${r.join("//")})`:t}else{let t=A0(n,(r,i)=>i===q?[fs(n.children[q],!1)]:[`${i}:${fs(r,!1)}`]);return Object.keys(n.children).length===1&&n.children[q]!=null?`${Va(n)}/${t[0]}`:`${Va(n)}/(${t.join("//")})`}}function $y(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ra(n){return $y(n).replace(/%3B/gi,";")}function S0(n){return encodeURI(n)}function Bl(n){return $y(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function xa(n){return decodeURIComponent(n)}function Dy(n){return xa(n.replace(/\+/g,"%20"))}function zy(n){return`${Bl(n.path)}${b0(n.parameters)}`}function b0(n){return Object.entries(n).map(([e,t])=>`;${Bl(e)}=${Bl(t)}`).join("")}function R0(n){let e=Object.entries(n).map(([t,r])=>Array.isArray(r)?r.map(i=>`${Ra(t)}=${Ra(i)}`).join("&"):`${Ra(t)}=${Ra(r)}`).filter(t=>t);return e.length?`?${e.join("&")}`:""}var D0=/^[^\/()?;#]+/;function kl(n){let e=n.match(D0);return e?e[0]:""}var P0=/^[^\/()?;=#]+/;function V0(n){let e=n.match(P0);return e?e[0]:""}var x0=/^[^=?&#]+/;function N0(n){let e=n.match(x0);return e?e[0]:""}var M0=/^[^&#]+/;function k0(n){let e=n.match(M0);return e?e[0]:""}var ql=class{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Y([],{}):new Y([],this.parseChildren())}parseQueryParams(){let e={};if(this.consumeOptional("?"))do this.parseQueryParam(e);while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(r[q]=new Y(e,t)),r}parseSegment(){let e=kl(this.remaining);if(e===""&&this.peekStartsWith(";"))throw new ne(4009,!1);return this.capture(e),new Hn(xa(e),this.parseMatrixParams())}parseMatrixParams(){let e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){let t=V0(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let i=kl(this.remaining);i&&(r=i,this.capture(r))}e[xa(t)]=xa(r)}parseQueryParam(e){let t=N0(this.remaining);if(!t)return;this.capture(t);let r="";if(this.consumeOptional("=")){let o=k0(this.remaining);o&&(r=o,this.capture(r))}let i=Dy(t),s=Dy(r);if(e.hasOwnProperty(i)){let o=e[i];Array.isArray(o)||(o=[o],e[i]=o),o.push(s)}else e[i]=s}parseParens(e){let t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=kl(this.remaining),i=this.remaining[r.length];if(i!=="/"&&i!==")"&&i!==";")throw new ne(4010,!1);let s;r.indexOf(":")>-1?(s=r.slice(0,r.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=q);let o=this.parseChildren();t[s]=Object.keys(o).length===1?o[q]:new Y([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return this.peekStartsWith(e)?(this.remaining=this.remaining.substring(e.length),!0):!1}capture(e){if(!this.consumeOptional(e))throw new ne(4011,!1)}};function Gy(n){return n.segments.length>0?new Y([],{[q]:n}):n}function Ky(n){let e={};for(let[r,i]of Object.entries(n.children)){let s=Ky(i);if(r===q&&s.segments.length===0&&s.hasChildren())for(let[o,a]of Object.entries(s.children))e[o]=a;else(s.segments.length>0||s.hasChildren())&&(e[r]=s)}let t=new Y(n.segments,e);return O0(t)}function O0(n){if(n.numberOfChildren===1&&n.children[q]){let e=n.children[q];return new Y(n.segments.concat(e.segments),e.children)}return n}function Gr(n){return n instanceof pn}function F0(n,e,t=null,r=null){let i=Wy(n);return Hy(i,e,t,r)}function Wy(n){let e;function t(s){let o={};for(let u of s.children){let c=t(u);o[u.outlet]=c}let a=new Y(s.url,o);return s===n&&(e=a),a}let r=t(n.root),i=Gy(r);return e??i}function Hy(n,e,t,r){let i=n;for(;i.parent;)i=i.parent;if(e.length===0)return Ol(i,i,i,t,r);let s=L0(e);if(s.toRoot())return Ol(i,i,new Y([],{}),t,r);let o=U0(s,i,n),a=o.processChildren?ms(o.segmentGroup,o.index,s.commands):Yy(o.segmentGroup,o.index,s.commands);return Ol(i,o.segmentGroup,a,t,r)}function Na(n){return typeof n=="object"&&n!=null&&!n.outlets&&!n.segmentPath}function ws(n){return typeof n=="object"&&n!=null&&n.outlets}function Ol(n,e,t,r,i){let s={};r&&Object.entries(r).forEach(([u,c])=>{s[u]=Array.isArray(c)?c.map(l=>`${l}`):`${c}`});let o;n===e?o=t:o=Qy(n,e,t);let a=Gy(Ky(o));return new pn(a,s,i)}function Qy(n,e,t){let r={};return Object.entries(n.children).forEach(([i,s])=>{s===e?r[i]=t:r[i]=Qy(s,e,t)}),new Y(n.segments,r)}var Ma=class{constructor(e,t,r){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=r,e&&r.length>0&&Na(r[0]))throw new ne(4003,!1);let i=r.find(ws);if(i&&i!==Ly(r))throw new ne(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function L0(n){if(typeof n[0]=="string"&&n.length===1&&n[0]==="/")return new Ma(!0,0,n);let e=0,t=!1,r=n.reduce((i,s,o)=>{if(typeof s=="object"&&s!=null){if(s.outlets){let a={};return Object.entries(s.outlets).forEach(([u,c])=>{a[u]=typeof c=="string"?c.split("/"):c}),[...i,{outlets:a}]}if(s.segmentPath)return[...i,s.segmentPath]}return typeof s!="string"?[...i,s]:o===0?(s.split("/").forEach((a,u)=>{u==0&&a==="."||(u==0&&a===""?t=!0:a===".."?e++:a!=""&&i.push(a))}),i):[...i,s]},[]);return new Ma(t,e,r)}var qr=class{constructor(e,t,r){this.segmentGroup=e,this.processChildren=t,this.index=r}};function U0(n,e,t){if(n.isAbsolute)return new qr(e,!0,0);if(!t)return new qr(e,!1,NaN);if(t.parent===null)return new qr(t,!0,0);let r=Na(n.commands[0])?0:1,i=t.segments.length-1+r;return j0(t,i,n.numberOfDoubleDots)}function j0(n,e,t){let r=n,i=e,s=t;for(;s>i;){if(s-=i,r=r.parent,!r)throw new ne(4005,!1);i=r.segments.length}return new qr(r,!1,i-s)}function B0(n){return ws(n[0])?n[0].outlets:{[q]:n}}function Yy(n,e,t){if(n??=new Y([],{}),n.segments.length===0&&n.hasChildren())return ms(n,e,t);let r=q0(n,e,t),i=t.slice(r.commandIndex);if(r.match&&r.pathIndex<n.segments.length){let s=new Y(n.segments.slice(0,r.pathIndex),{});return s.children[q]=new Y(n.segments.slice(r.pathIndex),n.children),ms(s,0,i)}else return r.match&&i.length===0?new Y(n.segments,{}):r.match&&!n.hasChildren()?$l(n,e,t):r.match?ms(n,0,i):$l(n,e,t)}function ms(n,e,t){if(t.length===0)return new Y(n.segments,{});{let r=B0(t),i={};if(Object.keys(r).some(s=>s!==q)&&n.children[q]&&n.numberOfChildren===1&&n.children[q].segments.length===0){let s=ms(n.children[q],e,t);return new Y(n.segments,s.children)}return Object.entries(r).forEach(([s,o])=>{typeof o=="string"&&(o=[o]),o!==null&&(i[s]=Yy(n.children[s],e,o))}),Object.entries(n.children).forEach(([s,o])=>{r[s]===void 0&&(i[s]=o)}),new Y(n.segments,i)}}function q0(n,e,t){let r=0,i=e,s={match:!1,pathIndex:0,commandIndex:0};for(;i<n.segments.length;){if(r>=t.length)return s;let o=n.segments[i],a=t[r];if(ws(a))break;let u=`${a}`,c=r<t.length-1?t[r+1]:null;if(i>0&&u===void 0)break;if(u&&c&&typeof c=="object"&&c.outlets===void 0){if(!Vy(u,c,o))return s;r+=2}else{if(!Vy(u,{},o))return s;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}function $l(n,e,t){let r=n.segments.slice(0,e),i=0;for(;i<t.length;){let s=t[i];if(ws(s)){let u=$0(s.outlets);return new Y(r,u)}if(i===0&&Na(t[0])){let u=n.segments[e];r.push(new Hn(u.path,Py(t[0]))),i++;continue}let o=ws(s)?s.outlets[q]:`${s}`,a=i<t.length-1?t[i+1]:null;o&&a&&Na(a)?(r.push(new Hn(o,Py(a))),i+=2):(r.push(new Hn(o,{})),i++)}return new Y(r,{})}function $0(n){let e={};return Object.entries(n).forEach(([t,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(e[t]=$l(new Y([],{}),0,r))}),e}function Py(n){let e={};return Object.entries(n).forEach(([t,r])=>e[t]=`${r}`),e}function Vy(n,e,t){return n==t.path&&Ct(e,t.parameters)}var ys="imperative",Ce=function(n){return n[n.NavigationStart=0]="NavigationStart",n[n.NavigationEnd=1]="NavigationEnd",n[n.NavigationCancel=2]="NavigationCancel",n[n.NavigationError=3]="NavigationError",n[n.RoutesRecognized=4]="RoutesRecognized",n[n.ResolveStart=5]="ResolveStart",n[n.ResolveEnd=6]="ResolveEnd",n[n.GuardsCheckStart=7]="GuardsCheckStart",n[n.GuardsCheckEnd=8]="GuardsCheckEnd",n[n.RouteConfigLoadStart=9]="RouteConfigLoadStart",n[n.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",n[n.ChildActivationStart=11]="ChildActivationStart",n[n.ChildActivationEnd=12]="ChildActivationEnd",n[n.ActivationStart=13]="ActivationStart",n[n.ActivationEnd=14]="ActivationEnd",n[n.Scroll=15]="Scroll",n[n.NavigationSkipped=16]="NavigationSkipped",n}(Ce||{}),it=class{constructor(e,t){this.id=e,this.url=t}},Kr=class extends it{constructor(e,t,r="imperative",i=null){super(e,t),this.type=Ce.NavigationStart,this.navigationTrigger=r,this.restoredState=i}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},lt=class extends it{constructor(e,t,r){super(e,t),this.urlAfterRedirects=r,this.type=Ce.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Je=function(n){return n[n.Redirect=0]="Redirect",n[n.SupersededByNewNavigation=1]="SupersededByNewNavigation",n[n.NoDataFromResolver=2]="NoDataFromResolver",n[n.GuardRejected=3]="GuardRejected",n}(Je||{}),ka=function(n){return n[n.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",n[n.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",n}(ka||{}),gn=class extends it{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=Ce.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},mn=class extends it{constructor(e,t,r,i){super(e,t),this.reason=r,this.code=i,this.type=Ce.NavigationSkipped}},Es=class extends it{constructor(e,t,r,i){super(e,t),this.error=r,this.target=i,this.type=Ce.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Oa=class extends it{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Ce.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},zl=class extends it{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Ce.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Gl=class extends it{constructor(e,t,r,i,s){super(e,t),this.urlAfterRedirects=r,this.state=i,this.shouldActivate=s,this.type=Ce.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Kl=class extends it{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Ce.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Wl=class extends it{constructor(e,t,r,i){super(e,t),this.urlAfterRedirects=r,this.state=i,this.type=Ce.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Hl=class{constructor(e){this.route=e,this.type=Ce.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},Ql=class{constructor(e){this.route=e,this.type=Ce.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},Yl=class{constructor(e){this.snapshot=e,this.type=Ce.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Xl=class{constructor(e){this.snapshot=e,this.type=Ce.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Jl=class{constructor(e){this.snapshot=e,this.type=Ce.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Zl=class{constructor(e){this.snapshot=e,this.type=Ce.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Fa=class{constructor(e,t,r){this.routerEvent=e,this.position=t,this.anchor=r,this.type=Ce.Scroll}toString(){let e=this.position?`${this.position[0]}, ${this.position[1]}`:null;return`Scroll(anchor: '${this.anchor}', position: '${e}')`}},Is=class{},Ts=class{constructor(e){this.url=e}};var eh=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new Ds,this.attachRef=null}},Ds=(()=>{let e=class e{constructor(){this.contexts=new Map}onChildOutletCreated(r,i){let s=this.getOrCreateContext(r);s.outlet=i,this.contexts.set(r,s)}onChildOutletDestroyed(r){let i=this.getContext(r);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){let r=this.contexts;return this.contexts=new Map,r}onOutletReAttached(r){this.contexts=r}getOrCreateContext(r){let i=this.getContext(r);return i||(i=new eh,this.contexts.set(r,i)),i}getContext(r){return this.contexts.get(r)||null}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),La=class{constructor(e){this._root=e}get root(){return this._root.value}parent(e){let t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){let t=th(e,this._root);return t?t.children.map(r=>r.value):[]}firstChild(e){let t=th(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){let t=nh(e,this._root);return t.length<2?[]:t[t.length-2].children.map(i=>i.value).filter(i=>i!==e)}pathFromRoot(e){return nh(e,this._root).map(t=>t.value)}};function th(n,e){if(n===e.value)return e;for(let t of e.children){let r=th(n,t);if(r)return r}return null}function nh(n,e){if(n===e.value)return[e];for(let t of e.children){let r=nh(n,t);if(r.length)return r.unshift(e),r}return[]}var Xe=class{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}};function Br(n){let e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}var Ua=class extends La{constructor(e,t){super(e),this.snapshot=t,dh(this,e)}toString(){return this.snapshot.toString()}};function Xy(n){let e=z0(n),t=new nt([new Hn("",{})]),r=new nt({}),i=new nt({}),s=new nt({}),o=new nt(""),a=new Yn(t,r,s,o,i,q,n,e.root);return a.snapshot=e.root,new Ua(new Xe(a,[]),e)}function z0(n){let e={},t={},r={},i="",s=new As([],e,r,i,t,q,n,null,{});return new ja("",new Xe(s,[]))}var Yn=class{constructor(e,t,r,i,s,o,a,u){this.urlSubject=e,this.paramsSubject=t,this.queryParamsSubject=r,this.fragmentSubject=i,this.dataSubject=s,this.outlet=o,this.component=a,this._futureSnapshot=u,this.title=this.dataSubject?.pipe(O(c=>c[bs]))??P(void 0),this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(O(e=>zr(e))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(O(e=>zr(e))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function hh(n,e,t="emptyOnly"){let r,{routeConfig:i}=n;return e!==null&&(t==="always"||i?.path===""||!e.component&&!e.routeConfig?.loadComponent)?r={params:D(D({},e.params),n.params),data:D(D({},e.data),n.data),resolve:D(D(D(D({},n.data),e.data),i?.data),n._resolvedData)}:r={params:D({},n.params),data:D({},n.data),resolve:D(D({},n.data),n._resolvedData??{})},i&&Zy(i)&&(r.resolve[bs]=i.title),r}var As=class{get title(){return this.data?.[bs]}constructor(e,t,r,i,s,o,a,u,c){this.url=e,this.params=t,this.queryParams=r,this.fragment=i,this.data=s,this.outlet=o,this.component=a,this.routeConfig=u,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=zr(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=zr(this.queryParams),this._queryParamMap}toString(){let e=this.url.map(r=>r.toString()).join("/"),t=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${e}', path:'${t}')`}},ja=class extends La{constructor(e,t){super(t),this.url=e,dh(this,t)}toString(){return Jy(this._root)}};function dh(n,e){e.value._routerState=n,e.children.forEach(t=>dh(n,t))}function Jy(n){let e=n.children.length>0?` { ${n.children.map(Jy).join(", ")} } `:"";return`${n.value}${e}`}function Fl(n){if(n.snapshot){let e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,Ct(e.queryParams,t.queryParams)||n.queryParamsSubject.next(t.queryParams),e.fragment!==t.fragment&&n.fragmentSubject.next(t.fragment),Ct(e.params,t.params)||n.paramsSubject.next(t.params),_0(e.url,t.url)||n.urlSubject.next(t.url),Ct(e.data,t.data)||n.dataSubject.next(t.data)}else n.snapshot=n._futureSnapshot,n.dataSubject.next(n._futureSnapshot.data)}function rh(n,e){let t=Ct(n.params,e.params)&&T0(n.url,e.url),r=!n.parent!=!e.parent;return t&&!r&&(!n.parent||rh(n.parent,e.parent))}function Zy(n){return typeof n.title=="string"||n.title===null}var G0=(()=>{let e=class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=q,this.activateEvents=new rt,this.deactivateEvents=new rt,this.attachEvents=new rt,this.detachEvents=new rt,this.parentContexts=x(Ds),this.location=x(Hg),this.changeDetector=x(kr),this.environmentInjector=x(Bn),this.inputBinder=x(Ga,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(r){if(r.name){let{firstChange:i,previousValue:s}=r.name;if(i)return;this.isTrackedInParentContexts(s)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(s)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(r){return this.parentContexts.getContext(r)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let r=this.parentContexts.getContext(this.name);r?.route&&(r.attachRef?this.attach(r.attachRef,r.route):this.activateWith(r.route,r.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ne(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ne(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ne(4012,!1);this.location.detach();let r=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(r.instance),r}attach(r,i){this.activated=r,this._activatedRoute=i,this.location.insert(r.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(r.instance)}deactivate(){if(this.activated){let r=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(r)}}activateWith(r,i){if(this.isActivated)throw new ne(4013,!1);this._activatedRoute=r;let s=this.location,a=r.snapshot.component,u=this.parentContexts.getOrCreateContext(this.name).children,c=new ih(r,u,s.injector);this.activated=s.createComponent(a,{index:s.length,injector:c,environmentInjector:i??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=Pe({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[qn]});let n=e;return n})(),ih=class{constructor(e,t,r){this.route=e,this.childContexts=t,this.parent=r}get(e,t){return e===Yn?this.route:e===Ds?this.childContexts:this.parent.get(e,t)}},Ga=new F(""),xy=(()=>{let e=class e{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(r){this.unsubscribeFromRouteData(r),this.subscribeToRouteData(r)}unsubscribeFromRouteData(r){this.outletDataSubscriptions.get(r)?.unsubscribe(),this.outletDataSubscriptions.delete(r)}subscribeToRouteData(r){let{activatedRoute:i}=r,s=Ho([i.queryParams,i.params,i.data]).pipe(ye(([o,a,u],c)=>(u=D(D(D({},o),a),u),c===0?P(u):Promise.resolve(u)))).subscribe(o=>{if(!r.isActivated||!r.activatedComponentRef||r.activatedRoute!==i||i.component===null){this.unsubscribeFromRouteData(r);return}let a=lm(i.component);if(!a){this.unsubscribeFromRouteData(r);return}for(let{templateName:u}of a.inputs)r.activatedComponentRef.setInput(u,o[u])});this.outletDataSubscriptions.set(r,s)}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})();function K0(n,e,t){let r=Cs(n,e._root,t?t._root:void 0);return new Ua(r,e)}function Cs(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){let r=t.value;r._futureSnapshot=e.value;let i=W0(n,e,t);return new Xe(r,i)}else{if(n.shouldAttach(e.value)){let s=n.retrieve(e.value);if(s!==null){let o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>Cs(n,a)),o}}let r=H0(e.value),i=e.children.map(s=>Cs(n,s));return new Xe(r,i)}}function W0(n,e,t){return e.children.map(r=>{for(let i of t.children)if(n.shouldReuseRoute(r.value,i.value.snapshot))return Cs(n,r,i);return Cs(n,r)})}function H0(n){return new Yn(new nt(n.url),new nt(n.params),new nt(n.queryParams),new nt(n.fragment),new nt(n.data),n.outlet,n.component,n)}var ev="ngNavigationCancelingError";function tv(n,e){let{redirectTo:t,navigationBehaviorOptions:r}=Gr(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,i=nv(!1,Je.Redirect);return i.url=t,i.navigationBehaviorOptions=r,i}function nv(n,e){let t=new Error(`NavigationCancelingError: ${n||""}`);return t[ev]=!0,t.cancellationCode=e,t}function Q0(n){return rv(n)&&Gr(n.url)}function rv(n){return!!n&&n[ev]}var Y0=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=Lg({type:e,selectors:[["ng-component"]],standalone:!0,features:[nm],decls:1,vars:0,template:function(i,s){i&1&&Jg(0,"router-outlet")},dependencies:[G0],encapsulation:2});let n=e;return n})();function X0(n,e){return n.providers&&!n._injector&&(n._injector=sl(n.providers,e,`Route: ${n.path}`)),n._injector??e}function fh(n){let e=n.children&&n.children.map(fh),t=e?se(D({},n),{children:e}):D({},n);return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==q&&(t.component=Y0),t}function St(n){return n.outlet||q}function J0(n,e){let t=n.filter(r=>St(r)===e);return t.push(...n.filter(r=>St(r)!==e)),t}function Ps(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){let t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}var Z0=(n,e,t,r)=>O(i=>(new sh(e,i.targetRouterState,i.currentRouterState,t,r).activate(n),i)),sh=class{constructor(e,t,r,i,s){this.routeReuseStrategy=e,this.futureState=t,this.currState=r,this.forwardEvent=i,this.inputBindingEnabled=s}activate(e){let t=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,r,e),Fl(this.futureState.root),this.activateChildRoutes(t,r,e)}deactivateChildRoutes(e,t,r){let i=Br(t);e.children.forEach(s=>{let o=s.value.outlet;this.deactivateRoutes(s,i[o],r),delete i[o]}),Object.values(i).forEach(s=>{this.deactivateRouteAndItsChildren(s,r)})}deactivateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(i===s)if(i.component){let o=r.getContext(i.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,r);else s&&this.deactivateRouteAndItsChildren(t,r)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Br(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);if(r&&r.outlet){let o=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){let r=t.getContext(e.value.outlet),i=r&&e.value.component?r.children:t,s=Br(e);for(let o of Object.values(s))this.deactivateRouteAndItsChildren(o,i);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(e,t,r){let i=Br(t);e.children.forEach(s=>{this.activateRoutes(s,i[s.value.outlet],r),this.forwardEvent(new Zl(s.value.snapshot))}),e.children.length&&this.forwardEvent(new Xl(e.value.snapshot))}activateRoutes(e,t,r){let i=e.value,s=t?t.value:null;if(Fl(i),i===s)if(i.component){let o=r.getOrCreateContext(i.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,r);else if(i.component){let o=r.getOrCreateContext(i.outlet);if(this.routeReuseStrategy.shouldAttach(i.snapshot)){let a=this.routeReuseStrategy.retrieve(i.snapshot);this.routeReuseStrategy.store(i.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),Fl(a.route.value),this.activateChildRoutes(e,null,o.children)}else{let a=Ps(i.snapshot);o.attachRef=null,o.route=i,o.injector=a,o.outlet&&o.outlet.activateWith(i,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,r)}},Ba=class{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}},$r=class{constructor(e,t){this.component=e,this.route=t}};function eC(n,e,t){let r=n._root,i=e?e._root:null;return ps(r,i,t,[r.value])}function tC(n){let e=n.routeConfig?n.routeConfig.canActivateChild:null;return!e||e.length===0?null:{node:n,guards:e}}function Hr(n,e){let t=Symbol(),r=e.get(n,t);return r===t?typeof n=="function"&&!Og(n)?n:e.get(n):r}function ps(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=Br(e);return n.children.forEach(o=>{nC(o,s[o.value.outlet],t,r.concat([o.value]),i),delete s[o.value.outlet]}),Object.entries(s).forEach(([o,a])=>vs(a,t.getContext(o),i)),i}function nC(n,e,t,r,i={canDeactivateChecks:[],canActivateChecks:[]}){let s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){let u=rC(o,s,s.routeConfig.runGuardsAndResolvers);u?i.canActivateChecks.push(new Ba(r)):(s.data=o.data,s._resolvedData=o._resolvedData),s.component?ps(n,e,a?a.children:null,r,i):ps(n,e,t,r,i),u&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new $r(a.outlet.component,o))}else o&&vs(e,a,i),i.canActivateChecks.push(new Ba(r)),s.component?ps(n,null,a?a.children:null,r,i):ps(n,null,t,r,i);return i}function rC(n,e,t){if(typeof t=="function")return t(n,e);switch(t){case"pathParamsChange":return!Qn(n.url,e.url);case"pathParamsOrQueryParamsChange":return!Qn(n.url,e.url)||!Ct(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!rh(n,e)||!Ct(n.queryParams,e.queryParams);case"paramsChange":default:return!rh(n,e)}}function vs(n,e,t){let r=Br(n),i=n.value;Object.entries(r).forEach(([s,o])=>{i.component?e?vs(o,e.children.getContext(s),t):vs(o,null,t):vs(o,e,t)}),i.component?e&&e.outlet&&e.outlet.isActivated?t.canDeactivateChecks.push(new $r(e.outlet.component,i)):t.canDeactivateChecks.push(new $r(null,i)):t.canDeactivateChecks.push(new $r(null,i))}function Vs(n){return typeof n=="function"}function iC(n){return typeof n=="boolean"}function sC(n){return n&&Vs(n.canLoad)}function oC(n){return n&&Vs(n.canActivate)}function aC(n){return n&&Vs(n.canActivateChild)}function uC(n){return n&&Vs(n.canDeactivate)}function cC(n){return n&&Vs(n.canMatch)}function iv(n){return n instanceof Rg||n?.name==="EmptyError"}var Da=Symbol("INITIAL_VALUE");function Wr(){return ye(n=>Ho(n.map(e=>e.pipe(xr(1),Mr(Da)))).pipe(O(e=>{for(let t of e)if(t!==!0){if(t===Da)return Da;if(t===!1||t instanceof pn)return t}return!0}),Ge(e=>e!==Da),xr(1)))}function lC(n,e){return He(t=>{let{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return o.length===0&&s.length===0?P(se(D({},t),{guardsResult:!0})):hC(o,r,i,n).pipe(He(a=>a&&iC(a)?dC(r,s,n,e):P(a)),O(a=>se(D({},t),{guardsResult:a})))})}function hC(n,e,t,r){return ee(n).pipe(He(i=>yC(i.component,i.route,t,e,r)),wt(i=>i!==!0,!0))}function dC(n,e,t,r){return ee(e).pipe(nn(i=>Dg(pC(i.route.parent,r),fC(i.route,r),mC(n,i.path,t),gC(n,i.route,t))),wt(i=>i!==!0,!0))}function fC(n,e){return n!==null&&e&&e(new Jl(n)),P(!0)}function pC(n,e){return n!==null&&e&&e(new Yl(n)),P(!0)}function gC(n,e,t){let r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||r.length===0)return P(!0);let i=r.map(s=>Xc(()=>{let o=Ps(e)??t,a=Hr(s,o),u=oC(a)?a.canActivate(e,n):It(o,()=>a(e,n));return yn(u).pipe(wt())}));return P(i).pipe(Wr())}function mC(n,e,t){let r=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>tC(o)).filter(o=>o!==null).map(o=>Xc(()=>{let a=o.guards.map(u=>{let c=Ps(o.node)??t,l=Hr(u,c),h=aC(l)?l.canActivateChild(r,n):It(c,()=>l(r,n));return yn(h).pipe(wt())});return P(a).pipe(Wr())}));return P(s).pipe(Wr())}function yC(n,e,t,r,i){let s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!s||s.length===0)return P(!0);let o=s.map(a=>{let u=Ps(e)??i,c=Hr(a,u),l=uC(c)?c.canDeactivate(n,e,t,r):It(u,()=>c(n,e,t,r));return yn(l).pipe(wt())});return P(o).pipe(Wr())}function vC(n,e,t,r){let i=e.canLoad;if(i===void 0||i.length===0)return P(!0);let s=i.map(o=>{let a=Hr(o,n),u=sC(a)?a.canLoad(e,t):It(n,()=>a(e,t));return yn(u)});return P(s).pipe(Wr(),sv(r))}function sv(n){return Cg(ve(e=>{if(Gr(e))throw tv(n,e)}),O(e=>e===!0))}function _C(n,e,t,r){let i=e.canMatch;if(!i||i.length===0)return P(!0);let s=i.map(o=>{let a=Hr(o,n),u=cC(a)?a.canMatch(e,t):It(n,()=>a(e,t));return yn(u)});return P(s).pipe(Wr(),sv(r))}var Ss=class{constructor(e){this.segmentGroup=e||null}},qa=class extends Error{constructor(e){super(),this.urlTree=e}};function jr(n){return $i(new Ss(n))}function wC(n){return $i(new ne(4e3,!1))}function EC(n){return $i(nv(!1,Je.GuardRejected))}var oh=class{constructor(e,t){this.urlSerializer=e,this.urlTree=t}lineralizeSegments(e,t){let r=[],i=t.root;for(;;){if(r=r.concat(i.segments),i.numberOfChildren===0)return P(r);if(i.numberOfChildren>1||!i.children[q])return wC(e.redirectTo);i=i.children[q]}}applyRedirectCommands(e,t,r){let i=this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,r);if(t.startsWith("/"))throw new qa(i);return i}applyRedirectCreateUrlTree(e,t,r,i){let s=this.createSegmentGroup(e,t.root,r,i);return new pn(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){let r={};return Object.entries(e).forEach(([i,s])=>{if(typeof s=="string"&&s.startsWith(":")){let a=s.substring(1);r[i]=t[a]}else r[i]=s}),r}createSegmentGroup(e,t,r,i){let s=this.createSegments(e,t.segments,r,i),o={};return Object.entries(t.children).forEach(([a,u])=>{o[a]=this.createSegmentGroup(e,u,r,i)}),new Y(s,o)}createSegments(e,t,r,i){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,i):this.findOrReturn(s,r))}findPosParam(e,t,r){let i=r[t.path.substring(1)];if(!i)throw new ne(4001,!1);return i}findOrReturn(e,t){let r=0;for(let i of t){if(i.path===e.path)return t.splice(r),i;r++}return e}},ah={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function IC(n,e,t,r,i){let s=ph(n,e,t);return s.matched?(r=X0(e,r),_C(r,e,t,i).pipe(O(o=>o===!0?s:D({},ah)))):P(s)}function ph(n,e,t){if(e.path==="**")return TC(t);if(e.path==="")return e.pathMatch==="full"&&(n.hasChildren()||t.length>0)?D({},ah):{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};let i=(e.matcher||v0)(t,n,e);if(!i)return D({},ah);let s={};Object.entries(i.posParams??{}).forEach(([a,u])=>{s[a]=u.path});let o=i.consumed.length>0?D(D({},s),i.consumed[i.consumed.length-1].parameters):s;return{matched:!0,consumedSegments:i.consumed,remainingSegments:t.slice(i.consumed.length),parameters:o,positionalParamSegments:i.posParams??{}}}function TC(n){return{matched:!0,parameters:n.length>0?Ly(n).parameters:{},consumedSegments:n,remainingSegments:[],positionalParamSegments:{}}}function Ny(n,e,t,r){return t.length>0&&SC(n,t,r)?{segmentGroup:new Y(e,CC(r,new Y(t,n.children))),slicedSegments:[]}:t.length===0&&bC(n,t,r)?{segmentGroup:new Y(n.segments,AC(n,t,r,n.children)),slicedSegments:t}:{segmentGroup:new Y(n.segments,n.children),slicedSegments:t}}function AC(n,e,t,r){let i={};for(let s of t)if(Ka(n,e,s)&&!r[St(s)]){let o=new Y([],{});i[St(s)]=o}return D(D({},r),i)}function CC(n,e){let t={};t[q]=e;for(let r of n)if(r.path===""&&St(r)!==q){let i=new Y([],{});t[St(r)]=i}return t}function SC(n,e,t){return t.some(r=>Ka(n,e,r)&&St(r)!==q)}function bC(n,e,t){return t.some(r=>Ka(n,e,r))}function Ka(n,e,t){return(n.hasChildren()||e.length>0)&&t.pathMatch==="full"?!1:t.path===""}function RC(n,e,t,r){return St(n)!==r&&(r===q||!Ka(e,t,n))?!1:ph(e,n,t).matched}function DC(n,e,t){return e.length===0&&!n.children[t]}var uh=class{};function PC(n,e,t,r,i,s,o="emptyOnly"){return new ch(n,e,t,r,i,o,s).recognize()}var VC=31,ch=class{constructor(e,t,r,i,s,o,a){this.injector=e,this.configLoader=t,this.rootComponentType=r,this.config=i,this.urlTree=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a,this.applyRedirects=new oh(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(e){return new ne(4002,`'${e.segmentGroup}'`)}recognize(){let e=Ny(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(e).pipe(O(t=>{let r=new As([],Object.freeze({}),Object.freeze(D({},this.urlTree.queryParams)),this.urlTree.fragment,{},q,this.rootComponentType,null,{}),i=new Xe(r,t),s=new ja("",i),o=F0(r,[],this.urlTree.queryParams,this.urlTree.fragment);return o.queryParams=this.urlTree.queryParams,s.url=this.urlSerializer.serialize(o),this.inheritParamsAndData(s._root,null),{state:s,tree:o}}))}match(e){return this.processSegmentGroup(this.injector,this.config,e,q).pipe(Vr(r=>{if(r instanceof qa)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof Ss?this.noMatchError(r):r}))}inheritParamsAndData(e,t){let r=e.value,i=hh(r,t,this.paramsInheritanceStrategy);r.params=Object.freeze(i.params),r.data=Object.freeze(i.data),e.children.forEach(s=>this.inheritParamsAndData(s,r))}processSegmentGroup(e,t,r,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(e,t,r):this.processSegment(e,t,r,r.segments,i,!0).pipe(O(s=>s instanceof Xe?[s]:[]))}processChildren(e,t,r){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return ee(i).pipe(nn(s=>{let o=r.children[s],a=J0(t,s);return this.processSegmentGroup(e,a,o,s)}),Nr((s,o)=>(s.push(...o),s)),Jc(null),Mg(),He(s=>{if(s===null)return jr(r);let o=ov(s);return xC(o),P(o)}))}processSegment(e,t,r,i,s,o){return ee(t).pipe(nn(a=>this.processSegmentAgainstRoute(a._injector??e,t,a,r,i,s,o).pipe(Vr(u=>{if(u instanceof Ss)return P(null);throw u}))),wt(a=>!!a),Vr(a=>{if(iv(a))return DC(r,i,s)?P(new uh):jr(r);throw a}))}processSegmentAgainstRoute(e,t,r,i,s,o,a){return RC(r,i,s,o)?r.redirectTo===void 0?this.matchSegmentAgainstRoute(e,i,r,s,o):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(e,i,t,r,s,o):jr(i):jr(i)}expandSegmentAgainstRouteUsingRedirect(e,t,r,i,s,o){let{matched:a,consumedSegments:u,positionalParamSegments:c,remainingSegments:l}=ph(t,i,s);if(!a)return jr(t);i.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>VC&&(this.allowRedirects=!1));let h=this.applyRedirects.applyRedirectCommands(u,i.redirectTo,c);return this.applyRedirects.lineralizeSegments(i,h).pipe(He(d=>this.processSegment(e,r,t,d.concat(l),o,!1)))}matchSegmentAgainstRoute(e,t,r,i,s){let o=IC(t,r,i,e,this.urlSerializer);return r.path==="**"&&(t.children={}),o.pipe(ye(a=>a.matched?(e=r._injector??e,this.getChildConfig(e,r,i).pipe(ye(({routes:u})=>{let c=r._loadedInjector??e,{consumedSegments:l,remainingSegments:h,parameters:d}=a,f=new As(l,d,Object.freeze(D({},this.urlTree.queryParams)),this.urlTree.fragment,MC(r),St(r),r.component??r._loadedComponent??null,r,kC(r)),{segmentGroup:E,slicedSegments:w}=Ny(t,l,h,u);if(w.length===0&&E.hasChildren())return this.processChildren(c,u,E).pipe(O(I=>I===null?null:new Xe(f,I)));if(u.length===0&&w.length===0)return P(new Xe(f,[]));let y=St(r)===s;return this.processSegment(c,u,E,w,y?q:s,!0).pipe(O(I=>new Xe(f,I instanceof Xe?[I]:[])))}))):jr(t)))}getChildConfig(e,t,r){return t.children?P({routes:t.children,injector:e}):t.loadChildren?t._loadedRoutes!==void 0?P({routes:t._loadedRoutes,injector:t._loadedInjector}):vC(e,t,r,this.urlSerializer).pipe(He(i=>i?this.configLoader.loadChildren(e,t).pipe(ve(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):EC(t))):P({routes:[],injector:e})}};function xC(n){n.sort((e,t)=>e.value.outlet===q?-1:t.value.outlet===q?1:e.value.outlet.localeCompare(t.value.outlet))}function NC(n){let e=n.value.routeConfig;return e&&e.path===""}function ov(n){let e=[],t=new Set;for(let r of n){if(!NC(r)){e.push(r);continue}let i=e.find(s=>r.value.routeConfig===s.value.routeConfig);i!==void 0?(i.children.push(...r.children),t.add(i)):e.push(r)}for(let r of t){let i=ov(r.children);e.push(new Xe(r.value,i))}return e.filter(r=>!t.has(r))}function MC(n){return n.data||{}}function kC(n){return n.resolve||{}}function OC(n,e,t,r,i,s){return He(o=>PC(n,e,t,r,o.extractedUrl,i,s).pipe(O(({state:a,tree:u})=>se(D({},o),{targetSnapshot:a,urlAfterRedirects:u}))))}function FC(n,e){return He(t=>{let{targetSnapshot:r,guards:{canActivateChecks:i}}=t;if(!i.length)return P(t);let s=new Set(i.map(u=>u.route)),o=new Set;for(let u of s)if(!o.has(u))for(let c of av(u))o.add(c);let a=0;return ee(o).pipe(nn(u=>s.has(u)?LC(u,r,n,e):(u.data=hh(u,u.parent,n).resolve,P(void 0))),ve(()=>a++),Zc(1),He(u=>a===o.size?P(t):en))})}function av(n){let e=n.children.map(t=>av(t)).flat();return[n,...e]}function LC(n,e,t,r){let i=n.routeConfig,s=n._resolve;return i?.title!==void 0&&!Zy(i)&&(s[bs]=i.title),UC(s,n,e,r).pipe(O(o=>(n._resolvedData=o,n.data=hh(n,n.parent,t).resolve,null)))}function UC(n,e,t,r){let i=jl(n);if(i.length===0)return P({});let s={};return ee(i).pipe(He(o=>jC(n[o],e,t,r).pipe(wt(),ve(a=>{s[o]=a}))),Zc(1),xg(s),Vr(o=>iv(o)?en:$i(o)))}function jC(n,e,t,r){let i=Ps(e)??r,s=Hr(n,i),o=s.resolve?s.resolve(e,t):It(i,()=>s(e,t));return yn(o)}function Ll(n){return ye(e=>{let t=n(e);return t?ee(t).pipe(O(()=>e)):P(e)})}var uv=(()=>{let e=class e{buildTitle(r){let i,s=r.root;for(;s!==void 0;)i=this.getResolvedTitleForRoute(s)??i,s=s.children.find(o=>o.outlet===q);return i}getResolvedTitleForRoute(r){return r.data[bs]}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:()=>x(BC),providedIn:"root"});let n=e;return n})(),BC=(()=>{let e=class e extends uv{constructor(r){super(),this.title=r}updateTitle(r){let i=this.buildTitle(r);i!==void 0&&this.title.setTitle(i)}};e.\u0275fac=function(i){return new(i||e)(S(Ym))},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),xs=new F("",{providedIn:"root",factory:()=>({})}),$a=new F(""),gh=(()=>{let e=class e{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=x(ia)}loadComponent(r){if(this.componentLoaders.get(r))return this.componentLoaders.get(r);if(r._loadedComponent)return P(r._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(r);let i=yn(r.loadComponent()).pipe(O(cv),ve(o=>{this.onLoadEndListener&&this.onLoadEndListener(r),r._loadedComponent=o}),jn(()=>{this.componentLoaders.delete(r)})),s=new Yc(i,()=>new _t).pipe(Qc());return this.componentLoaders.set(r,s),s}loadChildren(r,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return P({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);let o=qC(i,this.compiler,r,this.onLoadEndListener).pipe(jn(()=>{this.childrenLoaders.delete(i)})),a=new Yc(o,()=>new _t).pipe(Qc());return this.childrenLoaders.set(i,a),a}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function qC(n,e,t,r){return yn(n.loadChildren()).pipe(O(cv),He(i=>i instanceof Yg||Array.isArray(i)?P(i):ee(e.compileModuleAsync(i))),O(i=>{r&&r(n);let s,o,a=!1;return Array.isArray(i)?(o=i,a=!0):(s=i.create(t).injector,o=s.get($a,[],{optional:!0,self:!0}).flat()),{routes:o.map(fh),injector:s}}))}function $C(n){return n&&typeof n=="object"&&"default"in n}function cv(n){return $C(n)?n.default:n}var mh=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:()=>x(zC),providedIn:"root"});let n=e;return n})(),zC=(()=>{let e=class e{shouldProcessUrl(r){return!0}extract(r){return r}merge(r,i){return r}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),lv=new F(""),hv=new F("");function GC(n,e,t){let r=n.get(hv),i=n.get(Ye);return n.get(le).runOutsideAngular(()=>{if(!i.startViewTransition||r.skipNextTransition)return r.skipNextTransition=!1,Promise.resolve();let s,o=new Promise(c=>{s=c}),a=i.startViewTransition(()=>(s(),KC(n))),{onViewTransitionCreated:u}=r;return u&&It(n,()=>u({transition:a,from:e,to:t})),o})}function KC(n){return new Promise(e=>{Wg(e,{injector:n})})}var yh=(()=>{let e=class e{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new _t,this.transitionAbortSubject=new _t,this.configLoader=x(gh),this.environmentInjector=x(Bn),this.urlSerializer=x(Rs),this.rootContexts=x(Ds),this.location=x(Zi),this.inputBindingEnabled=x(Ga,{optional:!0})!==null,this.titleStrategy=x(uv),this.options=x(xs,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=x(mh),this.createViewTransition=x(lv,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>P(void 0),this.rootComponentType=null;let r=s=>this.events.next(new Hl(s)),i=s=>this.events.next(new Ql(s));this.configLoader.onLoadEndListener=i,this.configLoader.onLoadStartListener=r}complete(){this.transitions?.complete()}handleNavigationRequest(r){let i=++this.navigationId;this.transitions?.next(se(D(D({},this.transitions.value),r),{id:i}))}setupNavigations(r,i,s){return this.transitions=new nt({id:0,currentUrlTree:i,currentRawUrl:i,extractedUrl:this.urlHandlingStrategy.extract(i),urlAfterRedirects:this.urlHandlingStrategy.extract(i),rawUrl:i,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:ys,restoredState:null,currentSnapshot:s.snapshot,targetSnapshot:null,currentRouterState:s,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Ge(o=>o.id!==0),O(o=>se(D({},o),{extractedUrl:this.urlHandlingStrategy.extract(o.rawUrl)})),ye(o=>{let a=!1,u=!1;return P(o).pipe(ye(c=>{if(this.navigationId>o.id)return this.cancelNavigationTransition(o,"",Je.SupersededByNewNavigation),en;this.currentTransition=o,this.currentNavigation={id:c.id,initialUrl:c.rawUrl,extractedUrl:c.extractedUrl,trigger:c.source,extras:c.extras,previousNavigation:this.lastSuccessfulNavigation?se(D({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let l=!r.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),h=c.extras.onSameUrlNavigation??r.onSameUrlNavigation;if(!l&&h!=="reload"){let d="";return this.events.next(new mn(c.id,this.urlSerializer.serialize(c.rawUrl),d,ka.IgnoredSameUrlNavigation)),c.resolve(null),en}if(this.urlHandlingStrategy.shouldProcessUrl(c.rawUrl))return P(c).pipe(ye(d=>{let f=this.transitions?.getValue();return this.events.next(new Kr(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),f!==this.transitions?.getValue()?en:Promise.resolve(d)}),OC(this.environmentInjector,this.configLoader,this.rootComponentType,r.config,this.urlSerializer,this.paramsInheritanceStrategy),ve(d=>{o.targetSnapshot=d.targetSnapshot,o.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation=se(D({},this.currentNavigation),{finalUrl:d.urlAfterRedirects});let f=new Oa(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(f)}));if(l&&this.urlHandlingStrategy.shouldProcessUrl(c.currentRawUrl)){let{id:d,extractedUrl:f,source:E,restoredState:w,extras:y}=c,I=new Kr(d,this.urlSerializer.serialize(f),E,w);this.events.next(I);let k=Xy(this.rootComponentType).snapshot;return this.currentTransition=o=se(D({},c),{targetSnapshot:k,urlAfterRedirects:f,extras:se(D({},y),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=f,P(o)}else{let d="";return this.events.next(new mn(c.id,this.urlSerializer.serialize(c.extractedUrl),d,ka.IgnoredByUrlHandlingStrategy)),c.resolve(null),en}}),ve(c=>{let l=new zl(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(l)}),O(c=>(this.currentTransition=o=se(D({},c),{guards:eC(c.targetSnapshot,c.currentSnapshot,this.rootContexts)}),o)),lC(this.environmentInjector,c=>this.events.next(c)),ve(c=>{if(o.guardsResult=c.guardsResult,Gr(c.guardsResult))throw tv(this.urlSerializer,c.guardsResult);let l=new Gl(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot,!!c.guardsResult);this.events.next(l)}),Ge(c=>c.guardsResult?!0:(this.cancelNavigationTransition(c,"",Je.GuardRejected),!1)),Ll(c=>{if(c.guards.canActivateChecks.length)return P(c).pipe(ve(l=>{let h=new Kl(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(h)}),ye(l=>{let h=!1;return P(l).pipe(FC(this.paramsInheritanceStrategy,this.environmentInjector),ve({next:()=>h=!0,complete:()=>{h||this.cancelNavigationTransition(l,"",Je.NoDataFromResolver)}}))}),ve(l=>{let h=new Wl(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(h)}))}),Ll(c=>{let l=h=>{let d=[];h.routeConfig?.loadComponent&&!h.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(h.routeConfig).pipe(ve(f=>{h.component=f}),O(()=>{})));for(let f of h.children)d.push(...l(f));return d};return Ho(l(c.targetSnapshot.root)).pipe(Jc(null),xr(1))}),Ll(()=>this.afterPreactivation()),ye(()=>{let{currentSnapshot:c,targetSnapshot:l}=o,h=this.createViewTransition?.(this.environmentInjector,c.root,l.root);return h?ee(h).pipe(O(()=>o)):P(o)}),O(c=>{let l=K0(r.routeReuseStrategy,c.targetSnapshot,c.currentRouterState);return this.currentTransition=o=se(D({},c),{targetRouterState:l}),this.currentNavigation.targetRouterState=l,o}),ve(()=>{this.events.next(new Is)}),Z0(this.rootContexts,r.routeReuseStrategy,c=>this.events.next(c),this.inputBindingEnabled),xr(1),ve({next:c=>{a=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new lt(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects))),this.titleStrategy?.updateTitle(c.targetRouterState.snapshot),c.resolve(!0)},complete:()=>{a=!0}}),kg(this.transitionAbortSubject.pipe(ve(c=>{throw c}))),jn(()=>{!a&&!u&&this.cancelNavigationTransition(o,"",Je.SupersededByNewNavigation),this.currentTransition?.id===o.id&&(this.currentNavigation=null,this.currentTransition=null)}),Vr(c=>{if(u=!0,rv(c))this.events.next(new gn(o.id,this.urlSerializer.serialize(o.extractedUrl),c.message,c.cancellationCode)),Q0(c)?this.events.next(new Ts(c.url)):o.resolve(!1);else{this.events.next(new Es(o.id,this.urlSerializer.serialize(o.extractedUrl),c,o.targetSnapshot??void 0));try{o.resolve(r.errorHandler(c))}catch(l){this.options.resolveNavigationPromiseOnError?o.resolve(!1):o.reject(l)}}return en}))}))}cancelNavigationTransition(r,i,s){let o=new gn(r.id,this.urlSerializer.serialize(r.extractedUrl),i,s);this.events.next(o),r.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function WC(n){return n!==ys}var HC=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:()=>x(QC),providedIn:"root"});let n=e;return n})(),lh=class{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}},QC=(()=>{let e=class e extends lh{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=on(e)))(s||e)}})(),e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),dv=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:()=>x(YC),providedIn:"root"});let n=e;return n})(),YC=(()=>{let e=class e extends dv{constructor(){super(...arguments),this.location=x(Zi),this.urlSerializer=x(Rs),this.options=x(xs,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=x(mh),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new pn,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=Xy(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(r){return this.location.subscribe(i=>{i.type==="popstate"&&r(i.url,i.state)})}handleRouterEvent(r,i){if(r instanceof Kr)this.stateMemento=this.createStateMemento();else if(r instanceof mn)this.rawUrlTree=i.initialUrl;else if(r instanceof Oa){if(this.urlUpdateStrategy==="eager"&&!i.extras.skipLocationChange){let s=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl);this.setBrowserUrl(s,i)}}else r instanceof Is?(this.currentUrlTree=i.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(i.finalUrl,i.initialUrl),this.routerState=i.targetRouterState,this.urlUpdateStrategy==="deferred"&&(i.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,i))):r instanceof gn&&(r.code===Je.GuardRejected||r.code===Je.NoDataFromResolver)?this.restoreHistory(i):r instanceof Es?this.restoreHistory(i,!0):r instanceof lt&&(this.lastSuccessfulId=r.id,this.currentPageId=this.browserPageId)}setBrowserUrl(r,i){let s=this.urlSerializer.serialize(r);if(this.location.isCurrentPathEqualTo(s)||i.extras.replaceUrl){let o=this.browserPageId,a=D(D({},i.extras.state),this.generateNgRouterState(i.id,o));this.location.replaceState(s,"",a)}else{let o=D(D({},i.extras.state),this.generateNgRouterState(i.id,this.browserPageId+1));this.location.go(s,"",o)}}restoreHistory(r,i=!1){if(this.canceledNavigationResolution==="computed"){let s=this.browserPageId,o=this.currentPageId-s;o!==0?this.location.historyGo(o):this.currentUrlTree===r.finalUrl&&o===0&&(this.resetState(r),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(i&&this.resetState(r),this.resetUrlToCurrentUrlTree())}resetState(r){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,r.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(r,i){return this.canceledNavigationResolution==="computed"?{navigationId:r,\u0275routerPageId:i}:{navigationId:r}}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=on(e)))(s||e)}})(),e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),gs=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.FAILED=1]="FAILED",n[n.REDIRECTING=2]="REDIRECTING",n}(gs||{});function fv(n,e){n.events.pipe(Ge(t=>t instanceof lt||t instanceof gn||t instanceof Es||t instanceof mn),O(t=>t instanceof lt||t instanceof mn?gs.COMPLETE:(t instanceof gn?t.code===Je.Redirect||t.code===Je.SupersededByNewNavigation:!1)?gs.REDIRECTING:gs.FAILED),Ge(t=>t!==gs.REDIRECTING),xr(1)).subscribe(()=>{e()})}function XC(n){throw n}var JC={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},ZC={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Bt=(()=>{let e=class e{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=x(Zo),this.stateManager=x(dv),this.options=x(xs,{optional:!0})||{},this.pendingTasks=x(Qi),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=x(yh),this.urlSerializer=x(Rs),this.location=x(Zi),this.urlHandlingStrategy=x(mh),this._events=new _t,this.errorHandler=this.options.errorHandler||XC,this.navigated=!1,this.routeReuseStrategy=x(HC),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=x($a,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!x(Ga,{optional:!0}),this.eventsSubscription=new Ag,this.isNgZoneEnabled=x(le)instanceof le&&le.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:r=>{this.console.warn(r)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let r=this.navigationTransitions.events.subscribe(i=>{try{let s=this.navigationTransitions.currentTransition,o=this.navigationTransitions.currentNavigation;if(s!==null&&o!==null){if(this.stateManager.handleRouterEvent(i,o),i instanceof gn&&i.code!==Je.Redirect&&i.code!==Je.SupersededByNewNavigation)this.navigated=!0;else if(i instanceof lt)this.navigated=!0;else if(i instanceof Ts){let a=this.urlHandlingStrategy.merge(i.url,s.currentRawUrl),u={info:s.extras.info,skipLocationChange:s.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||WC(s.source)};this.scheduleNavigation(a,ys,null,u,{resolve:s.resolve,reject:s.reject,promise:s.promise})}}tS(i)&&this._events.next(i)}catch(s){this.navigationTransitions.transitionAbortSubject.next(s)}});this.eventsSubscription.add(r)}resetRootComponentType(r){this.routerState.root.component=r,this.navigationTransitions.rootComponentType=r}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),ys,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((r,i)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(r,"popstate",i)},0)})}navigateToSyncWithBrowser(r,i,s){let o={replaceUrl:!0},a=s?.navigationId?s:null;if(s){let c=D({},s);delete c.navigationId,delete c.\u0275routerPageId,Object.keys(c).length!==0&&(o.state=c)}let u=this.parseUrl(r);this.scheduleNavigation(u,i,a,o)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(r){this.config=r.map(fh),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(r,i={}){let{relativeTo:s,queryParams:o,fragment:a,queryParamsHandling:u,preserveFragment:c}=i,l=c?this.currentUrlTree.fragment:a,h=null;switch(u){case"merge":h=D(D({},this.currentUrlTree.queryParams),o);break;case"preserve":h=this.currentUrlTree.queryParams;break;default:h=o||null}h!==null&&(h=this.removeEmptyProps(h));let d;try{let f=s?s.snapshot:this.routerState.snapshot.root;d=Wy(f)}catch{(typeof r[0]!="string"||!r[0].startsWith("/"))&&(r=[]),d=this.currentUrlTree.root}return Hy(d,r,h,l??null)}navigateByUrl(r,i={skipLocationChange:!1}){let s=Gr(r)?r:this.parseUrl(r),o=this.urlHandlingStrategy.merge(s,this.rawUrlTree);return this.scheduleNavigation(o,ys,null,i)}navigate(r,i={skipLocationChange:!1}){return eS(r),this.navigateByUrl(this.createUrlTree(r,i),i)}serializeUrl(r){return this.urlSerializer.serialize(r)}parseUrl(r){try{return this.urlSerializer.parse(r)}catch{return this.urlSerializer.parse("/")}}isActive(r,i){let s;if(i===!0?s=D({},JC):i===!1?s=D({},ZC):s=i,Gr(r))return Ry(this.currentUrlTree,r,s);let o=this.parseUrl(r);return Ry(this.currentUrlTree,o,s)}removeEmptyProps(r){return Object.entries(r).reduce((i,[s,o])=>(o!=null&&(i[s]=o),i),{})}scheduleNavigation(r,i,s,o,a){if(this.disposed)return Promise.resolve(!1);let u,c,l;a?(u=a.resolve,c=a.reject,l=a.promise):l=new Promise((d,f)=>{u=d,c=f});let h=this.pendingTasks.add();return fv(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(h))}),this.navigationTransitions.handleNavigationRequest({source:i,restoredState:s,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:r,extras:o,resolve:u,reject:c,promise:l,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),l.catch(d=>Promise.reject(d))}};e.\u0275fac=function(i){return new(i||e)},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function eS(n){for(let e=0;e<n.length;e++)if(n[e]==null)throw new ne(4008,!1)}function tS(n){return!(n instanceof Is)&&!(n instanceof Ts)}var My=(()=>{let e=class e{constructor(r,i,s,o,a,u){this.router=r,this.route=i,this.tabIndexAttribute=s,this.renderer=o,this.el=a,this.locationStrategy=u,this.href=null,this.commands=null,this.onChanges=new _t,this.preserveFragment=!1,this.skipLocationChange=!1,this.replaceUrl=!1;let c=a.nativeElement.tagName?.toLowerCase();this.isAnchorElement=c==="a"||c==="area",this.isAnchorElement?this.subscription=r.events.subscribe(l=>{l instanceof lt&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(r){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",r)}ngOnChanges(r){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(r){r!=null?(this.commands=Array.isArray(r)?r:[r],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(r,i,s,o,a){let u=this.urlTree;if(u===null||this.isAnchorElement&&(r!==0||i||s||o||a||typeof this.target=="string"&&this.target!="_self"))return!0;let c={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(u,c),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let r=this.urlTree;this.href=r!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(r)):null;let i=this.href===null?null:$g(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",i)}applyAttributeValue(r,i){let s=this.renderer,o=this.el.nativeElement;i!==null?s.setAttribute(o,r,i):s.removeAttribute(o,r)}get urlTree(){return this.commands===null?null:this.router.createUrlTree(this.commands,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}};e.\u0275fac=function(i){return new(i||e)(z(Bt),z(Yn),jg("tabindex"),z(un),z(an),z(Ji))},e.\u0275dir=Pe({type:e,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(i,s){i&1&&jt("click",function(a){return s.onClick(a.button,a.ctrlKey,a.shiftKey,a.altKey,a.metaKey)}),i&2&&ol("target",s.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[Et.HasDecoratorInputTransform,"preserveFragment","preserveFragment",Or],skipLocationChange:[Et.HasDecoratorInputTransform,"skipLocationChange","skipLocationChange",Or],replaceUrl:[Et.HasDecoratorInputTransform,"replaceUrl","replaceUrl",Or],routerLink:"routerLink"},standalone:!0,features:[Qg,qn]});let n=e;return n})(),xV=(()=>{let e=class e{get isActive(){return this._isActive}constructor(r,i,s,o,a){this.router=r,this.element=i,this.renderer=s,this.cdr=o,this.link=a,this.classes=[],this._isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new rt,this.routerEventsSubscription=r.events.subscribe(u=>{u instanceof lt&&this.update()})}ngAfterContentInit(){P(this.links.changes,P(null)).pipe(zi()).subscribe(r=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){this.linkInputChangesSubscription?.unsubscribe();let r=[...this.links.toArray(),this.link].filter(i=>!!i).map(i=>i.onChanges);this.linkInputChangesSubscription=ee(r).pipe(zi()).subscribe(i=>{this._isActive!==this.isLinkActive(this.router)(i)&&this.update()})}set routerLinkActive(r){let i=Array.isArray(r)?r:r.split(" ");this.classes=i.filter(s=>!!s)}ngOnChanges(r){this.update()}ngOnDestroy(){this.routerEventsSubscription.unsubscribe(),this.linkInputChangesSubscription?.unsubscribe()}update(){!this.links||!this.router.navigated||queueMicrotask(()=>{let r=this.hasActiveLinks();this._isActive!==r&&(this._isActive=r,this.cdr.markForCheck(),this.classes.forEach(i=>{r?this.renderer.addClass(this.element.nativeElement,i):this.renderer.removeClass(this.element.nativeElement,i)}),r&&this.ariaCurrentWhenActive!==void 0?this.renderer.setAttribute(this.element.nativeElement,"aria-current",this.ariaCurrentWhenActive.toString()):this.renderer.removeAttribute(this.element.nativeElement,"aria-current"),this.isActiveChange.emit(r))})}isLinkActive(r){let i=nS(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return s=>{let o=s.urlTree;return o?r.isActive(o,i):!1}}hasActiveLinks(){let r=this.isLinkActive(this.router);return this.link&&r(this.link)||this.links.some(r)}};e.\u0275fac=function(i){return new(i||e)(z(Bt),z(an),z(un),z(kr),z(My,8))},e.\u0275dir=Pe({type:e,selectors:[["","routerLinkActive",""]],contentQueries:function(i,s,o){if(i&1&&Zg(o,My,5),i&2){let a;em(a=tm())&&(s.links=a)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",ariaCurrentWhenActive:"ariaCurrentWhenActive",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],standalone:!0,features:[qn]});let n=e;return n})();function nS(n){return!!n.paths}var za=class{};var rS=(()=>{let e=class e{constructor(r,i,s,o,a){this.router=r,this.injector=s,this.preloadingStrategy=o,this.loader=a}setUpPreloading(){this.subscription=this.router.events.pipe(Ge(r=>r instanceof lt),nn(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(r,i){let s=[];for(let o of i){o.providers&&!o._injector&&(o._injector=sl(o.providers,r,`Route: ${o.path}`));let a=o._injector??r,u=o._loadedInjector??a;(o.loadChildren&&!o._loadedRoutes&&o.canLoad===void 0||o.loadComponent&&!o._loadedComponent)&&s.push(this.preloadConfig(a,o)),(o.children||o._loadedRoutes)&&s.push(this.processRoutes(u,o.children??o._loadedRoutes))}return ee(s).pipe(zi())}preloadConfig(r,i){return this.preloadingStrategy.preload(i,()=>{let s;i.loadChildren&&i.canLoad===void 0?s=this.loader.loadChildren(r,i):s=P(null);let o=s.pipe(He(a=>a===null?P(void 0):(i._loadedRoutes=a.routes,i._loadedInjector=a.injector,this.processRoutes(a.injector??r,a.routes))));if(i.loadComponent&&!i._loadedComponent){let a=this.loader.loadComponent(i);return ee([o,a]).pipe(zi())}else return o})}};e.\u0275fac=function(i){return new(i||e)(S(Bt),S(ia),S(Bn),S(za),S(gh))},e.\u0275prov=$({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})(),pv=new F(""),iS=(()=>{let e=class e{constructor(r,i,s,o,a={}){this.urlSerializer=r,this.transitions=i,this.viewportScroller=s,this.zone=o,this.options=a,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},a.scrollPositionRestoration||="disabled",a.anchorScrolling||="disabled"}init(){this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof Kr?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=r.navigationTrigger,this.restoredId=r.restoredState?r.restoredState.navigationId:0):r instanceof lt?(this.lastId=r.id,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.urlAfterRedirects).fragment)):r instanceof mn&&r.code===ka.IgnoredSameUrlNavigation&&(this.lastSource=void 0,this.restoredId=0,this.scheduleScrollEvent(r,this.urlSerializer.parse(r.url).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(r=>{r instanceof Fa&&(r.position?this.options.scrollPositionRestoration==="top"?this.viewportScroller.scrollToPosition([0,0]):this.options.scrollPositionRestoration==="enabled"&&this.viewportScroller.scrollToPosition(r.position):r.anchor&&this.options.anchorScrolling==="enabled"?this.viewportScroller.scrollToAnchor(r.anchor):this.options.scrollPositionRestoration!=="disabled"&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(r,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new Fa(r,this.lastSource==="popstate"?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}};e.\u0275fac=function(i){zg()},e.\u0275prov=$({token:e,factory:e.\u0275fac});let n=e;return n})();function sS(n){return n.routerState.root}function Ns(n,e){return{\u0275kind:n,\u0275providers:e}}function oS(){let n=x(Yo);return e=>{let t=n.get(Xi);if(e!==t.components[0])return;let r=n.get(Bt),i=n.get(gv);n.get(vh)===1&&r.initialNavigation(),n.get(mv,null,nl.Optional)?.setUpPreloading(),n.get(pv,null,nl.Optional)?.init(),r.resetRootComponentType(t.componentTypes[0]),i.closed||(i.next(),i.complete(),i.unsubscribe())}}var gv=new F("",{factory:()=>new _t}),vh=new F("",{providedIn:"root",factory:()=>1});function aS(){return Ns(2,[{provide:vh,useValue:0},{provide:ul,multi:!0,deps:[Yo],useFactory:e=>{let t=e.get(fm,Promise.resolve());return()=>t.then(()=>new Promise(r=>{let i=e.get(Bt),s=e.get(gv);fv(i,()=>{r(!0)}),e.get(yh).afterPreactivation=()=>(r(!0),s.closed?P(void 0):s),i.initialNavigation()}))}}])}function uS(){return Ns(3,[{provide:ul,multi:!0,useFactory:()=>{let e=x(Bt);return()=>{e.setUpLocationChangeListener()}}},{provide:vh,useValue:2}])}var mv=new F("");function cS(n){return Ns(0,[{provide:mv,useExisting:rS},{provide:za,useExisting:n}])}function lS(){return Ns(8,[xy,{provide:Ga,useExisting:xy}])}function hS(n){let e=[{provide:lv,useValue:GC},{provide:hv,useValue:D({skipNextTransition:!!n?.skipInitialTransition},n)}];return Ns(9,e)}var ky=new F("ROUTER_FORROOT_GUARD"),dS=[Zi,{provide:Rs,useClass:_s},Bt,Ds,{provide:Yn,useFactory:sS,deps:[Bt]},gh,[]],NV=(()=>{let e=class e{constructor(r){}static forRoot(r,i){return{ngModule:e,providers:[dS,[],{provide:$a,multi:!0,useValue:r},{provide:ky,useFactory:mS,deps:[[Bt,new Gi,new Fg]]},{provide:xs,useValue:i||{}},i?.useHash?pS():gS(),fS(),i?.preloadingStrategy?cS(i.preloadingStrategy).\u0275providers:[],i?.initialNavigation?yS(i):[],i?.bindToComponentInputs?lS().\u0275providers:[],i?.enableViewTransitions?hS().\u0275providers:[],vS()]}}static forChild(r){return{ngModule:e,providers:[{provide:$a,multi:!0,useValue:r}]}}};e.\u0275fac=function(i){return new(i||e)(S(ky,8))},e.\u0275mod=Ue({type:e}),e.\u0275inj=Le({});let n=e;return n})();function fS(){return{provide:pv,useFactory:()=>{let n=x(vm),e=x(le),t=x(xs),r=x(yh),i=x(Rs);return t.scrollOffset&&n.setOffset(t.scrollOffset),new iS(i,r,n,e,t)}}}function pS(){return{provide:Ji,useClass:gm}}function gS(){return{provide:Ji,useClass:pm}}function mS(n){return"guarded"}function yS(n){return[n.initialNavigation==="disabled"?uS().\u0275providers:[],n.initialNavigation==="enabledBlocking"?aS().\u0275providers:[]]}var Oy=new F("");function vS(){return[{provide:Oy,useFactory:oS},{provide:ra,multi:!0,useExisting:Oy}]}var _S="firebase",wS="10.9.0";ln(_S,wS,"app");var Jn=new Yi("ANGULARFIRE2_VERSION");var ES=(n,e)=>{let t=e?[e]:Am(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Xn=class{constructor(){return ES(IS)}},IS="app-check";function _h(){}var Wa=class{zone;delegate;constructor(e,t=Sg){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},wh=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",_h,{},_h,_h)),t.pipe(ve({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},Ha=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new Wa(Zone.current)),this.insideAngular=t.run(()=>new Wa(Zone.current,Wo)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(S(le))};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function yv(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function zV(n){return n.pipe(tn(yv().outsideAngular))}function Ke(n){return TS(yv())(n)}function TS(n){return function(t){return t=t.lift(new wh(n.ngZone)),t.pipe(Pr(n.outsideAngular),tn(n.insideAngular))}}var AS="firebase",CS="10.9.0";je.registerVersion(AS,CS,"app-compat");var SS=["ngOnDestroy"],wv=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(SS.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let u=a?.[s];return typeof u=="function"?u.bind(a):u?.then?u.then(c=>t.run(()=>c)):t.run(()=>u)});return new Proxy(()=>{},{get:(a,u)=>o[u],apply:(a,u,c)=>o.then(l=>{let h=l?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,h),h})})})});var Qa=class{constructor(e){return e}},Qr=new F("angularfire2.app.options"),Yr=new F("angularfire2.app.name");function Ms(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=je.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>je.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;bS("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new Qa(o)}var bS=(n,...e)=>{cl()&&typeof console<"u"&&console[n](...e)},RS={provide:Qa,useFactory:Ms,deps:[Qr,le,[new Gi,Yr]]},ZV=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:Qr,useValue:t},{provide:Yr,useValue:r}]}}constructor(t){je.registerVersion("angularfire",Jn.full,"core"),je.registerVersion("angularfire",Jn.full,"app-compat"),je.registerVersion("angular",rm.full,t.toString())}static \u0275fac=function(r){return new(r||n)(S(Qe))};static \u0275mod=Ue({type:n});static \u0275inj=Le({providers:[RS]})}return n})();function Ya(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return DS(i,o)||(_v("error",`${e} was already initialized on the ${t} Firebase App with different settings.${PS?" You may need to reload as Firebase is not HMR aware.":""}`),_v("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function DS(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var PS=typeof module<"u"&&!!module.hot,_v=(n,...e)=>{cl()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var NS=new Map,MS={activated:!1,tokenObservers:[]},kS={initialized:!1,enabled:!1};function ht(n){return NS.get(n)||Object.assign({},MS)}function Cv(){return kS}var OS="https://content-firebaseappcheck.googleapis.com/v1";var FS="exchangeDebugToken",Ev={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},cx=24*60*60*1e3;var Ih=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return m(this,null,function*(){this.stop();try{this.pending=new ll,this.pending.promise.catch(t=>{}),yield LS(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new ll,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function LS(n){return new Promise(e=>{setTimeout(e,n)})}var US={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},vn=new Im("appCheck","AppCheck",US);function Sv(n){if(!ht(n).activated)throw vn.create("use-before-activation",{appName:n.name})}function bv(r,i){return m(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let f=yield o.getHeartbeatsHeader();f&&(s["X-Firebase-Client"]=f)}let a={method:"POST",body:JSON.stringify(e),headers:s},u;try{u=yield fetch(n,a)}catch(f){throw vn.create("fetch-network-error",{originalErrorMessage:f?.message})}if(u.status!==200)throw vn.create("fetch-status-error",{httpStatus:u.status});let c;try{c=yield u.json()}catch(f){throw vn.create("fetch-parse-error",{originalErrorMessage:f?.message})}let l=c.ttl.match(/^([\d.]+)(s)$/);if(!l||!l[2]||isNaN(Number(l[1])))throw vn.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let h=Number(l[1])*1e3,d=Date.now();return{token:c.token,expireTimeMillis:d+h,issuedAtTimeMillis:d}})}function Rv(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${OS}/projects/${t}/apps/${r}:${FS}?key=${i}`,body:{debug_token:e}}}var jS="firebase-app-check-database",BS=1,Th="firebase-app-check-store";var Xa=null;function qS(){return Xa||(Xa=new Promise((n,e)=>{try{let t=indexedDB.open(jS,BS);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(vn.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Th,{keyPath:"compositeKey"})}}}catch(t){e(vn.create("storage-open",{originalErrorMessage:t?.message}))}}),Xa)}function $S(n,e){return zS(GS(n),e)}function zS(n,e){return m(this,null,function*(){let r=(yield qS()).transaction(Th,"readwrite"),s=r.objectStore(Th).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=u=>{o()},r.onerror=u=>{var c;a(vn.create("storage-set",{originalErrorMessage:(c=u.target.error)===null||c===void 0?void 0:c.message}))}})})}function GS(n){return`${n.options.appId}-${n.name}`}var Ah=new ua("@firebase/app-check");function Eh(n,e){return aa()?$S(n,e).catch(t=>{Ah.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Dv(){return Cv().enabled}function Pv(){return m(this,null,function*(){let n=Cv();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var KS={error:"UNKNOWN_ERROR"};function WS(n){return _m.encodeString(JSON.stringify(n),!1)}function Ch(n,e=!1){return m(this,null,function*(){let t=n.app;Sv(t);let r=ht(t),i=r.token,s;if(i&&!ks(i)&&(r.token=void 0,i=void 0),!i){let u=yield r.cachedTokenPromise;u&&(ks(u)?i=u:yield Eh(t,void 0))}if(!e&&i&&ks(i))return{token:i.token};let o=!1;if(Dv()){r.exchangeTokenPromise||(r.exchangeTokenPromise=bv(Rv(t,yield Pv()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let u=yield r.exchangeTokenPromise;return yield Eh(t,u),r.token=u,{token:u.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield ht(t).exchangeTokenPromise}catch(u){u.code==="appCheck/throttled"?Ah.warn(u.message):Ah.error(u),s=u}let a;return i?s?ks(i)?a={token:i.token,internalError:s}:a=Tv(s):(a={token:i.token},r.token=i,yield Eh(t,i)):a=Tv(s),o&&XS(t,a),a})}function HS(n){return m(this,null,function*(){let e=n.app;Sv(e);let{provider:t}=ht(e);if(Dv()){let r=yield Pv(),{token:i}=yield bv(Rv(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function QS(n,e,t,r){let{app:i}=n,s=ht(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&ks(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),Iv(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Iv(n))}function Vv(n,e){let t=ht(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function Iv(n){let{app:e}=n,t=ht(e),r=t.tokenRefresher;r||(r=YS(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function YS(n){let{app:e}=n;return new Ih(()=>m(this,null,function*(){let t=ht(e),r;if(t.token?r=yield Ch(n,!0):r=yield Ch(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=ht(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},Ev.RETRIAL_MIN_WAIT,Ev.RETRIAL_MAX_WAIT)}function XS(n,e){let t=ht(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function ks(n){return n.expireTimeMillis-Date.now()>0}function Tv(n){return{token:WS(KS),error:n}}var Sh=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=ht(this.app);for(let t of e)Vv(this.app,t.next);return Promise.resolve()}};function JS(n,e){return new Sh(n,e)}function ZS(n){return{getToken:e=>Ch(n,e),getLimitedUseToken:()=>HS(n),addTokenListener:e=>QS(n,"INTERNAL",e),removeTokenListener:e=>Vv(n.app,e)}}var eb="@firebase/app-check",tb="0.8.2";var nb="app-check",Av="app-check-internal";function rb(){ts(new Gn(nb,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return JS(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Av).initialize()})),ts(new Gn(Av,n=>{let e=n.getProvider("app-check").getImmediate();return ZS(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),ln(eb,tb)}rb();var ib=["localhost","0.0.0.0","127.0.0.1"],Ex=typeof window<"u"&&ib.includes(window.location.hostname);var bh=new F("angularfire2.auth.use-emulator"),Rh=new F("angularfire2.auth.settings"),Dh=new F("angularfire2.auth.tenant-id"),Ph=new F("angularfire2.auth.langugage-code"),Vh=new F("angularfire2.auth.use-device-language"),xh=new F("angularfire.auth.persistence"),Nh=(n,e,t,r,i,s,o,a)=>Ya(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let u=e.runOutsideAngular(()=>n.auth());if(t&&u.useEmulator(...t),r&&(u.tenantId=r),u.languageCode=i,s&&u.useDeviceLanguage(),o)for(let[c,l]of Object.entries(o))u.settings[c]=l;return a&&u.setPersistence(a),u},[t,r,i,s,o,a]),Mh=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,u,c,l,h,d,f){let E=new _t,w=P(void 0).pipe(tn(o.outsideAngular),ye(()=>s.runOutsideAngular(()=>import("./chunk-R3ZTQMVJ.js"))),O(()=>Ms(t,s,r)),O(y=>Nh(y,s,a,c,l,h,u,d)),el({bufferSize:1,refCount:!1}));if(zn(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=P(null);else{w.pipe(wt()).subscribe();let y=w.pipe(ye(R=>R.getRedirectResult().then(M=>M,()=>null)),Ke,el({bufferSize:1,refCount:!1})),I=w.pipe(ye(R=>new Zt(M=>({unsubscribe:s.runOutsideAngular(()=>R.onAuthStateChanged(j=>M.next(j),j=>M.error(j),()=>M.complete()))})))),k=w.pipe(ye(R=>new Zt(M=>({unsubscribe:s.runOutsideAngular(()=>R.onIdTokenChanged(j=>M.next(j),j=>M.error(j),()=>M.complete()))}))));this.authState=y.pipe(tl(I),Pr(o.outsideAngular),tn(o.insideAngular)),this.user=y.pipe(tl(k),Pr(o.outsideAngular),tn(o.insideAngular)),this.idToken=this.user.pipe(ye(R=>R?ee(R.getIdToken()):P(null))),this.idTokenResult=this.user.pipe(ye(R=>R?ee(R.getIdTokenResult()):P(null))),this.credential=Vg(y,E,this.authState.pipe(Ge(R=>!R))).pipe(O(R=>R?.user?R:null),Pr(o.outsideAngular),tn(o.insideAngular))}return wv(this,w,s,{spy:{apply:(y,I,k)=>{(y.startsWith("signIn")||y.startsWith("createUser"))&&k.then(R=>E.next(R))}}})}static \u0275fac=function(r){return new(r||n)(S(Qr),S(Yr,8),S(Qe),S(le),S(Ha),S(bh,8),S(Rh,8),S(Dh,8),S(Ph,8),S(Vh,8),S(xh,8),S(Xn,8))};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),Fx=(()=>{class n{constructor(){je.registerVersion("angularfire",Jn.full,"auth-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Ue({type:n});static \u0275inj=Le({providers:[Mh]})}return n})();var ob=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ft={},C,nd=nd||{},L=ob||self;function hu(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function Qs(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function ab(n){return Object.prototype.hasOwnProperty.call(n,kh)&&n[kh]||(n[kh]=++ub)}var kh="closure_uid_"+(1e9*Math.random()>>>0),ub=0;function cb(n,e,t){return n.call.apply(n.bind,arguments)}function lb(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function Me(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?Me=cb:Me=lb,Me.apply(null,arguments)}function Ja(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function be(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function _n(){this.s=this.s,this.o=this.o}var hb=0;_n.prototype.s=!1;_n.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),hb!=0)&&ab(this)};_n.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Gv=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function rd(n){let e=n.length;if(0<e){let t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Nv(n,e){for(let t=1;t<arguments.length;t++){let r=arguments[t];if(hu(r)){let i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function ke(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}ke.prototype.h=function(){this.defaultPrevented=!0};var db=function(){if(!L.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let t=()=>{};L.addEventListener("test",t,e),L.removeEventListener("test",t,e)}catch{}return n}();function Bs(n){return/^[\s\xa0]*$/.test(n)}function du(){var n=L.navigator;return n&&(n=n.userAgent)?n:""}function bt(n){return du().indexOf(n)!=-1}function id(n){return id[" "](n),n}id[" "]=function(){};function fb(n,e){var t=tR;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var pb=bt("Opera"),ei=bt("Trident")||bt("MSIE"),Kv=bt("Edge"),jh=Kv||ei,Wv=bt("Gecko")&&!(du().toLowerCase().indexOf("webkit")!=-1&&!bt("Edge"))&&!(bt("Trident")||bt("MSIE"))&&!bt("Edge"),gb=du().toLowerCase().indexOf("webkit")!=-1&&!bt("Edge");function Hv(){var n=L.document;return n?n.documentMode:void 0}var Bh;e:{if(Za="",eu=function(){var n=du();if(Wv)return/rv:([^\);]+)(\)|;)/.exec(n);if(Kv)return/Edge\/([\d\.]+)/.exec(n);if(ei)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(gb)return/WebKit\/(\S+)/.exec(n);if(pb)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),eu&&(Za=eu?eu[1]:""),ei&&(tu=Hv(),tu!=null&&tu>parseFloat(Za))){Bh=String(tu);break e}Bh=Za}var Za,eu,tu,qh;L.document&&ei?(Oh=Hv(),qh=Oh||parseInt(Bh,10)||void 0):qh=void 0;var Oh,mb=qh;function qs(n,e){if(ke.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Wv){e:{try{id(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:yb[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&qs.$.h.call(this)}}be(qs,ke);var yb={2:"touch",3:"pen",4:"mouse"};qs.prototype.h=function(){qs.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var Ys="closure_listenable_"+(1e6*Math.random()|0),vb=0;function _b(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++vb,this.fa=this.ia=!1}function fu(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function sd(n,e,t){for(let r in n)e.call(t,n[r],r,n)}function wb(n,e){for(let t in n)e.call(void 0,n[t],t,n)}function Qv(n){let e={};for(let t in n)e[t]=n[t];return e}var Mv="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Yv(n,e){let t,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(t in r)n[t]=r[t];for(let s=0;s<Mv.length;s++)t=Mv[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function pu(n){this.src=n,this.g={},this.h=0}pu.prototype.add=function(n,e,t,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=zh(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new _b(e,this.src,s,!!r,i),e.ia=t,n.push(e)),e};function $h(n,e){var t=e.type;if(t in n.g){var r=n.g[t],i=Gv(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(fu(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function zh(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}var od="closure_lm_"+(1e6*Math.random()|0),Fh={};function Xv(n,e,t,r,i){if(r&&r.once)return Zv(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Xv(n,e[s],t,r,i);return null}return t=cd(t),n&&n[Ys]?n.O(e,t,Qs(r)?!!r.capture:!!r,i):Jv(n,e,t,!1,r,i)}function Jv(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=Qs(i)?!!i.capture:!!i,a=ud(n);if(a||(n[od]=a=new pu(n)),t=a.add(e,t,r,o,s),t.proxy)return t;if(r=Eb(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)db||(i=o),i===void 0&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(t_(e.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function Eb(){function n(t){return e.call(n.src,n.listener,t)}let e=Ib;return n}function Zv(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Zv(n,e[s],t,r,i);return null}return t=cd(t),n&&n[Ys]?n.P(e,t,Qs(r)?!!r.capture:!!r,i):Jv(n,e,t,!0,r,i)}function e_(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)e_(n,e[s],t,r,i);else r=Qs(r)?!!r.capture:!!r,t=cd(t),n&&n[Ys]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=zh(s,t,r,i),-1<t&&(fu(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=ud(n))&&(e=n.g[e.toString()],n=-1,e&&(n=zh(e,t,r,i)),(t=-1<n?e[n]:null)&&ad(t))}function ad(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[Ys])$h(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(t_(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=ud(e))?($h(t,n),t.h==0&&(t.src=null,e[od]=null)):fu(n)}}}function t_(n){return n in Fh?Fh[n]:Fh[n]="on"+n}function Ib(n,e){if(n.fa)n=!0;else{e=new qs(e,this);var t=n.listener,r=n.la||n.src;n.ia&&ad(n),n=t.call(r,e)}return n}function ud(n){return n=n[od],n instanceof pu?n:null}var Lh="__closure_events_fn_"+(1e9*Math.random()>>>0);function cd(n){return typeof n=="function"?n:(n[Lh]||(n[Lh]=function(e){return n.handleEvent(e)}),n[Lh])}function Se(){_n.call(this),this.i=new pu(this),this.S=this,this.J=null}be(Se,_n);Se.prototype[Ys]=!0;Se.prototype.removeEventListener=function(n,e,t,r){e_(this,n,e,t,r)};function xe(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,typeof e=="string")e=new ke(e,n);else if(e instanceof ke)e.target=e.target||n;else{var i=e;e=new ke(r,n),Yv(e,i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=nu(o,r,!0,e)&&i}if(o=e.g=n,i=nu(o,r,!0,e)&&i,i=nu(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)o=e.g=t[s],i=nu(o,r,!1,e)&&i}Se.prototype.N=function(){if(Se.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)fu(t[r]);delete n.g[e],n.h--}}this.J=null};Se.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)};Se.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};function nu(n,e,t,r){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,u=o.la||o.src;o.ia&&$h(n.i,o),i=a.call(u,r)!==!1&&i}}return i&&!r.defaultPrevented}var ld=L.JSON.stringify,Gh=class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function Tb(){var n=hd;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var Kh=class{constructor(){this.h=this.g=null}add(e,t){let r=n_.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},n_=new Gh(()=>new Wh,n=>n.reset()),Wh=class{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}};function Ab(n){var e=1;n=n.split(":");let t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function Cb(n){L.setTimeout(()=>{throw n},0)}var $s,zs=!1,hd=new Kh,r_=()=>{let n=L.Promise.resolve(void 0);$s=()=>{n.then(Sb)}},Sb=()=>{for(var n;n=Tb();){try{n.h.call(n.g)}catch(t){Cb(t)}var e=n_;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}zs=!1};function gu(n,e){Se.call(this),this.h=n||1,this.g=e||L,this.j=Me(this.qb,this),this.l=Date.now()}be(gu,Se);C=gu.prototype;C.ga=!1;C.T=null;C.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),xe(this,"tick"),this.ga&&(dd(this),this.start()))}};C.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function dd(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}C.N=function(){gu.$.N.call(this),dd(this),delete this.g};function fd(n,e,t){if(typeof n=="function")t&&(n=Me(n,t));else if(n&&typeof n.handleEvent=="function")n=Me(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:L.setTimeout(n,e||0)}function i_(n){n.g=fd(()=>{n.g=null,n.i&&(n.i=!1,i_(n))},n.j);let e=n.h;n.h=null,n.m.apply(null,e)}var Hh=class extends _n{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:i_(this)}N(){super.N(),this.g&&(L.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Gs(n){_n.call(this),this.h=n,this.g={}}be(Gs,_n);var kv=[];function s_(n,e,t,r){Array.isArray(t)||(t&&(kv[0]=t.toString()),t=kv);for(var i=0;i<t.length;i++){var s=Xv(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function o_(n){sd(n.g,function(e,t){this.g.hasOwnProperty(t)&&ad(e)},n),n.g={}}Gs.prototype.N=function(){Gs.$.N.call(this),o_(this)};Gs.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function mu(){this.g=!0}mu.prototype.Ea=function(){this.g=!1};function bb(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&h[1]=="type"?o+(l+"="+c+"&"):o+(l+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+t+`
`+o})}function Rb(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+t+`
`+s+" "+o})}function Jr(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+Pb(n,t)+(r?" "+r:"")})}function Db(n,e){n.info(function(){return"TIMEOUT: "+e})}mu.prototype.info=function(){};function Pb(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return ld(t)}catch{return e}}var nr={},Ov=null;function yu(){return Ov=Ov||new Se}nr.Ta="serverreachability";function a_(n){ke.call(this,nr.Ta,n)}be(a_,ke);function Ks(n){let e=yu();xe(e,new a_(e))}nr.STAT_EVENT="statevent";function u_(n,e){ke.call(this,nr.STAT_EVENT,n),this.stat=e}be(u_,ke);function Be(n){let e=yu();xe(e,new u_(e,n))}nr.Ua="timingevent";function c_(n,e){ke.call(this,nr.Ua,n),this.size=e}be(c_,ke);function Xs(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return L.setTimeout(function(){n()},e)}var vu={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},l_={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function pd(){}pd.prototype.h=null;function Fv(n){return n.h||(n.h=n.i())}function h_(){}var Js={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function gd(){ke.call(this,"d")}be(gd,ke);function md(){ke.call(this,"c")}be(md,ke);var Qh;function _u(){}be(_u,pd);_u.prototype.g=function(){return new XMLHttpRequest};_u.prototype.i=function(){return{}};Qh=new _u;function Zs(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Gs(this),this.P=Vb,n=jh?125:void 0,this.V=new gu(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new d_}function d_(){this.i=null,this.g="",this.h=!1}var Vb=45e3,f_={},Yh={};C=Zs.prototype;C.setTimeout=function(n){this.P=n};function Xh(n,e,t){n.L=1,n.A=Eu($t(e)),n.u=t,n.S=!0,p_(n,null)}function p_(n,e){n.G=Date.now(),eo(n),n.B=$t(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),I_(t.i,"t",r),n.o=0,t=n.l.J,n.h=new d_,n.g=$_(n.l,t?e:null,!n.u),0<n.O&&(n.M=new Hh(Me(n.Pa,n,n.g),n.O)),s_(n.U,n.g,"readystatechange",n.nb),e=n.I?Qv(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),Ks(),bb(n.j,n.v,n.B,n.m,n.W,n.u)}C.nb=function(n){n=n.target;let e=this.M;e&&Rt(n)==3?e.l():this.Pa(n)};C.Pa=function(n){try{if(n==this.g)e:{let l=Rt(this.g);var e=this.g.Ia();let h=this.g.da();if(!(3>l)&&(l!=3||jh||this.g&&(this.h.h||this.g.ja()||Bv(this.g)))){this.J||l!=4||e==7||(e==8||0>=h?Ks(3):Ks(2)),wu(this);var t=this.g.da();this.ca=t;t:if(g_(this)){var r=Bv(this.g);n="";var i=r.length,s=Rt(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Zn(this),js(this);var o="";break t}this.h.i=new L.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,Rb(this.j,this.v,this.B,this.m,this.W,l,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,u=this.g;if((a=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Bs(a)){var c=a;break t}}c=null}if(t=c)Jr(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Jh(this,t);else{this.i=!1,this.s=3,Be(12),Zn(this),js(this);break e}}this.S?(m_(this,l,o),jh&&this.i&&l==3&&(s_(this.U,this.V,"tick",this.mb),this.V.start())):(Jr(this.j,this.m,o,null),Jh(this,o)),l==4&&Zn(this),this.i&&!this.J&&(l==4?U_(this.l,this):(this.i=!1,eo(this)))}else Jb(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,Be(12)):(this.s=0,Be(13)),Zn(this),js(this)}}}catch{}finally{}};function g_(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function m_(n,e,t){let r=!0,i;for(;!n.J&&n.o<t.length;)if(i=xb(n,t),i==Yh){e==4&&(n.s=4,Be(14),r=!1),Jr(n.j,n.m,null,"[Incomplete Response]");break}else if(i==f_){n.s=4,Be(15),Jr(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}else Jr(n.j,n.m,i,null),Jh(n,i);g_(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,Be(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Id(e),e.M=!0,Be(11))):(Jr(n.j,n.m,t,"[Invalid Chunked Response]"),Zn(n),js(n))}C.mb=function(){if(this.g){var n=Rt(this.g),e=this.g.ja();this.o<e.length&&(wu(this),m_(this,n,e),this.i&&n!=4&&eo(this))}};function xb(n,e){var t=n.o,r=e.indexOf(`
`,t);return r==-1?Yh:(t=Number(e.substring(t,r)),isNaN(t)?f_:(r+=1,r+t>e.length?Yh:(e=e.slice(r,r+t),n.o=r+t,e)))}C.cancel=function(){this.J=!0,Zn(this)};function eo(n){n.Y=Date.now()+n.P,y_(n,n.P)}function y_(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=Xs(Me(n.lb,n),e)}function wu(n){n.C&&(L.clearTimeout(n.C),n.C=null)}C.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(Db(this.j,this.B),this.L!=2&&(Ks(),Be(17)),Zn(this),this.s=2,js(this)):y_(this,this.Y-n)};function js(n){n.l.H==0||n.J||U_(n.l,n)}function Zn(n){wu(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,dd(n.V),o_(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function Jh(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||Zh(t.i,n))){if(!n.K&&Zh(t.i,n)&&t.H==3){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)au(t),Au(t);else break e;Ed(t),Be(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&t.A==0&&!t.v&&(t.v=Xs(Me(t.ib,t),6e3));if(1>=C_(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else er(t,11)}else if((n.K||t.g==n)&&au(t),!Bs(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],t.H==2)if(c[0]=="c"){t.K=c[1],t.pa=c[2];let l=c[3];l!=null&&(t.ra=l,t.l.info("VER="+t.ra));let h=c[4];h!=null&&(t.Ga=h,t.l.info("SVER="+t.Ga));let d=c[5];d!=null&&typeof d=="number"&&0<d&&(r=1.5*d,t.L=r,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;let f=n.g;if(f){let E=f.g?f.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(E){var s=r.i;s.g||E.indexOf("spdy")==-1&&E.indexOf("quic")==-1&&E.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(yd(s,s.h),s.h=null))}if(r.F){let w=f.g?f.g.getResponseHeader("X-HTTP-Session-Id"):null;w&&(r.Da=w,re(r.I,r.F,w))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),r=t;var o=n;if(r.wa=q_(r,r.J?r.pa:null,r.Y),o.K){S_(r.i,o);var a=o,u=r.L;u&&a.setTimeout(u),a.C&&(wu(a),eo(a)),r.g=o}else F_(r);0<t.j.length&&Cu(t)}else c[0]!="stop"&&c[0]!="close"||er(t,7);else t.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?er(t,7):wd(t):c[0]!="noop"&&t.h&&t.h.Aa(c),t.A=0)}}Ks(4)}catch{}}function Nb(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(hu(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}e=[],t=0;for(r in n)e[t++]=n[r];return e}function Mb(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(hu(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(let r in n)e[t++]=r;return e}}}function v_(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(hu(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=Mb(n),r=Nb(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}var __=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function kb(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function tr(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof tr){this.h=n.h,su(this,n.j),this.s=n.s,this.g=n.g,ou(this,n.m),this.l=n.l;var e=n.i,t=new Ws;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),Lv(this,t),this.o=n.o}else n&&(e=String(n).match(__))?(this.h=!1,su(this,e[1]||"",!0),this.s=Ls(e[2]||""),this.g=Ls(e[3]||"",!0),ou(this,e[4]),this.l=Ls(e[5]||"",!0),Lv(this,e[6]||"",!0),this.o=Ls(e[7]||"")):(this.h=!1,this.i=new Ws(null,this.h))}tr.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Us(e,Uv,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(Us(e,Uv,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(Us(t,t.charAt(0)=="/"?Lb:Fb,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Us(t,jb)),n.join("")};function $t(n){return new tr(n)}function su(n,e,t){n.j=t?Ls(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function ou(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function Lv(n,e,t){e instanceof Ws?(n.i=e,Bb(n.i,n.h)):(t||(e=Us(e,Ub)),n.i=new Ws(e,n.h))}function re(n,e,t){n.i.set(e,t)}function Eu(n){return re(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Ls(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Us(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,Ob),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function Ob(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var Uv=/[#\/\?@]/g,Fb=/[#\?:]/g,Lb=/[#\?]/g,Ub=/[#\?@]/g,jb=/#/g;function Ws(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function wn(n){n.g||(n.g=new Map,n.h=0,n.i&&kb(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}C=Ws.prototype;C.add=function(n,e){wn(this),this.i=null,n=ti(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function w_(n,e){wn(n),e=ti(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function E_(n,e){return wn(n),e=ti(n,e),n.g.has(e)}C.forEach=function(n,e){wn(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)};C.ta=function(){wn(this);let n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){let i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t};C.Z=function(n){wn(this);let e=[];if(typeof n=="string")E_(this,n)&&(e=e.concat(this.g.get(ti(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};C.set=function(n,e){return wn(this),this.i=null,n=ti(this,n),E_(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};C.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function I_(n,e,t){w_(n,e),0<t.length&&(n.i=null,n.g.set(ti(n,e),rd(t)),n.h+=t.length)}C.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function ti(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Bb(n,e){e&&!n.j&&(wn(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(w_(this,r),I_(this,i,t))},n)),n.j=e}var qb=class{constructor(n,e){this.g=n,this.map=e}};function T_(n){this.l=n||$b,L.PerformanceNavigationTiming?(n=L.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(L.g&&L.g.Ka&&L.g.Ka()&&L.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var $b=10;function A_(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function C_(n){return n.h?1:n.g?n.g.size:0}function Zh(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function yd(n,e){n.g?n.g.add(e):n.h=e}function S_(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}T_.prototype.cancel=function(){if(this.i=b_(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function b_(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(let t of n.g.values())e=e.concat(t.F);return e}return rd(n.i)}var zb=class{stringify(n){return L.JSON.stringify(n,void 0)}parse(n){return L.JSON.parse(n,void 0)}};function Gb(){this.g=new zb}function Kb(n,e,t){let r=t||"";try{v_(n,function(i,s){let o=i;Qs(i)&&(o=ld(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Wb(n,e){let t=new mu;if(L.Image){let r=new Image;r.onload=Ja(ru,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Ja(ru,t,r,"TestLoadImage: error",!1,e),r.onabort=Ja(ru,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ja(ru,t,r,"TestLoadImage: timeout",!1,e),L.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}function ru(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function to(n){this.l=n.ec||null,this.j=n.ob||!1}be(to,pd);to.prototype.g=function(){return new Iu(this.l,this.j)};to.prototype.i=function(n){return function(){return n}}({});function Iu(n,e){Se.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=vd,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}be(Iu,Se);var vd=0;C=Iu.prototype;C.open=function(n,e){if(this.readyState!=vd)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Hs(this)};C.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||L).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};C.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,no(this)),this.readyState=vd};C.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Hs(this)),this.g&&(this.readyState=3,Hs(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof L.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;R_(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function R_(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}C.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?no(this):Hs(this),this.readyState==3&&R_(this)}};C.Za=function(n){this.g&&(this.response=this.responseText=n,no(this))};C.Ya=function(n){this.g&&(this.response=n,no(this))};C.ka=function(){this.g&&no(this)};function no(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Hs(n)}C.setRequestHeader=function(n,e){this.v.append(n,e)};C.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};C.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function Hs(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(Iu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var Hb=L.JSON.parse;function he(n){Se.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=D_,this.L=this.M=!1}be(he,Se);var D_="",Qb=/^https?$/i,Yb=["POST","PUT"];C=he.prototype;C.Oa=function(n){this.M=n};C.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():Qh.g(),this.C=this.u?Fv(this.u):Fv(Qh),this.g.onreadystatechange=Me(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){jv(this,s);return}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())t.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),i=L.FormData&&n instanceof L.FormData,!(0<=Gv(Yb,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{x_(this),0<this.B&&((this.L=Xb(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Me(this.ua,this)):this.A=fd(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){jv(this,s)}};function Xb(n){return ei&&typeof n.timeout=="number"&&n.ontimeout!==void 0}C.ua=function(){typeof nd<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,xe(this,"timeout"),this.abort(8))};function jv(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,P_(n),Tu(n)}function P_(n){n.F||(n.F=!0,xe(n,"complete"),xe(n,"error"))}C.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,xe(this,"complete"),xe(this,"abort"),Tu(this))};C.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Tu(this,!0)),he.$.N.call(this)};C.La=function(){this.s||(this.G||this.v||this.l?V_(this):this.kb())};C.kb=function(){V_(this)};function V_(n){if(n.h&&typeof nd<"u"&&(!n.C[1]||Rt(n)!=4||n.da()!=2)){if(n.v&&Rt(n)==4)fd(n.La,0,n);else if(xe(n,"readystatechange"),Rt(n)==4){n.h=!1;try{let o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=o===0){var i=String(n.I).match(__)[1]||null;!i&&L.self&&L.self.location&&(i=L.self.location.protocol.slice(0,-1)),r=!Qb.test(i?i.toLowerCase():"")}t=r}if(t)xe(n,"complete"),xe(n,"success");else{n.m=6;try{var s=2<Rt(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",P_(n)}}finally{Tu(n)}}}}function Tu(n,e){if(n.g){x_(n);let t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||xe(n,"ready");try{t.onreadystatechange=r}catch{}}}function x_(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(L.clearTimeout(n.A),n.A=null)}C.isActive=function(){return!!this.g};function Rt(n){return n.g?n.g.readyState:0}C.da=function(){try{return 2<Rt(this)?this.g.status:-1}catch{return-1}};C.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};C.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),Hb(e)}};function Bv(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case D_:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function Jb(n){let e={};n=(n.g&&2<=Rt(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(Bs(n[r]))continue;var t=Ab(n[r]);let i=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();let s=e[i]||[];e[i]=s,s.push(t)}wb(e,function(r){return r.join(", ")})}C.Ia=function(){return this.m};C.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function N_(n){let e="";return sd(n,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function _d(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=N_(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):re(n,e,t))}function Os(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function M_(n){this.Ga=0,this.j=[],this.l=new mu,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Os("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Os("baseRetryDelayMs",5e3,n),this.hb=Os("retryDelaySeedMs",1e4,n),this.eb=Os("forwardChannelMaxRetries",2,n),this.xa=Os("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new T_(n&&n.concurrentRequestLimit),this.Ja=new Gb,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}C=M_.prototype;C.ra=8;C.H=1;function wd(n){if(k_(n),n.H==3){var e=n.W++,t=$t(n.I);if(re(t,"SID",n.K),re(t,"RID",e),re(t,"TYPE","terminate"),ro(n,t),e=new Zs(n,n.l,e),e.L=2,e.A=Eu($t(t)),t=!1,L.navigator&&L.navigator.sendBeacon)try{t=L.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&L.Image&&(new Image().src=e.A,t=!0),t||(e.g=$_(e.l,null),e.g.ha(e.A)),e.G=Date.now(),eo(e)}B_(n)}function Au(n){n.g&&(Id(n),n.g.cancel(),n.g=null)}function k_(n){Au(n),n.u&&(L.clearTimeout(n.u),n.u=null),au(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&L.clearTimeout(n.m),n.m=null)}function Cu(n){if(!A_(n.i)&&!n.m){n.m=!0;var e=n.Na;$s||r_(),zs||($s(),zs=!0),hd.add(e,n),n.C=0}}function Zb(n,e){return C_(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=Xs(Me(n.Na,n,e),j_(n,n.C)),n.C++,!0)}C.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let i=new Zs(this,this.l,n),s=this.s;if(this.U&&(s?(s=Qv(s),Yv(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var r=this.j[t];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=O_(this,i,e),t=$t(this.I),re(t,"RID",n),re(t,"CVER",22),this.F&&re(t,"X-HTTP-Session-Id",this.F),ro(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(N_(s)))+"&"+e:this.o&&_d(t,this.o,s)),yd(this.i,i),this.bb&&re(t,"TYPE","init"),this.P?(re(t,"$req",e),re(t,"SID","null"),i.aa=!0,Xh(i,t,null)):Xh(i,t,e),this.H=2}}else this.H==3&&(n?qv(this,n):this.j.length==0||A_(this.i)||qv(this))};function qv(n,e){var t;e?t=e.m:t=n.W++;let r=$t(n.I);re(r,"SID",n.K),re(r,"RID",t),re(r,"AID",n.V),ro(n,r),n.o&&n.s&&_d(r,n.o,n.s),t=new Zs(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=O_(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),yd(n.i,t),Xh(t,r,e)}function ro(n,e){n.na&&sd(n.na,function(t,r){re(e,r,t)}),n.h&&v_({},function(t,r){re(e,r,t)})}function O_(n,e,t){t=Math.min(n.j.length,t);var r=n.h?Me(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){let o=["count="+t];s==-1?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let u=0;u<t;u++){let c=i[u].g,l=i[u].map;if(c-=s,0>c)s=Math.max(0,i[u].g-100),a=!1;else try{Kb(l,o,"req"+c+"_")}catch{r&&r(l)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function F_(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;$s||r_(),zs||($s(),zs=!0),hd.add(e,n),n.A=0}}function Ed(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=Xs(Me(n.Ma,n),j_(n,n.A)),n.A++,!0)}C.Ma=function(){if(this.u=null,L_(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=Xs(Me(this.jb,this),n)}};C.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Be(10),Au(this),L_(this))};function Id(n){n.B!=null&&(L.clearTimeout(n.B),n.B=null)}function L_(n){n.g=new Zs(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=$t(n.wa);re(e,"RID","rpc"),re(e,"SID",n.K),re(e,"AID",n.V),re(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&re(e,"TO",n.qa),re(e,"TYPE","xmlhttp"),ro(n,e),n.o&&n.s&&_d(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=Eu($t(e)),t.u=null,t.S=!0,p_(t,n)}C.ib=function(){this.v!=null&&(this.v=null,Au(this),Ed(this),Be(19))};function au(n){n.v!=null&&(L.clearTimeout(n.v),n.v=null)}function U_(n,e){var t=null;if(n.g==e){au(n),Id(n),n.g=null;var r=2}else if(Zh(n.i,e))t=e.F,S_(n.i,e),r=1;else return;if(n.H!=0){if(e.i)if(r==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;r=yu(),xe(r,new c_(r,t)),Cu(n)}else F_(n);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&Zb(n,e)||r==2&&Ed(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:er(n,5);break;case 4:er(n,10);break;case 3:er(n,6);break;default:er(n,2)}}}function j_(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function er(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var r=Me(n.pb,n);t||(t=new tr("//www.google.com/images/cleardot.gif"),L.location&&L.location.protocol=="http"||su(t,"https"),Eu(t)),Wb(t.toString(),r)}else Be(2);n.H=0,n.h&&n.h.za(e),B_(n),k_(n)}C.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Be(2)):(this.l.info("Failed to ping google.com"),Be(1))};function B_(n){if(n.H=0,n.ma=[],n.h){let e=b_(n.i);(e.length!=0||n.j.length!=0)&&(Nv(n.ma,e),Nv(n.ma,n.j),n.i.i.length=0,rd(n.j),n.j.length=0),n.h.ya()}}function q_(n,e,t){var r=t instanceof tr?$t(t):new tr(t);if(r.g!="")e&&(r.g=e+"."+r.g),ou(r,r.m);else{var i=L.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new tr(null);r&&su(s,r),e&&(s.g=e),i&&ou(s,i),t&&(s.l=t),r=s}return t=n.F,e=n.Da,t&&e&&re(r,t,e),re(r,"VER",n.ra),ro(n,r),r}function $_(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new he(new to({ob:t})):new he(n.va),e.Oa(n.J),e}C.isActive=function(){return!!this.h&&this.h.isActive(this)};function z_(){}C=z_.prototype;C.Ba=function(){};C.Aa=function(){};C.za=function(){};C.ya=function(){};C.isActive=function(){return!0};C.Va=function(){};function uu(){if(ei&&!(10<=Number(mb)))throw Error("Environmental error: no available transport.")}uu.prototype.g=function(n,e){return new Ze(n,e)};function Ze(n,e){Se.call(this),this.g=new M_(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!Bs(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Bs(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new ni(this)}be(Ze,Se);Ze.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Be(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=q_(n,null,n.Y),Cu(n)};Ze.prototype.close=function(){wd(this.g)};Ze.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=ld(n),n=t);e.j.push(new qb(e.fb++,n)),e.H==3&&Cu(e)};Ze.prototype.N=function(){this.g.h=null,delete this.j,wd(this.g),delete this.g,Ze.$.N.call(this)};function G_(n){gd.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(let t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}be(G_,gd);function K_(){md.call(this),this.status=1}be(K_,md);function ni(n){this.g=n}be(ni,z_);ni.prototype.Ba=function(){xe(this.g,"a")};ni.prototype.Aa=function(n){xe(this.g,new G_(n))};ni.prototype.za=function(n){xe(this.g,new K_)};ni.prototype.ya=function(){xe(this.g,"b")};function eR(){this.blockSize=-1}function dt(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}be(dt,eR);dt.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function Uh(n,e,t){t||(t=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],i=n.g[2];var s=n.g[3],o=e+(s^t&(i^s))+r[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[3]+3250441966&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[7]+4249261313&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[11]+2304563134&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[15]+1236535329&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(t^i))+r[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[0]+3921069994&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[4]+3889429448&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[8]+1163531501&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[12]+2368359562&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(t^i^s)+r[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[14]+4259657740&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[10]+3200236656&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[6]+76029189&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[2]+3299628645&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(i^(t|~s))+r[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[5]+4237533241&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[1]+2240044497&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[13]+1309151649&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}dt.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=t;)Uh(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){Uh(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){Uh(this,r),i=0;break}}this.h=i,this.i+=e};dt.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};function X(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==e||(t[i]=s,r=!1)}this.g=t}var tR={};function Td(n){return-128<=n&&128>n?fb(n,function(e){return new X([e|0],0>e?-1:0)}):new X([n|0],0>n?-1:0)}function Dt(n){if(isNaN(n)||!isFinite(n))return Zr;if(0>n)return Ve(Dt(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=ed;return new X(e,0)}function W_(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return Ve(W_(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Dt(Math.pow(e,8)),r=Zr,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=Dt(Math.pow(e,s)),r=r.R(s).add(Dt(o))):(r=r.R(t),r=r.add(Dt(o)))}return r}var ed=4294967296,Zr=Td(0),td=Td(1),$v=Td(16777216);C=X.prototype;C.ea=function(){if(st(this))return-Ve(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:ed+r)*e,e*=ed}return n};C.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(qt(this))return"0";if(st(this))return"-"+Ve(this).toString(n);for(var e=Dt(Math.pow(n,6)),t=this,r="";;){var i=lu(t,e).g;t=cu(t,i.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=i,qt(t))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};C.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function qt(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function st(n){return n.h==-1}C.X=function(n){return n=cu(this,n),st(n)?-1:qt(n)?0:1};function Ve(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new X(t,~n.h).add(td)}C.abs=function(){return st(this)?Ve(this):this};C.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,t[i]=o<<16|s}return new X(t,t[t.length-1]&-2147483648?-1:0)};function cu(n,e){return n.add(Ve(e))}C.R=function(n){if(qt(this)||qt(n))return Zr;if(st(this))return st(n)?Ve(this).R(Ve(n)):Ve(Ve(this).R(n));if(st(n))return Ve(this.R(Ve(n)));if(0>this.X($v)&&0>n.X($v))return Dt(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,u=n.D(i)&65535;t[2*r+2*i]+=o*u,iu(t,2*r+2*i),t[2*r+2*i+1]+=s*u,iu(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,iu(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,iu(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new X(t,0)};function iu(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Fs(n,e){this.g=n,this.h=e}function lu(n,e){if(qt(e))throw Error("division by zero");if(qt(n))return new Fs(Zr,Zr);if(st(n))return e=lu(Ve(n),e),new Fs(Ve(e.g),Ve(e.h));if(st(e))return e=lu(n,Ve(e)),new Fs(Ve(e.g),e.h);if(30<n.g.length){if(st(n)||st(e))throw Error("slowDivide_ only works with positive integers.");for(var t=td,r=e;0>=r.X(n);)t=zv(t),r=zv(r);var i=Xr(t,1),s=Xr(r,1);for(r=Xr(r,2),t=Xr(t,2);!qt(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=Xr(r,1),t=Xr(t,1)}return e=cu(n,i.R(e)),new Fs(i,e)}for(i=Zr;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=Math.ceil(Math.log(t)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=Dt(t),o=s.R(e);st(o)||0<o.X(n);)t-=r,s=Dt(t),o=s.R(e);qt(s)&&(s=td),i=i.add(s),n=cu(n,o)}return new Fs(i,n)}C.gb=function(n){return lu(this,n).h};C.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new X(t,this.h&n.h)};C.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new X(t,this.h|n.h)};C.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new X(t,this.h^n.h)};function zv(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new X(t,n.h)}function Xr(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new X(i,n.h)}uu.prototype.createWebChannel=uu.prototype.g;Ze.prototype.send=Ze.prototype.u;Ze.prototype.open=Ze.prototype.m;Ze.prototype.close=Ze.prototype.close;vu.NO_ERROR=0;vu.TIMEOUT=8;vu.HTTP_ERROR=6;l_.COMPLETE="complete";h_.EventType=Js;Js.OPEN="a";Js.CLOSE="b";Js.ERROR="c";Js.MESSAGE="d";Se.prototype.listen=Se.prototype.O;he.prototype.listenOnce=he.prototype.P;he.prototype.getLastError=he.prototype.Sa;he.prototype.getLastErrorCode=he.prototype.Ia;he.prototype.getStatus=he.prototype.da;he.prototype.getResponseJson=he.prototype.Wa;he.prototype.getResponseText=he.prototype.ja;he.prototype.send=he.prototype.ha;he.prototype.setWithCredentials=he.prototype.Oa;dt.prototype.digest=dt.prototype.l;dt.prototype.reset=dt.prototype.reset;dt.prototype.update=dt.prototype.j;X.prototype.add=X.prototype.add;X.prototype.multiply=X.prototype.R;X.prototype.modulo=X.prototype.gb;X.prototype.compare=X.prototype.X;X.prototype.toNumber=X.prototype.ea;X.prototype.toString=X.prototype.toString;X.prototype.getBits=X.prototype.D;X.fromNumber=Dt;X.fromString=W_;var H_=ft.createWebChannelTransport=function(){return new uu},Q_=ft.getStatEventTarget=function(){return yu()},Su=ft.ErrorCode=vu,Y_=ft.EventType=l_,X_=ft.Event=nr,Ad=ft.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Lx=ft.FetchXmlHttpFactory=to,io=ft.WebChannel=h_,J_=ft.XhrIo=he,Z_=ft.Md5=dt,rr=ft.Integer=X;var ew="@firebase/firestore";var Ee=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Ee.UNAUTHENTICATED=new Ee(null),Ee.GOOGLE_CREDENTIALS=new Ee("google-credentials-uid"),Ee.FIRST_PARTY=new Ee("first-party-uid"),Ee.MOCK_USER=new Ee("mock-user");var Ni="10.9.0";var bn=new ua("@firebase/firestore");function ai(){return bn.logLevel}function eE(n){bn.setLogLevel(n)}function _(n,...e){if(bn.logLevel<=At.DEBUG){let t=e.map(Rp);bn.debug(`Firestore (${Ni}): ${n}`,...t)}}function pe(n,...e){if(bn.logLevel<=At.ERROR){let t=e.map(Rp);bn.error(`Firestore (${Ni}): ${n}`,...t)}}function at(n,...e){if(bn.logLevel<=At.WARN){let t=e.map(Rp);bn.warn(`Firestore (${Ni}): ${n}`,...t)}}function Rp(n){if(typeof n=="string")return n;try{return function(t){return JSON.stringify(t)}(n)}catch{return n}}function b(n="Unexpected state"){let e=`FIRESTORE (${Ni}) INTERNAL ASSERTION FAILED: `+n;throw pe(e),new Error(e)}function V(n,e){n||b()}function tE(n,e){n||b()}function A(n,e){return n}var g={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},v=class extends Em{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ie=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var Fu=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},Dd=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ee.UNAUTHENTICATED))}shutdown(){}},Pd=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},Vd=class{constructor(e){this.t=e,this.currentUser=Ee.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.i,i=u=>this.i!==r?(r=this.i,t(u)):Promise.resolve(),s=new Ie;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Ie,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let u=s;e.enqueueRetryable(()=>m(this,null,function*(){yield u.promise,yield i(this.currentUser)}))},a=u=>{_("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=u,this.auth.addAuthTokenListener(this.o),o()};this.t.onInit(u=>a(u)),setTimeout(()=>{if(!this.auth){let u=this.t.getImmediate({optional:!0});u?a(u):(_("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ie)}},0),o()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(_("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(V(typeof r.accessToken=="string"),new Fu(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){let e=this.auth&&this.auth.getUid();return V(e===null||typeof e=="string"),new Ee(e)}},xd=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r,this.type="FirstParty",this.user=Ee.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);let e=this.T();return e&&this.I.set("Authorization",e),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}},Nd=class{constructor(e,t,r){this.l=e,this.h=t,this.P=r}getToken(){return Promise.resolve(new xd(this.l,this.h,this.P))}start(e,t){e.enqueueRetryable(()=>t(Ee.FIRST_PARTY))}shutdown(){}invalidateToken(){}},Md=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},kd=class{constructor(e){this.A=e,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(e,t){let r=s=>{s.error!=null&&_("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.R;return this.R=s.token,_("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{_("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.A.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.A.getImmediate({optional:!0});s?i(s):_("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(V(typeof t.token=="string"),this.R=t.token,new Md(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}};function nR(n){let e=typeof self<"u"&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}var Lu=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="";for(;r.length<20;){let i=nR(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}};function U(n,e){return n<e?-1:n>e?1:0}function mi(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function nE(n){return n+"\0"}var ue=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new v(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new v(g.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new v(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new v(g.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?U(this.nanoseconds,e.nanoseconds):U(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}};var N=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new ue(0,0))}static max(){return new n(new ue(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var Uu=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&b(),r===void 0?r=e.length-t:r>e.length-t&&b(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},H=class n extends Uu{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new v(g.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},rR=/^[_a-zA-Z][_a-zA-Z0-9]*$/,ge=class n extends Uu{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return rR.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)==="__name__"}static keyField(){return new n(["__name__"])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new v(g.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new v(g.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let u=e[i+1];if(u!=="\\"&&u!=="."&&u!=="`")throw new v(g.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,i+=2}else a==="`"?(o=!o,i++):a!=="."||o?(r+=a,i++):(s(),i++)}if(s(),o)throw new v(g.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var T=class n{constructor(e){this.path=e}static fromPath(e){return new n(H.fromString(e))}static fromName(e){return new n(H.fromString(e).popFirst(5))}static empty(){return new n(H.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&H.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return H.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new n(new H(e.slice()))}};var yi=class{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}};function Od(n){return n.fields.find(e=>e.kind===2)}function sr(n){return n.fields.filter(e=>e.kind!==2)}yi.UNKNOWN_ID=-1;var fi=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var yo=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(0,ut.min())}};function rE(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=N.fromTimestamp(r===1e9?new ue(t+1,0):new ue(t,r));return new ut(i,T.empty(),e)}function iE(n){return new ut(n.readTime,n.key,-1)}var ut=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(N.min(),T.empty(),-1)}static max(){return new n(N.max(),T.empty(),-1)}};function Dp(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0?t:(t=T.comparator(n.documentKey,e.documentKey),t!==0?t:U(n.largestBatchId,e.largestBatchId))}var sE="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",ju=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Fn(n){return m(this,null,function*(){if(n.code!==g.FAILED_PRECONDITION||n.message!==sE)throw n;_("LocalStore","Unexpectedly lost primary lease")})}var p=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&b(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},u=>r(u))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let u=0;u<s;u++){let c=u;t(e[c]).next(l=>{o[c]=l,++a,a===s&&r(o)},l=>i(l))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var Bu=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.V=new Ie,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{t.error?this.V.reject(new hr(e,t.error)):this.V.resolve()},this.transaction.onerror=r=>{let i=Pp(r.target.error);this.V.reject(new hr(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new hr(t,s)}}get m(){return this.V.promise}abort(e){e&&this.V.reject(e),this.aborted||(_("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){let e=this.transaction;this.aborted||typeof e.commit!="function"||e.commit()}store(e){let t=this.transaction.objectStore(e);return new Ld(t)}},Kt=class n{constructor(e,t,r){this.name=e,this.version=t,this.p=r,n.S(es())===12.2&&pe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return _("SimpleDb","Removing database:",e),or(window.indexedDB.deleteDatabase(e)).toPromise()}static D(){if(!aa())return!1;if(n.C())return!0;let e=es(),t=n.S(e),r=0<t&&t<10,i=n.v(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static C(){var e;return typeof process<"u"&&((e=process.__PRIVATE_env)===null||e===void 0?void 0:e.F)==="YES"}static M(e,t){return e.store(t)}static S(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static v(e){let t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}O(e){return m(this,null,function*(){return this.db||(_("SimpleDb","Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new hr(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new v(g.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new v(g.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new hr(e,o))},i.onupgradeneeded=s=>{_("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.p.N(o,i.transaction,s.oldVersion,this.version).next(()=>{_("SimpleDb","Database upgrade to version "+this.version+" complete")})}})),this.L&&(this.db.onversionchange=t=>this.L(t)),this.db})}B(e){this.L=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return m(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.O(e);let a=Bu.open(this.db,e,s?"readonly":"readwrite",r),u=i(a).next(c=>(a.g(),c)).catch(c=>(a.abort(c),p.reject(c))).toPromise();return u.catch(()=>{}),yield a.m,u}catch(a){let u=a,c=u.name!=="FirebaseError"&&o<3;if(_("SimpleDb","Transaction failed with error:",u.message,"Retrying:",c),this.close(),!c)return Promise.reject(u)}}})}close(){this.db&&this.db.close(),this.db=void 0}},Fd=class{constructor(e){this.k=e,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(e){this.k=e}done(){this.q=!0}U(e){this.K=e}delete(){return or(this.k.delete())}},hr=class extends v{constructor(e,t){super(g.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Ln(n){return n.name==="IndexedDbTransactionError"}var Ld=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(_("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(_("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),or(r)}add(e){return _("SimpleDb","ADD",this.store.name,e,e),or(this.store.add(e))}get(e){return or(this.store.get(e)).next(t=>(t===void 0&&(t=null),_("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return _("SimpleDb","DELETE",this.store.name,e),or(this.store.delete(e))}count(){return _("SimpleDb","COUNT",this.store.name),or(this.store.count())}W(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new p((o,a)=>{s.onerror=u=>{a(u.target.error)},s.onsuccess=u=>{o(u.target.result)}})}{let s=this.cursor(r),o=[];return this.G(s,(a,u)=>{o.push(u)}).next(()=>o)}}j(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new p((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}H(e,t){_("SimpleDb","DELETE ALL",this.store.name);let r=this.options(e,t);r.J=!1;let i=this.cursor(r);return this.G(i,(s,o,a)=>a.delete())}Y(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.G(i,t)}Z(e){let t=this.cursor({});return new p((r,i)=>{t.onerror=s=>{let o=Pp(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;o?e(o.primaryKey,o.value).next(a=>{a?o.continue():r()}):r()}})}G(e,t){let r=[];return new p((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a)return void i();let u=new Fd(a),c=t(a.primaryKey,a.value,u);if(c instanceof p){let l=c.catch(h=>(u.done(),p.reject(h)));r.push(l)}u.isDone?i():u.$===null?a.continue():a.continue(u.$)}}).next(()=>p.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.J?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}};function or(n){return new p((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=Pp(r.target.error);t(i)}})}var tw=!1;function Pp(n){let e=Kt.S(es());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new v("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return tw||(tw=!0,setTimeout(()=>{throw r},0)),r}}return n}var Ud=class{constructor(e,t){this.asyncQueue=e,this.X=t,this.task=null}start(){this.ee(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}ee(e){_("IndexBackfiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>m(this,null,function*(){this.task=null;try{_("IndexBackfiller",`Documents written: ${yield this.X.te()}`)}catch(t){Ln(t)?_("IndexBackfiller","Ignoring IndexedDB error during index backfill: ",t):yield Fn(t)}yield this.ee(6e4)}))}},jd=class{constructor(e,t){this.localStore=e,this.persistence=t}te(e=50){return m(this,null,function*(){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.ne(t,e))})}ne(e,t){let r=new Set,i=t,s=!0;return p.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o!==null&&!r.has(o))return _("IndexBackfiller",`Processing collection: ${o}`),this.re(e,o,i).next(a=>{i-=a,r.add(o)});s=!1})).next(()=>t-i)}re(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.ie(i,s)).next(a=>(_("IndexBackfiller",`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}ie(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=iE(s);Dp(o,r)>0&&(r=o)}),new ut(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var et=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.se(i),this.oe=i=>r.writeSequenceNumber(i))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.oe&&this.oe(t),t}}return n._e=-1,n})();function Uo(n){return n==null}function vo(n){return n===0&&1/n==-1/0}function oE(n){return typeof n=="number"&&Number.isInteger(n)&&!vo(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}function qe(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=nw(e)),e=iR(n.get(t),e);return nw(e)}function iR(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+="";break;case"":t+="";break;default:t+=s}}return t}function nw(n){return n+""}function Pt(n){let e=n.length;if(V(e>=2),e===2)return V(n.charAt(0)===""&&n.charAt(1)===""),H.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf("",s);switch((o<0||o>t)&&b(),n.charAt(o+1)){case"":let a=n.substring(s,o),u;i.length===0?u=a:(i+=a,u=i,i=""),r.push(u);break;case"":i+=n.substring(s,o),i+="\0";break;case"":i+=n.substring(s,o+1);break;default:b()}s=o+2}return new H(r)}var rw=["userId","batchId"];function Vu(n,e){return[n,qe(e)]}function aE(n,e,t){return[n,qe(e),t]}var sR={},oR=["prefixPath","collectionGroup","readTime","documentId"],aR=["prefixPath","collectionGroup","documentId"],uR=["collectionGroup","readTime","prefixPath","documentId"],cR=["canonicalId","targetId"],lR=["targetId","path"],hR=["path","targetId"],dR=["collectionId","parent"],fR=["indexId","uid"],pR=["uid","sequenceNumber"],gR=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],mR=["indexId","uid","orderedDocumentKey"],yR=["userId","collectionPath","documentId"],vR=["userId","collectionPath","largestBatchId"],_R=["userId","collectionGroup","largestBatchId"],uE=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],wR=[...uE,"documentOverlays"],cE=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],lE=cE,ER=[...lE,"indexConfiguration","indexState","indexEntries"];var _o=class extends ju{constructor(e,t){super(),this.ae=e,this.currentSequenceNumber=t}};function De(n,e){let t=A(n);return Kt.M(t.ae,e)}function iw(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Tr(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function hE(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var ie=class n{constructor(e,t){this.comparator=e,this.root=t||xt.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,xt.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,xt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new di(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new di(this.root,e,this.comparator,!1)}getReverseIterator(){return new di(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new di(this.root,e,this.comparator,!0)}},di=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(s===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},xt=class n{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=r??n.RED,this.left=i??n.EMPTY,this.right=s??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new n(e??this.key,t??this.value,r??this.color,i??this.left,s??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this,s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):s===0?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),t(e,i.key)===0){if(i.right.isEmpty())return n.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){let e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw b();let e=this.left.check();if(e!==this.right.check())throw b();return e+(this.isRed()?0:1)}};xt.EMPTY=null,xt.RED=!0,xt.BLACK=!1;xt.EMPTY=new class{constructor(){this.size=0}get key(){throw b()}get value(){throw b()}get color(){throw b()}get left(){throw b()}get right(){throw b()}copy(e,t,r,i,s){return this}insert(e,t,r){return new xt(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};var Z=class n{constructor(e){this.comparator=e,this.data=new ie(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=t!==void 0?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new qu(this.data.getIterator())}getIteratorFrom(e){return new qu(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},qu=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function ri(n){return n.hasNext()?n.getNext():void 0}var tt=class n{constructor(e){this.fields=e,e.sort(ge.comparator)}static empty(){return new n([])}unionWith(e){let t=new Z(ge.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return mi(this.fields,e.fields,(t,r)=>t.isEqual(r))}};var $u=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};function dE(){return typeof atob<"u"}var Re=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=function(i){try{return atob(i)}catch(s){throw typeof DOMException<"u"&&s instanceof DOMException?new $u("Invalid base64 string: "+s):s}}(e);return new n(t)}static fromUint8Array(e){let t=function(i){let s="";for(let o=0;o<i.length;++o)s+=String.fromCharCode(i[o]);return s}(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return function(t){return btoa(t)}(this.binaryString)}toUint8Array(){return function(t){let r=new Uint8Array(t.length);for(let i=0;i<t.length;i++)r[i]=t.charCodeAt(i);return r}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return U(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};Re.EMPTY_BYTE_STRING=new Re("");var IR=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Rn(n){if(V(!!n),typeof n=="string"){let e=0,t=IR.exec(n);if(V(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:de(n.seconds),nanos:de(n.nanos)}}function de(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Dn(n){return typeof n=="string"?Re.fromBase64String(n):Re.fromUint8Array(n)}function Nc(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{}).__type__)===null||t===void 0?void 0:t.stringValue)==="server_timestamp"}function Vp(n){let e=n.mapValue.fields.__previous_value__;return Nc(e)?Vp(e):e}function wo(n){let e=Rn(n.mapValue.fields.__local_write_time__.timestampValue);return new ue(e.seconds,e.nanos)}var Bd=class{constructor(e,t,r,i,s,o,a,u,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=u,this.useFetchStreams=c}},Pn=class n{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new n("","")}get isDefaultDatabase(){return this.database==="(default)"}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};var Cn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},xu={nullValue:"NULL_VALUE"};function dr(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Nc(n)?4:fE(n)?9007199254740991:10:b()}function kt(n,e){if(n===e)return!0;let t=dr(n);if(t!==dr(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return wo(n).isEqual(wo(e));case 3:return function(i,s){if(typeof i.timestampValue=="string"&&typeof s.timestampValue=="string"&&i.timestampValue.length===s.timestampValue.length)return i.timestampValue===s.timestampValue;let o=Rn(i.timestampValue),a=Rn(s.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return function(i,s){return Dn(i.bytesValue).isEqual(Dn(s.bytesValue))}(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,s){return de(i.geoPointValue.latitude)===de(s.geoPointValue.latitude)&&de(i.geoPointValue.longitude)===de(s.geoPointValue.longitude)}(n,e);case 2:return function(i,s){if("integerValue"in i&&"integerValue"in s)return de(i.integerValue)===de(s.integerValue);if("doubleValue"in i&&"doubleValue"in s){let o=de(i.doubleValue),a=de(s.doubleValue);return o===a?vo(o)===vo(a):isNaN(o)&&isNaN(a)}return!1}(n,e);case 9:return mi(n.arrayValue.values||[],e.arrayValue.values||[],kt);case 10:return function(i,s){let o=i.mapValue.fields||{},a=s.mapValue.fields||{};if(iw(o)!==iw(a))return!1;for(let u in o)if(o.hasOwnProperty(u)&&(a[u]===void 0||!kt(o[u],a[u])))return!1;return!0}(n,e);default:return b()}}function Eo(n,e){return(n.values||[]).find(t=>kt(t,e))!==void 0}function Vn(n,e){if(n===e)return 0;let t=dr(n),r=dr(e);if(t!==r)return U(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return U(n.booleanValue,e.booleanValue);case 2:return function(s,o){let a=de(s.integerValue||s.doubleValue),u=de(o.integerValue||o.doubleValue);return a<u?-1:a>u?1:a===u?0:isNaN(a)?isNaN(u)?0:-1:1}(n,e);case 3:return sw(n.timestampValue,e.timestampValue);case 4:return sw(wo(n),wo(e));case 5:return U(n.stringValue,e.stringValue);case 6:return function(s,o){let a=Dn(s),u=Dn(o);return a.compareTo(u)}(n.bytesValue,e.bytesValue);case 7:return function(s,o){let a=s.split("/"),u=o.split("/");for(let c=0;c<a.length&&c<u.length;c++){let l=U(a[c],u[c]);if(l!==0)return l}return U(a.length,u.length)}(n.referenceValue,e.referenceValue);case 8:return function(s,o){let a=U(de(s.latitude),de(o.latitude));return a!==0?a:U(de(s.longitude),de(o.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(s,o){let a=s.values||[],u=o.values||[];for(let c=0;c<a.length&&c<u.length;++c){let l=Vn(a[c],u[c]);if(l)return l}return U(a.length,u.length)}(n.arrayValue,e.arrayValue);case 10:return function(s,o){if(s===Cn.mapValue&&o===Cn.mapValue)return 0;if(s===Cn.mapValue)return 1;if(o===Cn.mapValue)return-1;let a=s.fields||{},u=Object.keys(a),c=o.fields||{},l=Object.keys(c);u.sort(),l.sort();for(let h=0;h<u.length&&h<l.length;++h){let d=U(u[h],l[h]);if(d!==0)return d;let f=Vn(a[u[h]],c[l[h]]);if(f!==0)return f}return U(u.length,l.length)}(n.mapValue,e.mapValue);default:throw b()}}function sw(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return U(n,e);let t=Rn(n),r=Rn(e),i=U(t.seconds,r.seconds);return i!==0?i:U(t.nanos,r.nanos)}function vi(n){return qd(n)}function qd(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(t){let r=Rn(t);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?function(t){return Dn(t).toBase64()}(n.bytesValue):"referenceValue"in n?function(t){return T.fromName(t).toString()}(n.referenceValue):"geoPointValue"in n?function(t){return`geo(${t.latitude},${t.longitude})`}(n.geoPointValue):"arrayValue"in n?function(t){let r="[",i=!0;for(let s of t.values||[])i?i=!1:r+=",",r+=qd(s);return r+"]"}(n.arrayValue):"mapValue"in n?function(t){let r=Object.keys(t.fields||{}).sort(),i="{",s=!0;for(let o of r)s?s=!1:i+=",",i+=`${o}:${qd(t.fields[o])}`;return i+"}"}(n.mapValue):b()}function fr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function $d(n){return!!n&&"integerValue"in n}function Io(n){return!!n&&"arrayValue"in n}function ow(n){return!!n&&"nullValue"in n}function aw(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Nu(n){return!!n&&"mapValue"in n}function ho(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Tr(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=ho(r)),e}if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ho(n.arrayValue.values[t]);return e}return Object.assign({},n)}function fE(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue==="__max__"}function TR(n){return"nullValue"in n?xu:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?fr(Pn.empty(),T.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:b()}function AR(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?fr(Pn.empty(),T.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Cn:b()}function uw(n,e){let t=Vn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function cw(n,e){let t=Vn(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var Fe=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Nu(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ho(t)}setAll(e){let t=ge.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let u=this.getFieldsMap(t);this.applyChanges(u,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=ho(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Nu(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return kt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Nu(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Tr(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(ho(this.value))}};function pE(n){let e=[];return Tr(n.fields,(t,r)=>{let i=new ge([t]);if(Nu(r)){let s=pE(r.mapValue).fields;if(s.length===0)e.push(i);else for(let o of s)e.push(i.child(o))}else e.push(i)}),new tt(e)}var Te=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,N.min(),N.min(),N.min(),Fe.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,N.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,N.min(),N.min(),Fe.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,N.min(),N.min(),Fe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(N.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Fe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Fe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=N.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};var Ot=class{constructor(e,t){this.position=e,this.inclusive=t}};function lw(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField()?r=T.comparator(T.fromName(o.referenceValue),t.key):r=Vn(o,t.data.field(s.field)),s.dir==="desc"&&(r*=-1),r!==0)break}return r}function hw(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!kt(n.position[t],e.position[t]))return!1;return!0}var pr=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function CR(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var zu=class{},G=class n extends zu{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new Kd(e,t,r):t==="array-contains"?new Qd(e,r):t==="in"?new Gu(e,r):t==="not-in"?new Yd(e,r):t==="array-contains-any"?new Xd(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new Wd(e,r):new Hd(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Vn(t,this.value)):t!==null&&dr(this.value)===dr(t)&&this.matchesComparison(Vn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return b()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},J=class n extends zu{constructor(e,t){super(),this.filters=e,this.op=t,this.ue=null}static create(e,t){return new n(e,t)}matches(e){return _i(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.ue!==null||(this.ue=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ue}getFilters(){return Object.assign([],this.filters)}};function _i(n){return n.op==="and"}function zd(n){return n.op==="or"}function xp(n){return gE(n)&&_i(n)}function gE(n){for(let e of n.filters)if(e instanceof J)return!1;return!0}function Gd(n){if(n instanceof G)return n.field.canonicalString()+n.op.toString()+vi(n.value);if(xp(n))return n.filters.map(e=>Gd(e)).join(",");{let e=n.filters.map(t=>Gd(t)).join(",");return`${n.op}(${e})`}}function mE(n,e){return n instanceof G?function(r,i){return i instanceof G&&r.op===i.op&&r.field.isEqual(i.field)&&kt(r.value,i.value)}(n,e):n instanceof J?function(r,i){return i instanceof J&&r.op===i.op&&r.filters.length===i.filters.length?r.filters.reduce((s,o,a)=>s&&mE(o,i.filters[a]),!0):!1}(n,e):void b()}function yE(n,e){let t=n.filters.concat(e);return J.create(t,n.op)}function vE(n){return n instanceof G?function(t){return`${t.field.canonicalString()} ${t.op} ${vi(t.value)}`}(n):n instanceof J?function(t){return t.op.toString()+" {"+t.getFilters().map(vE).join(" ,")+"}"}(n):"Filter"}var Kd=class extends G{constructor(e,t,r){super(e,t,r),this.key=T.fromName(r.referenceValue)}matches(e){let t=T.comparator(e.key,this.key);return this.matchesComparison(t)}},Wd=class extends G{constructor(e,t){super(e,"in",t),this.keys=_E("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},Hd=class extends G{constructor(e,t){super(e,"not-in",t),this.keys=_E("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function _E(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>T.fromName(r.referenceValue))}var Qd=class extends G{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return Io(t)&&Eo(t.arrayValue,this.value)}},Gu=class extends G{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&Eo(this.value.arrayValue,t)}},Yd=class extends G{constructor(e,t){super(e,"not-in",t)}matches(e){if(Eo(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!Eo(this.value.arrayValue,t)}},Xd=class extends G{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!Io(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Eo(this.value.arrayValue,r))}};var Jd=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.ce=null}};function Zd(n,e=null,t=[],r=[],i=null,s=null,o=null){return new Jd(n,e,t,r,i,s,o)}function gr(n){let e=A(n);if(e.ce===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Gd(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>function(s){return s.field.canonicalString()+s.dir}(r)).join(","),Uo(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>vi(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>vi(r)).join(",")),e.ce=t}return e.ce}function jo(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!CR(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!mE(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!hw(n.startAt,e.startAt)&&hw(n.endAt,e.endAt)}function Ku(n){return T.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Wu(n,e){return n.filters.filter(t=>t instanceof G&&t.field.isEqual(e))}function dw(n,e,t){let r=xu,i=!0;for(let s of Wu(n,e)){let o=xu,a=!0;switch(s.op){case"<":case"<=":o=TR(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=xu}uw({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];uw({value:r,inclusive:i},{value:o,inclusive:t.inclusive})<0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}function fw(n,e,t){let r=Cn,i=!0;for(let s of Wu(n,e)){let o=Cn,a=!0;switch(s.op){case">=":case">":o=AR(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Cn}cw({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let o=t.position[s];cw({value:r,inclusive:i},{value:o,inclusive:t.inclusive})>0&&(r=o,i=t.inclusive);break}}return{value:r,inclusive:i}}var pt=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,u=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=u,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}};function wE(n,e,t,r,i,s,o,a){return new pt(n,e,t,r,i,s,o,a)}function Mi(n){return new pt(n)}function pw(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Np(n){return n.collectionGroup!==null}function pi(n){let e=A(n);if(e.le===null){e.le=[];let t=new Set;for(let s of e.explicitOrderBy)e.le.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Z(ge.comparator);return o.filters.forEach(u=>{u.getFlattenedFilters().forEach(c=>{c.isInequality()&&(a=a.add(c.field))})}),a})(e).forEach(s=>{t.has(s.canonicalString())||s.isKeyField()||e.le.push(new pr(s,r))}),t.has(ge.keyField().canonicalString())||e.le.push(new pr(ge.keyField(),r))}return e.le}function $e(n){let e=A(n);return e.he||(e.he=SR(e,pi(n))),e.he}function SR(n,e){if(n.limitType==="F")return Zd(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new pr(i.field,s)});let t=n.endAt?new Ot(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Ot(n.startAt.position,n.startAt.inclusive):null;return Zd(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function ef(n,e){let t=n.filters.concat([e]);return new pt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Hu(n,e,t){return new pt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Bo(n,e){return jo($e(n),$e(e))&&n.limitType===e.limitType}function EE(n){return`${gr($e(n))}|lt:${n.limitType}`}function ui(n){return`Query(target=${function(t){let r=t.path.canonicalString();return t.collectionGroup!==null&&(r+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(r+=`, filters: [${t.filters.map(i=>vE(i)).join(", ")}]`),Uo(t.limit)||(r+=", limit: "+t.limit),t.orderBy.length>0&&(r+=`, orderBy: [${t.orderBy.map(i=>function(o){return`${o.field.canonicalString()} (${o.dir})`}(i)).join(", ")}]`),t.startAt&&(r+=", startAt: ",r+=t.startAt.inclusive?"b:":"a:",r+=t.startAt.position.map(i=>vi(i)).join(",")),t.endAt&&(r+=", endAt: ",r+=t.endAt.inclusive?"a:":"b:",r+=t.endAt.position.map(i=>vi(i)).join(",")),`Target(${r})`}($e(n))}; limitType=${n.limitType})`}function qo(n,e){return e.isFoundDocument()&&function(r,i){let s=i.key.path;return r.collectionGroup!==null?i.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(s):T.isDocumentKey(r.path)?r.path.isEqual(s):r.path.isImmediateParentOf(s)}(n,e)&&function(r,i){for(let s of pi(r))if(!s.field.isKeyField()&&i.data.field(s.field)===null)return!1;return!0}(n,e)&&function(r,i){for(let s of r.filters)if(!s.matches(i))return!1;return!0}(n,e)&&function(r,i){return!(r.startAt&&!function(o,a,u){let c=lw(o,a,u);return o.inclusive?c<=0:c<0}(r.startAt,pi(r),i)||r.endAt&&!function(o,a,u){let c=lw(o,a,u);return o.inclusive?c>=0:c>0}(r.endAt,pi(r),i))}(n,e)}function IE(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function TE(n){return(e,t)=>{let r=!1;for(let i of pi(n)){let s=bR(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function bR(n,e,t){let r=n.field.isKeyField()?T.comparator(e.key,t.key):function(s,o,a){let u=o.data.field(s),c=a.data.field(s);return u!==null&&c!==null?Vn(u,c):b()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return b()}}var Ft=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Tr(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return hE(this.inner)}size(){return this.innerSize}};var RR=new ie(T.comparator);function We(){return RR}var AE=new ie(T.comparator);function co(...n){let e=AE;for(let t of n)e=e.insert(t.key,t);return e}function CE(n){let e=AE;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Vt(){return fo()}function SE(){return fo()}function fo(){return new Ft(n=>n.toString(),(n,e)=>n.isEqual(e))}var DR=new ie(T.comparator),PR=new Z(T.comparator);function B(...n){let e=PR;for(let t of n)e=e.add(t);return e}var VR=new Z(U);function Mp(){return VR}function bE(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:vo(e)?"-0":e}}function RE(n){return{integerValue:""+n}}function DE(n,e){return oE(e)?RE(e):bE(n,e)}var wi=class{constructor(){this._=void 0}};function xR(n,e,t){return n instanceof xn?function(i,s){let o={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return s&&Nc(s)&&(s=Vp(s)),s&&(o.fields.__previous_value__=s),{mapValue:o}}(t,e):n instanceof Wt?VE(n,e):n instanceof Ht?xE(n,e):function(i,s){let o=PE(i,s),a=gw(o)+gw(i.Ie);return $d(o)&&$d(i.Ie)?RE(a):bE(i.serializer,a)}(n,e)}function NR(n,e,t){return n instanceof Wt?VE(n,e):n instanceof Ht?xE(n,e):t}function PE(n,e){return n instanceof Nn?function(r){return $d(r)||function(s){return!!s&&"doubleValue"in s}(r)}(e)?e:{integerValue:0}:null}var xn=class extends wi{},Wt=class extends wi{constructor(e){super(),this.elements=e}};function VE(n,e){let t=NE(e);for(let r of n.elements)t.some(i=>kt(i,r))||t.push(r);return{arrayValue:{values:t}}}var Ht=class extends wi{constructor(e){super(),this.elements=e}};function xE(n,e){let t=NE(e);for(let r of n.elements)t=t.filter(i=>!kt(i,r));return{arrayValue:{values:t}}}var Nn=class extends wi{constructor(e,t){super(),this.serializer=e,this.Ie=t}};function gw(n){return de(n.integerValue||n.doubleValue)}function NE(n){return Io(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var mr=class{constructor(e,t){this.field=e,this.transform=t}};function MR(n,e){return n.field.isEqual(e.field)&&function(r,i){return r instanceof Wt&&i instanceof Wt||r instanceof Ht&&i instanceof Ht?mi(r.elements,i.elements,kt):r instanceof Nn&&i instanceof Nn?kt(r.Ie,i.Ie):r instanceof xn&&i instanceof xn}(n.transform,e.transform)}var tf=class{constructor(e,t){this.version=e,this.transformResults=t}},fe=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Mu(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists===void 0||n.exists===e.isFoundDocument()}var Ei=class{};function ME(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new kn(n.key,fe.none()):new Mn(n.key,n.data,fe.none());{let t=n.data,r=Fe.empty(),i=new Z(ge.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new gt(n.key,r,new tt(i.toArray()),fe.none())}}function kR(n,e,t){n instanceof Mn?function(i,s,o){let a=i.value.clone(),u=yw(i.fieldTransforms,s,o.transformResults);a.setAll(u),s.convertToFoundDocument(o.version,a).setHasCommittedMutations()}(n,e,t):n instanceof gt?function(i,s,o){if(!Mu(i.precondition,s))return void s.convertToUnknownDocument(o.version);let a=yw(i.fieldTransforms,s,o.transformResults),u=s.data;u.setAll(kE(i)),u.setAll(a),s.convertToFoundDocument(o.version,u).setHasCommittedMutations()}(n,e,t):function(i,s,o){s.convertToNoDocument(o.version).setHasCommittedMutations()}(0,e,t)}function po(n,e,t,r){return n instanceof Mn?function(s,o,a,u){if(!Mu(s.precondition,o))return a;let c=s.value.clone(),l=vw(s.fieldTransforms,u,o);return c.setAll(l),o.convertToFoundDocument(o.version,c).setHasLocalMutations(),null}(n,e,t,r):n instanceof gt?function(s,o,a,u){if(!Mu(s.precondition,o))return a;let c=vw(s.fieldTransforms,u,o),l=o.data;return l.setAll(kE(s)),l.setAll(c),o.convertToFoundDocument(o.version,l).setHasLocalMutations(),a===null?null:a.unionWith(s.fieldMask.fields).unionWith(s.fieldTransforms.map(h=>h.field))}(n,e,t,r):function(s,o,a){return Mu(s.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a}(n,e,t)}function OR(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=PE(r.transform,i||null);s!=null&&(t===null&&(t=Fe.empty()),t.set(r.field,s))}return t||null}function mw(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&!!function(r,i){return r===void 0&&i===void 0||!(!r||!i)&&mi(r,i,(s,o)=>MR(s,o))}(n.fieldTransforms,e.fieldTransforms)&&(n.type===0?n.value.isEqual(e.value):n.type!==1||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask))}var Mn=class extends Ei{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}},gt=class extends Ei{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function kE(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function yw(n,e,t){let r=new Map;V(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,NR(o,a,t[i]))}return r}function vw(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,xR(s,o,e))}return r}var kn=class extends Ei{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}},To=class extends Ei{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var Ao=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];s.key.isEqual(e.key)&&kR(s,e,r[i])}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=po(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=po(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=SE();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let u=ME(o,a);u!==null&&r.set(i.key,u),o.isValidDocument()||o.convertToNoDocument(N.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),B())}isEqual(e){return this.batchId===e.batchId&&mi(this.mutations,e.mutations,(t,r)=>mw(t,r))&&mi(this.baseMutations,e.baseMutations,(t,r)=>mw(t,r))}},nf=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){V(e.mutations.length===r.length);let i=function(){return DR}(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Co=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var rf=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var _e,W;function OE(n){switch(n){default:return b();case g.CANCELLED:case g.UNKNOWN:case g.DEADLINE_EXCEEDED:case g.RESOURCE_EXHAUSTED:case g.INTERNAL:case g.UNAVAILABLE:case g.UNAUTHENTICATED:return!1;case g.INVALID_ARGUMENT:case g.NOT_FOUND:case g.ALREADY_EXISTS:case g.PERMISSION_DENIED:case g.FAILED_PRECONDITION:case g.ABORTED:case g.OUT_OF_RANGE:case g.UNIMPLEMENTED:case g.DATA_LOSS:return!0}}function FE(n){if(n===void 0)return pe("GRPC error has no .code"),g.UNKNOWN;switch(n){case _e.OK:return g.OK;case _e.CANCELLED:return g.CANCELLED;case _e.UNKNOWN:return g.UNKNOWN;case _e.DEADLINE_EXCEEDED:return g.DEADLINE_EXCEEDED;case _e.RESOURCE_EXHAUSTED:return g.RESOURCE_EXHAUSTED;case _e.INTERNAL:return g.INTERNAL;case _e.UNAVAILABLE:return g.UNAVAILABLE;case _e.UNAUTHENTICATED:return g.UNAUTHENTICATED;case _e.INVALID_ARGUMENT:return g.INVALID_ARGUMENT;case _e.NOT_FOUND:return g.NOT_FOUND;case _e.ALREADY_EXISTS:return g.ALREADY_EXISTS;case _e.PERMISSION_DENIED:return g.PERMISSION_DENIED;case _e.FAILED_PRECONDITION:return g.FAILED_PRECONDITION;case _e.ABORTED:return g.ABORTED;case _e.OUT_OF_RANGE:return g.OUT_OF_RANGE;case _e.UNIMPLEMENTED:return g.UNIMPLEMENTED;case _e.DATA_LOSS:return g.DATA_LOSS;default:return b()}}(W=_e||(_e={}))[W.OK=0]="OK",W[W.CANCELLED=1]="CANCELLED",W[W.UNKNOWN=2]="UNKNOWN",W[W.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",W[W.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",W[W.NOT_FOUND=5]="NOT_FOUND",W[W.ALREADY_EXISTS=6]="ALREADY_EXISTS",W[W.PERMISSION_DENIED=7]="PERMISSION_DENIED",W[W.UNAUTHENTICATED=16]="UNAUTHENTICATED",W[W.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",W[W.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",W[W.ABORTED=10]="ABORTED",W[W.OUT_OF_RANGE=11]="OUT_OF_RANGE",W[W.UNIMPLEMENTED=12]="UNIMPLEMENTED",W[W.INTERNAL=13]="INTERNAL",W[W.UNAVAILABLE=14]="UNAVAILABLE",W[W.DATA_LOSS=15]="DATA_LOSS";var _w=null;function LE(){return new TextEncoder}var FR=new rr([4294967295,4294967295],0);function ww(n){let e=LE().encode(n),t=new Z_;return t.update(e),new Uint8Array(t.digest())}function Ew(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new rr([t,r],0),new rr([i,s],0)]}var sf=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new lr(`Invalid padding: ${t}`);if(r<0)throw new lr(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new lr(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new lr(`Invalid padding when bitmap length is 0: ${t}`);this.Te=8*e.length-t,this.Ee=rr.fromNumber(this.Te)}de(e,t,r){let i=e.add(t.multiply(rr.fromNumber(r)));return i.compare(FR)===1&&(i=new rr([i.getBits(0),i.getBits(1)],0)),i.modulo(this.Ee).toNumber()}Ae(e){return(this.bitmap[Math.floor(e/8)]&1<<e%8)!=0}mightContain(e){if(this.Te===0)return!1;let t=ww(e),[r,i]=Ew(t);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);if(!this.Ae(o))return!1}return!0}static create(e,t,r){let i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.Te===0)return;let t=ww(e),[r,i]=Ew(t);for(let s=0;s<this.hashCount;s++){let o=this.de(r,i,s);this.Re(o)}}Re(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},lr=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var So=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,bo.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(N.min(),i,new ie(U),We(),B())}},bo=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,B(),B(),B())}};var gi=class{constructor(e,t,r,i){this.Ve=e,this.removedTargetIds=t,this.key=r,this.me=i}},Qu=class{constructor(e,t){this.targetId=e,this.fe=t}},Yu=class{constructor(e,t,r=Re.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Xu=class{constructor(){this.ge=0,this.pe=Tw(),this.ye=Re.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return this.ge!==0}get De(){return this.Se}Ce(e){e.approximateByteSize()>0&&(this.Se=!0,this.ye=e)}ve(){let e=B(),t=B(),r=B();return this.pe.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:b()}}),new bo(this.ye,this.we,e,t,r)}Fe(){this.Se=!1,this.pe=Tw()}Me(e,t){this.Se=!0,this.pe=this.pe.insert(e,t)}xe(e){this.Se=!0,this.pe=this.pe.remove(e)}Oe(){this.ge+=1}Ne(){this.ge-=1,V(this.ge>=0)}Le(){this.Se=!0,this.we=!0}},of=class{constructor(e){this.Be=e,this.ke=new Map,this.qe=We(),this.Qe=Iw(),this.Ke=new ie(U)}$e(e){for(let t of e.Ve)e.me&&e.me.isFoundDocument()?this.Ue(t,e.me):this.We(t,e.key,e.me);for(let t of e.removedTargetIds)this.We(t,e.key,e.me)}Ge(e){this.forEachTarget(e,t=>{let r=this.ze(t);switch(e.state){case 0:this.je(t)&&r.Ce(e.resumeToken);break;case 1:r.Ne(),r.be||r.Fe(),r.Ce(e.resumeToken);break;case 2:r.Ne(),r.be||this.removeTarget(t);break;case 3:this.je(t)&&(r.Le(),r.Ce(e.resumeToken));break;case 4:this.je(t)&&(this.He(t),r.Ce(e.resumeToken));break;default:b()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ke.forEach((r,i)=>{this.je(i)&&t(i)})}Je(e){let t=e.targetId,r=e.fe.count,i=this.Ye(t);if(i){let s=i.target;if(Ku(s))if(r===0){let o=new T(s.path);this.We(t,o,Te.newNoDocument(o,N.min()))}else V(r===1);else{let o=this.Ze(t);if(o!==r){let a=this.Xe(e),u=a?this.et(a,e,o):1;if(u!==0){this.He(t);let c=u===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(t,c)}_w?.tt(function(l,h,d,f,E){var w,y,I,k,R,M;let j={localCacheCount:l,existenceFilterCount:h.count,databaseId:d.database,projectId:d.projectId},K=h.unchangedNames;return K&&(j.bloomFilter={applied:E===0,hashCount:(w=K?.hashCount)!==null&&w!==void 0?w:0,bitmapLength:(k=(I=(y=K?.bits)===null||y===void 0?void 0:y.bitmap)===null||I===void 0?void 0:I.length)!==null&&k!==void 0?k:0,padding:(M=(R=K?.bits)===null||R===void 0?void 0:R.padding)!==null&&M!==void 0?M:0,mightContain:ce=>{var vt;return(vt=f?.mightContain(ce))!==null&&vt!==void 0&&vt}}),j}(o,e.fe,this.Be.nt(),a,u))}}}}Xe(e){let t=e.fe.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o,a;try{o=Dn(r).toUint8Array()}catch(u){if(u instanceof $u)return at("Decoding the base64 bloom filter in existence filter failed ("+u.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw u}try{a=new sf(o,i,s)}catch(u){return at(u instanceof lr?"BloomFilter error: ":"Applying bloom filter failed: ",u),null}return a.Te===0?null:a}et(e,t,r){return t.fe.count===r-this.rt(e,t.targetId)?0:2}rt(e,t){let r=this.Be.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.Be.nt(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.We(t,s,null),i++)}),i}it(e){let t=new Map;this.ke.forEach((s,o)=>{let a=this.Ye(o);if(a){if(s.current&&Ku(a.target)){let u=new T(a.target.path);this.qe.get(u)!==null||this.st(o,u)||this.We(o,u,Te.newNoDocument(u,e))}s.De&&(t.set(o,s.ve()),s.Fe())}});let r=B();this.Qe.forEach((s,o)=>{let a=!0;o.forEachWhile(u=>{let c=this.Ye(u);return!c||c.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)}),a&&(r=r.add(s))}),this.qe.forEach((s,o)=>o.setReadTime(e));let i=new So(e,t,this.Ke,this.qe,r);return this.qe=We(),this.Qe=Iw(),this.Ke=new ie(U),i}Ue(e,t){if(!this.je(e))return;let r=this.st(e,t.key)?2:0;this.ze(e).Me(t.key,r),this.qe=this.qe.insert(t.key,t),this.Qe=this.Qe.insert(t.key,this.ot(t.key).add(e))}We(e,t,r){if(!this.je(e))return;let i=this.ze(e);this.st(e,t)?i.Me(t,1):i.xe(t),this.Qe=this.Qe.insert(t,this.ot(t).delete(e)),r&&(this.qe=this.qe.insert(t,r))}removeTarget(e){this.ke.delete(e)}Ze(e){let t=this.ze(e).ve();return this.Be.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Oe(e){this.ze(e).Oe()}ze(e){let t=this.ke.get(e);return t||(t=new Xu,this.ke.set(e,t)),t}ot(e){let t=this.Qe.get(e);return t||(t=new Z(U),this.Qe=this.Qe.insert(e,t)),t}je(e){let t=this.Ye(e)!==null;return t||_("WatchChangeAggregator","Detected inactive target",e),t}Ye(e){let t=this.ke.get(e);return t&&t.be?null:this.Be._t(e)}He(e){this.ke.set(e,new Xu),this.Be.getRemoteKeysForTarget(e).forEach(t=>{this.We(e,t,null)})}st(e,t){return this.Be.getRemoteKeysForTarget(e).has(t)}};function Iw(){return new ie(T.comparator)}function Tw(){return new ie(T.comparator)}var LR={asc:"ASCENDING",desc:"DESCENDING"},UR={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},jR={and:"AND",or:"OR"},af=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function uf(n,e){return n.useProto3Json||Uo(e)?e:{value:e}}function Ii(n,e){return n.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function UE(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function BR(n,e){return Ii(n,e.toTimestamp())}function me(n){return V(!!n),N.fromTimestamp(function(t){let r=Rn(t);return new ue(r.seconds,r.nanos)}(n))}function kp(n,e){return cf(n,e).canonicalString()}function cf(n,e){let t=function(i){return new H(["projects",i.projectId,"databases",i.database])}(n).child("documents");return e===void 0?t:t.child(e)}function jE(n){let e=H.fromString(n);return V(YE(e)),e}function Ro(n,e){return kp(n.databaseId,e.path)}function Nt(n,e){let t=jE(e);if(t.get(1)!==n.databaseId.projectId)throw new v(g.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new v(g.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new T($E(t))}function BE(n,e){return kp(n.databaseId,e)}function qE(n){let e=jE(n);return e.length===4?H.emptyPath():$E(e)}function lf(n){return new H(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function $E(n){return V(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function Aw(n,e,t){return{name:Ro(n,e),fields:t.value.mapValue.fields}}function zE(n,e,t){let r=Nt(n,e.name),i=me(e.updateTime),s=e.createTime?me(e.createTime):N.min(),o=new Fe({mapValue:{fields:e.fields}}),a=Te.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function qR(n,e){return"found"in e?function(r,i){V(!!i.found),i.found.name,i.found.updateTime;let s=Nt(r,i.found.name),o=me(i.found.updateTime),a=i.found.createTime?me(i.found.createTime):N.min(),u=new Fe({mapValue:{fields:i.found.fields}});return Te.newFoundDocument(s,o,a,u)}(n,e):"missing"in e?function(r,i){V(!!i.missing),V(!!i.readTime);let s=Nt(r,i.missing),o=me(i.readTime);return Te.newNoDocument(s,o)}(n,e):b()}function $R(n,e){let t;if("targetChange"in e){e.targetChange;let r=function(c){return c==="NO_CHANGE"?0:c==="ADD"?1:c==="REMOVE"?2:c==="CURRENT"?3:c==="RESET"?4:b()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(c,l){return c.useProto3Json?(V(l===void 0||typeof l=="string"),Re.fromBase64String(l||"")):(V(l===void 0||l instanceof Uint8Array),Re.fromUint8Array(l||new Uint8Array))}(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(c){let l=c.code===void 0?g.UNKNOWN:FE(c.code);return new v(l,c.message||"")}(o);t=new Yu(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Nt(n,r.document.name),s=me(r.document.updateTime),o=r.document.createTime?me(r.document.createTime):N.min(),a=new Fe({mapValue:{fields:r.document.fields}}),u=Te.newFoundDocument(i,s,o,a),c=r.targetIds||[],l=r.removedTargetIds||[];t=new gi(c,l,u.key,u)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Nt(n,r.document),s=r.readTime?me(r.readTime):N.min(),o=Te.newNoDocument(i,s),a=r.removedTargetIds||[];t=new gi([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Nt(n,r.document),s=r.removedTargetIds||[];t=new gi([],s,i,null)}else{if(!("filter"in e))return b();{e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new rf(i,s),a=r.targetId;t=new Qu(a,o)}}return t}function Do(n,e){let t;if(e instanceof Mn)t={update:Aw(n,e.key,e.value)};else if(e instanceof kn)t={delete:Ro(n,e.key)};else if(e instanceof gt)t={update:Aw(n,e.key,e.data),updateMask:QR(e.fieldMask)};else{if(!(e instanceof To))return b();t={verify:Ro(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(s,o){let a=o.transform;if(a instanceof xn)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Wt)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Ht)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof Nn)return{fieldPath:o.field.canonicalString(),increment:a.Ie};throw b()}(0,r))),e.precondition.isNone||(t.currentDocument=function(i,s){return s.updateTime!==void 0?{updateTime:BR(i,s.updateTime)}:s.exists!==void 0?{exists:s.exists}:b()}(n,e.precondition)),t}function hf(n,e){let t=e.currentDocument?function(s){return s.updateTime!==void 0?fe.updateTime(me(s.updateTime)):s.exists!==void 0?fe.exists(s.exists):fe.none()}(e.currentDocument):fe.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(o,a){let u=null;if("setToServerValue"in a)V(a.setToServerValue==="REQUEST_TIME"),u=new xn;else if("appendMissingElements"in a){let l=a.appendMissingElements.values||[];u=new Wt(l)}else if("removeAllFromArray"in a){let l=a.removeAllFromArray.values||[];u=new Ht(l)}else"increment"in a?u=new Nn(o,a.increment):b();let c=ge.fromServerFormat(a.fieldPath);return new mr(c,u)}(n,i)):[];if(e.update){e.update.name;let i=Nt(n,e.update.name),s=new Fe({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=function(u){let c=u.fieldPaths||[];return new tt(c.map(l=>ge.fromServerFormat(l)))}(e.updateMask);return new gt(i,s,o,t,r)}return new Mn(i,s,t,r)}if(e.delete){let i=Nt(n,e.delete);return new kn(i,t)}if(e.verify){let i=Nt(n,e.verify);return new To(i,t)}return b()}function zR(n,e){return n&&n.length>0?(V(e!==void 0),n.map(t=>function(i,s){let o=i.updateTime?me(i.updateTime):me(s);return o.isEqual(N.min())&&(o=me(s)),new tf(o,i.transformResults||[])}(t,e))):[]}function GE(n,e){return{documents:[BE(n,e.path)]}}function KE(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=BE(n,i);let s=function(c){if(c.length!==0)return QE(J.create(c,"and"))}(e.filters);s&&(t.structuredQuery.where=s);let o=function(c){if(c.length!==0)return c.map(l=>function(d){return{field:ci(d.field),direction:KR(d.dir)}}(l))}(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=uf(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=function(c){return{before:c.inclusive,values:c.position}}(e.startAt)),e.endAt&&(t.structuredQuery.endAt=function(c){return{before:!c.inclusive,values:c.position}}(e.endAt)),{ut:t,parent:i}}function WE(n){let e=qE(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){V(r===1);let l=t.from[0];l.allDescendants?i=l.collectionId:e=e.child(l.collectionId)}let s=[];t.where&&(s=function(h){let d=HE(h);return d instanceof J&&xp(d)?d.getFilters():[d]}(t.where));let o=[];t.orderBy&&(o=function(h){return h.map(d=>function(E){return new pr(li(E.field),function(y){switch(y){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(E.direction))}(d))}(t.orderBy));let a=null;t.limit&&(a=function(h){let d;return d=typeof h=="object"?h.value:h,Uo(d)?null:d}(t.limit));let u=null;t.startAt&&(u=function(h){let d=!!h.before,f=h.values||[];return new Ot(f,d)}(t.startAt));let c=null;return t.endAt&&(c=function(h){let d=!h.before,f=h.values||[];return new Ot(f,d)}(t.endAt)),wE(e,i,o,s,a,"F",u,c)}function GR(n,e){let t=function(i){switch(i){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return b()}}(e.purpose);return t==null?null:{"goog-listen-tags":t}}function HE(n){return n.unaryFilter!==void 0?function(t){switch(t.unaryFilter.op){case"IS_NAN":let r=li(t.unaryFilter.field);return G.create(r,"==",{doubleValue:NaN});case"IS_NULL":let i=li(t.unaryFilter.field);return G.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let s=li(t.unaryFilter.field);return G.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let o=li(t.unaryFilter.field);return G.create(o,"!=",{nullValue:"NULL_VALUE"});default:return b()}}(n):n.fieldFilter!==void 0?function(t){return G.create(li(t.fieldFilter.field),function(i){switch(i){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return b()}}(t.fieldFilter.op),t.fieldFilter.value)}(n):n.compositeFilter!==void 0?function(t){return J.create(t.compositeFilter.filters.map(r=>HE(r)),function(i){switch(i){case"AND":return"and";case"OR":return"or";default:return b()}}(t.compositeFilter.op))}(n):b()}function KR(n){return LR[n]}function WR(n){return UR[n]}function HR(n){return jR[n]}function ci(n){return{fieldPath:n.canonicalString()}}function li(n){return ge.fromServerFormat(n.fieldPath)}function QE(n){return n instanceof G?function(t){if(t.op==="=="){if(aw(t.value))return{unaryFilter:{field:ci(t.field),op:"IS_NAN"}};if(ow(t.value))return{unaryFilter:{field:ci(t.field),op:"IS_NULL"}}}else if(t.op==="!="){if(aw(t.value))return{unaryFilter:{field:ci(t.field),op:"IS_NOT_NAN"}};if(ow(t.value))return{unaryFilter:{field:ci(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ci(t.field),op:WR(t.op),value:t.value}}}(n):n instanceof J?function(t){let r=t.getFilters().map(i=>QE(i));return r.length===1?r[0]:{compositeFilter:{op:HR(t.op),filters:r}}}(n):b()}function QR(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function YE(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var Ti=class n{constructor(e,t,r,i,s=N.min(),o=N.min(),a=Re.EMPTY_BYTE_STRING,u=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=u}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var Ju=class{constructor(e){this.ct=e}};function YR(n,e){let t;if(e.document)t=zE(n.ct,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=T.fromSegments(e.noDocument.path),i=vr(e.noDocument.readTime);t=Te.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return b();{let r=T.fromSegments(e.unknownDocument.path),i=vr(e.unknownDocument.version);t=Te.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(i){let s=new ue(i[0],i[1]);return N.fromTimestamp(s)}(e.readTime)),t}function Cw(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Zu(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=function(s,o){return{name:Ro(s,o.key),fields:o.data.value.mapValue.fields,updateTime:Ii(s,o.version.toTimestamp()),createTime:Ii(s,o.createTime.toTimestamp())}}(n.ct,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:yr(e.version)};else{if(!e.isUnknownDocument())return b();r.unknownDocument={path:t.path.toArray(),version:yr(e.version)}}return r}function Zu(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function yr(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function vr(n){let e=new ue(n.seconds,n.nanoseconds);return N.fromTimestamp(e)}function ar(n,e){let t=(e.baseMutations||[]).map(s=>hf(n.ct,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let a=e.mutations[s+1];o.updateTransforms=a.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>hf(n.ct,s)),i=ue.fromMillis(e.localWriteTimeMs);return new Ao(e.batchId,i,t,r)}function lo(n){let e=vr(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?vr(n.lastLimboFreeSnapshotVersion):N.min(),r;return r=function(s){return s.documents!==void 0}(n.query)?function(s){return V(s.documents.length===1),$e(Mi(qE(s.documents[0])))}(n.query):function(s){return $e(WE(s))}(n.query),new Ti(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,Re.fromBase64String(n.resumeToken))}function XE(n,e){let t=yr(e.snapshotVersion),r=yr(e.lastLimboFreeSnapshotVersion),i;i=Ku(e.target)?GE(n.ct,e.target):KE(n.ct,e.target).ut;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:gr(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Op(n){let e=WE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?Hu(e,e.limit,"L"):e}function Cd(n,e){return new Co(e.largestBatchId,hf(n.ct,e.overlayMutation))}function Sw(n,e){let t=e.path.lastSegment();return[n,qe(e.path.popLast()),t]}function bw(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:yr(r.readTime),documentKey:qe(r.documentKey.path),largestBatchId:r.largestBatchId}}var df=class{getBundleMetadata(e,t){return Rw(e).get(t).next(r=>{if(r)return function(s){return{id:s.bundleId,createTime:vr(s.createTime),version:s.version}}(r)})}saveBundleMetadata(e,t){return Rw(e).put(function(i){return{bundleId:i.id,createTime:yr(me(i.createTime)),version:i.version}}(t))}getNamedQuery(e,t){return Dw(e).get(t).next(r=>{if(r)return function(s){return{name:s.name,query:Op(s.bundledQuery),readTime:vr(s.readTime)}}(r)})}saveNamedQuery(e,t){return Dw(e).put(function(i){return{name:i.name,readTime:yr(me(i.readTime)),bundledQuery:i.bundledQuery}}(t))}};function Rw(n){return De(n,"bundles")}function Dw(n){return De(n,"namedQueries")}var ec=class n{constructor(e,t){this.serializer=e,this.userId=t}static lt(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return so(e).get(Sw(this.userId,t)).next(r=>r?Cd(this.serializer,r):null)}getOverlays(e,t){let r=Vt();return p.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Co(t,o);i.push(this.ht(e,a))}),p.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(qe(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(so(e).H("collectionPathOverlayIndex",a))}),p.waitFor(s)}getOverlaysForCollection(e,t,r){let i=Vt(),s=qe(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return so(e).W("collectionPathOverlayIndex",o).next(a=>{for(let u of a){let c=Cd(this.serializer,u);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=Vt(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return so(e).Y({index:"collectionGroupOverlayIndex",range:a},(u,c,l)=>{let h=Cd(this.serializer,c);s.size()<i||h.largestBatchId===o?(s.set(h.getKey(),h),o=h.largestBatchId):l.done()}).next(()=>s)}ht(e,t){return so(e).put(function(i,s,o){let[a,u,c]=Sw(s,o.mutation.key);return{userId:s,collectionPath:u,documentId:c,collectionGroup:o.mutation.key.getCollectionGroup(),largestBatchId:o.largestBatchId,overlayMutation:Do(i.ct,o.mutation)}}(this.serializer,this.userId,t))}};function so(n){return De(n,"documentOverlays")}var zt=class{constructor(){}Pt(e,t){this.It(e,t),t.Tt()}It(e,t){if("nullValue"in e)this.Et(t,5);else if("booleanValue"in e)this.Et(t,10),t.dt(e.booleanValue?1:0);else if("integerValue"in e)this.Et(t,15),t.dt(de(e.integerValue));else if("doubleValue"in e){let r=de(e.doubleValue);isNaN(r)?this.Et(t,13):(this.Et(t,15),vo(r)?t.dt(0):t.dt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Et(t,20),typeof r=="string"?t.At(r):(t.At(`${r.seconds||""}`),t.dt(r.nanos||0))}else if("stringValue"in e)this.Rt(e.stringValue,t),this.Vt(t);else if("bytesValue"in e)this.Et(t,30),t.ft(Dn(e.bytesValue)),this.Vt(t);else if("referenceValue"in e)this.gt(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.Et(t,45),t.dt(r.latitude||0),t.dt(r.longitude||0)}else"mapValue"in e?fE(e)?this.Et(t,Number.MAX_SAFE_INTEGER):(this.yt(e.mapValue,t),this.Vt(t)):"arrayValue"in e?(this.wt(e.arrayValue,t),this.Vt(t)):b()}Rt(e,t){this.Et(t,25),this.St(e,t)}St(e,t){t.At(e)}yt(e,t){let r=e.fields||{};this.Et(t,55);for(let i of Object.keys(r))this.Rt(i,t),this.It(r[i],t)}wt(e,t){let r=e.values||[];this.Et(t,50);for(let i of r)this.It(i,t)}gt(e,t){this.Et(t,37),T.fromName(e).path.forEach(r=>{this.Et(t,60),this.St(r,t)})}Et(e,t){e.dt(t)}Vt(e){e.dt(2)}};zt.bt=new zt;function XR(n){if(n===0)return 8;let e=0;return!(n>>4)&&(e+=4,n<<=4),!(n>>6)&&(e+=2,n<<=2),!(n>>7)&&(e+=1),e}function Pw(n){let e=64-function(r){let i=0;for(let s=0;s<8;++s){let o=XR(255&r[s]);if(i+=o,o!==8)break}return i}(n);return Math.ceil(e/8)}var ff=class{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Dt(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Ct(r.value),r=t.next();this.vt()}Ft(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.Mt(r.value),r=t.next();this.xt()}Ot(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Ct(r);else if(r<2048)this.Ct(960|r>>>6),this.Ct(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Ct(480|r>>>12),this.Ct(128|63&r>>>6),this.Ct(128|63&r);else{let i=t.codePointAt(0);this.Ct(240|i>>>18),this.Ct(128|63&i>>>12),this.Ct(128|63&i>>>6),this.Ct(128|63&i)}}this.vt()}Nt(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.Mt(r);else if(r<2048)this.Mt(960|r>>>6),this.Mt(128|63&r);else if(t<"\uD800"||"\uDBFF"<t)this.Mt(480|r>>>12),this.Mt(128|63&r>>>6),this.Mt(128|63&r);else{let i=t.codePointAt(0);this.Mt(240|i>>>18),this.Mt(128|63&i>>>12),this.Mt(128|63&i>>>6),this.Mt(128|63&i)}}this.xt()}Lt(e){let t=this.Bt(e),r=Pw(t);this.kt(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}qt(e){let t=this.Bt(e),r=Pw(t);this.kt(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Qt(){this.Kt(255),this.Kt(255)}$t(){this.Ut(255),this.Ut(255)}reset(){this.position=0}seed(e){this.kt(e.length),this.buffer.set(e,this.position),this.position+=e.length}Wt(){return this.buffer.slice(0,this.position)}Bt(e){let t=function(s){let o=new DataView(new ArrayBuffer(8));return o.setFloat64(0,s,!1),new Uint8Array(o.buffer)}(e),r=(128&t[0])!=0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ct(e){let t=255&e;t===0?(this.Kt(0),this.Kt(255)):t===255?(this.Kt(255),this.Kt(0)):this.Kt(t)}Mt(e){let t=255&e;t===0?(this.Ut(0),this.Ut(255)):t===255?(this.Ut(255),this.Ut(0)):this.Ut(e)}vt(){this.Kt(0),this.Kt(1)}xt(){this.Ut(0),this.Ut(1)}Kt(e){this.kt(1),this.buffer[this.position++]=e}Ut(e){this.kt(1),this.buffer[this.position++]=~e}kt(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},pf=class{constructor(e){this.Gt=e}ft(e){this.Gt.Dt(e)}At(e){this.Gt.Ot(e)}dt(e){this.Gt.Lt(e)}Tt(){this.Gt.Qt()}},gf=class{constructor(e){this.Gt=e}ft(e){this.Gt.Ft(e)}At(e){this.Gt.Nt(e)}dt(e){this.Gt.qt(e)}Tt(){this.Gt.$t()}},ur=class{constructor(){this.Gt=new ff,this.zt=new pf(this.Gt),this.jt=new gf(this.Gt)}seed(e){this.Gt.seed(e)}Ht(e){return e===0?this.zt:this.jt}Wt(){return this.Gt.Wt()}reset(){this.Gt.reset()}};var cr=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Jt(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function En(n,e){let t=n.indexId-e.indexId;return t!==0?t:(t=Vw(n.arrayValue,e.arrayValue),t!==0?t:(t=Vw(n.directionalValue,e.directionalValue),t!==0?t:T.comparator(n.documentKey,e.documentKey)))}function Vw(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var tc=class{constructor(e){this.Yt=new Z((t,r)=>ge.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.Zt=e.orderBy,this.Xt=[];for(let t of e.filters){let r=t;r.isInequality()?this.Yt=this.Yt.add(r):this.Xt.push(r)}}get en(){return this.Yt.size>1}tn(e){if(V(e.collectionGroup===this.collectionId),this.en)return!1;let t=Od(e);if(t!==void 0&&!this.nn(t))return!1;let r=sr(e),i=new Set,s=0,o=0;for(;s<r.length&&this.nn(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.Yt.size>0){let a=this.Yt.getIterator().getNext();if(!i.has(a.field.canonicalString())){let u=r[s];if(!this.rn(a,u)||!this.sn(this.Zt[o++],u))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.Zt.length||!this.sn(this.Zt[o++],a))return!1}return!0}on(){if(this.en)return null;let e=new Z(ge.comparator),t=[];for(let r of this.Xt)if(!r.field.isKeyField())if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new fi(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new fi(r.field,0))}for(let r of this.Zt)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new fi(r.field,r.dir==="asc"?0:1)));return new yi(yi.UNKNOWN_ID,this.collectionId,t,yo.empty())}nn(e){for(let t of this.Xt)if(this.rn(t,e))return!0;return!1}rn(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}sn(e,t){return!!e.field.isEqual(t.fieldPath)&&(t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc")}};function JE(n){var e,t;if(V(n instanceof G||n instanceof J),n instanceof G){if(n instanceof Gu){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>G.create(n.field,"==",s)))||[];return J.create(i,"or")}return n}let r=n.filters.map(i=>JE(i));return J.create(r,n.op)}function JR(n){if(n.getFilters().length===0)return[];let e=vf(JE(n));return V(ZE(e)),mf(e)||yf(e)?[e]:e.getFilters()}function mf(n){return n instanceof G}function yf(n){return n instanceof J&&xp(n)}function ZE(n){return mf(n)||yf(n)||function(t){if(t instanceof J&&zd(t)){for(let r of t.getFilters())if(!mf(r)&&!yf(r))return!1;return!0}return!1}(n)}function vf(n){if(V(n instanceof G||n instanceof J),n instanceof G)return n;if(n.filters.length===1)return vf(n.filters[0]);let e=n.filters.map(r=>vf(r)),t=J.create(e,n.op);return t=nc(t),ZE(t)?t:(V(t instanceof J),V(_i(t)),V(t.filters.length>1),t.filters.reduce((r,i)=>Fp(r,i)))}function Fp(n,e){let t;return V(n instanceof G||n instanceof J),V(e instanceof G||e instanceof J),t=n instanceof G?e instanceof G?function(i,s){return J.create([i,s],"and")}(n,e):xw(n,e):e instanceof G?xw(e,n):function(i,s){if(V(i.filters.length>0&&s.filters.length>0),_i(i)&&_i(s))return yE(i,s.getFilters());let o=zd(i)?i:s,a=zd(i)?s:i,u=o.filters.map(c=>Fp(c,a));return J.create(u,"or")}(n,e),nc(t)}function xw(n,e){if(_i(e))return yE(e,n.getFilters());{let t=e.filters.map(r=>Fp(n,r));return J.create(t,"or")}}function nc(n){if(V(n instanceof G||n instanceof J),n instanceof G)return n;let e=n.getFilters();if(e.length===1)return nc(e[0]);if(gE(n))return n;let t=e.map(i=>nc(i)),r=[];return t.forEach(i=>{i instanceof G?r.push(i):i instanceof J&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:J.create(r,n.op)}var _f=class{constructor(){this._n=new Po}addToCollectionParentIndex(e,t){return this._n.add(t),p.resolve()}getCollectionParents(e,t){return p.resolve(this._n.getEntries(t))}addFieldIndex(e,t){return p.resolve()}deleteFieldIndex(e,t){return p.resolve()}deleteAllFieldIndexes(e){return p.resolve()}createTargetIndexes(e,t){return p.resolve()}getDocumentsMatchingTarget(e,t){return p.resolve(null)}getIndexType(e,t){return p.resolve(0)}getFieldIndexes(e,t){return p.resolve([])}getNextCollectionGroupToUpdate(e){return p.resolve(null)}getMinOffset(e,t){return p.resolve(ut.min())}getMinOffsetFromCollectionGroup(e,t){return p.resolve(ut.min())}updateCollectionGroup(e,t,r){return p.resolve()}updateIndexEntries(e,t){return p.resolve()}},Po=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new Z(H.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new Z(H.comparator)).toArray()}};var bu=new Uint8Array(0),wf=class{constructor(e,t){this.databaseId=t,this.an=new Po,this.un=new Ft(r=>gr(r),(r,i)=>jo(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.an.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.an.add(t)});let s={collectionId:r,parent:qe(i)};return Nw(e).put(s)}return p.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[nE(t),""],!1,!0);return Nw(e).W(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(Pt(o.parent))}return r})}addFieldIndex(e,t){let r=oo(e),i=function(a){return{indexId:a.indexId,collectionGroup:a.collectionGroup,fields:a.fields.map(u=>[u.fieldPath.canonicalString(),u.kind])}}(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=si(e);return s.next(a=>{o.put(bw(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){let r=oo(e),i=si(e),s=ii(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=oo(e),r=ii(e),i=si(e);return t.H().next(()=>r.H()).next(()=>i.H())}createTargetIndexes(e,t){return p.forEach(this.cn(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let s=new tc(r).on();if(s!=null)return this.addFieldIndex(e,s)}}))}getDocumentsMatchingTarget(e,t){let r=ii(e),i=!0,s=new Map;return p.forEach(this.cn(t),o=>this.ln(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=B(),a=[];return p.forEach(s,(u,c)=>{_("IndexedDbIndexManager",`Using index ${function(R){return`id=${R.indexId}|cg=${R.collectionGroup}|f=${R.fields.map(M=>`${M.fieldPath}:${M.kind}`).join(",")}`}(u)} to execute ${gr(t)}`);let l=function(R,M){let j=Od(M);if(j===void 0)return null;for(let K of Wu(R,j.fieldPath))switch(K.op){case"array-contains-any":return K.value.arrayValue.values||[];case"array-contains":return[K.value]}return null}(c,u),h=function(R,M){let j=new Map;for(let K of sr(M))for(let ce of Wu(R,K.fieldPath))switch(ce.op){case"==":case"in":j.set(K.fieldPath.canonicalString(),ce.value);break;case"not-in":case"!=":return j.set(K.fieldPath.canonicalString(),ce.value),Array.from(j.values())}return null}(c,u),d=function(R,M){let j=[],K=!0;for(let ce of sr(M)){let vt=ce.kind===0?dw(R,ce.fieldPath,R.startAt):fw(R,ce.fieldPath,R.startAt);j.push(vt.value),K&&(K=vt.inclusive)}return new Ot(j,K)}(c,u),f=function(R,M){let j=[],K=!0;for(let ce of sr(M)){let vt=ce.kind===0?fw(R,ce.fieldPath,R.endAt):dw(R,ce.fieldPath,R.endAt);j.push(vt.value),K&&(K=vt.inclusive)}return new Ot(j,K)}(c,u),E=this.hn(u,c,d),w=this.hn(u,c,f),y=this.Pn(u,c,h),I=this.In(u.indexId,l,E,d.inclusive,w,f.inclusive,y);return p.forEach(I,k=>r.j(k,t.limit).next(R=>{R.forEach(M=>{let j=T.fromSegments(M.documentKey);o.has(j)||(o=o.add(j),a.push(j))})}))}).next(()=>a)}return p.resolve(null)})}cn(e){let t=this.un.get(e);return t||(e.filters.length===0?t=[e]:t=JR(J.create(e.filters,"and")).map(r=>Zd(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.un.set(e,t),t)}In(e,t,r,i,s,o,a){let u=(t!=null?t.length:1)*Math.max(r.length,s.length),c=u/(t!=null?t.length:1),l=[];for(let h=0;h<u;++h){let d=t?this.Tn(t[h/c]):bu,f=this.En(e,d,r[h%c],i),E=this.dn(e,d,s[h%c],o),w=a.map(y=>this.En(e,d,y,!0));l.push(...this.createRange(f,E,w))}return l}En(e,t,r,i){let s=new cr(e,T.empty(),t,r);return i?s:s.Jt()}dn(e,t,r,i){let s=new cr(e,T.empty(),t,r);return i?s.Jt():s}ln(e,t){let r=new tc(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.tn(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.cn(t);return p.forEach(i,s=>this.ln(e,s).next(o=>{o?r!==0&&o.fields.length<function(u){let c=new Z(ge.comparator),l=!1;for(let h of u.filters)for(let d of h.getFlattenedFilters())d.field.isKeyField()||(d.op==="array-contains"||d.op==="array-contains-any"?l=!0:c=c.add(d.field));for(let h of u.orderBy)h.field.isKeyField()||(c=c.add(h.field));return c.size+(l?1:0)}(s)&&(r=1):r=0})).next(()=>function(o){return o.limit!==null}(t)&&i.length>1&&r===2?1:r)}An(e,t){let r=new ur;for(let i of sr(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.Ht(i.kind);zt.bt.Pt(s,o)}return r.Wt()}Tn(e){let t=new ur;return zt.bt.Pt(e,t.Ht(0)),t.Wt()}Rn(e,t){let r=new ur;return zt.bt.Pt(fr(this.databaseId,t),r.Ht(function(s){let o=sr(s);return o.length===0?0:o[o.length-1].kind}(e))),r.Wt()}Pn(e,t,r){if(r===null)return[];let i=[];i.push(new ur);let s=0;for(let o of sr(e)){let a=r[s++];for(let u of i)if(this.Vn(t,o.fieldPath)&&Io(a))i=this.mn(i,o,a);else{let c=u.Ht(o.kind);zt.bt.Pt(a,c)}}return this.fn(i)}hn(e,t,r){return this.Pn(e,t,r.position)}fn(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Wt();return t}mn(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let u=new ur;u.seed(a.Wt()),zt.bt.Pt(o,u.Ht(t.kind)),s.push(u)}return s}Vn(e,t){return!!e.filters.find(r=>r instanceof G&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=oo(e),i=si(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(s=>{let o=[];return p.forEach(s,a=>i.get([a.indexId,this.uid]).next(u=>{o.push(function(l,h){let d=h?new yo(h.sequenceNumber,new ut(vr(h.readTime),new T(Pt(h.documentKey)),h.largestBatchId)):yo.empty(),f=l.fields.map(([E,w])=>new fi(ge.fromServerFormat(E),w));return new yi(l.indexId,l.collectionGroup,f,d)}(a,u))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:U(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=oo(e),s=si(e);return this.gn(e).next(o=>i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(a=>p.forEach(a,u=>s.put(bw(u.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return p.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?p.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(a=>(r.set(i.collectionGroup,a),p.forEach(a,u=>this.pn(e,i,u).next(c=>{let l=this.yn(s,u);return c.isEqual(l)?p.resolve():this.wn(e,s,u,c,l)}))))})}Sn(e,t,r,i){return ii(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.Rn(r,t.key),documentKey:t.key.path.toArray()})}bn(e,t,r,i){return ii(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.Rn(r,t.key),t.key.path.toArray()])}pn(e,t,r){let i=ii(e),s=new Z(En);return i.Y({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.Rn(r,t)])},(o,a)=>{s=s.add(new cr(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}yn(e,t){let r=new Z(En),i=this.An(t,e);if(i==null)return r;let s=Od(t);if(s!=null){let o=e.data.field(s.fieldPath);if(Io(o))for(let a of o.arrayValue.values||[])r=r.add(new cr(t.indexId,e.key,this.Tn(a),i))}else r=r.add(new cr(t.indexId,e.key,bu,i));return r}wn(e,t,r,i,s){_("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);let o=[];return function(u,c,l,h,d){let f=u.getIterator(),E=c.getIterator(),w=ri(f),y=ri(E);for(;w||y;){let I=!1,k=!1;if(w&&y){let R=l(w,y);R<0?k=!0:R>0&&(I=!0)}else w!=null?k=!0:I=!0;I?(h(y),y=ri(E)):k?(d(w),w=ri(f)):(w=ri(f),y=ri(E))}}(i,s,En,a=>{o.push(this.Sn(e,t,r,a))},a=>{o.push(this.bn(e,t,r,a))}),p.waitFor(o)}gn(e){let t=1;return si(e).Y({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>En(o,a)).filter((o,a,u)=>!a||En(o,u[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=En(o,e),u=En(o,t);if(a===0)i[0]=e.Jt();else if(a>0&&u<0)i.push(o),i.push(o.Jt());else if(u>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.Dn(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,bu,[]],u=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,bu,[]];s.push(IDBKeyRange.bound(a,u))}return s}Dn(e,t){return En(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(Mw)}getMinOffset(e,t){return p.mapArray(this.cn(t),r=>this.ln(e,r).next(i=>i||b())).next(Mw)}};function Nw(n){return De(n,"collectionParents")}function ii(n){return De(n,"indexEntries")}function oo(n){return De(n,"indexConfiguration")}function si(n){return De(n,"indexState")}function Mw(n){V(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;Dp(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new ut(e.readTime,e.documentKey,t)}var kw={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ot=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};function eI(n,e,t){let r=n.store("mutations"),i=n.store("documentMutations"),s=[],o=IDBKeyRange.only(t.batchId),a=0,u=r.Y({range:o},(l,h,d)=>(a++,d.delete()));s.push(u.next(()=>{V(a===1)}));let c=[];for(let l of t.mutations){let h=aE(e,l.key.path,t.batchId);s.push(i.delete(h)),c.push(l.key)}return p.waitFor(s).next(()=>c)}function rc(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw b();e=n.noDocument}return JSON.stringify(e).length}ot.DEFAULT_COLLECTION_PERCENTILE=10,ot.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ot.DEFAULT=new ot(41943040,ot.DEFAULT_COLLECTION_PERCENTILE,ot.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ot.DISABLED=new ot(-1,0,0);var ic=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.Cn={}}static lt(e,t,r,i){V(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return In(e).Y({index:"userMutationsIndex",range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=hi(e),o=In(e);return o.add({}).next(a=>{V(typeof a=="number");let u=new Ao(a,t,r,i),c=function(f,E,w){let y=w.baseMutations.map(k=>Do(f.ct,k)),I=w.mutations.map(k=>Do(f.ct,k));return{userId:E,batchId:w.batchId,localWriteTimeMs:w.localWriteTime.toMillis(),baseMutations:y,mutations:I}}(this.serializer,this.userId,u),l=[],h=new Z((d,f)=>U(d.canonicalString(),f.canonicalString()));for(let d of i){let f=aE(this.userId,d.key.path,a);h=h.add(d.key.path.popLast()),l.push(o.put(c)),l.push(s.put(f,sR))}return h.forEach(d=>{l.push(this.indexManager.addToCollectionParentIndex(e,d))}),e.addOnCommittedListener(()=>{this.Cn[a]=u.keys()}),p.waitFor(l).next(()=>u)})}lookupMutationBatch(e,t){return In(e).get(t).next(r=>r?(V(r.userId===this.userId),ar(this.serializer,r)):null)}vn(e,t){return this.Cn[t]?p.resolve(this.Cn[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.Cn[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return In(e).Y({index:"userMutationsIndex",range:i},(o,a,u)=>{a.userId===this.userId&&(V(a.batchId>=r),s=ar(this.serializer,a)),u.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=-1;return In(e).Y({index:"userMutationsIndex",range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return In(e).W("userMutationsIndex",t).next(r=>r.map(i=>ar(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Vu(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return hi(e).Y({range:i},(o,a,u)=>{let[c,l,h]=o,d=Pt(l);if(c===this.userId&&t.path.isEqual(d))return In(e).get(h).next(f=>{if(!f)throw b();V(f.userId===this.userId),s.push(ar(this.serializer,f))});u.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Z(U),i=[];return t.forEach(s=>{let o=Vu(this.userId,s.path),a=IDBKeyRange.lowerBound(o),u=hi(e).Y({range:a},(c,l,h)=>{let[d,f,E]=c,w=Pt(f);d===this.userId&&s.path.isEqual(w)?r=r.add(E):h.done()});i.push(u)}),p.waitFor(i).next(()=>this.Fn(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Vu(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new Z(U);return hi(e).Y({range:o},(u,c,l)=>{let[h,d,f]=u,E=Pt(d);h===this.userId&&r.isPrefixOf(E)?E.length===i&&(a=a.add(f)):l.done()}).next(()=>this.Fn(e,a))}Fn(e,t){let r=[],i=[];return t.forEach(s=>{i.push(In(e).get(s).next(o=>{if(o===null)throw b();V(o.userId===this.userId),r.push(ar(this.serializer,o))}))}),p.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return eI(e.ae,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.Mn(t.batchId)}),p.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}Mn(e){delete this.Cn[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return p.resolve();let r=IDBKeyRange.lowerBound(function(o){return[o]}(this.userId)),i=[];return hi(e).Y({range:r},(s,o,a)=>{if(s[0]===this.userId){let u=Pt(s[1]);i.push(u)}else a.done()}).next(()=>{V(i.length===0)})})}containsKey(e,t){return tI(e,this.userId,t)}xn(e){return nI(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}};function tI(n,e,t){let r=Vu(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return hi(n).Y({range:s,J:!0},(a,u,c)=>{let[l,h,d]=a;l===e&&h===i&&(o=!0),c.done()}).next(()=>o)}function In(n){return De(n,"mutations")}function hi(n){return De(n,"documentMutations")}function nI(n){return De(n,"mutationQueues")}var Ai=class n{constructor(e){this.On=e}next(){return this.On+=2,this.On}static Nn(){return new n(0)}static Ln(){return new n(-1)}};var Ef=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.Bn(e).next(t=>{let r=new Ai(t.highestTargetId);return t.highestTargetId=r.next(),this.kn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Bn(e).next(t=>N.fromTimestamp(new ue(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Bn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Bn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.kn(e,i)))}addTargetData(e,t){return this.qn(e,t).next(()=>this.Bn(e).next(r=>(r.targetCount+=1,this.Qn(t,r),this.kn(e,r))))}updateTargetData(e,t){return this.qn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>oi(e).delete(t.targetId)).next(()=>this.Bn(e)).next(r=>(V(r.targetCount>0),r.targetCount-=1,this.kn(e,r)))}removeTargets(e,t,r){let i=0,s=[];return oi(e).Y((o,a)=>{let u=lo(a);u.sequenceNumber<=t&&r.get(u.targetId)===null&&(i++,s.push(this.removeTargetData(e,u)))}).next(()=>p.waitFor(s)).next(()=>i)}forEachTarget(e,t){return oi(e).Y((r,i)=>{let s=lo(i);t(s)})}Bn(e){return Ow(e).get("targetGlobalKey").next(t=>(V(t!==null),t))}kn(e,t){return Ow(e).put("targetGlobalKey",t)}qn(e,t){return oi(e).put(XE(this.serializer,t))}Qn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Bn(e).next(t=>t.targetCount)}getTargetData(e,t){let r=gr(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return oi(e).Y({range:i,index:"queryTargetsIndex"},(o,a,u)=>{let c=lo(a);jo(t,c.target)&&(s=c,u.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Tn(e);return t.forEach(o=>{let a=qe(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),p.waitFor(i)}removeMatchingKeys(e,t,r){let i=Tn(e);return p.forEach(t,s=>{let o=qe(s.path);return p.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Tn(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Tn(e),s=B();return i.Y({range:r,J:!0},(o,a,u)=>{let c=Pt(o[1]),l=new T(c);s=s.add(l)}).next(()=>s)}containsKey(e,t){let r=qe(t.path),i=IDBKeyRange.bound([r],[nE(r)],!1,!0),s=0;return Tn(e).Y({index:"documentTargetsIndex",J:!0,range:i},([o,a],u,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}_t(e,t){return oi(e).get(t).next(r=>r?lo(r):null)}};function oi(n){return De(n,"targets")}function Ow(n){return De(n,"targetGlobal")}function Tn(n){return De(n,"targetDocuments")}function Fw([n,e],[t,r]){let i=U(n,t);return i===0?U(e,r):i}var If=class{constructor(e){this.Kn=e,this.buffer=new Z(Fw),this.$n=0}Un(){return++this.$n}Wn(e){let t=[e,this.Un()];if(this.buffer.size<this.Kn)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();Fw(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},Tf=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Gn=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.zn(6e4)}stop(){this.Gn&&(this.Gn.cancel(),this.Gn=null)}get started(){return this.Gn!==null}zn(e){_("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Gn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>m(this,null,function*(){this.Gn=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ln(t)?_("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):yield Fn(t)}yield this.zn(3e5)}))}},Af=class{constructor(e,t){this.jn=e,this.params=t}calculateTargetCount(e,t){return this.jn.Hn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return p.resolve(et._e);let r=new If(t);return this.jn.forEachTarget(e,i=>r.Wn(i.sequenceNumber)).next(()=>this.jn.Jn(e,i=>r.Wn(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.jn.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.jn.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===-1?(_("LruGarbageCollector","Garbage collection skipped; disabled"),p.resolve(kw)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(_("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),kw):this.Yn(e,t))}getCacheSize(e){return this.jn.getCacheSize(e)}Yn(e,t){let r,i,s,o,a,u,c,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(h=>(h>this.params.maximumSequenceNumbersToCollect?(_("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${h}`),i=this.params.maximumSequenceNumbersToCollect):i=h,o=Date.now(),this.nthSequenceNumber(e,i))).next(h=>(r=h,a=Date.now(),this.removeTargets(e,r,t))).next(h=>(s=h,u=Date.now(),this.removeOrphanedDocuments(e,r))).next(h=>(c=Date.now(),ai()<=At.DEBUG&&_("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-l}ms
	Determined least recently used ${i} in `+(a-o)+`ms
	Removed ${s} targets in `+(u-a)+`ms
	Removed ${h} documents in `+(c-u)+`ms
Total Duration: ${c-l}ms`),p.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:h})))}};function ZR(n,e){return new Af(n,e)}var Cf=class{constructor(e,t){this.db=e,this.garbageCollector=ZR(this,t)}Hn(e){let t=this.Zn(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Zn(e){let t=0;return this.Jn(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Jn(e,t){return this.Xn(e,(r,i)=>t(i))}addReference(e,t,r){return Ru(e,r)}removeReference(e,t,r){return Ru(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Ru(e,t)}er(e,t){return function(i,s){let o=!1;return nI(i).Z(a=>tI(i,a,s).next(u=>(u&&(o=!0),p.resolve(!u)))).next(()=>o)}(e,t)}removeOrphanedDocuments(e,t){let r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],s=0;return this.Xn(e,(o,a)=>{if(a<=t){let u=this.er(e,o).next(c=>{if(!c)return s++,r.getEntry(e,o).next(()=>(r.removeEntry(o,N.min()),Tn(e).delete(function(h){return[0,qe(h.path)]}(o))))});i.push(u)}}).next(()=>p.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Ru(e,t)}Xn(e,t){let r=Tn(e),i,s=et._e;return r.Y({index:"documentTargetsIndex"},([o,a],{path:u,sequenceNumber:c})=>{o===0?(s!==et._e&&t(new T(Pt(i)),s),s=c,i=u):s=et._e}).next(()=>{s!==et._e&&t(new T(Pt(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function Ru(n,e){return Tn(n).put(function(r,i){return{targetId:0,path:qe(r.path),sequenceNumber:i}}(e,n.currentSequenceNumber))}var sc=class{constructor(){this.changes=new Ft(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Te.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?p.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var Sf=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return ir(e).put(r)}removeEntry(e,t,r){return ir(e).delete(function(s,o){let a=s.path.toArray();return[a.slice(0,a.length-2),a[a.length-2],Zu(o),a[a.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.tr(e,r)))}getEntry(e,t){let r=Te.newInvalidDocument(t);return ir(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(ao(t))},(i,s)=>{r=this.nr(t,s)}).next(()=>r)}rr(e,t){let r={size:0,document:Te.newInvalidDocument(t)};return ir(e).Y({index:"documentKeyIndex",range:IDBKeyRange.only(ao(t))},(i,s)=>{r={document:this.nr(t,s),size:rc(s)}}).next(()=>r)}getEntries(e,t){let r=We();return this.ir(e,t,(i,s)=>{let o=this.nr(i,s);r=r.insert(i,o)}).next(()=>r)}sr(e,t){let r=We(),i=new ie(T.comparator);return this.ir(e,t,(s,o)=>{let a=this.nr(s,o);r=r.insert(s,a),i=i.insert(s,rc(o))}).next(()=>({documents:r,_r:i}))}ir(e,t,r){if(t.isEmpty())return p.resolve();let i=new Z(jw);t.forEach(u=>i=i.add(u));let s=IDBKeyRange.bound(ao(i.first()),ao(i.last())),o=i.getIterator(),a=o.getNext();return ir(e).Y({index:"documentKeyIndex",range:s},(u,c,l)=>{let h=T.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&jw(a,h)<0;)r(a,null),a=o.getNext();a&&a.isEqual(h)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?l.U(ao(a)):l.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),Zu(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],u=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ir(e).W(IDBKeyRange.bound(a,u,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let l=We();for(let h of c){let d=this.nr(T.fromSegments(h.prefixPath.concat(h.collectionGroup,h.documentId)),h);d.isFoundDocument()&&(qo(t,d)||i.has(d.key))&&(l=l.insert(d.key,d))}return l})}getAllFromCollectionGroup(e,t,r,i){let s=We(),o=Uw(t,r),a=Uw(t,ut.max());return ir(e).Y({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,a,!0)},(u,c,l)=>{let h=this.nr(T.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(h.key,h),s.size===i&&l.done()}).next(()=>s)}newChangeBuffer(e){return new bf(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return Lw(e).get("remoteDocumentGlobalKey").next(t=>(V(!!t),t))}tr(e,t){return Lw(e).put("remoteDocumentGlobalKey",t)}nr(e,t){if(t){let r=YR(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(N.min())))return r}return Te.newInvalidDocument(e)}};function rI(n){return new Sf(n)}var bf=class extends sc{constructor(e,t){super(),this.ar=e,this.trackRemovals=t,this.ur=new Ft(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new Z((s,o)=>U(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.ur.get(s);if(t.push(this.ar.removeEntry(e,s,a.readTime)),o.isValidDocument()){let u=Cw(this.ar.serializer,o);i=i.add(s.path.popLast());let c=rc(u);r+=c-a.size,t.push(this.ar.addEntry(e,s,u))}else if(r-=a.size,this.trackRemovals){let u=Cw(this.ar.serializer,o.convertToNoDocument(N.min()));t.push(this.ar.addEntry(e,s,u))}}),i.forEach(s=>{t.push(this.ar.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.ar.updateMetadata(e,r)),p.waitFor(t)}getFromCache(e,t){return this.ar.rr(e,t).next(r=>(this.ur.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.ar.sr(e,t).next(({documents:r,_r:i})=>(i.forEach((s,o)=>{this.ur.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function Lw(n){return De(n,"remoteDocumentGlobal")}function ir(n){return De(n,"remoteDocumentsV14")}function ao(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function Uw(n,e){let t=e.documentKey.path.toArray();return[n,Zu(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function jw(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=U(t[s],r[s]),i)return i;return i=U(t.length,r.length),i||(i=U(t[t.length-2],r[r.length-2]),i||U(t[t.length-1],r[r.length-1]))}var Rf=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var oc=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&po(r.mutation,i,tt.empty(),ue.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,B()).next(()=>r))}getLocalViewOfDocuments(e,t,r=B()){let i=Vt();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=co();return s.forEach((a,u)=>{o=o.insert(a,u.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Vt();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,B()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=We(),o=fo(),a=function(){return fo()}();return t.forEach((u,c)=>{let l=r.get(c.key);i.has(c.key)&&(l===void 0||l.mutation instanceof gt)?s=s.insert(c.key,c):l!==void 0?(o.set(c.key,l.mutation.getFieldMask()),po(l.mutation,c,l.mutation.getFieldMask(),ue.now())):o.set(c.key,tt.empty())}),this.recalculateAndSaveOverlays(e,s).next(u=>(u.forEach((c,l)=>o.set(c,l)),t.forEach((c,l)=>{var h;return a.set(c,new Rf(l,(h=o.get(c))!==null&&h!==void 0?h:null))}),a))}recalculateAndSaveOverlays(e,t){let r=fo(),i=new ie((o,a)=>o-a),s=B();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(u=>{let c=t.get(u);if(c===null)return;let l=r.get(u)||tt.empty();l=a.applyToLocalView(c,l),r.set(u,l);let h=(i.get(a.batchId)||B()).add(u);i=i.insert(a.batchId,h)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let u=a.getNext(),c=u.key,l=u.value,h=SE();l.forEach(d=>{if(!s.has(d)){let f=ME(t.get(d),r.get(d));f!==null&&h.set(d,f),s=s.add(d)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,h))}return p.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return function(o){return T.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Np(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):p.resolve(Vt()),a=-1,u=s;return o.next(c=>p.forEach(c,(l,h)=>(a<h.largestBatchId&&(a=h.largestBatchId),s.get(l)?p.resolve():this.remoteDocumentCache.getEntry(e,l).next(d=>{u=u.insert(l,d)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,u,c,B())).next(l=>({batchId:a,changes:CE(l)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new T(t)).next(r=>{let i=co();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=co();return this.indexManager.getCollectionParents(e,s).next(a=>p.forEach(a,u=>{let c=function(h,d){return new pt(d,null,h.explicitOrderBy.slice(),h.filters.slice(),h.limit,h.limitType,h.startAt,h.endAt)}(t,u.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(l=>{l.forEach((h,d)=>{o=o.insert(h,d)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((u,c)=>{let l=c.getKey();o.get(l)===null&&(o=o.insert(l,Te.newInvalidDocument(l)))});let a=co();return o.forEach((u,c)=>{let l=s.get(u);l!==void 0&&po(l.mutation,c,tt.empty(),ue.now()),qo(t,c)&&(a=a.insert(u,c))}),a})}};var Df=class{constructor(e){this.serializer=e,this.cr=new Map,this.lr=new Map}getBundleMetadata(e,t){return p.resolve(this.cr.get(t))}saveBundleMetadata(e,t){return this.cr.set(t.id,function(i){return{id:i.id,version:i.version,createTime:me(i.createTime)}}(t)),p.resolve()}getNamedQuery(e,t){return p.resolve(this.lr.get(t))}saveNamedQuery(e,t){return this.lr.set(t.name,function(i){return{name:i.name,query:Op(i.bundledQuery),readTime:me(i.readTime)}}(t)),p.resolve()}};var Pf=class{constructor(){this.overlays=new ie(T.comparator),this.hr=new Map}getOverlay(e,t){return p.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Vt();return p.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.ht(e,t,s)}),p.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.hr.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.hr.delete(r)),p.resolve()}getOverlaysForCollection(e,t,r){let i=Vt(),s=t.length+1,o=new T(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let u=a.getNext().value,c=u.getKey();if(!t.isPrefixOf(c.path))break;c.path.length===s&&u.largestBatchId>r&&i.set(u.getKey(),u)}return p.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new ie((c,l)=>c-l),o=this.overlays.getIterator();for(;o.hasNext();){let c=o.getNext().value;if(c.getKey().getCollectionGroup()===t&&c.largestBatchId>r){let l=s.get(c.largestBatchId);l===null&&(l=Vt(),s=s.insert(c.largestBatchId,l)),l.set(c.getKey(),c)}}let a=Vt(),u=s.getIterator();for(;u.hasNext()&&(u.getNext().value.forEach((c,l)=>a.set(c,l)),!(a.size()>=i)););return p.resolve(a)}ht(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.hr.get(i.largestBatchId).delete(r.key);this.hr.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Co(t,r));let s=this.hr.get(t);s===void 0&&(s=B(),this.hr.set(t,s)),this.hr.set(t,s.add(r.key))}};var Vo=class{constructor(){this.Pr=new Z(we.Ir),this.Tr=new Z(we.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(e,t){let r=new we(e,t);this.Pr=this.Pr.add(r),this.Tr=this.Tr.add(r)}dr(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.Ar(new we(e,t))}Rr(e,t){e.forEach(r=>this.removeReference(r,t))}Vr(e){let t=new T(new H([])),r=new we(t,e),i=new we(t,e+1),s=[];return this.Tr.forEachInRange([r,i],o=>{this.Ar(o),s.push(o.key)}),s}mr(){this.Pr.forEach(e=>this.Ar(e))}Ar(e){this.Pr=this.Pr.delete(e),this.Tr=this.Tr.delete(e)}gr(e){let t=new T(new H([])),r=new we(t,e),i=new we(t,e+1),s=B();return this.Tr.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new we(e,0),r=this.Pr.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},we=class{constructor(e,t){this.key=e,this.pr=t}static Ir(e,t){return T.comparator(e.key,t.key)||U(e.pr,t.pr)}static Er(e,t){return U(e.pr,t.pr)||T.comparator(e.key,t.key)}};var Vf=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.yr=1,this.wr=new Z(we.Ir)}checkEmpty(e){return p.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new Ao(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.wr=this.wr.add(new we(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return p.resolve(o)}lookupMutationBatch(e,t){return p.resolve(this.Sr(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.br(r),s=i<0?0:i;return p.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return p.resolve(this.mutationQueue.length===0?-1:this.yr-1)}getAllMutationBatches(e){return p.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new we(t,0),i=new we(t,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([r,i],o=>{let a=this.Sr(o.pr);s.push(a)}),p.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new Z(U);return t.forEach(i=>{let s=new we(i,0),o=new we(i,Number.POSITIVE_INFINITY);this.wr.forEachInRange([s,o],a=>{r=r.add(a.pr)})}),p.resolve(this.Dr(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;T.isDocumentKey(s)||(s=s.child(""));let o=new we(new T(s),0),a=new Z(U);return this.wr.forEachWhile(u=>{let c=u.key.path;return!!r.isPrefixOf(c)&&(c.length===i&&(a=a.add(u.pr)),!0)},o),p.resolve(this.Dr(a))}Dr(e){let t=[];return e.forEach(r=>{let i=this.Sr(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){V(this.Cr(t.batchId,"removed")===0),this.mutationQueue.shift();let r=this.wr;return p.forEach(t.mutations,i=>{let s=new we(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.wr=r})}Mn(e){}containsKey(e,t){let r=new we(t,0),i=this.wr.firstAfterOrEqual(r);return p.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,p.resolve()}Cr(e,t){return this.br(e)}br(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Sr(e){let t=this.br(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};var xf=class{constructor(e){this.vr=e,this.docs=function(){return new ie(T.comparator)}(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.vr(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return p.resolve(r?r.document.mutableCopy():Te.newInvalidDocument(t))}getEntries(e,t){let r=We();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Te.newInvalidDocument(i))}),p.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=We(),o=t.path,a=new T(o.child("")),u=this.docs.getIteratorFrom(a);for(;u.hasNext();){let{key:c,value:{document:l}}=u.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||Dp(iE(l),r)<=0||(i.has(l.key)||qo(t,l))&&(s=s.insert(l.key,l.mutableCopy()))}return p.resolve(s)}getAllFromCollectionGroup(e,t,r,i){b()}Fr(e,t){return p.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new Nf(this)}getSize(e){return p.resolve(this.size)}},Nf=class extends sc{constructor(e){super(),this.ar=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.ar.addEntry(e,i)):this.ar.removeEntry(r)}),p.waitFor(t)}getFromCache(e,t){return this.ar.getEntry(e,t)}getAllFromCache(e,t){return this.ar.getEntries(e,t)}};var Mf=class{constructor(e){this.persistence=e,this.Mr=new Ft(t=>gr(t),jo),this.lastRemoteSnapshotVersion=N.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Vo,this.targetCount=0,this.Lr=Ai.Nn()}forEachTarget(e,t){return this.Mr.forEach((r,i)=>t(i)),p.resolve()}getLastRemoteSnapshotVersion(e){return p.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return p.resolve(this.Or)}allocateTargetId(e){return this.highestTargetId=this.Lr.next(),p.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.Or&&(this.Or=t),p.resolve()}qn(e){this.Mr.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.Lr=new Ai(t),this.highestTargetId=t),e.sequenceNumber>this.Or&&(this.Or=e.sequenceNumber)}addTargetData(e,t){return this.qn(t),this.targetCount+=1,p.resolve()}updateTargetData(e,t){return this.qn(t),p.resolve()}removeTargetData(e,t){return this.Mr.delete(t.target),this.Nr.Vr(t.targetId),this.targetCount-=1,p.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.Mr.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.Mr.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),p.waitFor(s).next(()=>i)}getTargetCount(e){return p.resolve(this.targetCount)}getTargetData(e,t){let r=this.Mr.get(t)||null;return p.resolve(r)}addMatchingKeys(e,t,r){return this.Nr.dr(t,r),p.resolve()}removeMatchingKeys(e,t,r){this.Nr.Rr(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),p.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Nr.Vr(t),p.resolve()}getMatchingKeysForTargetId(e,t){let r=this.Nr.gr(t);return p.resolve(r)}containsKey(e,t){return p.resolve(this.Nr.containsKey(t))}};var ac=class{constructor(e,t){this.Br={},this.overlays={},this.kr=new et(0),this.qr=!1,this.qr=!0,this.referenceDelegate=e(this),this.Qr=new Mf(this),this.indexManager=new _f,this.remoteDocumentCache=function(i){return new xf(i)}(r=>this.referenceDelegate.Kr(r)),this.serializer=new Ju(t),this.$r=new Df(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Pf,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Br[e.toKey()];return r||(r=new Vf(t,this.referenceDelegate),this.Br[e.toKey()]=r),r}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(e,t,r){_("MemoryPersistence","Starting transaction:",e);let i=new kf(this.kr.next());return this.referenceDelegate.Ur(),r(i).next(s=>this.referenceDelegate.Wr(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Gr(e,t){return p.or(Object.values(this.Br).map(r=>()=>r.containsKey(e,t)))}},kf=class extends ju{constructor(e){super(),this.currentSequenceNumber=e}},uc=class n{constructor(e){this.persistence=e,this.zr=new Vo,this.jr=null}static Hr(e){return new n(e)}get Jr(){if(this.jr)return this.jr;throw b()}addReference(e,t,r){return this.zr.addReference(r,t),this.Jr.delete(r.toString()),p.resolve()}removeReference(e,t,r){return this.zr.removeReference(r,t),this.Jr.add(r.toString()),p.resolve()}markPotentiallyOrphaned(e,t){return this.Jr.add(t.toString()),p.resolve()}removeTarget(e,t){this.zr.Vr(t.targetId).forEach(i=>this.Jr.add(i.toString()));let r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Jr.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}Ur(){this.jr=new Set}Wr(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return p.forEach(this.Jr,r=>{let i=T.fromPath(r);return this.Yr(e,i).next(s=>{s||t.removeEntry(i,N.min())})}).next(()=>(this.jr=null,t.apply(e)))}updateLimboDocument(e,t){return this.Yr(e,t).next(r=>{r?this.Jr.delete(t.toString()):this.Jr.add(t.toString())})}Kr(e){return 0}Yr(e,t){return p.or([()=>p.resolve(this.zr.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Gr(e,t)])}};var Of=class{constructor(e){this.serializer=e}N(e,t,r,i){let s=new Bu("createOrUpgrade",t);r<1&&i>=1&&(function(u){u.createObjectStore("owner")}(e),function(u){u.createObjectStore("mutationQueues",{keyPath:"userId"}),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",rw,{unique:!0}),u.createObjectStore("documentMutations")}(e),Bw(e),function(u){u.createObjectStore("remoteDocuments")}(e));let o=p.resolve();return r<3&&i>=3&&(r!==0&&(function(u){u.deleteObjectStore("targetDocuments"),u.deleteObjectStore("targets"),u.deleteObjectStore("targetGlobal")}(e),Bw(e)),o=o.next(()=>function(u){let c=u.store("targetGlobal"),l={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:N.min().toTimestamp(),targetCount:0};return c.put("targetGlobalKey",l)}(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>function(u,c){return c.store("mutations").W().next(l=>{u.deleteObjectStore("mutations"),u.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",rw,{unique:!0});let h=c.store("mutations"),d=l.map(f=>h.put(f));return p.waitFor(d)})}(e,s))),o=o.next(()=>{(function(u){u.createObjectStore("clientMetadata",{keyPath:"clientId"})})(e)})),r<5&&i>=5&&(o=o.next(()=>this.Xr(s))),r<6&&i>=6&&(o=o.next(()=>(function(u){u.createObjectStore("remoteDocumentGlobal")}(e),this.ei(s)))),r<7&&i>=7&&(o=o.next(()=>this.ti(s))),r<8&&i>=8&&(o=o.next(()=>this.ni(e,s))),r<9&&i>=9&&(o=o.next(()=>{(function(u){u.objectStoreNames.contains("remoteDocumentChanges")&&u.deleteObjectStore("remoteDocumentChanges")})(e)})),r<10&&i>=10&&(o=o.next(()=>this.ri(s))),r<11&&i>=11&&(o=o.next(()=>{(function(u){u.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(u){u.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(o=o.next(()=>{(function(u){let c=u.createObjectStore("documentOverlays",{keyPath:yR});c.createIndex("collectionPathOverlayIndex",vR,{unique:!1}),c.createIndex("collectionGroupOverlayIndex",_R,{unique:!1})})(e)})),r<13&&i>=13&&(o=o.next(()=>function(u){let c=u.createObjectStore("remoteDocumentsV14",{keyPath:oR});c.createIndex("documentKeyIndex",aR),c.createIndex("collectionGroupIndex",uR)}(e)).next(()=>this.ii(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(o=o.next(()=>this.si(e,s))),r<15&&i>=15&&(o=o.next(()=>function(u){u.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),u.createObjectStore("indexState",{keyPath:fR}).createIndex("sequenceNumberIndex",pR,{unique:!1}),u.createObjectStore("indexEntries",{keyPath:gR}).createIndex("documentKeyIndex",mR,{unique:!1})}(e))),o}ei(e){let t=0;return e.store("remoteDocuments").Y((r,i)=>{t+=rc(i)}).next(()=>{let r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Xr(e){let t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(i=>p.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",o).next(a=>p.forEach(a,u=>{V(u.userId===s.userId);let c=ar(this.serializer,u);return eI(e,s.userId,c).next(()=>{})}))}))}ti(e){let t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{let s=[];return r.Y((o,a)=>{let u=new H(o),c=function(h){return[0,qe(h)]}(u);s.push(t.get(c).next(l=>l?p.resolve():(h=>t.put({targetId:0,path:qe(h),sequenceNumber:i.highestListenSequenceNumber}))(u)))}).next(()=>p.waitFor(s))})}ni(e,t){e.createObjectStore("collectionParents",{keyPath:dR});let r=t.store("collectionParents"),i=new Po,s=o=>{if(i.add(o)){let a=o.lastSegment(),u=o.popLast();return r.put({collectionId:a,parent:qe(u)})}};return t.store("remoteDocuments").Y({J:!0},(o,a)=>{let u=new H(o);return s(u.popLast())}).next(()=>t.store("documentMutations").Y({J:!0},([o,a,u],c)=>{let l=Pt(a);return s(l.popLast())}))}ri(e){let t=e.store("targets");return t.Y((r,i)=>{let s=lo(i),o=XE(this.serializer,s);return t.put(o)})}ii(e,t){let r=t.store("remoteDocuments"),i=[];return r.Y((s,o)=>{let a=t.store("remoteDocumentsV14"),u=function(h){return h.document?new T(H.fromString(h.document.name).popFirst(5)):h.noDocument?T.fromSegments(h.noDocument.path):h.unknownDocument?T.fromSegments(h.unknownDocument.path):b()}(o).path.toArray(),c={prefixPath:u.slice(0,u.length-2),collectionGroup:u[u.length-2],documentId:u[u.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>p.waitFor(i))}si(e,t){let r=t.store("mutations"),i=rI(this.serializer),s=new ac(uc.Hr,this.serializer.ct);return r.W().next(o=>{let a=new Map;return o.forEach(u=>{var c;let l=(c=a.get(u.userId))!==null&&c!==void 0?c:B();ar(this.serializer,u).keys().forEach(h=>l=l.add(h)),a.set(u.userId,l)}),p.forEach(a,(u,c)=>{let l=new Ee(c),h=ec.lt(this.serializer,l),d=s.getIndexManager(l),f=ic.lt(l,this.serializer,d,s.referenceDelegate);return new oc(i,f,h,d).recalculateAndSaveOverlaysForDocumentKeys(new _o(t,et._e),u).next()})})}};function Bw(n){n.createObjectStore("targetDocuments",{keyPath:lR}).createIndex("documentTargetsIndex",hR,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",cR,{unique:!0}),n.createObjectStore("targetGlobal")}var Sd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Ff=class n{constructor(e,t,r,i,s,o,a,u,c,l,h=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.oi=s,this.window=o,this.document=a,this._i=c,this.ai=l,this.ui=h,this.kr=null,this.qr=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ci=null,this.inForeground=!1,this.li=null,this.hi=null,this.Pi=Number.NEGATIVE_INFINITY,this.Ii=d=>Promise.resolve(),!n.D())throw new v(g.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Cf(this,i),this.Ti=t+"main",this.serializer=new Ju(u),this.Ei=new Kt(this.Ti,this.ui,new Of(this.serializer)),this.Qr=new Ef(this.referenceDelegate,this.serializer),this.remoteDocumentCache=rI(this.serializer),this.$r=new df,this.window&&this.window.localStorage?this.di=this.window.localStorage:(this.di=null,l===!1&&pe("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.Ai().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new v(g.FAILED_PRECONDITION,Sd);return this.Ri(),this.Vi(),this.mi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Qr.getHighestSequenceNumber(e))}).then(e=>{this.kr=new et(e,this._i)}).then(()=>{this.qr=!0}).catch(e=>(this.Ei&&this.Ei.close(),Promise.reject(e)))}fi(e){return this.Ii=t=>m(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.Ei.B(t=>m(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.oi.enqueueAndForget(()=>m(this,null,function*(){this.started&&(yield this.Ai())})))}Ai(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Du(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.gi(e).next(t=>{t||(this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)))})}).next(()=>this.pi(e)).next(t=>this.isPrimary&&!t?this.yi(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(Ln(e))return _("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return _("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.oi.enqueueRetryable(()=>this.Ii(e)),this.isPrimary=e})}gi(e){return uo(e).get("owner").next(t=>p.resolve(this.Si(t)))}bi(e){return Du(e).delete(this.clientId)}Di(){return m(this,null,function*(){if(this.isPrimary&&!this.Ci(this.Pi,18e5)){this.Pi=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=De(t,"clientMetadata");return r.W().next(i=>{let s=this.vi(i,18e5),o=i.filter(a=>s.indexOf(a)===-1);return p.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.di)for(let t of e)this.di.removeItem(this.Fi(t.clientId))}})}mi(){this.hi=this.oi.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.Ai().then(()=>this.Di()).then(()=>this.mi()))}Si(e){return!!e&&e.ownerId===this.clientId}pi(e){return this.ai?p.resolve(!0):uo(e).get("owner").next(t=>{if(t!==null&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)){if(this.Si(t)&&this.networkEnabled)return!0;if(!this.Si(t)){if(!t.allowTabSynchronization)throw new v(g.FAILED_PRECONDITION,Sd);return!1}}return!(!this.networkEnabled||!this.inForeground)||Du(e).W().next(r=>this.vi(r,5e3).find(i=>{if(this.clientId!==i.clientId){let s=!this.networkEnabled&&i.networkEnabled,o=!this.inForeground&&i.inForeground,a=this.networkEnabled===i.networkEnabled;if(s||o&&a)return!0}return!1})===void 0)}).next(t=>(this.isPrimary!==t&&_("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){return m(this,null,function*(){this.qr=!1,this.xi(),this.hi&&(this.hi.cancel(),this.hi=null),this.Oi(),this.Ni(),yield this.Ei.runTransaction("shutdown","readwrite",["owner","clientMetadata"],e=>{let t=new _o(e,et._e);return this.yi(t).next(()=>this.bi(t))}),this.Ei.close(),this.Li()})}vi(e,t){return e.filter(r=>this.Ci(r.updateTimeMs,t)&&!this.Mi(r.clientId))}Bi(){return this.runTransaction("getActiveClients","readonly",e=>Du(e).W().next(t=>this.vi(t,18e5).map(r=>r.clientId)))}get started(){return this.qr}getMutationQueue(e,t){return ic.lt(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new wf(e,this.serializer.ct.databaseId)}getDocumentOverlayCache(e){return ec.lt(this.serializer,e)}getBundleCache(){return this.$r}runTransaction(e,t,r){_("IndexedDbPersistence","Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=function(u){return u===15?ER:u===14?lE:u===13?cE:u===12?wR:u===11?uE:void b()}(this.ui),o;return this.Ei.runTransaction(e,i,s,a=>(o=new _o(a,this.kr?this.kr.next():et._e),t==="readwrite-primary"?this.gi(o).next(u=>!!u||this.pi(o)).next(u=>{if(!u)throw pe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.oi.enqueueRetryable(()=>this.Ii(!1)),new v(g.FAILED_PRECONDITION,sE);return r(o)}).next(u=>this.wi(o).next(()=>u)):this.ki(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}ki(e){return uo(e).get("owner").next(t=>{if(t!==null&&this.Ci(t.leaseTimestampMs,5e3)&&!this.Mi(t.ownerId)&&!this.Si(t)&&!(this.ai||this.allowTabSynchronization&&t.allowTabSynchronization))throw new v(g.FAILED_PRECONDITION,Sd)})}wi(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return uo(e).put("owner",t)}static D(){return Kt.D()}yi(e){let t=uo(e);return t.get("owner").next(r=>this.Si(r)?(_("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):p.resolve())}Ci(e,t){let r=Date.now();return!(e<r-t)&&(!(e>r)||(pe(`Detected an update time that is in the future: ${e} > ${r}`),!1))}Ri(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.li=()=>{this.oi.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.Ai()))},this.document.addEventListener("visibilitychange",this.li),this.inForeground=this.document.visibilityState==="visible")}Oi(){this.li&&(this.document.removeEventListener("visibilitychange",this.li),this.li=null)}Vi(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.ci=()=>{this.xi();let t=/(?:Version|Mobile)\/1[456]/;hl()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.oi.enterRestrictedMode(!0),this.oi.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.ci))}Ni(){this.ci&&(this.window.removeEventListener("pagehide",this.ci),this.ci=null)}Mi(e){var t;try{let r=((t=this.di)===null||t===void 0?void 0:t.getItem(this.Fi(e)))!==null;return _("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return pe("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}xi(){if(this.di)try{this.di.setItem(this.Fi(this.clientId),String(Date.now()))}catch(e){pe("Failed to set zombie client id.",e)}}Li(){if(this.di)try{this.di.removeItem(this.Fi(this.clientId))}catch{}}Fi(e){return`firestore_zombie_${this.persistenceKey}_${e}`}};function uo(n){return De(n,"owner")}function Du(n){return De(n,"clientMetadata")}function Lp(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}var Lf=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.qi=r,this.Qi=i}static Ki(e,t){let r=B(),i=B();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new n(e,t.fromCache,r,i)}};var Uf=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var cc=class{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){return hl()?8:Kt.v(es())>0?6:4}()}initialize(e,t){this.zi=e,this.indexManager=t,this.$i=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.ji(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.Hi(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new Uf;return this.Ji(e,t,o).next(a=>{if(s.result=a,this.Ui)return this.Yi(e,t,o,a.size)})}).next(()=>s.result)}Yi(e,t,r,i){return r.documentReadCount<this.Wi?(ai()<=At.DEBUG&&_("QueryEngine","SDK will not create cache indexes for query:",ui(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),p.resolve()):(ai()<=At.DEBUG&&_("QueryEngine","Query:",ui(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.Gi*i?(ai()<=At.DEBUG&&_("QueryEngine","The SDK decides to create cache indexes for query:",ui(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,$e(t))):p.resolve())}ji(e,t){if(pw(t))return p.resolve(null);let r=$e(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=Hu(t,null,"F"),r=$e(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=B(...s);return this.zi.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(u=>{let c=this.Zi(t,a);return this.Xi(t,c,o,u.readTime)?this.ji(e,Hu(t,null,"F")):this.es(e,c,t,u)}))})))}Hi(e,t,r,i){return pw(t)||i.isEqual(N.min())?p.resolve(null):this.zi.getDocuments(e,r).next(s=>{let o=this.Zi(t,s);return this.Xi(t,o,r,i)?p.resolve(null):(ai()<=At.DEBUG&&_("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ui(t)),this.es(e,o,t,rE(i,-1)).next(a=>a))})}Zi(e,t){let r=new Z(TE(e));return t.forEach((i,s)=>{qo(e,s)&&(r=r.add(s))}),r}Xi(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Ji(e,t,r){return ai()<=At.DEBUG&&_("QueryEngine","Using full collection scan to execute query:",ui(t)),this.zi.getDocumentsMatchingQuery(e,t,ut.min(),r)}es(e,t,r,i){return this.zi.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var jf=class{constructor(e,t,r,i){this.persistence=e,this.ts=t,this.serializer=i,this.ns=new ie(U),this.rs=new Ft(s=>gr(s),jo),this.ss=new Map,this.os=e.getRemoteDocumentCache(),this.Qr=e.getTargetCache(),this.$r=e.getBundleCache(),this._s(r)}_s(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new oc(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.ns))}};function iI(n,e,t,r){return new jf(n,e,t,r)}function sI(n,e){return m(this,null,function*(){let t=A(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t._s(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{let o=[],a=[],u=B();for(let c of i){o.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}for(let c of s){a.push(c.batchId);for(let l of c.mutations)u=u.add(l.key)}return t.localDocuments.getDocuments(r,u).next(c=>({us:c,removedBatchIds:o,addedBatchIds:a}))})})})}function eD(n,e){let t=A(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.os.newChangeBuffer({trackRemovals:!0});return function(a,u,c,l){let h=c.batch,d=h.keys(),f=p.resolve();return d.forEach(E=>{f=f.next(()=>l.getEntry(u,E)).next(w=>{let y=c.docVersions.get(E);V(y!==null),w.version.compareTo(y)<0&&(h.applyToRemoteDocument(w,c),w.isValidDocument()&&(w.setReadTime(c.commitVersion),l.addEntry(w)))})}),f.next(()=>a.mutationQueue.removeMutationBatch(u,h))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(a){let u=B();for(let c=0;c<a.mutationResults.length;++c)a.mutationResults[c].transformResults.length>0&&(u=u.add(a.batch.mutations[c].key));return u}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function oI(n){let e=A(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Qr.getLastRemoteSnapshotVersion(t))}function tD(n,e){let t=A(n),r=e.snapshotVersion,i=t.ns;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.os.newChangeBuffer({trackRemovals:!0});i=t.ns;let a=[];e.targetChanges.forEach((l,h)=>{let d=i.get(h);if(!d)return;a.push(t.Qr.removeMatchingKeys(s,l.removedDocuments,h).next(()=>t.Qr.addMatchingKeys(s,l.addedDocuments,h)));let f=d.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(h)!==null?f=f.withResumeToken(Re.EMPTY_BYTE_STRING,N.min()).withLastLimboFreeSnapshotVersion(N.min()):l.resumeToken.approximateByteSize()>0&&(f=f.withResumeToken(l.resumeToken,r)),i=i.insert(h,f),function(w,y,I){return w.resumeToken.approximateByteSize()===0||y.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=3e8?!0:I.addedDocuments.size+I.modifiedDocuments.size+I.removedDocuments.size>0}(d,f,l)&&a.push(t.Qr.updateTargetData(s,f))});let u=We(),c=B();if(e.documentUpdates.forEach(l=>{e.resolvedLimboDocuments.has(l)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,l))}),a.push(aI(s,o,e.documentUpdates).next(l=>{u=l.cs,c=l.ls})),!r.isEqual(N.min())){let l=t.Qr.getLastRemoteSnapshotVersion(s).next(h=>t.Qr.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(l)}return p.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,u,c)).next(()=>u)}).then(s=>(t.ns=i,s))}function aI(n,e,t){let r=B(),i=B();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=We();return t.forEach((a,u)=>{let c=s.get(a);u.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),u.isNoDocument()&&u.version.isEqual(N.min())?(e.removeEntry(a,u.readTime),o=o.insert(a,u)):!c.isValidDocument()||u.version.compareTo(c.version)>0||u.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(u),o=o.insert(a,u)):_("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",u.version)}),{cs:o,ls:i}})}function nD(n,e){let t=A(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function Ci(n,e){let t=A(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Qr.getTargetData(r,e).next(s=>s?(i=s,p.resolve(i)):t.Qr.allocateTargetId(r).next(o=>(i=new Ti(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.Qr.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.ns.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.ns=t.ns.insert(r.targetId,r),t.rs.set(e,r.targetId)),r})}function Si(n,e,t){return m(this,null,function*(){let r=A(n),i=r.ns.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(!Ln(o))throw o;_("LocalStore",`Failed to update sequence numbers for target ${e}: ${o}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)})}function lc(n,e,t){let r=A(n),i=N.min(),s=B();return r.persistence.runTransaction("Execute query","readwrite",o=>function(u,c,l){let h=A(u),d=h.rs.get(l);return d!==void 0?p.resolve(h.ns.get(d)):h.Qr.getTargetData(c,l)}(r,o,$e(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(o,a.targetId).next(u=>{s=u})}).next(()=>r.ts.getDocumentsMatchingQuery(o,e,t?i:N.min(),t?s:B())).next(a=>(lI(r,IE(e),a),{documents:a,hs:s})))}function uI(n,e){let t=A(n),r=A(t.Qr),i=t.ns.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r._t(s,e).next(o=>o?o.target:null))}function cI(n,e){let t=A(n),r=t.ss.get(e)||N.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.os.getAllFromCollectionGroup(i,e,rE(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(lI(t,e,i),i))}function lI(n,e,t){let r=n.ss.get(e)||N.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.ss.set(e,r)}function rD(n,e,t,r){return m(this,null,function*(){let i=A(n),s=B(),o=We();for(let c of t){let l=e.Ps(c.metadata.name);c.document&&(s=s.add(l));let h=e.Is(c);h.setReadTime(e.Ts(c.metadata.readTime)),o=o.insert(l,h)}let a=i.os.newChangeBuffer({trackRemovals:!0}),u=yield Ci(i,function(l){return $e(Mi(H.fromString(`__bundle__/docs/${l}`)))}(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>aI(c,a,o).next(l=>(a.apply(c),l)).next(l=>i.Qr.removeMatchingKeysForTargetId(c,u.targetId).next(()=>i.Qr.addMatchingKeys(c,s,u.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,l.cs,l.ls)).next(()=>l.cs)))})}function iD(r,i){return m(this,arguments,function*(n,e,t=B()){let s=yield Ci(n,$e(Op(e.bundledQuery))),o=A(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let u=me(e.readTime);if(s.snapshotVersion.compareTo(u)>=0)return o.$r.saveNamedQuery(a,e);let c=s.withResumeToken(Re.EMPTY_BYTE_STRING,u);return o.ns=o.ns.insert(c.targetId,c),o.Qr.updateTargetData(a,c).next(()=>o.Qr.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.Qr.addMatchingKeys(a,t,s.targetId)).next(()=>o.$r.saveNamedQuery(a,e))})})}function qw(n,e){return`firestore_clients_${n}_${e}`}function $w(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function bd(n,e){return`firestore_targets_${n}_${e}`}var hc=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Es(e,t,r){let i=JSON.parse(r),s,o=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object");return o&&i.error&&(o=typeof i.error.message=="string"&&typeof i.error.code=="string",o&&(s=new v(i.error.code,i.error.message))),o?new n(e,t,i.state,s):(pe("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},go=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Es(e,t){let r=JSON.parse(t),i,s=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object");return s&&r.error&&(s=typeof r.error.message=="string"&&typeof r.error.code=="string",s&&(i=new v(r.error.code,r.error.message))),s?new n(e,r.state,i):(pe("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}ds(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},dc=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Es(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=Mp();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=oE(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(pe("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}},Bf=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static Es(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(pe("SharedClientState",`Failed to parse online state: ${e}`),null)}},xo=class{constructor(){this.activeTargetIds=Mp()}As(e){this.activeTargetIds=this.activeTargetIds.add(e)}Rs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}ds(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},mo=class{constructor(e,t,r,i,s){this.window=e,this.oi=t,this.persistenceKey=r,this.Vs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.fs=this.gs.bind(this),this.ps=new ie(U),this.started=!1,this.ys=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ws=qw(this.persistenceKey,this.Vs),this.Ss=function(u){return`firestore_sequence_number_${u}`}(this.persistenceKey),this.ps=this.ps.insert(this.Vs,new xo),this.bs=new RegExp(`^firestore_clients_${o}_([^_]*)$`),this.Ds=new RegExp(`^firestore_mutations_${o}_(\\d+)(?:_(.*))?$`),this.Cs=new RegExp(`^firestore_targets_${o}_(\\d+)$`),this.vs=function(u){return`firestore_online_state_${u}`}(this.persistenceKey),this.Fs=function(u){return`firestore_bundle_loaded_v2_${u}`}(this.persistenceKey),this.window.addEventListener("storage",this.fs)}static D(e){return!(!e||!e.localStorage)}start(){return m(this,null,function*(){let e=yield this.syncEngine.Bi();for(let r of e){if(r===this.Vs)continue;let i=this.getItem(qw(this.persistenceKey,r));if(i){let s=dc.Es(r,i);s&&(this.ps=this.ps.insert(s.clientId,s))}}this.Ms();let t=this.storage.getItem(this.vs);if(t){let r=this.xs(t);r&&this.Os(r)}for(let r of this.ys)this.gs(r);this.ys=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.Ss,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ns(this.ps)}isActiveQueryTarget(e){let t=!1;return this.ps.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Ls(e,"pending")}updateMutationState(e,t,r){this.Ls(e,t,r),this.Bs(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(bd(this.persistenceKey,e));if(r){let i=go.Es(e,r);i&&(t=i.state)}}return this.ks.As(e),this.Ms(),t}removeLocalQueryTarget(e){this.ks.Rs(e),this.Ms()}isLocalQueryTarget(e){return this.ks.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(bd(this.persistenceKey,e))}updateQueryState(e,t,r){this.qs(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Bs(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.Qs(e)}notifyBundleLoaded(e){this.Ks(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.fs),this.removeItem(this.ws),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return _("SharedClientState","READ",e,t),t}setItem(e,t){_("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){_("SharedClientState","REMOVE",e),this.storage.removeItem(e)}gs(e){let t=e;if(t.storageArea===this.storage){if(_("SharedClientState","EVENT",t.key,t.newValue),t.key===this.ws)return void pe("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.oi.enqueueRetryable(()=>m(this,null,function*(){if(this.started){if(t.key!==null){if(this.bs.test(t.key)){if(t.newValue==null){let r=this.$s(t.key);return this.Us(r,null)}{let r=this.Ws(t.key,t.newValue);if(r)return this.Us(r.clientId,r)}}else if(this.Ds.test(t.key)){if(t.newValue!==null){let r=this.Gs(t.key,t.newValue);if(r)return this.zs(r)}}else if(this.Cs.test(t.key)){if(t.newValue!==null){let r=this.js(t.key,t.newValue);if(r)return this.Hs(r)}}else if(t.key===this.vs){if(t.newValue!==null){let r=this.xs(t.newValue);if(r)return this.Os(r)}}else if(t.key===this.Ss){let r=function(s){let o=et._e;if(s!=null)try{let a=JSON.parse(s);V(typeof a=="number"),o=a}catch(a){pe("SharedClientState","Failed to read sequence number from WebStorage",a)}return o}(t.newValue);r!==et._e&&this.sequenceNumberHandler(r)}else if(t.key===this.Fs){let r=this.Js(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.Ys(i)))}}}else this.ys.push(t)}))}}get ks(){return this.ps.get(this.Vs)}Ms(){this.setItem(this.ws,this.ks.ds())}Ls(e,t,r){let i=new hc(this.currentUser,e,t,r),s=$w(this.persistenceKey,this.currentUser,e);this.setItem(s,i.ds())}Bs(e){let t=$w(this.persistenceKey,this.currentUser,e);this.removeItem(t)}Qs(e){let t={clientId:this.Vs,onlineState:e};this.storage.setItem(this.vs,JSON.stringify(t))}qs(e,t,r){let i=bd(this.persistenceKey,e),s=new go(e,t,r);this.setItem(i,s.ds())}Ks(e){let t=JSON.stringify(Array.from(e));this.setItem(this.Fs,t)}$s(e){let t=this.bs.exec(e);return t?t[1]:null}Ws(e,t){let r=this.$s(e);return dc.Es(r,t)}Gs(e,t){let r=this.Ds.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return hc.Es(new Ee(s),i,t)}js(e,t){let r=this.Cs.exec(e),i=Number(r[1]);return go.Es(i,t)}xs(e){return Bf.Es(e)}Js(e){return JSON.parse(e)}zs(e){return m(this,null,function*(){if(e.user.uid===this.currentUser.uid)return this.syncEngine.Zs(e.batchId,e.state,e.error);_("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})}Hs(e){return this.syncEngine.Xs(e.targetId,e.state,e.error)}Us(e,t){let r=t?this.ps.insert(e,t):this.ps.remove(e),i=this.Ns(this.ps),s=this.Ns(r),o=[],a=[];return s.forEach(u=>{i.has(u)||o.push(u)}),i.forEach(u=>{s.has(u)||a.push(u)}),this.syncEngine.eo(o,a).then(()=>{this.ps=r})}Os(e){this.ps.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ns(e){let t=Mp();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}},fc=class{constructor(){this.no=new xo,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.no.As(e),this.ro[e]||"not-current"}updateQueryState(e,t,r){this.ro[e]=t}removeLocalQueryTarget(e){this.no.Rs(e)}isLocalQueryTarget(e){return this.no.activeTargetIds.has(e)}clearQueryState(e){delete this.ro[e]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(e){return this.no.activeTargetIds.has(e)}start(){return this.no=new xo,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var qf=class{io(e){}shutdown(){}};var pc=class{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(e){this.uo.push(e)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){_("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(let e of this.uo)e(0)}ao(){_("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(let e of this.uo)e(1)}static D(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}};var Pu=null;function Rd(){return Pu===null?Pu=function(){return 268435456+Math.round(2147483648*Math.random())}():Pu++,"0x"+Pu.toString(16)}var sD={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};var $f=class{constructor(e){this.lo=e.lo,this.ho=e.ho}Po(e){this.Io=e}To(e){this.Eo=e}onMessage(e){this.Ao=e}close(){this.ho()}send(e){this.lo(e)}Ro(){this.Io()}Vo(e){this.Eo(e)}mo(e){this.Ao(e)}};var Oe="WebChannelConnection",zf=class extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;let r=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.fo=r+"://"+t.host,this.po=`projects/${i}/databases/${s}`,this.yo=this.databaseId.database==="(default)"?`project_id=${i}`:`project_id=${i}&database_id=${s}`}get wo(){return!1}So(t,r,i,s,o){let a=Rd(),u=this.bo(t,r.toUriEncodedString());_("RestConnection",`Sending RPC '${t}' ${a}:`,u,i);let c={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(c,s,o),this.Co(t,u,c,i).then(l=>(_("RestConnection",`Received RPC '${t}' ${a}: `,l),l),l=>{throw at("RestConnection",`RPC '${t}' ${a} failed with error: `,l,"url: ",u,"request:",i),l})}vo(t,r,i,s,o,a){return this.So(t,r,i,s,o)}Do(t,r,i){t["X-Goog-Api-Client"]=function(){return"gl-js/ fire/"+Ni}(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),r&&r.headers.forEach((s,o)=>t[o]=s),i&&i.headers.forEach((s,o)=>t[o]=s)}bo(t,r){let i=sD[t];return`${this.fo}/v1/${r}:${i}`}terminate(){}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Co(e,t,r,i){let s=Rd();return new Promise((o,a)=>{let u=new J_;u.setWithCredentials(!0),u.listenOnce(Y_.COMPLETE,()=>{try{switch(u.getLastErrorCode()){case Su.NO_ERROR:let l=u.getResponseJson();_(Oe,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(l)),o(l);break;case Su.TIMEOUT:_(Oe,`RPC '${e}' ${s} timed out`),a(new v(g.DEADLINE_EXCEEDED,"Request time out"));break;case Su.HTTP_ERROR:let h=u.getStatus();if(_(Oe,`RPC '${e}' ${s} failed with status:`,h,"response text:",u.getResponseText()),h>0){let d=u.getResponseJson();Array.isArray(d)&&(d=d[0]);let f=d?.error;if(f&&f.status&&f.message){let E=function(y){let I=y.toLowerCase().replace(/_/g,"-");return Object.values(g).indexOf(I)>=0?I:g.UNKNOWN}(f.status);a(new v(E,f.message))}else a(new v(g.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new v(g.UNAVAILABLE,"Connection failed."));break;default:b()}}finally{_(Oe,`RPC '${e}' ${s} completed.`)}});let c=JSON.stringify(i);_(Oe,`RPC '${e}' ${s} sending request:`,i),u.send(t,"POST",c,r,15)})}Fo(e,t,r){let i=Rd(),s=[this.fo,"/","google.firestore.v1.Firestore","/",e,"/channel"],o=H_(),a=Q_(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;c!==void 0&&(u.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(u.useFetchStreams=!0),this.Do(u.initMessageHeaders,t,r),u.encodeInitMessageHeaders=!0;let l=s.join("");_(Oe,`Creating RPC '${e}' stream ${i}: ${l}`,u);let h=o.createWebChannel(l,u),d=!1,f=!1,E=new $f({lo:y=>{f?_(Oe,`Not sending because RPC '${e}' stream ${i} is closed:`,y):(d||(_(Oe,`Opening RPC '${e}' stream ${i} transport.`),h.open(),d=!0),_(Oe,`RPC '${e}' stream ${i} sending:`,y),h.send(y))},ho:()=>h.close()}),w=(y,I,k)=>{y.listen(I,R=>{try{k(R)}catch(M){setTimeout(()=>{throw M},0)}})};return w(h,io.EventType.OPEN,()=>{f||_(Oe,`RPC '${e}' stream ${i} transport opened.`)}),w(h,io.EventType.CLOSE,()=>{f||(f=!0,_(Oe,`RPC '${e}' stream ${i} transport closed`),E.Vo())}),w(h,io.EventType.ERROR,y=>{f||(f=!0,at(Oe,`RPC '${e}' stream ${i} transport errored:`,y),E.Vo(new v(g.UNAVAILABLE,"The operation could not be completed")))}),w(h,io.EventType.MESSAGE,y=>{var I;if(!f){let k=y.data[0];V(!!k);let R=k,M=R.error||((I=R[0])===null||I===void 0?void 0:I.error);if(M){_(Oe,`RPC '${e}' stream ${i} received error:`,M);let j=M.status,K=function(VT){let Ig=_e[VT];if(Ig!==void 0)return FE(Ig)}(j),ce=M.message;K===void 0&&(K=g.INTERNAL,ce="Unknown error status: "+j+" with message "+M.message),f=!0,E.Vo(new v(K,ce)),h.close()}else _(Oe,`RPC '${e}' stream ${i} received:`,k),E.mo(k)}}),w(a,X_.STAT_EVENT,y=>{y.stat===Ad.PROXY?_(Oe,`RPC '${e}' stream ${i} detected buffering proxy`):y.stat===Ad.NOPROXY&&_(Oe,`RPC '${e}' stream ${i} detected no buffering proxy`)}),setTimeout(()=>{E.Ro()},0),E}};function hI(){return typeof window<"u"?window:null}function ku(){return typeof document<"u"?document:null}function $o(n){return new af(n,!0)}var No=class{constructor(e,t,r=1e3,i=1.5,s=6e4){this.oi=e,this.timerId=t,this.Mo=r,this.xo=i,this.Oo=s,this.No=0,this.Lo=null,this.Bo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(e){this.cancel();let t=Math.floor(this.No+this.Qo()),r=Math.max(0,Date.now()-this.Bo),i=Math.max(0,t-r);i>0&&_("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.No} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.Lo=this.oi.enqueueAfterDelay(this.timerId,i,()=>(this.Bo=Date.now(),e())),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){this.Lo!==null&&(this.Lo.skipDelay(),this.Lo=null)}cancel(){this.Lo!==null&&(this.Lo.cancel(),this.Lo=null)}Qo(){return(Math.random()-.5)*this.No}};var gc=class{constructor(e,t,r,i,s,o,a,u){this.oi=e,this.$o=r,this.Uo=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=u,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new No(e,t)}Ho(){return this.state===1||this.state===5||this.Jo()}Jo(){return this.state===2||this.state===3}start(){this.state!==4?this.auth():this.Yo()}stop(){return m(this,null,function*(){this.Ho()&&(yield this.close(0))})}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&this.Go===null&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,()=>this.e_()))}t_(e){this.n_(),this.stream.send(e)}e_(){return m(this,null,function*(){if(this.Jo())return this.close(0)})}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}close(e,t){return m(this,null,function*(){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,e!==4?this.jo.reset():t&&t.code===g.RESOURCE_EXHAUSTED?(pe(t.toString()),pe("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):t&&t.code===g.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.i_(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.To(t)})}i_(){}auth(){this.state=1;let e=this.s_(this.Wo),t=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.Wo===t&&this.o_(r,i)},r=>{e(()=>{let i=new v(g.UNKNOWN,"Fetching auth token failed: "+r.message);return this.__(i)})})}o_(e,t){let r=this.s_(this.Wo);this.stream=this.a_(e,t),this.stream.Po(()=>{r(()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,()=>(this.Jo()&&(this.state=3),Promise.resolve())),this.listener.Po()))}),this.stream.To(i=>{r(()=>this.__(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Yo(){this.state=5,this.jo.qo(()=>m(this,null,function*(){this.state=0,this.start()}))}__(e){return _("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}s_(e){return t=>{this.oi.enqueueAndForget(()=>this.Wo===e?t():(_("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},Gf=class extends gc{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}a_(e,t){return this.connection.Fo("Listen",e,t)}onMessage(e){this.jo.reset();let t=$R(this.serializer,e),r=function(s){if(!("targetChange"in s))return N.min();let o=s.targetChange;return o.targetIds&&o.targetIds.length?N.min():o.readTime?me(o.readTime):N.min()}(e);return this.listener.u_(t,r)}c_(e){let t={};t.database=lf(this.serializer),t.addTarget=function(s,o){let a,u=o.target;if(a=Ku(u)?{documents:GE(s,u)}:{query:KE(s,u).ut},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=UE(s,o.resumeToken);let c=uf(s,o.expectedCount);c!==null&&(a.expectedCount=c)}else if(o.snapshotVersion.compareTo(N.min())>0){a.readTime=Ii(s,o.snapshotVersion.toTimestamp());let c=uf(s,o.expectedCount);c!==null&&(a.expectedCount=c)}return a}(this.serializer,e);let r=GR(this.serializer,e);r&&(t.labels=r),this.t_(t)}l_(e){let t={};t.database=lf(this.serializer),t.removeTarget=e,this.t_(t)}},Kf=class extends gc{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(e,t){return this.connection.Fo("Write",e,t)}onMessage(e){if(V(!!e.streamToken),this.lastStreamToken=e.streamToken,this.h_){this.jo.reset();let t=zR(e.writeResults,e.commitTime),r=me(e.commitTime);return this.listener.T_(r,t)}return V(!e.writeResults||e.writeResults.length===0),this.h_=!0,this.listener.E_()}d_(){let e={};e.database=lf(this.serializer),this.t_(e)}I_(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>Do(this.serializer,r))};this.t_(t)}};var Wf=class extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.A_=!1}R_(){if(this.A_)throw new v(g.FAILED_PRECONDITION,"The client has already been terminated.")}So(e,t,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.So(e,cf(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new v(g.UNKNOWN,s.toString())})}vo(e,t,r,i,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.vo(e,cf(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===g.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new v(g.UNKNOWN,o.toString())})}terminate(){this.A_=!0,this.connection.terminate()}};var Hf=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){this.m_===0&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve())))}S_(e){this.state==="Online"?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.y_("Offline")))}set(e){this.b_(),this.m_=0,e==="Online"&&(this.g_=!1),this.y_(e)}y_(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}w_(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(pe(t),this.g_=!1):_("OnlineStateTracker",t)}b_(){this.f_!==null&&(this.f_.cancel(),this.f_=null)}};var Qf=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io(o=>{r.enqueueAndForget(()=>m(this,null,function*(){Un(this)&&(_("RemoteStore","Restarting streams for network reachability change."),yield function(u){return m(this,null,function*(){let c=A(u);c.v_.add(4),yield ki(c),c.x_.set("Unknown"),c.v_.delete(4),yield zo(c)})}(this))}))}),this.x_=new Hf(r,i)}};function zo(n){return m(this,null,function*(){if(Un(n))for(let e of n.F_)yield e(!0)})}function ki(n){return m(this,null,function*(){for(let e of n.F_)yield e(!1)})}function Mc(n,e){let t=A(n);t.C_.has(e.targetId)||(t.C_.set(e.targetId,e),Bp(t)?jp(t):Fi(t).Jo()&&Up(t,e))}function bi(n,e){let t=A(n),r=Fi(t);t.C_.delete(e),r.Jo()&&dI(t,e),t.C_.size===0&&(r.Jo()?r.Xo():Un(t)&&t.x_.set("Unknown"))}function Up(n,e){if(n.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(N.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Fi(n).c_(e)}function dI(n,e){n.O_.Oe(e),Fi(n).l_(e)}function jp(n){n.O_=new of({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>n.C_.get(e)||null,nt:()=>n.datastore.serializer.databaseId}),Fi(n).start(),n.x_.p_()}function Bp(n){return Un(n)&&!Fi(n).Ho()&&n.C_.size>0}function Un(n){return A(n).v_.size===0}function fI(n){n.O_=void 0}function oD(n){return m(this,null,function*(){n.C_.forEach((e,t)=>{Up(n,e)})})}function aD(n,e){return m(this,null,function*(){fI(n),Bp(n)?(n.x_.S_(e),jp(n)):n.x_.set("Unknown")})}function uD(n,e,t){return m(this,null,function*(){if(n.x_.set("Online"),e instanceof Yu&&e.state===2&&e.cause)try{yield function(i,s){return m(this,null,function*(){let o=s.cause;for(let a of s.targetIds)i.C_.has(a)&&(yield i.remoteSyncer.rejectListen(a,o),i.C_.delete(a),i.O_.removeTarget(a))})}(n,e)}catch(r){_("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield mc(n,r)}else if(e instanceof gi?n.O_.$e(e):e instanceof Qu?n.O_.Je(e):n.O_.Ge(e),!t.isEqual(N.min()))try{let r=yield oI(n.localStore);t.compareTo(r)>=0&&(yield function(s,o){let a=s.O_.it(o);return a.targetChanges.forEach((u,c)=>{if(u.resumeToken.approximateByteSize()>0){let l=s.C_.get(c);l&&s.C_.set(c,l.withResumeToken(u.resumeToken,o))}}),a.targetMismatches.forEach((u,c)=>{let l=s.C_.get(u);if(!l)return;s.C_.set(u,l.withResumeToken(Re.EMPTY_BYTE_STRING,l.snapshotVersion)),dI(s,u);let h=new Ti(l.target,u,c,l.sequenceNumber);Up(s,h)}),s.remoteSyncer.applyRemoteEvent(a)}(n,t))}catch(r){_("RemoteStore","Failed to raise snapshot:",r),yield mc(n,r)}})}function mc(n,e,t){return m(this,null,function*(){if(!Ln(e))throw e;n.v_.add(1),yield ki(n),n.x_.set("Offline"),t||(t=()=>oI(n.localStore)),n.asyncQueue.enqueueRetryable(()=>m(this,null,function*(){_("RemoteStore","Retrying IndexedDB access"),yield t(),n.v_.delete(1),yield zo(n)}))})}function pI(n,e){return e().catch(t=>mc(n,t,e))}function Oi(n){return m(this,null,function*(){let e=A(n),t=On(e),r=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;cD(e);)try{let i=yield nD(e.localStore,r);if(i===null){e.D_.length===0&&t.Xo();break}r=i.batchId,lD(e,i)}catch(i){yield mc(e,i)}gI(e)&&mI(e)})}function cD(n){return Un(n)&&n.D_.length<10}function lD(n,e){n.D_.push(e);let t=On(n);t.Jo()&&t.P_&&t.I_(e.mutations)}function gI(n){return Un(n)&&!On(n).Ho()&&n.D_.length>0}function mI(n){On(n).start()}function hD(n){return m(this,null,function*(){On(n).d_()})}function dD(n){return m(this,null,function*(){let e=On(n);for(let t of n.D_)e.I_(t.mutations)})}function fD(n,e,t){return m(this,null,function*(){let r=n.D_.shift(),i=nf.from(r,e,t);yield pI(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Oi(n)})}function pD(n,e){return m(this,null,function*(){e&&On(n).P_&&(yield function(r,i){return m(this,null,function*(){if(function(o){return OE(o)&&o!==g.ABORTED}(i.code)){let s=r.D_.shift();On(r).Zo(),yield pI(r,()=>r.remoteSyncer.rejectFailedWrite(s.batchId,i)),yield Oi(r)}})}(n,e)),gI(n)&&mI(n)})}function zw(n,e){return m(this,null,function*(){let t=A(n);t.asyncQueue.verifyOperationInProgress(),_("RemoteStore","RemoteStore received new credentials");let r=Un(t);t.v_.add(3),yield ki(t),r&&t.x_.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.v_.delete(3),yield zo(t)})}function Yf(n,e){return m(this,null,function*(){let t=A(n);e?(t.v_.delete(2),yield zo(t)):e||(t.v_.add(2),yield ki(t),t.x_.set("Unknown"))})}function Fi(n){return n.N_||(n.N_=function(t,r,i){let s=A(t);return s.R_(),new Gf(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:oD.bind(null,n),To:aD.bind(null,n),u_:uD.bind(null,n)}),n.F_.push(e=>m(this,null,function*(){e?(n.N_.Zo(),Bp(n)?jp(n):n.x_.set("Unknown")):(yield n.N_.stop(),fI(n))}))),n.N_}function On(n){return n.L_||(n.L_=function(t,r,i){let s=A(t);return s.R_(),new Kf(r,s.connection,s.authCredentials,s.appCheckCredentials,s.serializer,i)}(n.datastore,n.asyncQueue,{Po:hD.bind(null,n),To:pD.bind(null,n),E_:dD.bind(null,n),T_:fD.bind(null,n)}),n.F_.push(e=>m(this,null,function*(){e?(n.L_.Zo(),yield Oi(n)):(yield n.L_.stop(),n.D_.length>0&&(_("RemoteStore",`Stopping write stream with ${n.D_.length} pending writes`),n.D_=[]))}))),n.L_}var Xf=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ie,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new v(g.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Li(n,e){if(pe("AsyncQueue",`${e}: ${n}`),Ln(n))return new v(g.UNAVAILABLE,`${e}: ${n}`);throw n}var yc=class n{constructor(e){this.comparator=e?(t,r)=>e(t,r)||T.comparator(t.key,r.key):(t,r)=>T.comparator(t.key,r.key),this.keyedMap=co(),this.sortedSet=new ie(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var vc=class{constructor(){this.B_=new ie(T.comparator)}track(e){let t=e.doc.key,r=this.B_.get(t);r?e.type!==0&&r.type===3?this.B_=this.B_.insert(t,e):e.type===3&&r.type!==1?this.B_=this.B_.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.B_=this.B_.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.B_=this.B_.remove(t):e.type===1&&r.type===2?this.B_=this.B_.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.B_=this.B_.insert(t,{type:2,doc:e.doc}):b():this.B_=this.B_.insert(t,e)}k_(){let e=[];return this.B_.inorderTraversal((t,r)=>{e.push(r)}),e}},Ri=class n{constructor(e,t,r,i,s,o,a,u,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=u,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,yc.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Bo(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var Jf=class{constructor(){this.q_=void 0,this.Q_=[]}K_(){return this.Q_.some(e=>e.U_())}},Zf=class{constructor(){this.queries=new Ft(e=>EE(e),Bo),this.onlineState="Unknown",this.W_=new Set}};function qp(n,e){return m(this,null,function*(){let t=A(n),r=3,i=e.query,s=t.queries.get(i);s?!s.K_()&&e.U_()&&(r=2):(s=new Jf,r=e.U_()?0:1);try{switch(r){case 0:s.q_=yield t.onListen(i,!0);break;case 1:s.q_=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i)}}catch(o){let a=Li(o,`Initialization of query '${ui(e.query)}' failed`);return void e.onError(a)}t.queries.set(i,s),s.Q_.push(e),e.G_(t.onlineState),s.q_&&e.z_(s.q_)&&zp(t)})}function $p(n,e){return m(this,null,function*(){let t=A(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.Q_.indexOf(e);o>=0&&(s.Q_.splice(o,1),s.Q_.length===0?i=e.U_()?0:1:!s.K_()&&e.U_()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function gD(n,e){let t=A(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.Q_)a.z_(i)&&(r=!0);o.q_=i}}r&&zp(t)}function mD(n,e,t){let r=A(n),i=r.queries.get(e);if(i)for(let s of i.Q_)s.onError(t);r.queries.delete(e)}function zp(n){n.W_.forEach(e=>{e.next()})}var ep,Gw;(Gw=ep||(ep={})).j_="default",Gw.Cache="cache";var Mo=class{constructor(e,t,r){this.query=e,this.H_=t,this.J_=!1,this.Y_=null,this.onlineState="Unknown",this.options=r||{}}z_(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new Ri(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.J_?this.Z_(e)&&(this.H_.next(e),t=!0):this.X_(e,this.onlineState)&&(this.ea(e),t=!0),this.Y_=e,t}onError(e){this.H_.error(e)}G_(e){this.onlineState=e;let t=!1;return this.Y_&&!this.J_&&this.X_(this.Y_,e)&&(this.ea(this.Y_),t=!0),t}X_(e,t){if(!e.fromCache||!this.U_())return!0;let r=t!=="Offline";return(!this.options.ta||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||t==="Offline")}Z_(e){if(e.docChanges.length>0)return!0;let t=this.Y_&&this.Y_.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&this.options.includeMetadataChanges===!0}ea(e){e=Ri.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.J_=!0,this.H_.next(e)}U_(){return this.options.source!==ep.Cache}};var tp=class{constructor(e,t){this.na=e,this.byteLength=t}ra(){return"metadata"in this.na}};var _c=class{constructor(e){this.serializer=e}Ps(e){return Nt(this.serializer,e)}Is(e){return e.metadata.exists?zE(this.serializer,e.document,!1):Te.newNoDocument(this.Ps(e.metadata.name),this.Ts(e.metadata.readTime))}Ts(e){return me(e)}},np=class{constructor(e,t,r){this.ia=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=yI(e)}sa(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.na.namedQuery)this.queries.push(e.na.namedQuery);else if(e.na.documentMetadata){this.documents.push({metadata:e.na.documentMetadata}),e.na.documentMetadata.exists||++t;let r=H.fromString(e.na.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.na.document&&(this.documents[this.documents.length-1].document=e.na.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}oa(e){let t=new Map,r=new _c(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.Ps(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||B()).add(s);t.set(o,a)}}return t}complete(){return m(this,null,function*(){let e=yield rD(this.localStore,new _c(this.serializer),this.documents,this.ia.id),t=this.oa(this.documents);for(let r of this.queries)yield iD(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,_a:this.collectionGroups,aa:e}})}};function yI(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var wc=class{constructor(e){this.key=e}},Ec=class{constructor(e){this.key=e}},Ic=class{constructor(e,t){this.query=e,this.ua=t,this.ca=null,this.hasCachedResults=!1,this.current=!1,this.la=B(),this.mutatedKeys=B(),this.ha=TE(e),this.Pa=new yc(this.ha)}get Ia(){return this.ua}Ta(e,t){let r=t?t.Ea:new vc,i=t?t.Pa:this.Pa,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,u=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((l,h)=>{let d=i.get(l),f=qo(this.query,h)?h:null,E=!!d&&this.mutatedKeys.has(d.key),w=!!f&&(f.hasLocalMutations||this.mutatedKeys.has(f.key)&&f.hasCommittedMutations),y=!1;d&&f?d.data.isEqual(f.data)?E!==w&&(r.track({type:3,doc:f}),y=!0):this.da(d,f)||(r.track({type:2,doc:f}),y=!0,(u&&this.ha(f,u)>0||c&&this.ha(f,c)<0)&&(a=!0)):!d&&f?(r.track({type:0,doc:f}),y=!0):d&&!f&&(r.track({type:1,doc:d}),y=!0,(u||c)&&(a=!0)),y&&(f?(o=o.add(f),s=w?s.add(l):s.delete(l)):(o=o.delete(l),s=s.delete(l)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let l=this.query.limitType==="F"?o.last():o.first();o=o.delete(l.key),s=s.delete(l.key),r.track({type:1,doc:l})}return{Pa:o,Ea:r,Xi:a,mutatedKeys:s}}da(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.Pa;this.Pa=e.Pa,this.mutatedKeys=e.mutatedKeys;let o=e.Ea.k_();o.sort((l,h)=>function(f,E){let w=y=>{switch(y){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return b()}};return w(f)-w(E)}(l.type,h.type)||this.ha(l.doc,h.doc)),this.Aa(r),i=i!=null&&i;let a=t&&!i?this.Ra():[],u=this.la.size===0&&this.current&&!i?1:0,c=u!==this.ca;return this.ca=u,o.length!==0||c?{snapshot:new Ri(this.query,e.Pa,s,o,e.mutatedKeys,u===0,c,!1,!!r&&r.resumeToken.approximateByteSize()>0),Va:a}:{Va:a}}G_(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({Pa:this.Pa,Ea:new vc,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{Va:[]}}ma(e){return!this.ua.has(e)&&!!this.Pa.has(e)&&!this.Pa.get(e).hasLocalMutations}Aa(e){e&&(e.addedDocuments.forEach(t=>this.ua=this.ua.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.ua=this.ua.delete(t)),this.current=e.current)}Ra(){if(!this.current)return[];let e=this.la;this.la=B(),this.Pa.forEach(r=>{this.ma(r.key)&&(this.la=this.la.add(r.key))});let t=[];return e.forEach(r=>{this.la.has(r)||t.push(new Ec(r))}),this.la.forEach(r=>{e.has(r)||t.push(new wc(r))}),t}fa(e){this.ua=e.hs,this.la=B();let t=this.Ta(e.documents);return this.applyChanges(t,!0)}ga(){return Ri.fromInitialDocuments(this.query,this.Pa,this.mutatedKeys,this.ca===0,this.hasCachedResults)}},rp=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},ip=class{constructor(e){this.key=e,this.pa=!1}},sp=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.ya={},this.wa=new Ft(a=>EE(a),Bo),this.Sa=new Map,this.ba=new Set,this.Da=new ie(T.comparator),this.Ca=new Map,this.va=new Vo,this.Fa={},this.Ma=new Map,this.xa=Ai.Ln(),this.onlineState="Unknown",this.Oa=void 0}get isPrimaryClient(){return this.Oa===!0}};function yD(n,e,t=!0){return m(this,null,function*(){let r=kc(n),i,s=r.wa.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.ga()):i=yield vI(r,e,t,!0),i})}function vD(n,e){return m(this,null,function*(){let t=kc(n);yield vI(t,e,!0,!1)})}function vI(n,e,t,r){return m(this,null,function*(){let i=yield Ci(n.localStore,$e(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield Gp(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Mc(n.remoteStore,i),a})}function Gp(n,e,t,r,i){return m(this,null,function*(){n.Na=(h,d,f)=>function(w,y,I,k){return m(this,null,function*(){let R=y.view.Ta(I);R.Xi&&(R=yield lc(w.localStore,y.query,!1).then(({documents:ce})=>y.view.Ta(ce,R)));let M=k&&k.targetChanges.get(y.targetId),j=k&&k.targetMismatches.get(y.targetId)!=null,K=y.view.applyChanges(R,w.isPrimaryClient,M,j);return op(w,y.targetId,K.Va),K.snapshot})}(n,h,d,f);let s=yield lc(n.localStore,e,!0),o=new Ic(e,s.hs),a=o.Ta(s.documents),u=bo.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,u);op(n,t,c.Va);let l=new rp(e,t,o);return n.wa.set(e,l),n.Sa.has(t)?n.Sa.get(t).push(e):n.Sa.set(t,[e]),c.snapshot})}function _D(n,e,t){return m(this,null,function*(){let r=A(n),i=r.wa.get(e),s=r.Sa.get(i.targetId);if(s.length>1)return r.Sa.set(i.targetId,s.filter(o=>!Bo(o,e))),void r.wa.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Si(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&bi(r.remoteStore,i.targetId),Di(r,i.targetId)}).catch(Fn))):(Di(r,i.targetId),yield Si(r.localStore,i.targetId,!0))})}function wD(n,e){return m(this,null,function*(){let t=A(n),r=t.wa.get(e),i=t.Sa.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),bi(t.remoteStore,r.targetId))})}function ED(n,e,t){return m(this,null,function*(){let r=Qp(n);try{let i=yield function(o,a){let u=A(o),c=ue.now(),l=a.reduce((f,E)=>f.add(E.key),B()),h,d;return u.persistence.runTransaction("Locally write mutations","readwrite",f=>{let E=We(),w=B();return u.os.getEntries(f,l).next(y=>{E=y,E.forEach((I,k)=>{k.isValidDocument()||(w=w.add(I))})}).next(()=>u.localDocuments.getOverlayedDocuments(f,E)).next(y=>{h=y;let I=[];for(let k of a){let R=OR(k,h.get(k.key).overlayedDocument);R!=null&&I.push(new gt(k.key,R,pE(R.value.mapValue),fe.exists(!0)))}return u.mutationQueue.addMutationBatch(f,c,I,a)}).next(y=>{d=y;let I=y.applyToLocalDocumentSet(h,w);return u.documentOverlayCache.saveOverlays(f,y.batchId,I)})}).then(()=>({batchId:d.batchId,changes:CE(h)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(o,a,u){let c=o.Fa[o.currentUser.toKey()];c||(c=new ie(U)),c=c.insert(a,u),o.Fa[o.currentUser.toKey()]=c}(r,i.batchId,t),yield Xt(r,i.changes),yield Oi(r.remoteStore)}catch(i){let s=Li(i,"Failed to persist write");t.reject(s)}})}function _I(n,e){return m(this,null,function*(){let t=A(n);try{let r=yield tD(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.Ca.get(s);o&&(V(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.pa=!0:i.modifiedDocuments.size>0?V(o.pa):i.removedDocuments.size>0&&(V(o.pa),o.pa=!1))}),yield Xt(t,r,e)}catch(r){yield Fn(r)}})}function Kw(n,e,t){let r=A(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.wa.forEach((s,o)=>{let a=o.view.G_(e);a.snapshot&&i.push(a.snapshot)}),function(o,a){let u=A(o);u.onlineState=a;let c=!1;u.queries.forEach((l,h)=>{for(let d of h.Q_)d.G_(a)&&(c=!0)}),c&&zp(u)}(r.eventManager,e),i.length&&r.ya.u_(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function ID(n,e,t){return m(this,null,function*(){let r=A(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.Ca.get(e),s=i&&i.key;if(s){let o=new ie(T.comparator);o=o.insert(s,Te.newNoDocument(s,N.min()));let a=B().add(s),u=new So(N.min(),new Map,new ie(U),o,a);yield _I(r,u),r.Da=r.Da.remove(s),r.Ca.delete(e),Hp(r)}else yield Si(r.localStore,e,!1).then(()=>Di(r,e,t)).catch(Fn)})}function TD(n,e){return m(this,null,function*(){let t=A(n),r=e.batch.batchId;try{let i=yield eD(t.localStore,e);Wp(t,r,null),Kp(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Xt(t,i)}catch(i){yield Fn(i)}})}function AD(n,e,t){return m(this,null,function*(){let r=A(n);try{let i=yield function(o,a){let u=A(o);return u.persistence.runTransaction("Reject batch","readwrite-primary",c=>{let l;return u.mutationQueue.lookupMutationBatch(c,a).next(h=>(V(h!==null),l=h.keys(),u.mutationQueue.removeMutationBatch(c,h))).next(()=>u.mutationQueue.performConsistencyCheck(c)).next(()=>u.documentOverlayCache.removeOverlaysForBatchId(c,l,a)).next(()=>u.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(c,l)).next(()=>u.localDocuments.getDocuments(c,l))})}(r.localStore,e);Wp(r,e,t),Kp(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Xt(r,i)}catch(i){yield Fn(i)}})}function CD(n,e){return m(this,null,function*(){let t=A(n);Un(t.remoteStore)||_("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield function(o){let a=A(o);return a.persistence.runTransaction("Get highest unacknowledged batch id","readonly",u=>a.mutationQueue.getHighestUnacknowledgedBatchId(u))}(t.localStore);if(r===-1)return void e.resolve();let i=t.Ma.get(r)||[];i.push(e),t.Ma.set(r,i)}catch(r){let i=Li(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function Kp(n,e){(n.Ma.get(e)||[]).forEach(t=>{t.resolve()}),n.Ma.delete(e)}function Wp(n,e,t){let r=A(n),i=r.Fa[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.Fa[r.currentUser.toKey()]=i}}function Di(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.Sa.get(e))n.wa.delete(r),t&&n.ya.La(r,t);n.Sa.delete(e),n.isPrimaryClient&&n.va.Vr(e).forEach(r=>{n.va.containsKey(r)||wI(n,r)})}function wI(n,e){n.ba.delete(e.path.canonicalString());let t=n.Da.get(e);t!==null&&(bi(n.remoteStore,t),n.Da=n.Da.remove(e),n.Ca.delete(t),Hp(n))}function op(n,e,t){for(let r of t)r instanceof wc?(n.va.addReference(r.key,e),SD(n,r)):r instanceof Ec?(_("SyncEngine","Document no longer in limbo: "+r.key),n.va.removeReference(r.key,e),n.va.containsKey(r.key)||wI(n,r.key)):b()}function SD(n,e){let t=e.key,r=t.path.canonicalString();n.Da.get(t)||n.ba.has(r)||(_("SyncEngine","New document in limbo: "+t),n.ba.add(r),Hp(n))}function Hp(n){for(;n.ba.size>0&&n.Da.size<n.maxConcurrentLimboResolutions;){let e=n.ba.values().next().value;n.ba.delete(e);let t=new T(H.fromString(e)),r=n.xa.next();n.Ca.set(r,new ip(t)),n.Da=n.Da.insert(t,r),Mc(n.remoteStore,new Ti($e(Mi(t.path)),r,"TargetPurposeLimboResolution",et._e))}}function Xt(n,e,t){return m(this,null,function*(){let r=A(n),i=[],s=[],o=[];r.wa.isEmpty()||(r.wa.forEach((a,u)=>{o.push(r.Na(u,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(u.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let l=Lf.Ki(u.targetId,c);s.push(l)}}))}),yield Promise.all(o),r.ya.u_(i),yield function(u,c){return m(this,null,function*(){let l=A(u);try{yield l.persistence.runTransaction("notifyLocalViewChanges","readwrite",h=>p.forEach(c,d=>p.forEach(d.qi,f=>l.persistence.referenceDelegate.addReference(h,d.targetId,f)).next(()=>p.forEach(d.Qi,f=>l.persistence.referenceDelegate.removeReference(h,d.targetId,f)))))}catch(h){if(!Ln(h))throw h;_("LocalStore","Failed to update sequence numbers: "+h)}for(let h of c){let d=h.targetId;if(!h.fromCache){let f=l.ns.get(d),E=f.snapshotVersion,w=f.withLastLimboFreeSnapshotVersion(E);l.ns=l.ns.insert(d,w)}}})}(r.localStore,s))})}function bD(n,e){return m(this,null,function*(){let t=A(n);if(!t.currentUser.isEqual(e)){_("SyncEngine","User change. New user:",e.toKey());let r=yield sI(t.localStore,e);t.currentUser=e,function(s,o){s.Ma.forEach(a=>{a.forEach(u=>{u.reject(new v(g.CANCELLED,o))})}),s.Ma.clear()}(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield Xt(t,r.us)}})}function RD(n,e){let t=A(n),r=t.Ca.get(e);if(r&&r.pa)return B().add(r.key);{let i=B(),s=t.Sa.get(e);if(!s)return i;for(let o of s){let a=t.wa.get(o);i=i.unionWith(a.view.Ia)}return i}}function DD(n,e){return m(this,null,function*(){let t=A(n),r=yield lc(t.localStore,e.query,!0),i=e.view.fa(r);return t.isPrimaryClient&&op(t,e.targetId,i.Va),i})}function PD(n,e){return m(this,null,function*(){let t=A(n);return cI(t.localStore,e).then(r=>Xt(t,r))})}function VD(n,e,t,r){return m(this,null,function*(){let i=A(n),s=yield function(a,u){let c=A(a),l=A(c.mutationQueue);return c.persistence.runTransaction("Lookup mutation documents","readonly",h=>l.vn(h,u).next(d=>d?c.localDocuments.getDocuments(h,d):p.resolve(null)))}(i.localStore,e);s!==null?(t==="pending"?yield Oi(i.remoteStore):t==="acknowledged"||t==="rejected"?(Wp(i,e,r||null),Kp(i,e),function(a,u){A(A(a).mutationQueue).Mn(u)}(i.localStore,e)):b(),yield Xt(i,s)):_("SyncEngine","Cannot apply mutation batch with id: "+e)})}function xD(n,e){return m(this,null,function*(){let t=A(n);if(kc(t),Qp(t),e===!0&&t.Oa!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Ww(t,r.toArray());t.Oa=!0,yield Yf(t.remoteStore,!0);for(let s of i)Mc(t.remoteStore,s)}else if(e===!1&&t.Oa!==!1){let r=[],i=Promise.resolve();t.Sa.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Di(t,o),Si(t.localStore,o,!0))),bi(t.remoteStore,o)}),yield i,yield Ww(t,r),function(o){let a=A(o);a.Ca.forEach((u,c)=>{bi(a.remoteStore,c)}),a.va.mr(),a.Ca=new Map,a.Da=new ie(T.comparator)}(t),t.Oa=!1,yield Yf(t.remoteStore,!1)}})}function Ww(n,e,t){return m(this,null,function*(){let r=A(n),i=[],s=[];for(let o of e){let a,u=r.Sa.get(o);if(u&&u.length!==0){a=yield Ci(r.localStore,$e(u[0]));for(let c of u){let l=r.wa.get(c),h=yield DD(r,l);h.snapshot&&s.push(h.snapshot)}}else{let c=yield uI(r.localStore,o);a=yield Ci(r.localStore,c),yield Gp(r,EI(c),o,!1,a.resumeToken)}i.push(a)}return r.ya.u_(s),i})}function EI(n){return wE(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function ND(n){return function(t){return A(A(t).persistence).Bi()}(A(n).localStore)}function MD(n,e,t,r){return m(this,null,function*(){let i=A(n);if(i.Oa)return void _("SyncEngine","Ignoring unexpected query state notification.");let s=i.Sa.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield cI(i.localStore,IE(s[0])),a=So.createSynthesizedRemoteEventForCurrentChange(e,t==="current",Re.EMPTY_BYTE_STRING);yield Xt(i,o,a);break}case"rejected":yield Si(i.localStore,e,!0),Di(i,e,r);break;default:b()}})}function kD(n,e,t){return m(this,null,function*(){let r=kc(n);if(r.Oa){for(let i of e){if(r.Sa.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){_("SyncEngine","Adding an already active target "+i);continue}let s=yield uI(r.localStore,i),o=yield Ci(r.localStore,s);yield Gp(r,EI(s),o.targetId,!1,o.resumeToken),Mc(r.remoteStore,o)}for(let i of t)r.Sa.has(i)&&(yield Si(r.localStore,i,!1).then(()=>{bi(r.remoteStore,i),Di(r,i)}).catch(Fn))}})}function kc(n){let e=A(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=_I.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=RD.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=ID.bind(null,e),e.ya.u_=gD.bind(null,e.eventManager),e.ya.La=mD.bind(null,e.eventManager),e}function Qp(n){let e=A(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=TD.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=AD.bind(null,e),e}function OD(n,e,t){let r=A(n);(function(s,o,a){return m(this,null,function*(){try{let u=yield o.getMetadata();if(yield function(f,E){let w=A(f),y=me(E.createTime);return w.persistence.runTransaction("hasNewerBundle","readonly",I=>w.$r.getBundleMetadata(I,E.id)).then(I=>!!I&&I.createTime.compareTo(y)>=0)}(s.localStore,u))return yield o.close(),a._completeWith(function(f){return{taskState:"Success",documentsLoaded:f.totalDocuments,bytesLoaded:f.totalBytes,totalDocuments:f.totalDocuments,totalBytes:f.totalBytes}}(u)),Promise.resolve(new Set);a._updateProgress(yI(u));let c=new np(u,s.localStore,o.serializer),l=yield o.Ba();for(;l;){let d=yield c.sa(l);d&&a._updateProgress(d),l=yield o.Ba()}let h=yield c.complete();return yield Xt(s,h.aa,void 0),yield function(f,E){let w=A(f);return w.persistence.runTransaction("Save bundle","readwrite",y=>w.$r.saveBundleMetadata(y,E))}(s.localStore,u),a._completeWith(h.progress),Promise.resolve(h._a)}catch(u){return at("SyncEngine",`Loading bundle failed with ${u}`),a._failWith(u),Promise.resolve(new Set)}})})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}var ko=class{constructor(){this.synchronizeTabs=!1}initialize(e){return m(this,null,function*(){this.serializer=$o(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return iI(this.persistence,new cc,e.initialUser,this.serializer)}createPersistence(e){return new ac(uc.Hr,this.serializer)}createSharedClientState(e){return new fc}terminate(){return m(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Tc=class n extends ko{constructor(e,t,r){super(),this.ka=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return m(this,null,function*(){yield Hc(n.prototype,this,"initialize").call(this,e),yield this.ka.initialize(this,e),yield Qp(this.ka.syncEngine),yield Oi(this.ka.remoteStore),yield this.persistence.fi(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return iI(this.persistence,new cc,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new Tf(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new jd(t,this.persistence);return new Ud(e.asyncQueue,r)}createPersistence(e){let t=Lp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?ot.withCacheSize(this.cacheSizeBytes):ot.DEFAULT;return new Ff(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,hI(),ku(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new fc}},ap=class n extends Tc{constructor(e,t){super(e,t,!1),this.ka=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return m(this,null,function*(){yield Hc(n.prototype,this,"initialize").call(this,e);let t=this.ka.syncEngine;this.sharedClientState instanceof mo&&(this.sharedClientState.syncEngine={Zs:VD.bind(null,t),Xs:MD.bind(null,t),eo:kD.bind(null,t),Bi:ND.bind(null,t),Ys:PD.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.fi(r=>m(this,null,function*(){yield xD(this.ka.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=hI();if(!mo.D(t))throw new v(g.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=Lp(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new mo(t,e.asyncQueue,r,e.clientId,e.initialUser)}},Oo=class{initialize(e,t){return m(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Kw(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=bD.bind(null,this.syncEngine),yield Yf(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return function(){return new Zf}()}createDatastore(e){let t=$o(e.databaseInfo.databaseId),r=function(s){return new zf(s)}(e.databaseInfo);return function(s,o,a,u){return new Wf(s,o,a,u)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(r,i,s,o,a){return new Qf(r,i,s,o,a)}(this.localStore,this.datastore,e.asyncQueue,t=>Kw(this.syncEngine,t,0),function(){return pc.D()?new pc:new qf}())}createSyncEngine(e,t){return function(i,s,o,a,u,c,l){let h=new sp(i,s,o,a,u,c);return l&&(h.Oa=!0),h}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return m(this,null,function*(){var e;yield function(r){return m(this,null,function*(){let i=A(r);_("RemoteStore","RemoteStore shutting down."),i.v_.add(5),yield ki(i),i.M_.shutdown(),i.x_.set("Unknown")})}(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};function Hw(n,e=10240){let t=0;return{read(){return m(this,null,function*(){if(t<n.byteLength){let i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})},cancel(){return m(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}var Pi=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.qa(this.observer.next,e)}error(e){this.observer.error?this.qa(this.observer.error,e):pe("Uncaught Error in snapshot listener:",e.toString())}Qa(){this.muted=!0}qa(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var up=class{constructor(e,t){this.Ka=e,this.serializer=t,this.metadata=new Ie,this.buffer=new Uint8Array,this.$a=function(){return new TextDecoder("utf-8")}(),this.Ua().then(r=>{r&&r.ra()?this.metadata.resolve(r.na.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.na)}`))},r=>this.metadata.reject(r))}close(){return this.Ka.cancel()}getMetadata(){return m(this,null,function*(){return this.metadata.promise})}Ba(){return m(this,null,function*(){return yield this.getMetadata(),this.Ua()})}Ua(){return m(this,null,function*(){let e=yield this.Wa();if(e===null)return null;let t=this.$a.decode(e),r=Number(t);isNaN(r)&&this.Ga(`length string (${t}) is not valid number`);let i=yield this.za(r);return new tp(JSON.parse(i),e.length+r)})}ja(){return this.buffer.findIndex(e=>e===123)}Wa(){return m(this,null,function*(){for(;this.ja()<0&&!(yield this.Ha()););if(this.buffer.length===0)return null;let e=this.ja();e<0&&this.Ga("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}za(e){return m(this,null,function*(){for(;this.buffer.length<e;)(yield this.Ha())&&this.Ga("Reached the end of bundle when more is expected.");let t=this.$a.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}Ga(e){throw this.Ka.cancel(),new Error(`Invalid bundle format: ${e}`)}Ha(){return m(this,null,function*(){let e=yield this.Ka.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};var cp=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return m(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new v(g.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield function(i,s){return m(this,null,function*(){let o=A(i),a={documents:s.map(h=>Ro(o.serializer,h))},u=yield o.vo("BatchGetDocuments",o.serializer.databaseId,H.emptyPath(),a,s.length),c=new Map;u.forEach(h=>{let d=qR(o.serializer,h);c.set(d.key.toString(),d)});let l=[];return s.forEach(h=>{let d=c.get(h.toString());V(!!d),l.push(d)}),l})}(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new kn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return m(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=T.fromPath(r);this.mutations.push(new To(i,this.precondition(i)))}),yield function(r,i){return m(this,null,function*(){let s=A(r),o={writes:i.map(a=>Do(s.serializer,a))};yield s.So("Commit",s.serializer.databaseId,H.emptyPath(),o)})}(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw b();t=N.min()}let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new v(g.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(N.min())?fe.exists(!1):fe.updateTime(t):fe.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(N.min()))throw new v(g.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return fe.updateTime(t)}return fe.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var lp=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.Ja=r.maxAttempts,this.jo=new No(this.asyncQueue,"transaction_retry")}Ya(){this.Ja-=1,this.Za()}Za(){this.jo.qo(()=>m(this,null,function*(){let e=new cp(this.datastore),t=this.Xa(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.eu(i)}))}).catch(r=>{this.eu(r)})}))}Xa(e){try{let t=this.updateFunction(e);return!Uo(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}eu(e){this.Ja>0&&this.tu(e)?(this.Ja-=1,this.asyncQueue.enqueueAndForget(()=>(this.Za(),Promise.resolve()))):this.deferred.reject(e)}tu(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!OE(t)}return!1}};var hp=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Ee.UNAUTHENTICATED,this.clientId=Lu.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>m(this,null,function*(){_("FirestoreClient","Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(_("FirestoreClient","Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new v(g.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ie;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>m(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Li(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Ou(n,e){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),_("FirestoreClient","Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>m(this,null,function*(){r.isEqual(i)||(yield sI(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function dp(n,e){return m(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield Yp(n);_("FirestoreClient","Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>zw(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>zw(e.remoteStore,i)),n._onlineComponents=e})}function II(n){return n.name==="FirebaseError"?n.code===g.FAILED_PRECONDITION||n.code===g.UNIMPLEMENTED:!(typeof DOMException<"u"&&n instanceof DOMException)||n.code===22||n.code===20||n.code===11}function Yp(n){return m(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){_("FirestoreClient","Using user provided OfflineComponentProvider");try{yield Ou(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!II(t))throw t;at("Error using user provided cache. Falling back to memory cache: "+t),yield Ou(n,new ko)}}else _("FirestoreClient","Using default OfflineComponentProvider"),yield Ou(n,new ko);return n._offlineComponents})}function Oc(n){return m(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(_("FirestoreClient","Using user provided OnlineComponentProvider"),yield dp(n,n._uninitializedComponentsProvider._online)):(_("FirestoreClient","Using default OnlineComponentProvider"),yield dp(n,new Oo))),n._onlineComponents})}function TI(n){return Yp(n).then(e=>e.persistence)}function Xp(n){return Yp(n).then(e=>e.localStore)}function AI(n){return Oc(n).then(e=>e.remoteStore)}function Jp(n){return Oc(n).then(e=>e.syncEngine)}function FD(n){return Oc(n).then(e=>e.datastore)}function Vi(n){return m(this,null,function*(){let e=yield Oc(n),t=e.eventManager;return t.onListen=yD.bind(null,e.syncEngine),t.onUnlisten=_D.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=vD.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=wD.bind(null,e.syncEngine),t})}function LD(n){return n.asyncQueue.enqueue(()=>m(this,null,function*(){let e=yield TI(n),t=yield AI(n);return e.setNetworkEnabled(!0),function(i){let s=A(i);return s.v_.delete(0),zo(s)}(t)}))}function UD(n){return n.asyncQueue.enqueue(()=>m(this,null,function*(){let e=yield TI(n),t=yield AI(n);return e.setNetworkEnabled(!1),function(i){return m(this,null,function*(){let s=A(i);s.v_.add(0),yield ki(s),s.x_.set("Offline")})}(t)}))}function jD(n,e){let t=new Ie;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s,o){return m(this,null,function*(){try{let a=yield function(c,l){let h=A(c);return h.persistence.runTransaction("read document","readonly",d=>h.localDocuments.getDocument(d,l))}(i,s);a.isFoundDocument()?o.resolve(a):a.isNoDocument()?o.resolve(null):o.reject(new v(g.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(a){let u=Li(a,`Failed to get document '${s} from cache`);o.reject(u)}})}(yield Xp(n),e,t)})),t.promise}function CI(n,e,t={}){let r=new Ie;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(s,o,a,u,c){let l=new Pi({next:d=>{o.enqueueAndForget(()=>$p(s,h));let f=d.docs.has(a);!f&&d.fromCache?c.reject(new v(g.UNAVAILABLE,"Failed to get document because the client is offline.")):f&&d.fromCache&&u&&u.source==="server"?c.reject(new v(g.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new Mo(Mi(a.path),l,{includeMetadataChanges:!0,ta:!0});return qp(s,h)}(yield Vi(n),n.asyncQueue,e,t,r)})),r.promise}function BD(n,e){let t=new Ie;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s,o){return m(this,null,function*(){try{let a=yield lc(i,s,!0),u=new Ic(s,a.hs),c=u.Ta(a.documents),l=u.applyChanges(c,!1);o.resolve(l.snapshot)}catch(a){let u=Li(a,`Failed to execute query '${s} against cache`);o.reject(u)}})}(yield Xp(n),e,t)})),t.promise}function SI(n,e,t={}){let r=new Ie;return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(s,o,a,u,c){let l=new Pi({next:d=>{o.enqueueAndForget(()=>$p(s,h)),d.fromCache&&u.source==="server"?c.reject(new v(g.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):c.resolve(d)},error:d=>c.reject(d)}),h=new Mo(a,l,{includeMetadataChanges:!0,ta:!0});return qp(s,h)}(yield Vi(n),n.asyncQueue,e,t,r)})),r.promise}function qD(n,e){let t=new Pi(e);return n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s){A(i).W_.add(s),s.next()}(yield Vi(n),t)})),()=>{t.Qa(),n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return function(i,s){A(i).W_.delete(s)}(yield Vi(n),t)}))}}function $D(n,e,t,r){let i=function(o,a){let u;return u=typeof o=="string"?LE().encode(o):o,function(l,h){return new up(l,h)}(function(l,h){if(l instanceof Uint8Array)return Hw(l,h);if(l instanceof ArrayBuffer)return Hw(new Uint8Array(l),h);if(l instanceof ReadableStream)return l.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(u),a)}(t,$o(e));n.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){OD(yield Jp(n),i,r)}))}function zD(n,e){return n.asyncQueue.enqueue(()=>m(this,null,function*(){return function(r,i){let s=A(r);return s.persistence.runTransaction("Get named query","readonly",o=>s.$r.getNamedQuery(o,i))}(yield Xp(n),e)}))}function bI(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var Qw=new Map;function Zp(n,e,t){if(!t)throw new v(g.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function eg(n,e,t,r){if(e===!0&&r===!0)throw new v(g.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function Yw(n){if(!T.isDocumentKey(n))throw new v(g.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Xw(n){if(T.isDocumentKey(n))throw new v(g.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Fc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=function(r){return r.constructor?r.constructor.name:null}(n);return e?`a custom ${e} object`:"an object"}}return typeof n=="function"?"a function":b()}function Q(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new v(g.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Fc(n);throw new v(g.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function RI(n,e){if(e<=0)throw new v(g.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}var Ac=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new v(g.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=(t=e.ssl)===null||t===void 0||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=41943040;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<1048576)throw new v(g.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}eg("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=bI((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),function(s){if(s.timeoutSeconds!==void 0){if(isNaN(s.timeoutSeconds))throw new v(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (must not be NaN)`);if(s.timeoutSeconds<5)throw new v(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (minimum allowed value is 5)`);if(s.timeoutSeconds>30)throw new v(g.INVALID_ARGUMENT,`invalid long polling timeout: ${s.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(r,i){return r.timeoutSeconds===i.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}},_r=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ac({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new v(g.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new v(g.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ac(e),e.credentials!==void 0&&(this._authCredentials=function(r){if(!r)return new Dd;switch(r.type){case"firstParty":return new Nd(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new v(g.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){let r=Qw.get(t);r&&(_("ComponentProvider","Removing Datastore"),Qw.delete(t),r.terminate())}(this),Promise.resolve()}};function DI(n,e,t,r={}){var i;let s=(n=Q(n,_r))._getSettings(),o=`${e}:${t}`;if(s.host!=="firestore.googleapis.com"&&s.host!==o&&at("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,u;if(typeof r.mockUserToken=="string")a=r.mockUserToken,u=Ee.MOCK_USER;else{a=wm(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new v(g.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");u=new Ee(c)}n._authCredentials=new Pd(new Fu(a,u))}}var Ne=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},te=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Mt(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Mt=class n extends Ne{constructor(e,t,r){super(e,t,Mi(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new te(this.firestore,null,new T(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function tg(n,e,...t){if(n=ae(n),Zp("collection","path",e),n instanceof _r){let r=H.fromString(e,...t);return Xw(r),new Mt(n,null,r)}{if(!(n instanceof te||n instanceof Mt))throw new v(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(H.fromString(e,...t));return Xw(r),new Mt(n.firestore,null,r)}}function PI(n,e){if(n=Q(n,_r),Zp("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new v(g.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ne(n,null,function(r){return new pt(H.emptyPath(),r)}(e))}function Go(n,e,...t){if(n=ae(n),arguments.length===1&&(e=Lu.newId()),Zp("doc","path",e),n instanceof _r){let r=H.fromString(e,...t);return Yw(r),new te(n,null,new T(r))}{if(!(n instanceof te||n instanceof Mt))throw new v(g.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(H.fromString(e,...t));return Yw(r),new te(n.firestore,n instanceof Mt?n.converter:null,new T(r))}}function ng(n,e){return n=ae(n),e=ae(e),(n instanceof te||n instanceof Mt)&&(e instanceof te||e instanceof Mt)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function rg(n,e){return n=ae(n),e=ae(e),n instanceof Ne&&e instanceof Ne&&n.firestore===e.firestore&&Bo(n._query,e._query)&&n.converter===e.converter}var fp=class{constructor(){this.nu=Promise.resolve(),this.ru=[],this.iu=!1,this.su=[],this.ou=null,this._u=!1,this.au=!1,this.uu=[],this.jo=new No(this,"async_queue_retry"),this.cu=()=>{let t=ku();t&&_("AsyncQueue","Visibility state changed to "+t.visibilityState),this.jo.Ko()};let e=ku();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this.cu)}get isShuttingDown(){return this.iu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.lu(),this.hu(e)}enterRestrictedMode(e){if(!this.iu){this.iu=!0,this.au=e||!1;let t=ku();t&&typeof t.removeEventListener=="function"&&t.removeEventListener("visibilitychange",this.cu)}}enqueue(e){if(this.lu(),this.iu)return new Promise(()=>{});let t=new Ie;return this.hu(()=>this.iu&&this.au?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.ru.push(e),this.Pu()))}Pu(){return m(this,null,function*(){if(this.ru.length!==0){try{yield this.ru[0](),this.ru.shift(),this.jo.reset()}catch(e){if(!Ln(e))throw e;_("AsyncQueue","Operation failed with retryable error: "+e)}this.ru.length>0&&this.jo.qo(()=>this.Pu())}})}hu(e){let t=this.nu.then(()=>(this._u=!0,e().catch(r=>{this.ou=r,this._u=!1;let i=function(o){let a=o.message||"";return o.stack&&(a=o.stack.includes(o.message)?o.stack:o.message+`
`+o.stack),a}(r);throw pe("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this._u=!1,r))));return this.nu=t,t}enqueueAfterDelay(e,t,r){this.lu(),this.uu.indexOf(e)>-1&&(t=0);let i=Xf.createAndSchedule(this,e,t,r,s=>this.Iu(s));return this.su.push(i),i}lu(){this.ou&&b()}verifyOperationInProgress(){}Tu(){return m(this,null,function*(){let e;do e=this.nu,yield e;while(e!==this.nu)})}Eu(e){for(let t of this.su)if(t.timerId===e)return!0;return!1}du(e){return this.Tu().then(()=>{this.su.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.su)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.Tu()})}Au(e){this.uu.push(e)}Iu(e){let t=this.su.indexOf(e);this.su.splice(t,1)}};function pp(n){return function(t,r){if(typeof t!="object"||t===null)return!1;let i=t;for(let s of r)if(s in i&&typeof i[s]=="function")return!0;return!1}(n,["next","error","complete"])}var gp=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ie,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var VI=-1,oe=class extends _r{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=function(){return new fp}(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||xI(this),this._firestoreClient.terminate()}};function Ae(n){return n._firestoreClient||xI(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function xI(n){var e,t,r;let i=n._freezeSettings(),s=function(a,u,c,l){return new Bd(a,u,c,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,bI(l.experimentalLongPollingOptions),l.useFetchStreams)}(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new hp(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function NI(n,e){qI(n=Q(n,oe));let t=Ae(n);if(t._uninitializedComponentsProvider)throw new v(g.FAILED_PRECONDITION,"SDK cache is already specified.");at("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new Oo;return kI(t,i,new Tc(i,r.cacheSizeBytes,e?.forceOwnership))}function MI(n){qI(n=Q(n,oe));let e=Ae(n);if(e._uninitializedComponentsProvider)throw new v(g.FAILED_PRECONDITION,"SDK cache is already specified.");at("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new Oo;return kI(e,r,new ap(r,t.cacheSizeBytes))}function kI(n,e,t){let r=new Ie;return n.asyncQueue.enqueue(()=>m(this,null,function*(){try{yield Ou(n,t),yield dp(n,e),r.resolve()}catch(i){let s=i;if(!II(s))throw s;at("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function OI(n){if(n._initialized&&!n._terminated)throw new v(g.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Ie;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>m(this,null,function*(){try{yield function(r){return m(this,null,function*(){if(!Kt.D())return Promise.resolve();let i=r+"main";yield Kt.delete(i)})}(Lp(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function FI(n){return function(t){let r=new Ie;return t.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return CD(yield Jp(t),r)})),r.promise}(Ae(n=Q(n,oe)))}function LI(n){return LD(Ae(n=Q(n,oe)))}function UI(n){return UD(Ae(n=Q(n,oe)))}function jI(n,e){let t=Ae(n=Q(n,oe)),r=new gp;return $D(t,n._databaseId,e,r),r}function BI(n,e){return zD(Ae(n=Q(n,oe)),e).then(t=>t?new Ne(n,null,t.query):null)}function qI(n){if(n._initialized||n._terminated)throw new v(g.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Lt=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(Re.fromBase64String(e))}catch(t){throw new v(g.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(Re.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var mt=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new v(g.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ge(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Qt=class{constructor(e){this._methodName=e}};var wr=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new v(g.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new v(g.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return U(this._lat,e._lat)||U(this._long,e._long)}};var GD=/^__.*__$/,mp=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new gt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Mn(e,this.data,t,this.fieldTransforms)}},Cc=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new gt(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function $I(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw b()}}var Sc=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.Ru(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}mu(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}fu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.mu({path:r,gu:!1});return i.pu(e),i}yu(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.mu({path:r,gu:!1});return i.Ru(),i}wu(e){return this.mu({path:void 0,gu:!0})}Su(e){return bc(e,this.settings.methodName,this.settings.bu||!1,this.path,this.settings.Du)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}Ru(){if(this.path)for(let e=0;e<this.path.length;e++)this.pu(this.path.get(e))}pu(e){if(e.length===0)throw this.Su("Document fields must not be empty");if($I(this.Vu)&&GD.test(e))throw this.Su('Document fields cannot begin and end with "__"')}},yp=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||$o(e)}Cu(e,t,r,i=!1){return new Sc({Vu:e,methodName:t,Du:r,path:ge.emptyPath(),gu:!1,bu:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Ar(n){let e=n._freezeSettings(),t=$o(n._databaseId);return new yp(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Lc(n,e,t,r,i,s={}){let o=n.Cu(s.merge||s.mergeFields?2:0,e,t,i);og("Data must be an object, but it was:",o,r);let a=KI(r,o),u,c;if(s.merge)u=new tt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let l=[];for(let h of s.mergeFields){let d=Ip(e,h,t);if(!o.contains(d))throw new v(g.INVALID_ARGUMENT,`Field '${d}' is specified in your field mask but missing from your input data.`);HI(l,d)||l.push(d)}u=new tt(l),c=o.fieldTransforms.filter(h=>u.covers(h.field))}else u=null,c=o.fieldTransforms;return new mp(new Fe(a),u,c)}var Fo=class n extends Qt{_toFieldTransform(e){if(e.Vu!==2)throw e.Vu===1?e.Su(`${this._methodName}() can only appear at the top level of your update data`):e.Su(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof n}};function zI(n,e,t){return new Sc({Vu:3,Du:e.settings.Du,methodName:n._methodName,gu:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var vp=class n extends Qt{_toFieldTransform(e){return new mr(e.path,new xn)}isEqual(e){return e instanceof n}},_p=class n extends Qt{constructor(e,t){super(e),this.vu=t}_toFieldTransform(e){let t=zI(this,e,!0),r=this.vu.map(s=>Cr(s,t)),i=new Wt(r);return new mr(e.path,i)}isEqual(e){return e instanceof n&&dl(this.vu,e.vu)}},wp=class n extends Qt{constructor(e,t){super(e),this.vu=t}_toFieldTransform(e){let t=zI(this,e,!0),r=this.vu.map(s=>Cr(s,t)),i=new Ht(r);return new mr(e.path,i)}isEqual(e){return e instanceof n&&dl(this.vu,e.vu)}},Ep=class n extends Qt{constructor(e,t){super(e),this.Fu=t}_toFieldTransform(e){let t=new Nn(e.serializer,DE(e.serializer,this.Fu));return new mr(e.path,t)}isEqual(e){return e instanceof n&&this.Fu===e.Fu}};function ig(n,e,t,r){let i=n.Cu(1,e,t);og("Data must be an object, but it was:",i,r);let s=[],o=Fe.empty();Tr(r,(u,c)=>{let l=ag(e,u,t);c=ae(c);let h=i.yu(l);if(c instanceof Fo)s.push(l);else{let d=Cr(c,h);d!=null&&(s.push(l),o.set(l,d))}});let a=new tt(s);return new Cc(o,a,i.fieldTransforms)}function sg(n,e,t,r,i,s){let o=n.Cu(1,e,t),a=[Ip(e,r,t)],u=[i];if(s.length%2!=0)throw new v(g.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let d=0;d<s.length;d+=2)a.push(Ip(e,s[d])),u.push(s[d+1]);let c=[],l=Fe.empty();for(let d=a.length-1;d>=0;--d)if(!HI(c,a[d])){let f=a[d],E=u[d];E=ae(E);let w=o.yu(f);if(E instanceof Fo)c.push(f);else{let y=Cr(E,w);y!=null&&(c.push(f),l.set(f,y))}}let h=new tt(c);return new Cc(l,h,o.fieldTransforms)}function GI(n,e,t,r=!1){return Cr(t,n.Cu(r?4:3,e))}function Cr(n,e){if(WI(n=ae(n)))return og("Unsupported field value:",e,n),KI(n,e);if(n instanceof Qt)return function(r,i){if(!$I(i.Vu))throw i.Su(`${r._methodName}() can only be used with update() and set()`);if(!i.path)throw i.Su(`${r._methodName}() is not currently supported inside arrays`);let s=r._toFieldTransform(i);s&&i.fieldTransforms.push(s)}(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.gu&&e.Vu!==4)throw e.Su("Nested arrays are not supported");return function(r,i){let s=[],o=0;for(let a of r){let u=Cr(a,i.wu(o));u==null&&(u={nullValue:"NULL_VALUE"}),s.push(u),o++}return{arrayValue:{values:s}}}(n,e)}return function(r,i){if((r=ae(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return DE(i.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){let s=ue.fromDate(r);return{timestampValue:Ii(i.serializer,s)}}if(r instanceof ue){let s=new ue(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Ii(i.serializer,s)}}if(r instanceof wr)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Lt)return{bytesValue:UE(i.serializer,r._byteString)};if(r instanceof te){let s=i.databaseId,o=r.firestore._databaseId;if(!o.isEqual(s))throw i.Su(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${s.projectId}/${s.database}`);return{referenceValue:kp(r.firestore._databaseId||i.databaseId,r._key.path)}}throw i.Su(`Unsupported field value: ${Fc(r)}`)}(n,e)}function KI(n,e){let t={};return hE(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Tr(n,(r,i)=>{let s=Cr(i,e.fu(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function WI(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof ue||n instanceof wr||n instanceof Lt||n instanceof te||n instanceof Qt)}function og(n,e,t){if(!WI(t)||!function(i){return typeof i=="object"&&i!==null&&(Object.getPrototypeOf(i)===Object.prototype||Object.getPrototypeOf(i)===null)}(t)){let r=Fc(t);throw r==="an object"?e.Su(n+" a custom object"):e.Su(n+" "+r)}}function Ip(n,e,t){if((e=ae(e))instanceof mt)return e._internalPath;if(typeof e=="string")return ag(n,e);throw bc("Field path arguments must be of type string or ",n,!1,void 0,t)}var KD=new RegExp("[~\\*/\\[\\]]");function ag(n,e,t){if(e.search(KD)>=0)throw bc(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new mt(...e.split("."))._internalPath}catch{throw bc(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function bc(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let u="";return(s||o)&&(u+=" (found",s&&(u+=` in field ${r}`),o&&(u+=` in document ${i}`),u+=")"),new v(g.INVALID_ARGUMENT,a+n+u)}function HI(n,e){return n.some(t=>t.isEqual(e))}var Er=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new te(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){let e=new Tp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(Uc("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},Tp=class extends Er{data(){return super.data()}};function Uc(n,e){return typeof e=="string"?ag(n,e):e instanceof mt?e._internalPath:e._delegate._internalPath}function QI(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new v(g.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Lo=class{},Ir=class extends Lo{};function Jt(n,e,...t){let r=[];e instanceof Lo&&r.push(e),r=r.concat(t),function(s){let o=s.filter(u=>u instanceof Ap).length,a=s.filter(u=>u instanceof Rc).length;if(o>1||o>0&&a>0)throw new v(g.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(let i of r)n=i._apply(n);return n}var Rc=class n extends Ir{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return sT(e._query,t),new Ne(e.firestore,e.converter,ef(e._query,t))}_parse(e){let t=Ar(e.firestore);return function(s,o,a,u,c,l,h){let d;if(c.isKeyField()){if(l==="array-contains"||l==="array-contains-any")throw new v(g.INVALID_ARGUMENT,`Invalid Query. You can't perform '${l}' queries on documentId().`);if(l==="in"||l==="not-in"){Zw(h,l);let f=[];for(let E of h)f.push(Jw(u,s,E));d={arrayValue:{values:f}}}else d=Jw(u,s,h)}else l!=="in"&&l!=="not-in"&&l!=="array-contains-any"||Zw(h,l),d=GI(a,o,h,l==="in"||l==="not-in");return G.create(c,l,d)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function YI(n,e,t){let r=e,i=Uc("where",n);return Rc._create(i,r,t)}var Ap=class n extends Lo{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:J.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(function(i,s){let o=i,a=s.getFlattenedFilters();for(let u of a)sT(o,u),o=ef(o,u)}(e._query,t),new Ne(e.firestore,e.converter,ef(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var Cp=class n extends Ir{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=function(i,s,o){if(i.startAt!==null)throw new v(g.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(i.endAt!==null)throw new v(g.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new pr(s,o)}(e._query,this._field,this._direction);return new Ne(e.firestore,e.converter,function(i,s){let o=i.explicitOrderBy.concat([s]);return new pt(i.path,i.collectionGroup,o,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}};function XI(n,e="asc"){let t=e,r=Uc("orderBy",n);return Cp._create(r,t)}var Dc=class n extends Ir{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new Ne(e.firestore,e.converter,Hu(e._query,this._limit,this._limitType))}};function JI(n){return RI("limit",n),Dc._create("limit",n,"F")}function ZI(n){return RI("limitToLast",n),Dc._create("limitToLast",n,"L")}var Pc=class n extends Ir{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=iT(e,this.type,this._docOrFields,this._inclusive);return new Ne(e.firestore,e.converter,function(i,s){return new pt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,s,i.endAt)}(e._query,t))}};function eT(...n){return Pc._create("startAt",n,!0)}function tT(...n){return Pc._create("startAfter",n,!1)}var Vc=class n extends Ir{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=iT(e,this.type,this._docOrFields,this._inclusive);return new Ne(e.firestore,e.converter,function(i,s){return new pt(i.path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,s)}(e._query,t))}};function nT(...n){return Vc._create("endBefore",n,!1)}function rT(...n){return Vc._create("endAt",n,!0)}function iT(n,e,t,r){if(t[0]=ae(t[0]),t[0]instanceof Er)return function(s,o,a,u,c){if(!u)throw new v(g.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${a}().`);let l=[];for(let h of pi(s))if(h.field.isKeyField())l.push(fr(o,u.key));else{let d=u.data.field(h.field);if(Nc(d))throw new v(g.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+h.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(d===null){let f=h.field.canonicalString();throw new v(g.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${f}' (used as the orderBy) does not exist.`)}l.push(d)}return new Ot(l,c)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Ar(n.firestore);return function(o,a,u,c,l,h){let d=o.explicitOrderBy;if(l.length>d.length)throw new v(g.INVALID_ARGUMENT,`Too many arguments provided to ${c}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let f=[];for(let E=0;E<l.length;E++){let w=l[E];if(d[E].field.isKeyField()){if(typeof w!="string")throw new v(g.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${c}(), but got a ${typeof w}`);if(!Np(o)&&w.indexOf("/")!==-1)throw new v(g.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${c}() must be a plain document ID, but '${w}' contains a slash.`);let y=o.path.child(H.fromString(w));if(!T.isDocumentKey(y))throw new v(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${c}() must result in a valid document path, but '${y}' is not because it contains an odd number of segments.`);let I=new T(y);f.push(fr(a,I))}else{let y=GI(u,c,w);f.push(y)}}return new Ot(f,h)}(n._query,n.firestore._databaseId,i,e,t,r)}}function Jw(n,e,t){if(typeof(t=ae(t))=="string"){if(t==="")throw new v(g.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Np(e)&&t.indexOf("/")!==-1)throw new v(g.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(H.fromString(t));if(!T.isDocumentKey(r))throw new v(g.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return fr(n,new T(r))}if(t instanceof te)return fr(n,t._key);throw new v(g.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Fc(t)}.`)}function Zw(n,e){if(!Array.isArray(n)||n.length===0)throw new v(g.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function sT(n,e){let t=function(i,s){for(let o of i)for(let a of o.getFlattenedFilters())if(s.indexOf(a.op)>=0)return a.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(t!==null)throw t===e.op?new v(g.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new v(g.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}var xi=class{convertValue(e,t="none"){switch(dr(e)){case 0:return null;case 1:return e.booleanValue;case 2:return de(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Dn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw b()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Tr(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new wr(de(e.latitude),de(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=Vp(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(wo(e));default:return null}}convertTimestamp(e){let t=Rn(e);return new ue(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=H.fromString(e);V(YE(r));let i=new Pn(r.get(1),r.get(3)),s=new T(r.popFirst(5));return i.isEqual(t)||pe(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function jc(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}var Sp=class extends xi{constructor(e){super(),this.firestore=e}convertBytes(e){return new Lt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new te(this.firestore,null,t)}};var Gt=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},ct=class extends Er{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new Sn(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let r=this._document.data.field(Uc("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Sn=class extends ct{data(e={}){return super.data(e)}},yt=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Gt(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Sn(this._firestore,this._userDataWriter,r.key,r,new Gt(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new v(g.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,s){if(i._snapshot.oldDocs.isEmpty()){let o=0;return i._snapshot.docChanges.map(a=>{let u=new Sn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Gt(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter);return a.doc,{type:"added",doc:u,oldIndex:-1,newIndex:o++}})}{let o=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(a=>s||a.type!==3).map(a=>{let u=new Sn(i._firestore,i._userDataWriter,a.doc.key,a.doc,new Gt(i._snapshot.mutatedKeys.has(a.doc.key),i._snapshot.fromCache),i.query.converter),c=-1,l=-1;return a.type!==0&&(c=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),l=o.indexOf(a.doc.key)),{type:WD(a.type),doc:u,oldIndex:c,newIndex:l}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function WD(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return b()}}function ug(n,e){return n instanceof ct&&e instanceof ct?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof yt&&e instanceof yt&&n._firestore===e._firestore&&rg(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}function oT(n){n=Q(n,te);let e=Q(n.firestore,oe);return CI(Ae(e),n._key).then(t=>dg(e,n,t))}var Yt=class extends xi{constructor(e){super(),this.firestore=e}convertBytes(e){return new Lt(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new te(this.firestore,null,t)}};function aT(n){n=Q(n,te);let e=Q(n.firestore,oe),t=Ae(e),r=new Yt(e);return jD(t,n._key).then(i=>new ct(e,r,n._key,i,new Gt(i!==null&&i.hasLocalMutations,!0),n.converter))}function uT(n){n=Q(n,te);let e=Q(n.firestore,oe);return CI(Ae(e),n._key,{source:"server"}).then(t=>dg(e,n,t))}function cT(n){n=Q(n,Ne);let e=Q(n.firestore,oe),t=Ae(e),r=new Yt(e);return QI(n._query),SI(t,n._query).then(i=>new yt(e,r,n,i))}function lT(n){n=Q(n,Ne);let e=Q(n.firestore,oe),t=Ae(e),r=new Yt(e);return BD(t,n._query).then(i=>new yt(e,r,n,i))}function hT(n){n=Q(n,Ne);let e=Q(n.firestore,oe),t=Ae(e),r=new Yt(e);return SI(t,n._query,{source:"server"}).then(i=>new yt(e,r,n,i))}function cg(n,e,t){n=Q(n,te);let r=Q(n.firestore,oe),i=jc(n.converter,e,t);return Ui(r,[Lc(Ar(r),"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,fe.none())])}function lg(n,e,t,...r){n=Q(n,te);let i=Q(n.firestore,oe),s=Ar(i),o;return o=typeof(e=ae(e))=="string"||e instanceof mt?sg(s,"updateDoc",n._key,e,t,r):ig(s,"updateDoc",n._key,e),Ui(i,[o.toMutation(n._key,fe.exists(!0))])}function dT(n){return Ui(Q(n.firestore,oe),[new kn(n._key,fe.none())])}function fT(n,e){let t=Q(n.firestore,oe),r=Go(n),i=jc(n.converter,e);return Ui(t,[Lc(Ar(n.firestore),"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,fe.exists(!1))]).then(()=>r)}function hg(n,...e){var t,r,i;n=ae(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]!="object"||pp(e[o])||(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(pp(e[o])){let h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),e[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let u,c,l;if(n instanceof te)c=Q(n.firestore,oe),l=Mi(n._key.path),u={next:h=>{e[o]&&e[o](dg(c,n,h))},error:e[o+1],complete:e[o+2]};else{let h=Q(n,Ne);c=Q(h.firestore,oe),l=h._query;let d=new Yt(c);u={next:f=>{e[o]&&e[o](new yt(c,d,h,f))},error:e[o+1],complete:e[o+2]},QI(n._query)}return function(d,f,E,w){let y=new Pi(w),I=new Mo(f,y,E);return d.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return qp(yield Vi(d),I)})),()=>{y.Qa(),d.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return $p(yield Vi(d),I)}))}}(Ae(c),l,a,u)}function pT(n,e){return qD(Ae(n=Q(n,oe)),pp(e)?e:{next:e})}function Ui(n,e){return function(r,i){let s=new Ie;return r.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){return ED(yield Jp(r),i,s)})),s.promise}(Ae(n),e)}function dg(n,e,t){let r=t.docs.get(e._key),i=new Yt(n);return new ct(n,i,e._key,r,new Gt(t.hasPendingWrites,t.fromCache),e.converter)}var HD={maxAttempts:5};var xc=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ar(e)}set(e,t,r){this._verifyNotCommitted();let i=An(e,this._firestore),s=jc(i.converter,t,r),o=Lc(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,fe.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=An(e,this._firestore),o;return o=typeof(t=ae(t))=="string"||t instanceof mt?sg(this._dataReader,"WriteBatch.update",s._key,t,r,i):ig(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,fe.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=An(e,this._firestore);return this._mutations=this._mutations.concat(new kn(t._key,fe.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new v(g.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function An(n,e){if((n=ae(n)).firestore!==e)throw new v(g.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var bp=class extends class{constructor(t,r){this._firestore=t,this._transaction=r,this._dataReader=Ar(t)}get(t){let r=An(t,this._firestore),i=new Sp(this._firestore);return this._transaction.lookup([r._key]).then(s=>{if(!s||s.length!==1)return b();let o=s[0];if(o.isFoundDocument())return new Er(this._firestore,i,o.key,o,r.converter);if(o.isNoDocument())return new Er(this._firestore,i,r._key,null,r.converter);throw b()})}set(t,r,i){let s=An(t,this._firestore),o=jc(s.converter,r,i),a=Lc(this._dataReader,"Transaction.set",s._key,o,s.converter!==null,i);return this._transaction.set(s._key,a),this}update(t,r,i,...s){let o=An(t,this._firestore),a;return a=typeof(r=ae(r))=="string"||r instanceof mt?sg(this._dataReader,"Transaction.update",o._key,r,i,s):ig(this._dataReader,"Transaction.update",o._key,r),this._transaction.update(o._key,a),this}delete(t){let r=An(t,this._firestore);return this._transaction.delete(r._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=An(e,this._firestore),r=new Yt(this._firestore);return super.get(e).then(i=>new ct(this._firestore,r,t._key,i._document,new Gt(!1,!1),t.converter))}};function gT(n,e,t){n=Q(n,oe);let r=Object.assign(Object.assign({},HD),t);return function(s){if(s.maxAttempts<1)throw new v(g.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(s,o,a){let u=new Ie;return s.asyncQueue.enqueueAndForget(()=>m(this,null,function*(){let c=yield FD(s);new lp(s.asyncQueue,c,a,o,u).Ya()})),u.promise}(Ae(n),i=>e(new bp(n,i)),r)}function mT(){return new Fo("deleteField")}function yT(){return new vp("serverTimestamp")}function vT(...n){return new _p("arrayUnion",n)}function _T(...n){return new wp("arrayRemove",n)}function wT(n){return new Ep("increment",n)}(function(e,t=!0){(function(i){Ni=i})(Tm),ts(new Gn("firestore",(r,{instanceIdentifier:i,options:s})=>{let o=r.getProvider("app").getImmediate(),a=new oe(new Vd(r.getProvider("auth-internal")),new kd(r.getProvider("app-check-internal")),function(c,l){if(!Object.prototype.hasOwnProperty.apply(c.options,["projectId"]))throw new v(g.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Pn(c.options.projectId,l)}(o,i),o);return s=Object.assign({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),ln(ew,"4.5.0",e),ln(ew,"4.5.0","esm2017")})();var QD="@firebase/firestore-compat",YD="0.3.27";function vg(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new v("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function ET(){if(typeof Uint8Array>"u")throw new v("unimplemented","Uint8Arrays are not available in this environment.")}function IT(){if(!dE())throw new v("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Bc=class n{constructor(e){this._delegate=e}static fromBase64String(e){return IT(),new n(Lt.fromBase64String(e))}static fromUint8Array(e){return ET(),new n(Lt.fromUint8Array(e))}toBase64(){return IT(),this._delegate.toBase64()}toUint8Array(){return ET(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function fg(n){return XD(n,["next","error","complete"])}function XD(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var pg=class{enableIndexedDbPersistence(e,t){return NI(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return MI(e._delegate)}clearIndexedDbPersistence(e){return OI(e._delegate)}},qc=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Pn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&at("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){DI(this._delegate,e,t,r)}enableNetwork(){return LI(this._delegate)}disableNetwork(){return UI(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,eg("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return FI(this._delegate)}onSnapshotsInSync(e){return pT(this._delegate,e)}get app(){if(!this._appCompat)throw new v("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new qi(this,tg(this._delegate,e))}catch(t){throw ze(t,"collection()","Firestore.collection()")}}doc(e){try{return new Ut(this,Go(this._delegate,e))}catch(t){throw ze(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Dr(this,PI(this._delegate,e))}catch(t){throw ze(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return gT(this._delegate,t=>e(new $c(this,t)))}batch(){return Ae(this._delegate),new zc(new xc(this._delegate,e=>Ui(this._delegate,e)))}loadBundle(e){return jI(this._delegate,e)}namedQuery(e){return BI(this._delegate,e).then(t=>t?new Dr(this,t):null)}},ji=class extends xi{constructor(e){super(),this.firestore=e}convertBytes(e){return new Bc(new Lt(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return Ut.forKey(t,this.firestore,null)}};function JD(n){eE(n)}var $c=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new ji(e)}get(e){let t=Sr(e);return this._delegate.get(t).then(r=>new br(this._firestore,new ct(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Sr(e);return r?(vg("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Sr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Sr(e);return this._delegate.delete(t),this}},zc=class{constructor(e){this._delegate=e}set(e,t,r){let i=Sr(e);return r?(vg("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Sr(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Sr(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Bi=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new Sn(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Rr(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new ji(e),t),i.set(t,s)),s}};Bi.INSTANCES=new WeakMap;var Ut=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ji(e)}static forPath(e,t,r){if(e.length%2!==0)throw new v("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new te(t._delegate,r,new T(e)))}static forKey(e,t,r){return new n(t,new te(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new qi(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new qi(this.firestore,tg(this._delegate,e))}catch(t){throw ze(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=ae(e),e instanceof te?ng(this._delegate,e):!1}set(e,t){t=vg("DocumentReference.set",t);try{return t?cg(this._delegate,e,t):cg(this._delegate,e)}catch(r){throw ze(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?lg(this._delegate,e):lg(this._delegate,e,t,...r)}catch(i){throw ze(i,"updateDoc()","DocumentReference.update()")}}delete(){return dT(this._delegate)}onSnapshot(...e){let t=TT(e),r=AT(e,i=>new br(this.firestore,new ct(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return hg(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=aT(this._delegate):e?.source==="server"?t=uT(this._delegate):t=oT(this._delegate),t.then(r=>new br(this.firestore,new ct(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Bi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function ze(n,e,t){return n.message=n.message.replace(e,t),n}function TT(n){for(let e of n)if(typeof e=="object"&&!fg(e))return e;return{}}function AT(n,e){var t,r;let i;return fg(n[0])?i=n[0]:fg(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var br=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Ut(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return ug(this._delegate,e._delegate)}},Rr=class extends br{data(e){let t=this._delegate.data(e);return this._delegate._converter||tE(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Dr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new ji(e)}where(e,t,r){try{return new n(this.firestore,Jt(this._delegate,YI(e,t,r)))}catch(i){throw ze(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,Jt(this._delegate,XI(e,t)))}catch(r){throw ze(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,Jt(this._delegate,JI(e)))}catch(t){throw ze(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,Jt(this._delegate,ZI(e)))}catch(t){throw ze(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,Jt(this._delegate,eT(...e)))}catch(t){throw ze(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,Jt(this._delegate,tT(...e)))}catch(t){throw ze(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,Jt(this._delegate,nT(...e)))}catch(t){throw ze(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,Jt(this._delegate,rT(...e)))}catch(t){throw ze(t,"endAt()","Query.endAt()")}}isEqual(e){return rg(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=lT(this._delegate):e?.source==="server"?t=hT(this._delegate):t=cT(this._delegate),t.then(r=>new Ko(this.firestore,new yt(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=TT(e),r=AT(e,i=>new Ko(this.firestore,new yt(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return hg(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Bi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},gg=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Rr(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Ko=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Dr(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Rr(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new gg(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Rr(this._firestore,r))})}isEqual(e){return ug(this._delegate,e._delegate)}},qi=class n extends Dr{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new Ut(this.firestore,e):null}doc(e){try{return e===void 0?new Ut(this.firestore,Go(this._delegate)):new Ut(this.firestore,Go(this._delegate,e))}catch(t){throw ze(t,"doc()","CollectionReference.doc()")}}add(e){return fT(this._delegate,e).then(t=>new Ut(this.firestore,t))}isEqual(e){return ng(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Bi.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Sr(n){return Q(n,te)}var mg=class n{constructor(...e){this._delegate=new mt(...e)}static documentId(){return new n(ge.keyField().canonicalString())}isEqual(e){return e=ae(e),e instanceof mt?this._delegate._internalPath.isEqual(e._internalPath):!1}};var yg=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=yT();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=mT();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=vT(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=_T(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=wT(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var ZD={Firestore:qc,GeoPoint:wr,Timestamp:ue,Blob:Bc,Transaction:$c,WriteBatch:zc,DocumentReference:Ut,DocumentSnapshot:br,Query:Dr,QueryDocumentSnapshot:Rr,QuerySnapshot:Ko,CollectionReference:qi,FieldPath:mg,FieldValue:yg,setLogLevel:JD,CACHE_SIZE_UNLIMITED:VI};function eP(n,e){n.INTERNAL.registerComponent(new Gn("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},ZD)))}function tP(n){eP(n,(e,t)=>new qc(e,t,new pg)),n.registerVersion(QD,YD)}tP(je);function nP(n,e=Wo){return new Zt(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function CT(n,e){return nP(n,e)}function rP(n,e){return CT(n,e).pipe(Mr(void 0),Qo(),O(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function Eg(n,e){return CT(n,e).pipe(O(t=>({payload:t,type:"query"})))}var Gc=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=PT(r,t);return new Wc(i,s,this.afs)}snapshotChanges(){return rP(this.ref,this.afs.schedulers.outsideAngular).pipe(Ke)}valueChanges(e={}){return this.snapshotChanges().pipe(O(({payload:t})=>e.idField?se(D({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return ee(this.ref.get(e)).pipe(Ke)}};function Kc(n,e){return Eg(n,e).pipe(Mr(void 0),Qo(),O(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,u)=>{let c=s.find(h=>h.doc.ref.isEqual(a.ref)),l=r?.payload.docs.find(h=>h.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&l&&JSON.stringify(l.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:u,newIndex:u,type:"modified",doc:a}})}),o}))}function ST(n,e,t){return Kc(n,t).pipe(Nr((r,i)=>iP(r,i.map(s=>s.payload),e),[]),Ng(),O(r=>r.map(i=>({type:i.type,payload:i}))))}function iP(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=sP(n,r))}),n}function _g(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function sP(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return _g(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return _g(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return _g(n,e.oldIndex,1);break}return n}function bT(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var Wc=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Kc(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(O(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(Mr(void 0),Qo(),Ge(([r,i])=>i.length>0||!r),O(([,r])=>r),Ke)}auditTrail(e){return this.stateChanges(e).pipe(Nr((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=bT(e);return ST(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ke)}valueChanges(e={}){return Eg(this.query,this.afs.schedulers.outsideAngular).pipe(O(t=>t.payload.docs.map(r=>e.idField?se(D({},r.data()),{[e.idField]:r.id}):r.data())),Ke)}get(e){return ee(this.query.get(e)).pipe(Ke)}add(e){return this.ref.add(e)}doc(e){return new Gc(this.ref.doc(e),this.afs)}},wg=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?Kc(this.query,this.afs.schedulers.outsideAngular).pipe(Ke):Kc(this.query,this.afs.schedulers.outsideAngular).pipe(O(t=>t.filter(r=>e.indexOf(r.type)>-1)),Ge(t=>t.length>0),Ke)}auditTrail(e){return this.stateChanges(e).pipe(Nr((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=bT(e);return ST(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ke)}valueChanges(e={}){return Eg(this.query,this.afs.schedulers.outsideAngular).pipe(O(r=>r.payload.docs.map(i=>e.idField?D({[e.idField]:i.id},i.data()):i.data())),Ke)}get(e){return ee(this.query.get(e)).pipe(Ke)}},RT=new F("angularfire2.enableFirestorePersistence"),DT=new F("angularfire2.firestore.persistenceSettings"),oP=new F("angularfire2.firestore.settings"),aP=new F("angularfire2.firestore.use-emulator");function PT(n,e=t=>t){return{query:e(n),ref:n}}var uP=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,u,c,l,h,d,f,E,w,y,I,k){this.schedulers=u;let R=Ms(t,a,r),M=l;h&&Nh(R,a,d,E,w,y,f,I),[this.firestore,this.persistenceEnabled$]=Ya(`${R.name}.firestore`,"AngularFirestore",R.name,()=>{let j=a.runOutsideAngular(()=>R.firestore());if(s&&j.settings(s),M&&j.useEmulator(...M),i&&!zn(o)){let K=()=>{try{return ee(j.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(ce){return typeof console<"u"&&console.warn(ce),P(!1)}};return[j,a.runOutsideAngular(K)]}else return[j,P(!1)]},[s,M,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=PT(i,r),a=this.schedulers.ngZone.run(()=>s);return new Wc(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new wg(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new Gc(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(S(Qr),S(Yr,8),S(RT,8),S(oP,8),S(Qe),S(le),S(Ha),S(DT,8),S(aP,8),S(Mh,8),S(bh,8),S(Rh,8),S(Dh,8),S(Ph,8),S(Vh,8),S(xh,8),S(Xn,8))};static \u0275prov=$({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),EN=(()=>{class n{constructor(){je.registerVersion("angularfire",Jn.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:RT,useValue:!0},{provide:DT,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=Ue({type:n});static \u0275inj=Le({providers:[uP]})}return n})();export{jT as a,_P as b,$m as c,qP as d,$P as e,zP as f,Yn as g,G0 as h,Bt as i,My as j,xV as k,NV as l,Jn as m,Xn as n,Ha as o,zV as p,Ke as q,Qr as r,Yr as s,Ms as t,ZV as u,Ya as v,bh as w,Rh as x,Dh as y,Ph as z,Vh as A,xh as B,Nh as C,Mh as D,Fx as E,uP as F,EN as G,VA as H,ay as I,Xm as J,hs as K,uV as L,a0 as M,l0 as N,d0 as O,Sy as P,lV as Q,hV as R,dV as S};

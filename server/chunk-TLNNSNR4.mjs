import './polyfills.server.mjs';
import{A as Ra,Ca as ka,Da as Ls,Dc as $c,Hb as kr,I as pw,Ia as Bs,K as gw,Mb as fp,N as jc,Nb as _w,O as Gc,Q as up,Sa as _e,T as Hc,Tb as Sw,U as Mi,V as dp,Y as mw,Ya as Oa,_ as Kc,_a as Nr,aa as Rr,ac as pp,ba as xi,bb as In,bc as Tw,c as xs,ca as ir,ea as Fe,f as uw,ga as ee,gc as ww,h as zc,i as dw,ia as yw,jb as vw,jc as gp,k as Ir,l as Ps,la as Fs,m as An,n as Dr,na as sr,oa as Lt,r as st,rb as Pi,ta as hp,x as hw,ya as Na,z as fw}from"./chunk-WAP4PGVX.mjs";import{G as Ae,H as Fi,K as Dn,L as Qc,M as xa,N as Iw,O as Dw,P as Or,Q as wt,c as Ew,f as mp,g as Cw,h as Ma,l as yp,m as Wc,n as bw,o as Aw,x as vp}from"./chunk-B5JBQX2M.mjs";import{a as Ht,b as rr,c as le,f as T,h as cw,i as cp,j as g}from"./chunk-H6KHSOBK.mjs";var oe=T($t=>{"use strict";Object.defineProperty($t,"__esModule",{value:!0});$t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=$t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=$t.Propagate=$t.LogVerbosity=$t.Status=void 0;var B0=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(B0||($t.Status=B0={})),V0=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(V0||($t.LogVerbosity=V0={})),q0=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(q0||($t.Propagate=q0={}));$t.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;$t.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var Og=T((WH,ZM)=>{ZM.exports={name:"@grpc/grpc-js",version:"1.9.14",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Oe=T(Ct=>{"use strict";var Mg,xg,Pg,Fg;Object.defineProperty(Ct,"__esModule",{value:!0});Ct.isTracerEnabled=Ct.trace=Ct.log=Ct.setLoggerVerbosity=Ct.setLogger=Ct.getLogger=void 0;var Lr=oe(),ex=le("process"),tx=Og().version,nx={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},Hi=nx,Ws=Lr.LogVerbosity.ERROR,rx=(xg=(Mg=process.env.GRPC_NODE_VERBOSITY)!==null&&Mg!==void 0?Mg:process.env.GRPC_VERBOSITY)!==null&&xg!==void 0?xg:"";switch(rx.toUpperCase()){case"DEBUG":Ws=Lr.LogVerbosity.DEBUG;break;case"INFO":Ws=Lr.LogVerbosity.INFO;break;case"ERROR":Ws=Lr.LogVerbosity.ERROR;break;case"NONE":Ws=Lr.LogVerbosity.NONE;break;default:}var ix=()=>Hi;Ct.getLogger=ix;var sx=n=>{Hi=n};Ct.setLogger=sx;var ox=n=>{Ws=n};Ct.setLoggerVerbosity=ox;var ax=(n,...e)=>{let t;if(n>=Ws){switch(n){case Lr.LogVerbosity.DEBUG:t=Hi.debug;break;case Lr.LogVerbosity.INFO:t=Hi.info;break;case Lr.LogVerbosity.ERROR:t=Hi.error;break}t||(t=Hi.error),t&&t.bind(Hi)(...e)}};Ct.log=ax;var lx=(Fg=(Pg=process.env.GRPC_NODE_TRACE)!==null&&Pg!==void 0?Pg:process.env.GRPC_TRACE)!==null&&Fg!==void 0?Fg:"",Lg=new Set,U0=new Set;for(let n of lx.split(","))n.startsWith("-")?U0.add(n.substring(1)):Lg.add(n);var cx=Lg.has("all");function ux(n,e,t){z0(e)&&(0,Ct.log)(n,new Date().toISOString()+" | v"+tx+" "+ex.pid+" | "+e+" | "+t)}Ct.trace=ux;function z0(n){return!U0.has(n)&&(cx||Lg.has(n))}Ct.isTracerEnabled=z0});var Uu=T(Qs=>{"use strict";Object.defineProperty(Qs,"__esModule",{value:!0});Qs.getErrorCode=Qs.getErrorMessage=void 0;function dx(n){return n instanceof Error?n.message:String(n)}Qs.getErrorMessage=dx;function hx(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}Qs.getErrorCode=hx});var bt=T(ju=>{"use strict";Object.defineProperty(ju,"__esModule",{value:!0});ju.Metadata=void 0;var fx=Oe(),px=oe(),gx=Uu(),mx=/^[0-9a-z_.-]+$/,yx=/^[ -~]*$/;function vx(n){return mx.test(n)}function _x(n){return yx.test(n)}function G0(n){return n.endsWith("-bin")}function Sx(n){return!n.startsWith("grpc-")}function zu(n){return n.toLowerCase()}function j0(n,e){if(!vx(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(G0(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!_x(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var Bg=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=zu(e),j0(e,t),this.internalRepr.set(e,[t])}add(e,t){e=zu(e),j0(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=zu(e),this.internalRepr.delete(e)}get(e){return e=zu(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(Tx);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{G0(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(Sx(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,gx.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,fx.log)(px.LogVerbosity.ERROR,o)}}return t}};ju.Metadata=Bg;var Tx=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var jg=T(Gu=>{"use strict";Object.defineProperty(Gu,"__esModule",{value:!0});Gu.CallCredentials=void 0;var zg=bt();function wx(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var Ys=class n{static createFromMetadataGenerator(e){return new qg(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;wx(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new zg.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new Ug}};Gu.CallCredentials=Ys;var Vg=class n extends Ys{constructor(e){super(),this.creds=e}generateMetadata(e){return g(this,null,function*(){let t=new zg.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},qg=class n extends Ys{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new Vg([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},Ug=class n extends Ys{generateMetadata(e){return Promise.resolve(new zg.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var Hg=T(Xs=>{"use strict";Object.defineProperty(Xs,"__esModule",{value:!0});Xs.getDefaultRootsData=Xs.CIPHER_SUITES=void 0;var Ex=le("fs");Xs.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var H0=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,Gg=null;function Cx(){return H0?(Gg===null&&(Gg=Ex.readFileSync(H0)),Gg):null}Xs.getDefaultRootsData=Cx});var $u=T(Ku=>{"use strict";Object.defineProperty(Ku,"__esModule",{value:!0});Ku.ChannelCredentials=void 0;var bx=le("tls"),Ax=jg(),K0=Hg();function Kg(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var Js=class{constructor(e){this.callCredentials=e||Ax.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(Kg(e,"Root certificate"),Kg(t,"Private key"),Kg(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,bx.createSecureContext)({ca:(s=e??(0,K0.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:K0.CIPHER_SUITES});return new Hu(o,i??{})}static createFromSecureContext(e,t){return new Hu(e,t??{})}static createInsecure(){return new $g}};Ku.ChannelCredentials=Js;var $g=class n extends Js{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},Hu=class n extends Js{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new Wg(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},Wg=class n extends Js{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var Vr=T(pt=>{"use strict";Object.defineProperty(pt,"__esModule",{value:!0});pt.validateLoadBalancingConfig=pt.getFirstUsableConfig=pt.isLoadBalancerNameRegistered=pt.createLoadBalancer=pt.registerDefaultLoadBalancerType=pt.registerLoadBalancerType=pt.createChildChannelControlHelper=void 0;function Ix(n,e){var t,r,i,s,o,a,l,c,u,d;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(d=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&d!==void 0?d:n.removeChannelzChild.bind(n)}}pt.createChildChannelControlHelper=Ix;var Br={},Qg=null;function Dx(n,e,t){Br[n]={LoadBalancer:e,LoadBalancingConfig:t}}pt.registerLoadBalancerType=Dx;function Rx(n){Qg=n}pt.registerDefaultLoadBalancerType=Rx;function Nx(n,e){let t=n.getLoadBalancerName();return t in Br?new Br[t].LoadBalancer(e):null}pt.createLoadBalancer=Nx;function kx(n){return n in Br}pt.isLoadBalancerNameRegistered=kx;function Ox(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in Br)return t;return e&&Qg?new Br[Qg].LoadBalancingConfig:null}pt.getFirstUsableConfig=Ox;function Mx(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in Br)return Br[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}pt.validateLoadBalancingConfig=Mx});var Yg=T(qr=>{"use strict";Object.defineProperty(qr,"__esModule",{value:!0});qr.extractAndSelectServiceConfig=qr.validateServiceConfig=qr.validateRetryThrottling=void 0;var xx=le("os"),Wu=oe(),Px=Vr(),Qu=/^\d+(\.\d{1,9})?s$/,Fx="node";function Lx(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function Bx(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!Qu.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!Qu.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(Wu.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(Wu.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function Vx(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!Qu.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(Wu.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(Wu.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function qx(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(Lx(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&Qu.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=Bx(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=Vx(n.hedgingPolicy));return t}function $0(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}qr.validateRetryThrottling=$0;function W0(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,Px.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(qx(r));"retryThrottling"in n&&(e.retryThrottling=$0(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}qr.validateServiceConfig=W0;function Ux(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:W0(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function zx(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=Ux(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===xx.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===Fx&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function jx(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return zx(i,e)}return null}qr.extractAndSelectServiceConfig=jx});var Wt=T(Yu=>{"use strict";Object.defineProperty(Yu,"__esModule",{value:!0});Yu.ConnectivityState=void 0;var Q0=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(Q0||(Yu.ConnectivityState=Q0={}))});var Vt=T(Ur=>{"use strict";Object.defineProperty(Ur,"__esModule",{value:!0});Ur.uriToString=Ur.splitHostPort=Ur.parseUri=void 0;var Gx=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function Hx(n){let e=Gx.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}Ur.parseUri=Hx;var Y0=/^\d+$/;function Kx(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return Y0.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?Y0.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}Ur.splitHostPort=Kx;function $x(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}Ur.uriToString=$x});var On=T(Qt=>{"use strict";Object.defineProperty(Qt,"__esModule",{value:!0});Qt.mapUriDefaultScheme=Qt.getDefaultAuthority=Qt.createResolver=Qt.registerDefaultScheme=Qt.registerResolver=void 0;var Jg=Vt(),Zs={},Xg=null;function Wx(n,e){Zs[n]=e}Qt.registerResolver=Wx;function Qx(n){Xg=n}Qt.registerDefaultScheme=Qx;function Yx(n,e,t){if(n.scheme!==void 0&&n.scheme in Zs)return new Zs[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,Jg.uriToString)(n)}`)}Qt.createResolver=Yx;function Xx(n){if(n.scheme!==void 0&&n.scheme in Zs)return Zs[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,Jg.uriToString)(n)}`)}Qt.getDefaultAuthority=Xx;function Jx(n){return n.scheme===void 0||!(n.scheme in Zs)?Xg!==null?{scheme:Xg,authority:void 0,path:(0,Jg.uriToString)(n)}:null:n}Qt.mapUriDefaultScheme=Jx});var jr=T(zr=>{"use strict";Object.defineProperty(zr,"__esModule",{value:!0});zr.QueuePicker=zr.UnavailablePicker=zr.PickResultType=void 0;var Zx=bt(),eP=oe(),Xu=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(Xu||(zr.PickResultType=Xu={})),Zg=class{constructor(e){this.status=Object.assign({code:eP.Status.UNAVAILABLE,details:"No connection established",metadata:new Zx.Metadata},e)}pick(e){return{pickResultType:Xu.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};zr.UnavailablePicker=Zg;var em=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:Xu.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};zr.QueuePicker=em});var ul=T(Ju=>{"use strict";Object.defineProperty(Ju,"__esModule",{value:!0});Ju.BackoffTimeout=void 0;var tP=1e3,nP=1.6,rP=12e4,iP=.2;function sP(n,e){return Math.random()*(e-n)+n}var tm=class{constructor(e,t){this.callback=e,this.initialDelay=tP,this.multiplier=nP,this.maxDelay=rP,this.jitter=iP,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+sP(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};Ju.BackoffTimeout=tm});var ed=T(Zu=>{"use strict";Object.defineProperty(Zu,"__esModule",{value:!0});Zu.ChildLoadBalancerHandler=void 0;var oP=Vr(),aP=Wt(),lP="child_load_balancer_helper",nm=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===aP.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,oP.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return lP}};Zu.ChildLoadBalancerHandler=nm});var J0=T(td=>{"use strict";Object.defineProperty(td,"__esModule",{value:!0});td.ResolvingLoadBalancer=void 0;var cP=Vr(),uP=Yg(),Ot=Wt(),dP=On(),eo=jr(),hP=ul(),rm=oe(),fP=bt(),pP=Oe(),gP=oe(),mP=Vt(),yP=ed(),vP="resolving_load_balancer";function X0(n){pP.trace(gP.LogVerbosity.DEBUG,vP,n)}var _P=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function SP(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function TP(n,e,t,r){for(let i of t)if(SP(n,e,i,r))return i;return null}function wP(n){return function(t,r){var i,s;let o=t.split("/").filter(c=>c.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of _P){let u=TP(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:rm.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:rm.Status.OK,dynamicFilterFactories:[]}}}var im=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=Ot.ConnectivityState.IDLE,this.latestChildPicker=new eo.QueuePicker(this),this.currentState=Ot.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,uP.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(Ot.ConnectivityState.IDLE,new eo.QueuePicker(this)),this.childLoadBalancer=new yP.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(X0("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,dP.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,d)=>{var h;this.backoffTimeout.stop(),this.backoffTimeout.reset();let p=null;l===null?c===null?(this.previousServiceConfig=null,p=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):p=this.previousServiceConfig:(p=l,this.previousServiceConfig=l);let y=(h=p?.loadBalancingConfig)!==null&&h!==void 0?h:[],_=(0,cP.getFirstUsableConfig)(y,!0);if(_===null){this.handleResolutionFailure({code:rm.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new fP.Metadata});return}this.childLoadBalancer.updateAddressList(a,_,d);let S=p??this.defaultServiceConfig;this.onSuccessfulResolution(S,u??wP(S))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new hP.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===Ot.ConnectivityState.IDLE&&this.updateState(Ot.ConnectivityState.CONNECTING,new eo.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){X0((0,mP.uriToString)(this.target)+" "+Ot.ConnectivityState[this.currentState]+" -> "+Ot.ConnectivityState[e]),e===Ot.ConnectivityState.IDLE&&(t=new eo.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===Ot.ConnectivityState.IDLE&&(this.updateState(Ot.ConnectivityState.TRANSIENT_FAILURE,new eo.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===Ot.ConnectivityState.IDLE||this.currentState===Ot.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=Ot.ConnectivityState.IDLE,this.latestChildPicker=new eo.QueuePicker(this),this.currentState=Ot.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};td.ResolvingLoadBalancer=im});var Z0=T(to=>{"use strict";Object.defineProperty(to,"__esModule",{value:!0});to.channelOptionsEqual=to.recognizedOptions=void 0;to.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function EP(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}to.channelOptionsEqual=EP});var xn=T(Mn=>{"use strict";Object.defineProperty(Mn,"__esModule",{value:!0});Mn.stringToSubchannelAddress=Mn.subchannelAddressToString=Mn.subchannelAddressEqual=Mn.isTcpSubchannelAddress=void 0;var CP=le("net");function dl(n){return"port"in n}Mn.isTcpSubchannelAddress=dl;function bP(n,e){return!n&&!e?!0:!n||!e?!1:dl(n)?dl(e)&&n.host===e.host&&n.port===e.port:!dl(e)&&n.path===e.path}Mn.subchannelAddressEqual=bP;function AP(n){return dl(n)?n.host+":"+n.port:n.path}Mn.subchannelAddressToString=AP;var IP=443;function DP(n,e){return(0,CP.isIP)(n)?{host:n,port:e??IP}:{path:n}}Mn.stringToSubchannelAddress=DP});var nd=T(no=>{"use strict";Object.defineProperty(no,"__esModule",{value:!0});no.addAdminServicesToServer=no.registerAdminService=void 0;var eC=[];function RP(n,e){eC.push({getServiceDefinition:n,getHandlers:e})}no.registerAdminService=RP;function NP(n){for(let{getServiceDefinition:e,getHandlers:t}of eC)n.addService(e(),t())}no.addAdminServicesToServer=NP});var tC=T(Yt=>{"use strict";Object.defineProperty(Yt,"__esModule",{value:!0});Yt.ClientDuplexStreamImpl=Yt.ClientWritableStreamImpl=Yt.ClientReadableStreamImpl=Yt.ClientUnaryCallImpl=Yt.callErrorFromStatus=void 0;var kP=le("events"),cm=le("stream"),hl=oe();function OP(n,e){let t=`${n.code} ${hl.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}Yt.callErrorFromStatus=OP;var sm=class extends kP.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(hl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};Yt.ClientUnaryCallImpl=sm;var om=class extends cm.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(hl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};Yt.ClientReadableStreamImpl=om;var am=class extends cm.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(hl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Yt.ClientWritableStreamImpl=am;var lm=class extends cm.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(hl.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};Yt.ClientDuplexStreamImpl=lm});var nC=T(ro=>{"use strict";Object.defineProperty(ro,"__esModule",{value:!0});ro.InterceptingListenerImpl=ro.isInterceptingListener=void 0;function MP(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}ro.isInterceptingListener=MP;var um=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};ro.InterceptingListenerImpl=um});var ym=T(Xt=>{"use strict";Object.defineProperty(Xt,"__esModule",{value:!0});Xt.getInterceptingCall=Xt.InterceptingCall=Xt.RequesterBuilder=Xt.ListenerBuilder=Xt.InterceptorConfigurationError=void 0;var xP=bt(),rC=nC(),iC=oe(),sC=Uu(),pl=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};Xt.InterceptorConfigurationError=pl;var hm=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};Xt.ListenerBuilder=hm;var fm=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};Xt.RequesterBuilder=fm;var dm={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},fl={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},pm=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:fl.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:fl.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:fl.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:fl.cancel}:this.requester=fl}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,d)=>{var h,p,y;this.processingMetadata=!1;let _;if((0,rC.isInterceptingListener)(d))_=d;else{let S={onReceiveMetadata:(h=d.onReceiveMetadata)!==null&&h!==void 0?h:dm.onReceiveMetadata,onReceiveMessage:(p=d.onReceiveMessage)!==null&&p!==void 0?p:dm.onReceiveMessage,onReceiveStatus:(y=d.onReceiveStatus)!==null&&y!==void 0?y:dm.onReceiveStatus};_=new rC.InterceptingListenerImpl(S,c)}this.nextCall.start(u,_),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};Xt.InterceptingCall=pm;function PP(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var rd=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(iC.Status.INTERNAL,`Request message serialization failure: ${(0,sC.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:iC.Status.INTERNAL,details:`Response message parsing error: ${(0,sC.getErrorMessage)(a)}`,metadata:new xP.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},gm=class extends rd{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},mm=class extends rd{};function FP(n,e,t){let r=PP(n,t.path,e);return t.responseStream?new mm(r,t):new gm(r,t)}function LP(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new pl("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new pl("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>c=>l(c,a),a=>FP(r,a,e))(s)}Xt.getInterceptingCall=LP});var Sm=T(sd=>{"use strict";Object.defineProperty(sd,"__esModule",{value:!0});sd.Client=void 0;var Pn=tC(),BP=Tm(),VP=Wt(),Gr=oe(),io=bt(),id=ym(),hn=Symbol(),so=Symbol(),oo=Symbol(),lr=Symbol();function vm(n){return typeof n=="function"}function ao(n){return n.stack.split(`
`).slice(1).join(`
`)}var _m=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[so]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[oo]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[so].length>0&&this[oo].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[lr]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[hn]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[hn]=o(e,t,r)}else this[hn]=new BP.ChannelImplementation(e,t,r)}close(){this[hn].close()}getChannel(){return this[hn]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[hn].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===VP.ConnectivityState.READY)t();else try{this[hn].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(vm(e))return{metadata:new io.Metadata,options:{},callback:e};if(vm(t))return e instanceof io.Metadata?{metadata:e,options:{},callback:t}:{metadata:new io.Metadata,options:e,callback:t};if(!(e instanceof io.Metadata&&t instanceof Object&&vm(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),d={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},h={argument:i,metadata:u.metadata,call:new Pn.ClientUnaryCallImpl,channel:this[hn],methodDefinition:d,callOptions:u.options,callback:u.callback};this[lr]&&(h=this[lr](h));let p=h.call,y={clientInterceptors:this[so],clientInterceptorProviders:this[oo],callInterceptors:(l=h.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=h.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},_=(0,id.getInterceptingCall)(y,h.methodDefinition,h.callOptions,h.channel);p.call=_;let S=null,R=!1,w=new Error;return _.start(h.metadata,{onReceiveMetadata:N=>{p.emit("metadata",N)},onReceiveMessage(N){S!==null&&_.cancelWithStatus(Gr.Status.INTERNAL,"Too many responses received"),S=N},onReceiveStatus(N){if(!R){if(R=!0,N.code===Gr.Status.OK)if(S===null){let k=ao(w);h.callback((0,Pn.callErrorFromStatus)({code:Gr.Status.INTERNAL,details:"No message received",metadata:N.metadata},k))}else h.callback(null,S);else{let k=ao(w);h.callback((0,Pn.callErrorFromStatus)(N,k))}w=null,p.emit("status",N)}}}),_.sendMessage(i),_.halfClose(),p}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(i,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},d={metadata:c.metadata,call:new Pn.ClientWritableStreamImpl(t),channel:this[hn],methodDefinition:u,callOptions:c.options,callback:c.callback};this[lr]&&(d=this[lr](d));let h=d.call,p={clientInterceptors:this[so],clientInterceptorProviders:this[oo],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},y=(0,id.getInterceptingCall)(p,d.methodDefinition,d.callOptions,d.channel);h.call=y;let _=null,S=!1,R=new Error;return y.start(d.metadata,{onReceiveMetadata:w=>{h.emit("metadata",w)},onReceiveMessage(w){_!==null&&y.cancelWithStatus(Gr.Status.INTERNAL,"Too many responses received"),_=w},onReceiveStatus(w){if(!S){if(S=!0,w.code===Gr.Status.OK)if(_===null){let N=ao(R);d.callback((0,Pn.callErrorFromStatus)({code:Gr.Status.INTERNAL,details:"No message received",metadata:w.metadata},N))}else d.callback(null,_);else{let N=ao(R);d.callback((0,Pn.callErrorFromStatus)(w,N))}R=null,h.emit("status",w)}}}),h}checkMetadataAndOptions(e,t){let r,i;return e instanceof io.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new io.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},d={argument:i,metadata:c.metadata,call:new Pn.ClientReadableStreamImpl(r),channel:this[hn],methodDefinition:u,callOptions:c.options};this[lr]&&(d=this[lr](d));let h=d.call,p={clientInterceptors:this[so],clientInterceptorProviders:this[oo],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},y=(0,id.getInterceptingCall)(p,d.methodDefinition,d.callOptions,d.channel);h.call=y;let _=!1,S=new Error;return y.start(d.metadata,{onReceiveMetadata(R){h.emit("metadata",R)},onReceiveMessage(R){h.push(R)},onReceiveStatus(R){if(!_){if(_=!0,h.push(null),R.code!==Gr.Status.OK){let w=ao(S);h.emit("error",(0,Pn.callErrorFromStatus)(R,w))}S=null,h.emit("status",R)}}}),y.sendMessage(i),y.halfClose(),h}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new Pn.ClientDuplexStreamImpl(t,r),channel:this[hn],methodDefinition:c,callOptions:l.options};this[lr]&&(u=this[lr](u));let d=u.call,h={clientInterceptors:this[so],clientInterceptorProviders:this[oo],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},p=(0,id.getInterceptingCall)(h,u.methodDefinition,u.callOptions,u.channel);d.call=p;let y=!1,_=new Error;return p.start(u.metadata,{onReceiveMetadata(S){d.emit("metadata",S)},onReceiveMessage(S){d.push(S)},onReceiveStatus(S){if(!y){if(y=!0,d.push(null),S.code!==Gr.Status.OK){let R=ao(_);d.emit("error",(0,Pn.callErrorFromStatus)(S,R))}_=null,d.emit("status",S)}}}),d}};sd.Client=_m});var Em=T(lo=>{"use strict";Object.defineProperty(lo,"__esModule",{value:!0});lo.loadPackageDefinition=lo.makeClientConstructor=void 0;var gl=Sm(),qP={unary:gl.Client.prototype.makeUnaryRequest,server_stream:gl.Client.prototype.makeServerStreamRequest,client_stream:gl.Client.prototype.makeClientStreamRequest,bidi:gl.Client.prototype.makeBidiStreamRequest};function wm(n){return["__proto__","prototype","constructor"].includes(n)}function oC(n,e,t){t||(t={});class r extends gl.Client{}return Object.keys(n).forEach(i=>{if(wm(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=UP(qP[o],s.path,a,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!wm(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}lo.makeClientConstructor=oC;function UP(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function zP(n){return"format"in n}function jP(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>wm(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];zP(r)?o[s]=r:o[s]=oC(r,s,{})}return e}lo.loadPackageDefinition=jP});var kC=T((SK,NC)=>{"use strict";var GP=1/0,HP="[object Symbol]",KP=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,$P=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ad="\\ud800-\\udfff",pC="\\u0300-\\u036f\\ufe20-\\ufe23",gC="\\u20d0-\\u20f0",mC="\\u2700-\\u27bf",yC="a-z\\xdf-\\xf6\\xf8-\\xff",WP="\\xac\\xb1\\xd7\\xf7",QP="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",YP="\\u2000-\\u206f",XP=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",vC="A-Z\\xc0-\\xd6\\xd8-\\xde",_C="\\ufe0e\\ufe0f",SC=WP+QP+YP+XP,bm="['\u2019]",JP="["+ad+"]",aC="["+SC+"]",od="["+pC+gC+"]",TC="\\d+",ZP="["+mC+"]",wC="["+yC+"]",EC="[^"+ad+SC+TC+mC+yC+vC+"]",Cm="\\ud83c[\\udffb-\\udfff]",eF="(?:"+od+"|"+Cm+")",CC="[^"+ad+"]",Am="(?:\\ud83c[\\udde6-\\uddff]){2}",Im="[\\ud800-\\udbff][\\udc00-\\udfff]",co="["+vC+"]",bC="\\u200d",lC="(?:"+wC+"|"+EC+")",tF="(?:"+co+"|"+EC+")",cC="(?:"+bm+"(?:d|ll|m|re|s|t|ve))?",uC="(?:"+bm+"(?:D|LL|M|RE|S|T|VE))?",AC=eF+"?",IC="["+_C+"]?",nF="(?:"+bC+"(?:"+[CC,Am,Im].join("|")+")"+IC+AC+")*",DC=IC+AC+nF,rF="(?:"+[ZP,Am,Im].join("|")+")"+DC,iF="(?:"+[CC+od+"?",od,Am,Im,JP].join("|")+")",sF=RegExp(bm,"g"),oF=RegExp(od,"g"),aF=RegExp(Cm+"(?="+Cm+")|"+iF+DC,"g"),lF=RegExp([co+"?"+wC+"+"+cC+"(?="+[aC,co,"$"].join("|")+")",tF+"+"+uC+"(?="+[aC,co+lC,"$"].join("|")+")",co+"?"+lC+"+"+cC,co+"+"+uC,TC,rF].join("|"),"g"),cF=RegExp("["+bC+ad+pC+gC+_C+"]"),uF=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,dF={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},hF=typeof global=="object"&&global&&global.Object===Object&&global,fF=typeof self=="object"&&self&&self.Object===Object&&self,pF=hF||fF||Function("return this")();function gF(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function mF(n){return n.split("")}function yF(n){return n.match(KP)||[]}function vF(n){return function(e){return n?.[e]}}var _F=vF(dF);function RC(n){return cF.test(n)}function SF(n){return uF.test(n)}function TF(n){return RC(n)?wF(n):mF(n)}function wF(n){return n.match(aF)||[]}function EF(n){return n.match(lF)||[]}var CF=Object.prototype,bF=CF.toString,dC=pF.Symbol,hC=dC?dC.prototype:void 0,fC=hC?hC.toString:void 0;function AF(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function IF(n){if(typeof n=="string")return n;if(OF(n))return fC?fC.call(n):"";var e=n+"";return e=="0"&&1/n==-GP?"-0":e}function DF(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:AF(n,e,t)}function RF(n){return function(e){e=ld(e);var t=RC(e)?TF(e):void 0,r=t?t[0]:e.charAt(0),i=t?DF(t,1).join(""):e.slice(1);return r[n]()+i}}function NF(n){return function(e){return gF(LF(PF(e).replace(sF,"")),n,"")}}function kF(n){return!!n&&typeof n=="object"}function OF(n){return typeof n=="symbol"||kF(n)&&bF.call(n)==HP}function ld(n){return n==null?"":IF(n)}var MF=NF(function(n,e,t){return e=e.toLowerCase(),n+(t?xF(e):e)});function xF(n){return FF(ld(n).toLowerCase())}function PF(n){return n=ld(n),n&&n.replace($P,_F).replace(oF,"")}var FF=RF("toUpperCase");function LF(n,e,t){return n=ld(n),e=t?void 0:e,e===void 0?SF(n)?EF(n):yF(n):n.match(e)||[]}NC.exports=MF});var Dm=T((TK,OC)=>{"use strict";OC.exports=BF;function BF(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var d=new Array(arguments.length-1),h=0;h<d.length;)d[h++]=arguments[h];a.apply(null,d)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var FC=T(PC=>{"use strict";var cd=PC;cd.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var uo=new Array(64),xC=new Array(123);for(fn=0;fn<64;)xC[uo[fn]=fn<26?fn+65:fn<52?fn+71:fn<62?fn-4:fn-59|43]=fn++;var fn;cd.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var c=e[t++];switch(a){case 0:s[o++]=uo[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=uo[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=uo[l|c>>6],s[o++]=uo[c&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=uo[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var MC="invalid encoding";cd.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=xC[l])===void 0)throw Error(MC);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(MC);return r-i};cd.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var BC=T((EK,LC)=>{"use strict";LC.exports=ud;function ud(){this._listeners={}}ud.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};ud.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};ud.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var HC=T((CK,GC)=>{"use strict";GC.exports=VC(VC);function VC(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o}():function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,qC),n.writeFloatBE=e.bind(null,UC);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,zC),n.readFloatBE=t.bind(null,jC)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o}():function(){function e(r,i,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,r(u>>>0,a,l+i),r((c<<31|u/4294967296)>>>0,a,l+s);else{var d=Math.floor(Math.log(o)/Math.LN2);d===1024&&(d=1023),u=o*Math.pow(2,-d),r(u*4503599627370496>>>0,a,l+i),r((c<<31|d+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,qC,0,4),n.writeDoubleBE=e.bind(null,UC,4,0);function t(r,i,s,o,a){var l=r(o,a+i),c=r(o,a+s),u=(c>>31)*2+1,d=c>>>20&2047,h=4294967296*(c&1048575)+l;return d===2047?h?NaN:u*(1/0):d===0?u*5e-324*h:u*Math.pow(2,d-1075)*(h+4503599627370496)}n.readDoubleLE=t.bind(null,zC,0,4),n.readDoubleBE=t.bind(null,jC,4,0)}(),n}function qC(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function UC(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function zC(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function jC(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var Rm=T((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var $C=T(KC=>{"use strict";var Nm=KC;Nm.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};Nm.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};Nm.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var QC=T((AK,WC)=>{"use strict";WC.exports=VF;function VF(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var XC=T((IK,YC)=>{"use strict";YC.exports=Je;var ml=Fn();function Je(n,e){this.lo=n>>>0,this.hi=e>>>0}var Ki=Je.zero=new Je(0,0);Ki.toNumber=function(){return 0};Ki.zzEncode=Ki.zzDecode=function(){return this};Ki.length=function(){return 1};var qF=Je.zeroHash="\0\0\0\0\0\0\0\0";Je.fromNumber=function(e){if(e===0)return Ki;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new Je(r,i)};Je.from=function(e){if(typeof e=="number")return Je.fromNumber(e);if(ml.isString(e))if(ml.Long)e=ml.Long.fromString(e);else return Je.fromNumber(parseInt(e,10));return e.low||e.high?new Je(e.low>>>0,e.high>>>0):Ki};Je.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};Je.prototype.toLong=function(e){return ml.Long?new ml.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var Hr=String.prototype.charCodeAt;Je.fromHash=function(e){return e===qF?Ki:new Je((Hr.call(e,0)|Hr.call(e,1)<<8|Hr.call(e,2)<<16|Hr.call(e,3)<<24)>>>0,(Hr.call(e,4)|Hr.call(e,5)<<8|Hr.call(e,6)<<16|Hr.call(e,7)<<24)>>>0)};Je.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};Je.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};Je.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};Je.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var Fn=T(km=>{"use strict";var U=km;U.asPromise=Dm();U.base64=FC();U.EventEmitter=BC();U.float=HC();U.inquire=Rm();U.utf8=$C();U.pool=QC();U.LongBits=XC();U.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);U.global=U.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||km;U.emptyArray=Object.freeze?Object.freeze([]):[];U.emptyObject=Object.freeze?Object.freeze({}):{};U.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};U.isString=function(e){return typeof e=="string"||e instanceof String};U.isObject=function(e){return e&&typeof e=="object"};U.isset=U.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};U.Buffer=function(){try{var n=U.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();U._Buffer_from=null;U._Buffer_allocUnsafe=null;U.newBuffer=function(e){return typeof e=="number"?U.Buffer?U._Buffer_allocUnsafe(e):new U.Array(e):U.Buffer?U._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};U.Array=typeof Uint8Array<"u"?Uint8Array:Array;U.Long=U.global.dcodeIO&&U.global.dcodeIO.Long||U.global.Long||U.inquire("long");U.key2Re=/^true|false|0|1$/;U.key32Re=/^-?(?:0|[1-9][0-9]*)$/;U.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;U.longToHash=function(e){return e?U.LongBits.from(e).toHash():U.LongBits.zeroHash};U.longFromHash=function(e,t){var r=U.LongBits.fromHash(e);return U.Long?U.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function JC(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}U.merge=JC;U.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function ZC(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&JC(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}U.newError=ZC;U.ProtocolError=ZC("ProtocolError");U.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};U.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};U.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};U._configure=function(){var n=U.Buffer;if(!n){U._Buffer_from=U._Buffer_allocUnsafe=null;return}U._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},U._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var hd=T((RK,rb)=>{"use strict";rb.exports=se;var Jt=Fn(),Om,dd=Jt.LongBits,eb=Jt.base64,tb=Jt.utf8;function yl(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function xm(){}function UF(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function se(){this.len=0,this.head=new yl(xm,0,0),this.tail=this.head,this.states=null}var nb=function(){return Jt.Buffer?function(){return(se.create=function(){return new Om})()}:function(){return new se}};se.create=nb();se.alloc=function(e){return new Jt.Array(e)};Jt.Array!==Array&&(se.alloc=Jt.pool(se.alloc,Jt.Array.prototype.subarray));se.prototype._push=function(e,t,r){return this.tail=this.tail.next=new yl(e,t,r),this.len+=t,this};function Pm(n,e,t){e[t]=n&255}function zF(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function Fm(n,e){this.len=n,this.next=void 0,this.val=e}Fm.prototype=Object.create(yl.prototype);Fm.prototype.fn=zF;se.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new Fm((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};se.prototype.int32=function(e){return e<0?this._push(Lm,10,dd.fromNumber(e)):this.uint32(e)};se.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Lm(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}se.prototype.uint64=function(e){var t=dd.from(e);return this._push(Lm,t.length(),t)};se.prototype.int64=se.prototype.uint64;se.prototype.sint64=function(e){var t=dd.from(e).zzEncode();return this._push(Lm,t.length(),t)};se.prototype.bool=function(e){return this._push(Pm,1,e?1:0)};function Mm(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}se.prototype.fixed32=function(e){return this._push(Mm,4,e>>>0)};se.prototype.sfixed32=se.prototype.fixed32;se.prototype.fixed64=function(e){var t=dd.from(e);return this._push(Mm,4,t.lo)._push(Mm,4,t.hi)};se.prototype.sfixed64=se.prototype.fixed64;se.prototype.float=function(e){return this._push(Jt.float.writeFloatLE,4,e)};se.prototype.double=function(e){return this._push(Jt.float.writeDoubleLE,8,e)};var jF=Jt.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};se.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(Pm,1,0);if(Jt.isString(e)){var r=se.alloc(t=eb.length(e));eb.decode(e,r,0),e=r}return this.uint32(t)._push(jF,t,e)};se.prototype.string=function(e){var t=tb.length(e);return t?this.uint32(t)._push(tb.write,t,e):this._push(Pm,1,0)};se.prototype.fork=function(){return this.states=new UF(this),this.head=this.tail=new yl(xm,0,0),this.len=0,this};se.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new yl(xm,0,0),this.len=0),this};se.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};se.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};se._configure=function(n){Om=n,se.create=nb(),Om._configure()}});var ob=T((NK,sb)=>{"use strict";sb.exports=Ln;var ib=hd();(Ln.prototype=Object.create(ib.prototype)).constructor=Ln;var Kr=Fn();function Ln(){ib.call(this)}Ln._configure=function(){Ln.alloc=Kr._Buffer_allocUnsafe,Ln.writeBytesBuffer=Kr.Buffer&&Kr.Buffer.prototype instanceof Uint8Array&&Kr.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};Ln.prototype.bytes=function(e){Kr.isString(e)&&(e=Kr._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Ln.writeBytesBuffer,t,e),this};function GF(n,e,t){n.length<40?Kr.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}Ln.prototype.string=function(e){var t=Kr.Buffer.byteLength(e);return this.uint32(t),t&&this._push(GF,t,e),this};Ln._configure()});var pd=T((kK,db)=>{"use strict";db.exports=Le;var pn=Fn(),Vm,cb=pn.LongBits,HF=pn.utf8;function gn(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function Le(n){this.buf=n,this.pos=0,this.len=n.length}var ab=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Le(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Le(e);throw Error("illegal buffer")},ub=function(){return pn.Buffer?function(t){return(Le.create=function(i){return pn.Buffer.isBuffer(i)?new Vm(i):ab(i)})(t)}:ab};Le.create=ub();Le.prototype._slice=pn.Array.prototype.subarray||pn.Array.prototype.slice;Le.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,gn(this,10);return e}}();Le.prototype.int32=function(){return this.uint32()|0};Le.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Bm(){var n=new cb(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw gn(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw gn(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}Le.prototype.bool=function(){return this.uint32()!==0};function fd(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}Le.prototype.fixed32=function(){if(this.pos+4>this.len)throw gn(this,4);return fd(this.buf,this.pos+=4)};Le.prototype.sfixed32=function(){if(this.pos+4>this.len)throw gn(this,4);return fd(this.buf,this.pos+=4)|0};function lb(){if(this.pos+8>this.len)throw gn(this,8);return new cb(fd(this.buf,this.pos+=4),fd(this.buf,this.pos+=4))}Le.prototype.float=function(){if(this.pos+4>this.len)throw gn(this,4);var e=pn.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Le.prototype.double=function(){if(this.pos+8>this.len)throw gn(this,4);var e=pn.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Le.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw gn(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=pn.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};Le.prototype.string=function(){var e=this.bytes();return HF.read(e,0,e.length)};Le.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw gn(this,e);this.pos+=e}else do if(this.pos>=this.len)throw gn(this);while(this.buf[this.pos++]&128);return this};Le.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};Le._configure=function(n){Vm=n,Le.create=ub(),Vm._configure();var e=pn.Long?"toLong":"toNumber";pn.merge(Le.prototype,{int64:function(){return Bm.call(this)[e](!1)},uint64:function(){return Bm.call(this)[e](!0)},sint64:function(){return Bm.call(this).zzDecode()[e](!1)},fixed64:function(){return lb.call(this)[e](!0)},sfixed64:function(){return lb.call(this)[e](!1)}})}});var gb=T((OK,pb)=>{"use strict";pb.exports=$i;var fb=pd();($i.prototype=Object.create(fb.prototype)).constructor=$i;var hb=Fn();function $i(n){fb.call(this,n)}$i._configure=function(){hb.Buffer&&($i.prototype._slice=hb.Buffer.prototype.slice)};$i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};$i._configure()});var yb=T((MK,mb)=>{"use strict";mb.exports=vl;var qm=Fn();(vl.prototype=Object.create(qm.EventEmitter.prototype)).constructor=vl;function vl(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");qm.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}vl.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return qm.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof r))try{c=r[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};vl.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var Um=T(vb=>{"use strict";var KF=vb;KF.Service=yb()});var zm=T((PK,_b)=>{"use strict";_b.exports={}});var wb=T(Tb=>{"use strict";var Mt=Tb;Mt.build="minimal";Mt.Writer=hd();Mt.BufferWriter=ob();Mt.Reader=pd();Mt.BufferReader=gb();Mt.util=Fn();Mt.rpc=Um();Mt.roots=zm();Mt.configure=Sb;function Sb(){Mt.util._configure(),Mt.Writer._configure(Mt.BufferWriter),Mt.Reader._configure(Mt.BufferReader)}Sb()});var Cb=T((LK,Eb)=>{"use strict";Eb.exports=jm;function jm(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(jm.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var d=new Array(arguments.length-1),h=0;h<d.length;)d[h]=arguments[++h];if(h=0,s=s.replace(/%([%dfijs])/g,function(y,_){var S=d[h++];switch(_){case"d":case"f":return String(Number(S));case"i":return String(Math.floor(S));case"j":return JSON.stringify(S);case"s":return String(S)}return"%"}),h!==d.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}jm.verbose=!1});var Ab=T((BK,bb)=>{"use strict";bb.exports=_l;var $F=Dm(),WF=Rm(),Gm=WF("fs");function _l(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&Gm&&Gm.readFile?Gm.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?_l.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):_l.xhr(n,e,t):$F(_l,this,n,e)}_l.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var Rb=T(Db=>{"use strict";var Km=Db,Ib=Km.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},Hm=Km.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=Ib(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};Km.resolve=function(e,t,r){return r||(t=Hm(t)),Ib(t)?t:(r||(e=Hm(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?Hm(e+"/"+t):t)}});var Wi=T(Nb=>{"use strict";var Sl=Nb,QF=Ze(),YF=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function Tl(n,e){var t=0,r={};for(e|=0;t<n.length;)r[YF[t+e]]=n[t++];return r}Sl.basic=Tl([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);Sl.defaults=Tl([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",QF.emptyArray,null]);Sl.long=Tl([0,0,0,1,1],7);Sl.mapKey=Tl([0,0,0,5,5,0,0,0,1,1,0,2],2);Sl.packed=Tl([1,5,0,0,0,5,5,0,0,0,1,1,0])});var $r=T((UK,Mb)=>{"use strict";Mb.exports=Zt;var gd=Qi();((Zt.prototype=Object.create(gd.prototype)).constructor=Zt).className="Field";var kb=mn(),Ob=Wi(),Ge=Ze(),$m,XF=/^required|optional|repeated$/;Zt.fromJSON=function(e,t){return new Zt(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function Zt(n,e,t,r,i,s,o){if(Ge.isObject(r)?(o=i,s=r,r=i=void 0):Ge.isObject(i)&&(o=s,s=i,i=void 0),gd.call(this,n,s),!Ge.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!Ge.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!XF.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!Ge.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=Ge.Long?Ob.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(Zt.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});Zt.prototype.setOption=function(e,t,r){return e==="packed"&&(this._packed=null),gd.prototype.setOption.call(this,e,t,r)};Zt.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Ge.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Zt.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=Ob.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof $m?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof kb&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof kb))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=Ge.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;Ge.base64.test(this.typeDefault)?Ge.base64.decode(this.typeDefault,e=Ge.newBuffer(Ge.base64.length(this.typeDefault)),0):Ge.utf8.write(this.typeDefault,e=Ge.newBuffer(Ge.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=Ge.emptyObject:this.repeated?this.defaultValue=Ge.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof $m&&(this.parent.ctor.prototype[this.name]=this.defaultValue),gd.prototype.resolve.call(this)};Zt.d=function(e,t,r,i){return typeof t=="function"?t=Ge.decorateType(t).name:t&&typeof t=="object"&&(t=Ge.decorateEnum(t).name),function(o,a){Ge.decorateType(o.constructor).add(new Zt(a,e,t,r,{default:i}))}};Zt._configure=function(e){$m=e}});var ho=T((zK,Fb)=>{"use strict";Fb.exports=en;var yd=Qi();((en.prototype=Object.create(yd.prototype)).constructor=en).className="OneOf";var xb=$r(),md=Ze();function en(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),yd.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}en.fromJSON=function(e,t){return new en(e,t.oneof,t.options,t.comment)};en.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return md.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function Pb(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}en.prototype.add=function(e){if(!(e instanceof xb))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,Pb(this),this};en.prototype.remove=function(e){if(!(e instanceof xb))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};en.prototype.onAdd=function(e){yd.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}Pb(this)};en.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);yd.prototype.onRemove.call(this,e)};en.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){md.decorateType(i.constructor).add(new en(s,e)),Object.defineProperty(i,s,{get:md.oneOfGetter(e),set:md.oneOfSetter(e)})}}});var go=T((jK,qb)=>{"use strict";qb.exports=ae;var Wm=Qi();((ae.prototype=Object.create(Wm.prototype)).constructor=ae).className="Namespace";var Lb=$r(),vd=Ze(),JF=ho(),fo,wl,po;ae.fromJSON=function(e,t){return new ae(e,t.options).addJSON(t.nested)};function Bb(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}ae.arrayToJSON=Bb;ae.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};ae.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function ae(n,e){Wm.call(this,n,e),this.nested=void 0,this._nestedArray=null}function Vb(n){return n._nestedArray=null,n}Object.defineProperty(ae.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=vd.toArray(this.nested))}});ae.prototype.toJSON=function(e){return vd.toObject(["options",this.options,"nested",Bb(this.nestedArray,e)])};ae.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?fo.fromJSON:s.values!==void 0?po.fromJSON:s.methods!==void 0?wl.fromJSON:s.id!==void 0?Lb.fromJSON:ae.fromJSON)(r[i],s));return this};ae.prototype.get=function(e){return this.nested&&this.nested[e]||null};ae.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof po)return this.nested[e].values;throw Error("no such enum: "+e)};ae.prototype.add=function(e){if(!(e instanceof Lb&&e.extend!==void 0||e instanceof fo||e instanceof JF||e instanceof po||e instanceof wl||e instanceof ae))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof ae&&e instanceof ae&&!(t instanceof fo||t instanceof wl)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),Vb(this)};ae.prototype.remove=function(e){if(!(e instanceof Wm))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),Vb(this)};ae.prototype.define=function(e,t){if(vd.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof ae))throw Error("path conflicts with non-namespace objects")}else r.add(r=new ae(i))}return t&&r.addJSON(t),r};ae.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof ae?e[t++].resolveAll():e[t++].resolve();return this.resolve()};ae.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),vd.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof ae&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof ae&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};ae.prototype.lookupType=function(e){var t=this.lookup(e,[fo]);if(!t)throw Error("no such type: "+e);return t};ae.prototype.lookupEnum=function(e){var t=this.lookup(e,[po]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};ae.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[fo,po]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};ae.prototype.lookupService=function(e){var t=this.lookup(e,[wl]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};ae._configure=function(n,e,t){fo=n,wl=e,po=t}});var _d=T((GK,Ub)=>{"use strict";Ub.exports=cr;var Qm=$r();((cr.prototype=Object.create(Qm.prototype)).constructor=cr).className="MapField";var ZF=Wi(),El=Ze();function cr(n,e,t,r,i,s){if(Qm.call(this,n,e,r,void 0,void 0,i,s),!El.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}cr.fromJSON=function(e,t){return new cr(e,t.id,t.keyType,t.type,t.options,t.comment)};cr.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return El.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};cr.prototype.resolve=function(){if(this.resolved)return this;if(ZF.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return Qm.prototype.resolve.call(this)};cr.d=function(e,t,r){return typeof r=="function"?r=El.decorateType(r).name:r&&typeof r=="object"&&(r=El.decorateEnum(r).name),function(s,o){El.decorateType(s.constructor).add(new cr(o,e,t,r))}}});var Sd=T((HK,zb)=>{"use strict";zb.exports=Yi;var Ym=Qi();((Yi.prototype=Object.create(Ym.prototype)).constructor=Yi).className="Method";var mo=Ze();function Yi(n,e,t,r,i,s,o,a,l){if(mo.isObject(i)?(o=i,i=s=void 0):mo.isObject(s)&&(o=s,s=void 0),!(e===void 0||mo.isString(e)))throw TypeError("type must be a string");if(!mo.isString(t))throw TypeError("requestType must be a string");if(!mo.isString(r))throw TypeError("responseType must be a string");Ym.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}Yi.fromJSON=function(e,t){return new Yi(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};Yi.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return mo.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};Yi.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),Ym.prototype.resolve.call(this))}});var Td=T((KK,Gb)=>{"use strict";Gb.exports=tn;var Wr=go();((tn.prototype=Object.create(Wr.prototype)).constructor=tn).className="Service";var Xm=Sd(),Cl=Ze(),eL=Um();function tn(n,e){Wr.call(this,n,e),this.methods={},this._methodsArray=null}tn.fromJSON=function(e,t){var r=new tn(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(Xm.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r};tn.prototype.toJSON=function(e){var t=Wr.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return Cl.toObject(["options",t&&t.options||void 0,"methods",Wr.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(tn.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=Cl.toArray(this.methods))}});function jb(n){return n._methodsArray=null,n}tn.prototype.get=function(e){return this.methods[e]||Wr.prototype.get.call(this,e)};tn.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return Wr.prototype.resolve.call(this)};tn.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof Xm?(this.methods[e.name]=e,e.parent=this,jb(this)):Wr.prototype.add.call(this,e)};tn.prototype.remove=function(e){if(e instanceof Xm){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,jb(this)}return Wr.prototype.remove.call(this,e)};tn.prototype.create=function(e,t,r){for(var i=new eL.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=Cl.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=Cl.codegen(["r","c"],Cl.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var wd=T(($K,Hb)=>{"use strict";Hb.exports=Bn;var tL=Fn();function Bn(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}Bn.create=function(e){return this.$type.create(e)};Bn.encode=function(e,t){return this.$type.encode(e,t)};Bn.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};Bn.decode=function(e){return this.$type.decode(e)};Bn.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};Bn.verify=function(e){return this.$type.verify(e)};Bn.fromObject=function(e){return this.$type.fromObject(e)};Bn.toObject=function(e,t){return this.$type.toObject(e,t)};Bn.prototype.toJSON=function(){return this.$type.toObject(this,tL.toJSONOptions)}});var Jm=T((WK,$b)=>{"use strict";$b.exports=iL;var nL=mn(),ur=Wi(),Kb=Ze();function rL(n){return"missing required '"+n.name+"'"}function iL(n){var e=Kb.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof nL?"int32":r.type,s="m"+Kb.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),ur.defaults[r.keyType]!==void 0?e("k=%j",ur.defaults[r.keyType]):e("k=null"),ur.defaults[i]!==void 0?e("value=%j",ur.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),ur.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),ur.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),ur.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),ur.basic[i]===void 0?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):ur.basic[i]===void 0?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",rL(o))}return e("return m")}});var ty=T((QK,Wb)=>{"use strict";Wb.exports=aL;var sL=mn(),Zm=Ze();function nn(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function ey(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof sL){n("switch(%s){",r)("default:")("return%j",nn(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",nn(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",nn(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",nn(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",nn(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",nn(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",nn(e,"buffer"));break}return n}function oL(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",nn(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",nn(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",nn(e,"boolean key"));break}return n}function aL(n){var e=Zm.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+Zm.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",nn(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),oL(e,s,"k[i]"),ey(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",nn(s,"array"))("for(var i=0;i<%s.length;++i){",o),ey(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=Zm.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}ey(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var iy=T(Yb=>{"use strict";var Qb=Yb,bl=mn(),Vn=Ze();function ny(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof bl){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}Qb.fromObject=function(e){var t=e.fieldsArray,r=Vn.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=Vn.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),ny(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),ny(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof bl||r("if(d%s!=null){",o),ny(r,s,i,o),s.resolvedType instanceof bl||r("}"))}return r("return m")};function ry(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof bl?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}Qb.toObject=function(e){var t=e.fieldsArray.slice().sort(Vn.compareFieldsById);if(!t.length)return Vn.codegen()("return {}");for(var r=Vn.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",Vn.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",Vn.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=Vn.safeProp(l.name);if(l.resolvedType instanceof bl)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var d=!1;for(a=0;a<t.length;++a){var l=t[a],h=e._fieldsArray.indexOf(l),c=Vn.safeProp(l.name);l.map?(d||(d=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),ry(r,l,h,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),ry(r,l,h,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),ry(r,l,h,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",Vn.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var sy=T(Xb=>{"use strict";var lL=Xb,cL=wd();lL[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof cL){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var bd=T((JK,Zb)=>{"use strict";Zb.exports=ge;var yn=go();((ge.prototype=Object.create(yn.prototype)).constructor=ge).className="Type";var uL=mn(),ly=ho(),Ed=$r(),dL=_d(),hL=Td(),oy=wd(),ay=pd(),fL=hd(),gt=Ze(),pL=cy(),gL=Jm(),mL=ty(),Jb=iy(),yL=sy();function ge(n,e){yn.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(ge.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=gt.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=gt.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=ge.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof oy||((n.prototype=new oy).constructor=n,gt.merge(n.prototype,e)),n.$type=n.prototype.$type=this,gt.merge(n,oy,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:gt.oneOfGetter(this._oneofsArray[t].oneof),set:gt.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});ge.generateConstructor=function(e){for(var t=gt.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",gt.safeProp(i.name)):i.repeated&&t("this%s=[]",gt.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function Cd(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}ge.fromJSON=function(e,t){var r=new ge(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?dL.fromJSON:Ed.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(ly.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?Ed.fromJSON:o.fields!==void 0?ge.fromJSON:o.values!==void 0?uL.fromJSON:o.methods!==void 0?hL.fromJSON:yn.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r};ge.prototype.toJSON=function(e){var t=yn.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return gt.toObject(["options",t&&t.options||void 0,"oneofs",yn.arrayToJSON(this.oneofsArray,e),"fields",yn.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};ge.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return yn.prototype.resolveAll.call(this)};ge.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};ge.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof Ed&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),Cd(this)}return e instanceof ly?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),Cd(this)):yn.prototype.add.call(this,e)};ge.prototype.remove=function(e){if(e instanceof Ed&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),Cd(this)}if(e instanceof ly){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),Cd(this)}return yn.prototype.remove.call(this,e)};ge.prototype.isReservedId=function(e){return yn.isReservedId(this.reserved,e)};ge.prototype.isReservedName=function(e){return yn.isReservedName(this.reserved,e)};ge.prototype.create=function(e){return new this.ctor(e)};ge.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=pL(this)({Writer:fL,types:t,util:gt}),this.decode=gL(this)({Reader:ay,types:t,util:gt}),this.verify=mL(this)({types:t,util:gt}),this.fromObject=Jb.fromObject(this)({types:t,util:gt}),this.toObject=Jb.toObject(this)({types:t,util:gt});var i=yL[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};ge.prototype.encode=function(e,t){return this.setup().encode(e,t)};ge.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};ge.prototype.decode=function(e,t){return this.setup().decode(e,t)};ge.prototype.decodeDelimited=function(e){return e instanceof ay||(e=ay.create(e)),this.decode(e,e.uint32())};ge.prototype.verify=function(e){return this.setup().verify(e)};ge.prototype.fromObject=function(e){return this.setup().fromObject(e)};ge.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};ge.d=function(e){return function(r){gt.decorateType(r,e)}}});var Dd=T((ZK,iA)=>{"use strict";iA.exports=qt;var Id=go();((qt.prototype=Object.create(Id.prototype)).constructor=qt).className="Root";var dy=$r(),tA=mn(),vL=ho(),Qr=Ze(),nA,uy,Al;function qt(n){Id.call(this,"",n),this.deferred=[],this.files=[]}qt.fromJSON=function(e,t){return t||(t=new qt),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};qt.prototype.resolvePath=Qr.path.resolve;qt.prototype.fetch=Qr.fetch;function rA(){}qt.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return Qr.asPromise(n,i,e,t);var s=r===rA;function o(p,y){if(r){if(s)throw p;var _=r;r=null,_(p,y)}}function a(p){var y=p.lastIndexOf("google/protobuf/");if(y>-1){var _=p.substring(y);if(_ in Al)return _}return null}function l(p,y){try{if(Qr.isString(y)&&y.charAt(0)==="{"&&(y=JSON.parse(y)),!Qr.isString(y))i.setOptions(y.options).addJSON(y.nested);else{uy.filename=p;var _=uy(y,i,t),S,R=0;if(_.imports)for(;R<_.imports.length;++R)(S=a(_.imports[R])||i.resolvePath(p,_.imports[R]))&&c(S);if(_.weakImports)for(R=0;R<_.weakImports.length;++R)(S=a(_.weakImports[R])||i.resolvePath(p,_.weakImports[R]))&&c(S,!0)}}catch(w){o(w)}!s&&!u&&o(null,i)}function c(p,y){if(p=a(p)||p,!(i.files.indexOf(p)>-1)){if(i.files.push(p),p in Al){s?l(p,Al[p]):(++u,setTimeout(function(){--u,l(p,Al[p])}));return}if(s){var _;try{_=Qr.fs.readFileSync(p).toString("utf8")}catch(S){y||o(S);return}l(p,_)}else++u,i.fetch(p,function(S,R){if(--u,!!r){if(S){y?u||o(null,i):o(S);return}l(p,R)}})}}var u=0;Qr.isString(e)&&(e=[e]);for(var d=0,h;d<e.length;++d)(h=i.resolvePath("",e[d]))&&c(h);if(s)return i;u||o(null,i)};qt.prototype.loadSync=function(e,t){if(!Qr.isNode)throw Error("not supported");return this.load(e,t,rA)};qt.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return Id.prototype.resolveAll.call(this)};var Ad=/^[A-Z]/;function eA(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new dy(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}qt.prototype._handleAdd=function(e){if(e instanceof dy)e.extend!==void 0&&!e.extensionField&&(eA(this,e)||this.deferred.push(e));else if(e instanceof tA)Ad.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof vL)){if(e instanceof nA)for(var t=0;t<this.deferred.length;)eA(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);Ad.test(e.name)&&(e.parent[e.name]=e)}};qt.prototype._handleRemove=function(e){if(e instanceof dy){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof tA)Ad.test(e.name)&&delete e.parent[e.name];else if(e instanceof Id){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);Ad.test(e.name)&&delete e.parent[e.name]}};qt._configure=function(n,e,t){nA=n,uy=e,Al=t}});var Ze=T((e$,oA)=>{"use strict";var Be=oA.exports=Fn(),sA=zm(),hy,fy;Be.codegen=Cb();Be.fetch=Ab();Be.path=Rb();Be.fs=Be.inquire("fs");Be.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};Be.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var _L=/\\/g,SL=/"/g;Be.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};Be.safeProp=function(e){return!/^[$\w_]+$/.test(e)||Be.isReserved(e)?'["'+e.replace(_L,"\\\\").replace(SL,'\\"')+'"]':"."+e};Be.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var TL=/_([a-z])/g;Be.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(TL,function(t,r){return r.toUpperCase()})};Be.compareFieldsById=function(e,t){return e.id-t.id};Be.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(Be.decorateRoot.remove(e.$type),e.$type.name=t,Be.decorateRoot.add(e.$type)),e.$type;hy||(hy=bd());var r=new hy(t||e.name);return Be.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var wL=0;Be.decorateEnum=function(e){if(e.$type)return e.$type;fy||(fy=mn());var t=new fy("Enum"+wL++,e);return Be.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};Be.setProperty=function(e,t,r){function i(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=i(s[l]||{},o,a);else{var c=s[l];c&&(a=[].concat(c).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),i(e,t,r)};Object.defineProperty(Be,"decorateRoot",{get:function(){return sA.decorated||(sA.decorated=new(Dd()))}})});var Qi=T((t$,aA)=>{"use strict";aA.exports=Ut;Ut.className="ReflectionObject";var Rd=Ze(),Nd;function Ut(n,e){if(!Rd.isString(n))throw TypeError("name must be a string");if(e&&!Rd.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(Ut.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});Ut.prototype.toJSON=function(){throw Error()};Ut.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof Nd&&t._handleAdd(this)};Ut.prototype.onRemove=function(e){var t=e.root;t instanceof Nd&&t._handleRemove(this),this.parent=null,this.resolved=!1};Ut.prototype.resolve=function(){return this.resolved?this:(this.root instanceof Nd&&(this.resolved=!0),this)};Ut.prototype.getOption=function(e){if(this.options)return this.options[e]};Ut.prototype.setOption=function(e,t,r){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};Ut.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];Rd.setProperty(o,r,t)}else s={},s[e]=Rd.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};Ut.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};Ut.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};Ut._configure=function(n){Nd=n}});var mn=T((n$,uA)=>{"use strict";uA.exports=qn;var lA=Qi();((qn.prototype=Object.create(lA.prototype)).constructor=qn).className="Enum";var cA=go(),kd=Ze();function qn(n,e,t,r,i,s){if(lA.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}qn.fromJSON=function(e,t){var r=new qn(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r};qn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return kd.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};qn.prototype.add=function(e,t,r,i){if(!kd.isString(e))throw TypeError("name must be a string");if(!kd.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};qn.prototype.remove=function(e){if(!kd.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};qn.prototype.isReservedId=function(e){return cA.isReservedId(this.reserved,e)};qn.prototype.isReservedName=function(e){return cA.isReservedName(this.reserved,e)}});var cy=T((r$,hA)=>{"use strict";hA.exports=CL;var EL=mn(),py=Wi(),gy=Ze();function dA(n,e,t,r){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function CL(n){for(var e=gy.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(gy.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof EL?"int32":s.type,l=py.basic[a];r="m"+gy.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|py.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&py.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?dA(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?dA(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var pA=T((i$,fA)=>{"use strict";var te=fA.exports=wb();te.build="light";function bL(n,e,t){return typeof e=="function"?(t=e,e=new te.Root):e||(e=new te.Root),e.load(n,t)}te.load=bL;function AL(n,e){return e||(e=new te.Root),e.loadSync(n)}te.loadSync=AL;te.encoder=cy();te.decoder=Jm();te.verifier=ty();te.converter=iy();te.ReflectionObject=Qi();te.Namespace=go();te.Root=Dd();te.Enum=mn();te.Type=bd();te.Field=$r();te.OneOf=ho();te.MapField=_d();te.Service=Td();te.Method=Sd();te.Message=wd();te.wrappers=sy();te.types=Wi();te.util=Ze();te.ReflectionObject._configure(te.Root);te.Namespace._configure(te.Type,te.Service,te.Enum);te.Root._configure(te.Type);te.Field._configure(te.Type)});var yy=T((s$,yA)=>{"use strict";yA.exports=mA;var my=/[\s{}=;:[\],'"()<>]/g,IL=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,DL=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,RL=/^ *[*/]+ */,NL=/^\s*\*?\/*/,kL=/\n/g,OL=/\s/,ML=/\\(.?)/g,xL={0:"\0",r:"\r",n:`
`,t:"	"};function gA(n){return n.replace(ML,function(e,t){switch(t){case"\\":case"":return t;default:return xL[t]||""}})}mA.unescape=gA;function mA(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function c(k){return Error("illegal "+k+" (line "+i+")")}function u(){var k=l==="'"?DL:IL;k.lastIndex=t-1;var V=k.exec(n);if(!V)throw c("string");return t=k.lastIndex,S(l),l=null,gA(V[1])}function d(k){return n.charAt(k)}function h(k,V,H){var X={type:n.charAt(k++),lineEmpty:!1,leading:H},We;e?We=2:We=3;var ct=k-We,pe;do if(--ct<0||(pe=n.charAt(ct))===`
`){X.lineEmpty=!0;break}while(pe===" "||pe==="	");for(var C=n.substring(k,V).split(kL),Re=0;Re<C.length;++Re)C[Re]=C[Re].replace(e?NL:RL,"").trim();X.text=C.join(`
`).trim(),o[i]=X,s=i}function p(k){var V=y(k),H=n.substring(k,V),X=/^\s*\/\//.test(H);return X}function y(k){for(var V=k;V<r&&d(V)!==`
`;)V++;return V}function _(){if(a.length>0)return a.shift();if(l)return u();var k,V,H,X,We,ct=t===0;do{if(t===r)return null;for(k=!1;OL.test(H=d(t));)if(H===`
`&&(ct=!0,++i),++t===r)return null;if(d(t)==="/"){if(++t===r)throw c("comment");if(d(t)==="/")if(e){if(X=t,We=!1,p(t-1)){We=!0;do if(t=y(t),t===r||(t++,!ct))break;while(p(t))}else t=Math.min(r,y(t)+1);We&&(h(X,t,ct),ct=!0),i++,k=!0}else{for(We=d(X=t+1)==="/";d(++t)!==`
`;)if(t===r)return null;++t,We&&(h(X,t-1,ct),ct=!0),++i,k=!0}else if((H=d(t))==="*"){X=t+1,We=e||d(X)==="*";do{if(H===`
`&&++i,++t===r)throw c("comment");V=H,H=d(t)}while(V!=="*"||H!=="/");++t,We&&(h(X,t-2,ct),ct=!0),k=!0}else return"/"}}while(k);var pe=t;my.lastIndex=0;var C=my.test(d(pe++));if(!C)for(;pe<r&&!my.test(d(pe));)++pe;var Re=n.substring(t,t=pe);return(Re==='"'||Re==="'")&&(l=Re),Re}function S(k){a.push(k)}function R(){if(!a.length){var k=_();if(k===null)return null;S(k)}return a[0]}function w(k,V){var H=R(),X=H===k;if(X)return _(),!0;if(!V)throw c("token '"+H+"', '"+k+"' expected");return!1}function N(k){var V=null,H;return k===void 0?(H=o[i-1],delete o[i-1],H&&(e||H.type==="*"||H.lineEmpty)&&(V=H.leading?H.text:null)):(s<k&&R(),H=o[k],delete o[k],H&&!H.lineEmpty&&(e||H.type==="/")&&(V=H.leading?null:H.text)),V}return Object.defineProperty({next:_,peek:R,push:S,skip:w,cmnt:N},"line",{get:function(){return i}})}});var EA=T((o$,wA)=>{"use strict";wA.exports=dr;dr.filename=null;dr.defaults={keepCase:!1};var PL=yy(),vA=Dd(),_A=bd(),SA=$r(),FL=_d(),TA=ho(),LL=mn(),BL=Td(),VL=Sd(),vy=Wi(),_y=Ze(),qL=/^[1-9][0-9]*$/,UL=/^-?[1-9][0-9]*$/,zL=/^0[x][0-9a-fA-F]+$/,jL=/^-?0[x][0-9a-fA-F]+$/,GL=/^0[0-7]+$/,HL=/^-?0[0-7]+$/,KL=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,Un=/^[a-zA-Z_][a-zA-Z_0-9]*$/,zn=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,$L=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function dr(n,e,t){e instanceof vA||(t=e,e=new vA),t||(t=dr.defaults);var r=t.preferTrailingComment||!1,i=PL(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,c=i.cmnt,u=!0,d,h,p,y,_=!1,S=e,R=t.keepCase?function(A){return A}:_y.camelCase;function w(A,I,O){var G=dr.filename;return O||(dr.filename=null),Error("illegal "+(I||"token")+" '"+A+"' ("+(G?G+", ":"")+"line "+i.line+")")}function N(){var A=[],I;do{if((I=s())!=='"'&&I!=="'")throw w(I);A.push(s()),l(I),I=a()}while(I==='"'||I==="'");return A.join("")}function k(A){var I=s();switch(I){case"'":case'"':return o(I),N();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return H(I,!0)}catch{if(A&&zn.test(I))return I;throw w(I,"value")}}function V(A,I){var O,G;do I&&((O=a())==='"'||O==="'")?A.push(N()):A.push([G=X(s()),l("to",!0)?X(s()):G]);while(l(",",!0));l(";")}function H(A,I){var O=1;switch(A.charAt(0)==="-"&&(O=-1,A=A.substring(1)),A){case"inf":case"INF":case"Inf":return O*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(qL.test(A))return O*parseInt(A,10);if(zL.test(A))return O*parseInt(A,16);if(GL.test(A))return O*parseInt(A,8);if(KL.test(A))return O*parseFloat(A);throw w(A,"number",I)}function X(A,I){switch(A){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!I&&A.charAt(0)==="-")throw w(A,"id");if(UL.test(A))return parseInt(A,10);if(jL.test(A))return parseInt(A,16);if(HL.test(A))return parseInt(A,8);throw w(A,"id")}function We(){if(d!==void 0)throw w("package");if(d=s(),!zn.test(d))throw w(d,"name");S=S.define(d),l(";")}function ct(){var A=a(),I;switch(A){case"weak":I=p||(p=[]),s();break;case"public":s();default:I=h||(h=[]);break}A=N(),l(";"),I.push(A)}function pe(){if(l("="),y=N(),_=y==="proto3",!_&&y!=="proto2")throw w(y,"syntax");l(";")}function C(A,I){switch(I){case"option":return ve(A,I),l(";"),!0;case"message":return b(A,I),!0;case"enum":return de(A,I),!0;case"service":return je(A,I),!0;case"extend":return Ms(A,I),!0}return!1}function Re(A,I,O){var G=i.line;if(A&&(typeof A.comment!="string"&&(A.comment=c()),A.filename=dr.filename),l("{",!0)){for(var z;(z=s())!=="}";)I(z);l(";",!0)}else O&&O(),l(";"),A&&(typeof A.comment!="string"||r)&&(A.comment=c(G)||A.comment)}function b(A,I){if(!Un.test(I=s()))throw w(I,"type name");var O=new _A(I);Re(O,function(z){if(!C(O,z))switch(z){case"map":ie(O,z);break;case"required":case"repeated":f(O,z);break;case"optional":_?f(O,"proto3_optional"):f(O,"optional");break;case"oneof":we(O,z);break;case"extensions":V(O.extensions||(O.extensions=[]));break;case"reserved":V(O.reserved||(O.reserved=[]),!0);break;default:if(!_||!zn.test(z))throw w(z);o(z),f(O,"optional");break}}),A.add(O)}function f(A,I,O){var G=s();if(G==="group"){F(A,I);return}for(;G.endsWith(".")||a().startsWith(".");)G+=s();if(!zn.test(G))throw w(G,"type");var z=s();if(!Un.test(z))throw w(z,"name");z=R(z),l("=");var J=new SA(z,X(s()),G,I,O);if(Re(J,function(Ft){if(Ft==="option")ve(J,Ft),l(";");else throw w(Ft)},function(){ut(J)}),I==="proto3_optional"){var it=new TA("_"+z);J.setOption("proto3_optional",!0),it.add(J),A.add(it)}else A.add(J);!_&&J.repeated&&(vy.packed[G]!==void 0||vy.basic[G]===void 0)&&J.setOption("packed",!1,!0)}function F(A,I){var O=s();if(!Un.test(O))throw w(O,"name");var G=_y.lcFirst(O);O===G&&(O=_y.ucFirst(O)),l("=");var z=X(s()),J=new _A(O);J.group=!0;var it=new SA(G,z,O,I);it.filename=dr.filename,Re(J,function(Ft){switch(Ft){case"option":ve(J,Ft),l(";");break;case"required":case"repeated":f(J,Ft);break;case"optional":_?f(J,"proto3_optional"):f(J,"optional");break;case"message":b(J,Ft);break;case"enum":de(J,Ft);break;default:throw w(Ft)}}),A.add(J).add(it)}function ie(A){l("<");var I=s();if(vy.mapKey[I]===void 0)throw w(I,"type");l(",");var O=s();if(!zn.test(O))throw w(O,"type");l(">");var G=s();if(!Un.test(G))throw w(G,"name");l("=");var z=new FL(R(G),X(s()),I,O);Re(z,function(it){if(it==="option")ve(z,it),l(";");else throw w(it)},function(){ut(z)}),A.add(z)}function we(A,I){if(!Un.test(I=s()))throw w(I,"name");var O=new TA(R(I));Re(O,function(z){z==="option"?(ve(O,z),l(";")):(o(z),f(O,"optional"))}),A.add(O)}function de(A,I){if(!Un.test(I=s()))throw w(I,"name");var O=new LL(I);Re(O,function(z){switch(z){case"option":ve(O,z),l(";");break;case"reserved":V(O.reserved||(O.reserved=[]),!0);break;default:Pe(O,z)}}),A.add(O)}function Pe(A,I){if(!Un.test(I))throw w(I,"name");l("=");var O=X(s(),!0),G={options:void 0};G.setOption=function(z,J){this.options===void 0&&(this.options={}),this.options[z]=J},Re(G,function(J){if(J==="option")ve(G,J),l(";");else throw w(J)},function(){ut(G)}),A.add(I,O,G.comment,G.options)}function ve(A,I){var O=l("(",!0);if(!zn.test(I=s()))throw w(I,"name");var G=I,z=G,J;O&&(l(")"),G="("+G+")",z=G,I=a(),$L.test(I)&&(J=I.slice(1),G+=I,s())),l("=");var it=St(A,G);Ne(A,z,it,J)}function St(A,I){if(l("{",!0)){for(var O={};!l("}",!0);){if(!Un.test(dt=s()))throw w(dt,"name");if(dt===null)throw w(dt,"end of input");var G,z=dt;if(l(":",!0),a()==="{")G=St(A,I+"."+dt);else if(a()==="["){G=[];var J;if(l("[",!0)){do J=k(!0),G.push(J);while(l(",",!0));l("]"),typeof J<"u"&&ze(A,I+"."+dt,J)}}else G=k(!0),ze(A,I+"."+dt,G);var it=O[z];it&&(G=[].concat(it).concat(G)),O[z]=G,l(",",!0),l(";",!0)}return O}var Ar=k(!0);return ze(A,I,Ar),Ar}function ze(A,I,O){A.setOption&&A.setOption(I,O)}function Ne(A,I,O,G){A.setParsedOption&&A.setParsedOption(I,O,G)}function ut(A){if(l("[",!0)){do ve(A,"option");while(l(",",!0));l("]")}return A}function je(A,I){if(!Un.test(I=s()))throw w(I,"service name");var O=new BL(I);Re(O,function(z){if(!C(O,z))if(z==="rpc")Tt(O,z);else throw w(z)}),A.add(O)}function Tt(A,I){var O=c(),G=I;if(!Un.test(I=s()))throw w(I,"name");var z=I,J,it,Ar,Ft;if(l("("),l("stream",!0)&&(it=!0),!zn.test(I=s())||(J=I,l(")"),l("returns"),l("("),l("stream",!0)&&(Ft=!0),!zn.test(I=s())))throw w(I);Ar=I,l(")");var Uc=new VL(z,G,J,Ar,it,Ft);Uc.comment=O,Re(Uc,function(lp){if(lp==="option")ve(Uc,lp),l(";");else throw w(lp)}),A.add(Uc)}function Ms(A,I){if(!zn.test(I=s()))throw w(I,"reference");var O=I;Re(null,function(z){switch(z){case"required":case"repeated":f(A,z,O);break;case"optional":_?f(A,"proto3_optional",O):f(A,"optional",O);break;default:if(!_||!zn.test(z))throw w(z);o(z),f(A,"optional",O);break}})}for(var dt;(dt=s())!==null;)switch(dt){case"package":if(!u)throw w(dt);We();break;case"import":if(!u)throw w(dt);ct();break;case"syntax":if(!u)throw w(dt);pe();break;case"option":ve(S,dt),l(";");break;default:if(C(S,dt)){u=!1;continue}throw w(dt)}return dr.filename=null,{package:d,imports:h,weakImports:p,syntax:y,root:e}}});var AA=T((a$,bA)=>{"use strict";bA.exports=vn;var WL=/\/|\./;function vn(n,e){WL.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),vn[n]=e}vn("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var CA;vn("duration",{Duration:CA={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});vn("timestamp",{Timestamp:CA});vn("empty",{Empty:{fields:{}}});vn("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});vn("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});vn("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});vn.get=function(e){return vn[e]||null}});var DA=T((l$,IA)=>{"use strict";var Yr=IA.exports=pA();Yr.build="full";Yr.tokenize=yy();Yr.parse=EA();Yr.common=AA();Yr.Root._configure(Yr.Type,Yr.parse,Yr.common)});var Od=T((c$,RA)=>{"use strict";RA.exports=DA()});var Sy=T((u$,QL)=>{QL.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var xA=T((Y,MA)=>{"use strict";var At=Od();MA.exports=Y=At.descriptor=At.Root.fromJSON(Sy()).lookup(".google.protobuf");var NA=At.Namespace,Il=At.Root,hr=At.Enum,Xr=At.Type,Jr=At.Field,YL=At.MapField,Md=At.OneOf,Dl=At.Service,xd=At.Method;Il.fromDescriptor=function(e){typeof e.length=="number"&&(e=Y.FileDescriptorSet.decode(e));var t=new Il;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add(Xr.fromDescriptor(r.messageType[o],r.syntax));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(hr.fromDescriptor(r.enumType[o]));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(Jr.fromDescriptor(r.extension[o]));if(r.service)for(o=0;o<r.service.length;++o)i.add(Dl.fromDescriptor(r.service[o]));var a=yo(r.options,Y.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)i.setOption(l[o],a[l[o]])}}return t};Il.prototype.toDescriptor=function(e){var t=Y.FileDescriptorSet.create();return kA(this,t.file,e),t};function kA(n,e,t){var r=Y.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof Il||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof Xr?r.messageType.push(s.toDescriptor(t)):s instanceof hr?r.enumType.push(s.toDescriptor()):s instanceof Jr?r.extension.push(s.toDescriptor(t)):s instanceof Dl?r.service.push(s.toDescriptor()):s instanceof NA&&kA(s,e,t);r.options=vo(n.options,Y.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var XL=0;Xr.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=Y.DescriptorProto.decode(e));var r=new Xr(e.name.length?e.name:"Type"+XL++,yo(e.options,Y.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(Md.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=Jr.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(Jr.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add(Xr.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(hr.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};Xr.prototype.toDescriptor=function(e){var t=Y.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof YL){var s=Ty(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),o=Ty(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),a=o===11||o===14?this._fieldsArray[r].resolvedType&&OA(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(Y.DescriptorProto.create({name:i.typeName,field:[Y.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),Y.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:Y.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof Jr?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof Xr?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof hr&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(Y.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(Y.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=vo(this.options,Y.MessageOptions),t};var JL=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;Jr.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=Y.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=r2(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new Jr(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=yo(e.options,Y.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=JL.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return i2(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};Jr.prototype.toDescriptor=function(e){var t=Y.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=At.util.ucFirst(this.name),t.label=3;else{switch(t.type=Ty(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?OA(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=vo(this.options,Y.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=Y.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=Y.FieldOptions.create())).packed=!0),t};var ZL=0;hr.fromDescriptor=function(e){typeof e.length=="number"&&(e=Y.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new hr(e.name&&e.name.length?e.name:"Enum"+ZL++,t,yo(e.options,Y.EnumOptions))};hr.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(Y.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return Y.EnumDescriptorProto.create({name:this.name,value:e,options:vo(this.options,Y.EnumOptions)})};var e2=0;Md.fromDescriptor=function(e){return typeof e.length=="number"&&(e=Y.OneofDescriptorProto.decode(e)),new Md(e.name&&e.name.length?e.name:"oneof"+e2++)};Md.prototype.toDescriptor=function(){return Y.OneofDescriptorProto.create({name:this.name})};var t2=0;Dl.fromDescriptor=function(e){typeof e.length=="number"&&(e=Y.ServiceDescriptorProto.decode(e));var t=new Dl(e.name&&e.name.length?e.name:"Service"+t2++,yo(e.options,Y.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(xd.fromDescriptor(e.method[r]));return t};Dl.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return Y.ServiceDescriptorProto.create({name:this.name,method:e,options:vo(this.options,Y.ServiceOptions)})};var n2=0;xd.fromDescriptor=function(e){return typeof e.length=="number"&&(e=Y.MethodDescriptorProto.decode(e)),new xd(e.name&&e.name.length?e.name:"Method"+n2++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,yo(e.options,Y.MethodOptions))};xd.prototype.toDescriptor=function(){return Y.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:vo(this.options,Y.MethodOptions)})};function r2(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function i2(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function Ty(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof hr)return 14;if(e instanceof Xr)return e.group?10:11;throw Error("illegal type: "+n)}function yo(n,e){if(n){for(var t=[],r=0,i,s,o;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],i.resolvedType instanceof hr&&typeof o=="number"&&i.resolvedType.valuesById[o]!==void 0&&(o=i.resolvedType.valuesById[o]),t.push(s2(s),o));return t.length?At.util.toObject(t):void 0}}function vo(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,o;r<i.length;++r)if(o=n[s=i[r]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=At.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(At.util.toObject(t)):void 0}}function OA(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof Il)&&e instanceof NA)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function s2(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var PA=T((d$,o2)=>{o2.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var FA=T((h$,a2)=>{a2.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var LA=T((f$,l2)=>{l2.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var UA=T(Zr=>{"use strict";Object.defineProperty(Zr,"__esModule",{value:!0});Zr.addCommonProtos=Zr.loadProtosWithOptionsSync=Zr.loadProtosWithOptions=void 0;var BA=le("fs"),VA=le("path"),_o=Od();function qA(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(VA.isAbsolute(i))return i;for(let s of e){let o=VA.join(s,i);try{return BA.accessSync(o,BA.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function c2(n,e){return g(this,null,function*(){let t=new _o.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));qA(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}Zr.loadProtosWithOptions=c2;function u2(n,e){let t=new _o.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");qA(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}Zr.loadProtosWithOptionsSync=u2;function d2(){let n=PA(),e=Sy(),t=FA(),r=LA();_o.common("api",n.nested.google.nested.protobuf.nested),_o.common("descriptor",e.nested.google.nested.protobuf.nested),_o.common("source_context",t.nested.google.nested.protobuf.nested),_o.common("type",r.nested.google.nested.protobuf.nested)}Zr.addCommonProtos=d2});var GA=T((jA,wy)=>{"use strict";var zA=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(b,f,F){this.low=b|0,this.high=f|0,this.unsigned=!!F}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(b){return(b&&b.__isLong__)===!0}function i(b){var f=Math.clz32(b&-b);return b?31-f:f}t.isLong=r;var s={},o={};function a(b,f){var F,ie,we;return f?(b>>>=0,(we=0<=b&&b<256)&&(ie=o[b],ie)?ie:(F=c(b,0,!0),we&&(o[b]=F),F)):(b|=0,(we=-128<=b&&b<128)&&(ie=s[b],ie)?ie:(F=c(b,b<0?-1:0,!1),we&&(s[b]=F),F))}t.fromInt=a;function l(b,f){if(isNaN(b))return f?k:N;if(f){if(b<0)return k;if(b>=S)return ct}else{if(b<=-R)return pe;if(b+1>=R)return We}return b<0?l(-b,f).neg():c(b%_|0,b/_|0,f)}t.fromNumber=l;function c(b,f,F){return new t(b,f,F)}t.fromBits=c;var u=Math.pow;function d(b,f,F){if(b.length===0)throw Error("empty string");if(typeof f=="number"?(F=f,f=!1):f=!!f,b==="NaN"||b==="Infinity"||b==="+Infinity"||b==="-Infinity")return f?k:N;if(F=F||10,F<2||36<F)throw RangeError("radix");var ie;if((ie=b.indexOf("-"))>0)throw Error("interior hyphen");if(ie===0)return d(b.substring(1),f,F).neg();for(var we=l(u(F,8)),de=N,Pe=0;Pe<b.length;Pe+=8){var ve=Math.min(8,b.length-Pe),St=parseInt(b.substring(Pe,Pe+ve),F);if(ve<8){var ze=l(u(F,ve));de=de.mul(ze).add(l(St))}else de=de.mul(we),de=de.add(l(St))}return de.unsigned=f,de}t.fromString=d;function h(b,f){return typeof b=="number"?l(b,f):typeof b=="string"?d(b,f):c(b.low,b.high,typeof f=="boolean"?f:b.unsigned)}t.fromValue=h;var p=65536,y=1<<24,_=p*p,S=_*_,R=S/2,w=a(y),N=a(0);t.ZERO=N;var k=a(0,!0);t.UZERO=k;var V=a(1);t.ONE=V;var H=a(1,!0);t.UONE=H;var X=a(-1);t.NEG_ONE=X;var We=c(-1,2147483647,!1);t.MAX_VALUE=We;var ct=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=ct;var pe=c(0,-2147483648,!1);t.MIN_VALUE=pe;var C=t.prototype;C.toInt=function(){return this.unsigned?this.low>>>0:this.low},C.toNumber=function(){return this.unsigned?(this.high>>>0)*_+(this.low>>>0):this.high*_+(this.low>>>0)},C.toString=function(f){if(f=f||10,f<2||36<f)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(pe)){var F=l(f),ie=this.div(F),we=ie.mul(F).sub(this);return ie.toString(f)+we.toInt().toString(f)}else return"-"+this.neg().toString(f);for(var de=l(u(f,6),this.unsigned),Pe=this,ve="";;){var St=Pe.div(de),ze=Pe.sub(St.mul(de)).toInt()>>>0,Ne=ze.toString(f);if(Pe=St,Pe.isZero())return Ne+ve;for(;Ne.length<6;)Ne="0"+Ne;ve=""+Ne+ve}},C.getHighBits=function(){return this.high},C.getHighBitsUnsigned=function(){return this.high>>>0},C.getLowBits=function(){return this.low},C.getLowBitsUnsigned=function(){return this.low>>>0},C.getNumBitsAbs=function(){if(this.isNegative())return this.eq(pe)?64:this.neg().getNumBitsAbs();for(var f=this.high!=0?this.high:this.low,F=31;F>0&&!(f&1<<F);F--);return this.high!=0?F+33:F+1},C.isZero=function(){return this.high===0&&this.low===0},C.eqz=C.isZero,C.isNegative=function(){return!this.unsigned&&this.high<0},C.isPositive=function(){return this.unsigned||this.high>=0},C.isOdd=function(){return(this.low&1)===1},C.isEven=function(){return(this.low&1)===0},C.equals=function(f){return r(f)||(f=h(f)),this.unsigned!==f.unsigned&&this.high>>>31===1&&f.high>>>31===1?!1:this.high===f.high&&this.low===f.low},C.eq=C.equals,C.notEquals=function(f){return!this.eq(f)},C.neq=C.notEquals,C.ne=C.notEquals,C.lessThan=function(f){return this.comp(f)<0},C.lt=C.lessThan,C.lessThanOrEqual=function(f){return this.comp(f)<=0},C.lte=C.lessThanOrEqual,C.le=C.lessThanOrEqual,C.greaterThan=function(f){return this.comp(f)>0},C.gt=C.greaterThan,C.greaterThanOrEqual=function(f){return this.comp(f)>=0},C.gte=C.greaterThanOrEqual,C.ge=C.greaterThanOrEqual,C.compare=function(f){if(r(f)||(f=h(f)),this.eq(f))return 0;var F=this.isNegative(),ie=f.isNegative();return F&&!ie?-1:!F&&ie?1:this.unsigned?f.high>>>0>this.high>>>0||f.high===this.high&&f.low>>>0>this.low>>>0?-1:1:this.sub(f).isNegative()?-1:1},C.comp=C.compare,C.negate=function(){return!this.unsigned&&this.eq(pe)?pe:this.not().add(V)},C.neg=C.negate,C.add=function(f){r(f)||(f=h(f));var F=this.high>>>16,ie=this.high&65535,we=this.low>>>16,de=this.low&65535,Pe=f.high>>>16,ve=f.high&65535,St=f.low>>>16,ze=f.low&65535,Ne=0,ut=0,je=0,Tt=0;return Tt+=de+ze,je+=Tt>>>16,Tt&=65535,je+=we+St,ut+=je>>>16,je&=65535,ut+=ie+ve,Ne+=ut>>>16,ut&=65535,Ne+=F+Pe,Ne&=65535,c(je<<16|Tt,Ne<<16|ut,this.unsigned)},C.subtract=function(f){return r(f)||(f=h(f)),this.add(f.neg())},C.sub=C.subtract,C.multiply=function(f){if(this.isZero())return this;if(r(f)||(f=h(f)),e){var F=e.mul(this.low,this.high,f.low,f.high);return c(F,e.get_high(),this.unsigned)}if(f.isZero())return this.unsigned?k:N;if(this.eq(pe))return f.isOdd()?pe:N;if(f.eq(pe))return this.isOdd()?pe:N;if(this.isNegative())return f.isNegative()?this.neg().mul(f.neg()):this.neg().mul(f).neg();if(f.isNegative())return this.mul(f.neg()).neg();if(this.lt(w)&&f.lt(w))return l(this.toNumber()*f.toNumber(),this.unsigned);var ie=this.high>>>16,we=this.high&65535,de=this.low>>>16,Pe=this.low&65535,ve=f.high>>>16,St=f.high&65535,ze=f.low>>>16,Ne=f.low&65535,ut=0,je=0,Tt=0,Ms=0;return Ms+=Pe*Ne,Tt+=Ms>>>16,Ms&=65535,Tt+=de*Ne,je+=Tt>>>16,Tt&=65535,Tt+=Pe*ze,je+=Tt>>>16,Tt&=65535,je+=we*Ne,ut+=je>>>16,je&=65535,je+=de*ze,ut+=je>>>16,je&=65535,je+=Pe*St,ut+=je>>>16,je&=65535,ut+=ie*Ne+we*ze+de*St+Pe*ve,ut&=65535,c(Tt<<16|Ms,ut<<16|je,this.unsigned)},C.mul=C.multiply,C.divide=function(f){if(r(f)||(f=h(f)),f.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&f.low===-1&&f.high===-1)return this;var F=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,f.low,f.high);return c(F,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?k:N;var ie,we,de;if(this.unsigned){if(f.unsigned||(f=f.toUnsigned()),f.gt(this))return k;if(f.gt(this.shru(1)))return H;de=k}else{if(this.eq(pe)){if(f.eq(V)||f.eq(X))return pe;if(f.eq(pe))return V;var Pe=this.shr(1);return ie=Pe.div(f).shl(1),ie.eq(N)?f.isNegative()?V:X:(we=this.sub(f.mul(ie)),de=ie.add(we.div(f)),de)}else if(f.eq(pe))return this.unsigned?k:N;if(this.isNegative())return f.isNegative()?this.neg().div(f.neg()):this.neg().div(f).neg();if(f.isNegative())return this.div(f.neg()).neg();de=N}for(we=this;we.gte(f);){ie=Math.max(1,Math.floor(we.toNumber()/f.toNumber()));for(var ve=Math.ceil(Math.log(ie)/Math.LN2),St=ve<=48?1:u(2,ve-48),ze=l(ie),Ne=ze.mul(f);Ne.isNegative()||Ne.gt(we);)ie-=St,ze=l(ie,this.unsigned),Ne=ze.mul(f);ze.isZero()&&(ze=V),de=de.add(ze),we=we.sub(Ne)}return de},C.div=C.divide,C.modulo=function(f){if(r(f)||(f=h(f)),e){var F=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,f.low,f.high);return c(F,e.get_high(),this.unsigned)}return this.sub(this.div(f).mul(f))},C.mod=C.modulo,C.rem=C.modulo,C.not=function(){return c(~this.low,~this.high,this.unsigned)},C.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},C.clz=C.countLeadingZeros,C.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},C.ctz=C.countTrailingZeros,C.and=function(f){return r(f)||(f=h(f)),c(this.low&f.low,this.high&f.high,this.unsigned)},C.or=function(f){return r(f)||(f=h(f)),c(this.low|f.low,this.high|f.high,this.unsigned)},C.xor=function(f){return r(f)||(f=h(f)),c(this.low^f.low,this.high^f.high,this.unsigned)},C.shiftLeft=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low<<f,this.high<<f|this.low>>>32-f,this.unsigned):c(0,this.low<<f-32,this.unsigned)},C.shl=C.shiftLeft,C.shiftRight=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>f,this.unsigned):c(this.high>>f-32,this.high>=0?0:-1,this.unsigned)},C.shr=C.shiftRight,C.shiftRightUnsigned=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>>f,this.unsigned):f===32?c(this.high,0,this.unsigned):c(this.high>>>f-32,0,this.unsigned)},C.shru=C.shiftRightUnsigned,C.shr_u=C.shiftRightUnsigned,C.rotateLeft=function(f){var F;return r(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(F=32-f,c(this.low<<f|this.high>>>F,this.high<<f|this.low>>>F,this.unsigned)):(f-=32,F=32-f,c(this.high<<f|this.low>>>F,this.low<<f|this.high>>>F,this.unsigned))},C.rotl=C.rotateLeft,C.rotateRight=function(f){var F;return r(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(F=32-f,c(this.high<<F|this.low>>>f,this.low<<F|this.high>>>f,this.unsigned)):(f-=32,F=32-f,c(this.low<<F|this.high>>>f,this.high<<F|this.low>>>f,this.unsigned))},C.rotr=C.rotateRight,C.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},C.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},C.toBytes=function(f){return f?this.toBytesLE():this.toBytesBE()},C.toBytesLE=function(){var f=this.high,F=this.low;return[F&255,F>>>8&255,F>>>16&255,F>>>24,f&255,f>>>8&255,f>>>16&255,f>>>24]},C.toBytesBE=function(){var f=this.high,F=this.low;return[f>>>24,f>>>16&255,f>>>8&255,f&255,F>>>24,F>>>16&255,F>>>8&255,F&255]},t.fromBytes=function(f,F,ie){return ie?t.fromBytesLE(f,F):t.fromBytesBE(f,F)},t.fromBytesLE=function(f,F){return new t(f[0]|f[1]<<8|f[2]<<16|f[3]<<24,f[4]|f[5]<<8|f[6]<<16|f[7]<<24,F)},t.fromBytesBE=function(f,F){return new t(f[4]<<24|f[5]<<16|f[6]<<8|f[7],f[0]<<24|f[1]<<16|f[2]<<8|f[3],F)};var Re=t;return n.default=Re,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return zA}):typeof wy=="object"&&typeof jA=="object"&&(wy.exports=zA)});var Ay=T(mt=>{"use strict";Object.defineProperty(mt,"__esModule",{value:!0});mt.loadFileDescriptorSetFromObject=mt.loadFileDescriptorSetFromBuffer=mt.fromJSON=mt.loadSync=mt.load=mt.isAnyExtension=mt.Long=void 0;var h2=kC(),jn=Od(),Cy=xA(),by=UA(),f2=GA();mt.Long=f2;function p2(n){return"@type"in n&&typeof n["@type"]=="string"}mt.isAnyExtension=p2;var $A={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function g2(n,e){return n===""?e:n+"."+e}function m2(n){return n instanceof jn.Service||n instanceof jn.Type||n instanceof jn.Enum}function y2(n){return n instanceof jn.Namespace||n instanceof jn.Root}function WA(n,e){let t=g2(e,n.name);return m2(n)?[[t,n]]:y2(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>WA(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function HA(n,e){return function(r){return n.toObject(n.decode(r),e)}}function KA(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function v2(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:KA(i),requestDeserialize:HA(i,t),responseSerialize:KA(s),responseDeserialize:HA(s,t),originalName:h2(n.name),requestType:Ey(i,r),responseType:Ey(s,r)}}function _2(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=v2(s,e,t,r);return i}function Ey(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,$A),fileDescriptorProtos:e}}function S2(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,$A),fileDescriptorProtos:e}}function T2(n,e,t,r){if(n instanceof jn.Service)return _2(n,e,t,r);if(n instanceof jn.Type)return Ey(n,r);if(n instanceof jn.Enum)return S2(n,r);throw new Error("Type mismatch in reflection object handling")}function Pd(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(Cy.FileDescriptorProto.encode(s).finish()));for(let[s,o]of WA(n,""))t[s]=T2(o,s,e,i);return t}function QA(n,e){e=e||{};let t=jn.Root.fromDescriptor(n);return t.resolveAll(),Pd(t,e)}function w2(n,e){return(0,by.loadProtosWithOptions)(n,e).then(t=>Pd(t,e))}mt.load=w2;function E2(n,e){let t=(0,by.loadProtosWithOptionsSync)(n,e);return Pd(t,e)}mt.loadSync=E2;function C2(n,e){e=e||{};let t=jn.Root.fromJSON(n);return t.resolveAll(),Pd(t,e)}mt.fromJSON=C2;function b2(n,e){let t=Cy.FileDescriptorSet.decode(n);return QA(t,e)}mt.loadFileDescriptorSetFromBuffer=b2;function A2(n,e){let t=Cy.FileDescriptorSet.fromObject(n);return QA(t,e)}mt.loadFileDescriptorSetFromObject=A2;(0,by.addCommonProtos)()});var Xi=T(Ee=>{"use strict";Object.defineProperty(Ee,"__esModule",{value:!0});Ee.setup=Ee.getChannelzServiceDefinition=Ee.getChannelzHandlers=Ee.unregisterChannelzRef=Ee.registerChannelzSocket=Ee.registerChannelzServer=Ee.registerChannelzSubchannel=Ee.registerChannelzChannel=Ee.ChannelzCallTracker=Ee.ChannelzChildrenTracker=Ee.ChannelzTrace=void 0;var YA=le("net"),Rl=Wt(),kl=oe(),I2=xn(),D2=nd(),R2=Em();function Iy(n){return{channel_id:n.id,name:n.name}}function ky(n){return{subchannel_id:n.id,name:n.name}}function N2(n){return{server_id:n.id}}function Ld(n){return{socket_id:n.id,name:n.name}}var XA=32,Dy=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=XA*2&&(this.events=this.events.slice(XA)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:fr(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:fr(e.timestamp),channel_ref:e.childChannel?Iy(e.childChannel):null,subchannel_ref:e.childSubchannel?ky(e.childSubchannel):null}))}}};Ee.ChannelzTrace=Dy;var Ry=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};Ee.ChannelzChildrenTracker=Ry;var Ny=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};Ee.ChannelzCallTracker=Ny;var k2=1;function Bd(){return k2++}var Nl=[],Oy=[],ei=[],My=[];function O2(n,e,t){let r=Bd(),i={id:r,name:n,kind:"channel"};return t&&(Nl[r]={ref:i,getInfo:e}),i}Ee.registerChannelzChannel=O2;function M2(n,e,t){let r=Bd(),i={id:r,name:n,kind:"subchannel"};return t&&(Oy[r]={ref:i,getInfo:e}),i}Ee.registerChannelzSubchannel=M2;function x2(n,e){let t=Bd(),r={id:t,kind:"server"};return e&&(ei[t]={ref:r,getInfo:n}),r}Ee.registerChannelzServer=x2;function P2(n,e,t){let r=Bd(),i={id:r,name:n,kind:"socket"};return t&&(My[r]={ref:i,getInfo:e}),i}Ee.registerChannelzSocket=P2;function F2(n){switch(n.kind){case"channel":delete Nl[n.id];return;case"subchannel":delete Oy[n.id];return;case"server":delete ei[n.id];return;case"socket":delete My[n.id];return}}Ee.unregisterChannelzRef=F2;function L2(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function JA(n){if(n==="")return[];let e=n.split(":").map(r=>L2(r));return[].concat(...e)}function B2(n){if((0,YA.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,YA.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(JA(e)),s=Buffer.from(JA(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function eI(n){switch(n){case Rl.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case Rl.ConnectivityState.IDLE:return{state:"IDLE"};case Rl.ConnectivityState.READY:return{state:"READY"};case Rl.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case Rl.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function fr(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function tI(n){let e=n.getInfo();return{ref:Iy(n.ref),data:{target:e.target,state:eI(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:fr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>Iy(t)),subchannel_ref:e.children.subchannels.map(t=>ky(t))}}function V2(n,e){let t=Number.parseInt(n.request.channel_id),r=Nl[t];if(r===void 0){e({code:kl.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:tI(r)})}function q2(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<Nl.length;i++){let s=Nl[i];if(s!==void 0&&(r.push(tI(s)),r.length>=t))break}e(null,{channel:r,end:i>=ei.length})}function nI(n){let e=n.getInfo();return{ref:N2(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:fr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>Ld(t))}}function U2(n,e){let t=Number.parseInt(n.request.server_id),r=ei[t];if(r===void 0){e({code:kl.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:nI(r)})}function z2(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<ei.length;i++){let s=ei[i];if(s!==void 0&&(r.push(nI(s)),r.length>=t))break}e(null,{server:r,end:i>=ei.length})}function j2(n,e){let t=Number.parseInt(n.request.subchannel_id),r=Oy[t];if(r===void 0){e({code:kl.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:ky(r.ref),data:{target:i.target,state:eI(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:fr(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>Ld(o))};e(null,{subchannel:s})}function ZA(n){var e;return(0,I2.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=B2(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function G2(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=My[a];if(l===void 0){e({code:kl.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,d={ref:Ld(l.ref),local:c.localAddress?ZA(c.localAddress):null,remote:c.remoteAddress?ZA(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:fr(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:fr(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:fr(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:fr(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:d})}function H2(n,e){let t=Number.parseInt(n.request.server_id),r=ei[t];if(r===void 0){e({code:kl.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((u,d)=>u.id-d.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=i&&(l.push(Ld(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function rI(){return{GetChannel:V2,GetTopChannels:q2,GetServer:U2,GetServers:z2,GetSubchannel:j2,GetSocket:G2,GetServerSockets:H2}}Ee.getChannelzHandlers=rI;var Fd=null;function iI(){if(Fd)return Fd;let n=Ay().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return Fd=(0,R2.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,Fd}Ee.getChannelzServiceDefinition=iI;function K2(){(0,D2.registerAdminService)(iI,rI)}Ee.setup=K2});var sI=T(qd=>{"use strict";Object.defineProperty(qd,"__esModule",{value:!0});qd.Subchannel=void 0;var me=Wt(),$2=ul(),xy=Oe(),Vd=oe(),W2=Vt(),Q2=xn(),So=Xi(),Y2="subchannel",X2=~(1<<31),Py=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=me.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new So.ChannelzCallTracker,this.childrenTracker=new So.ChannelzChildrenTracker,this.streamTracker=new So.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new $2.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,Q2.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new So.ChannelzTrace,this.channelzRef=(0,So.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){xy.trace(Vd.LogVerbosity.DEBUG,Y2,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){xy.trace(Vd.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([me.ConnectivityState.TRANSIENT_FAILURE],me.ConnectivityState.CONNECTING):this.transitionToState([me.ConnectivityState.TRANSIENT_FAILURE],me.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,X2);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([me.ConnectivityState.CONNECTING],me.ConnectivityState.READY)?(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([me.ConnectivityState.READY],me.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,xy.log(Vd.LogVerbosity.ERROR,`Connection to ${(0,W2.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))})):t.shutdown()},t=>{this.transitionToState([me.ConnectivityState.CONNECTING],me.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(me.ConnectivityState[this.connectivityState]+" -> "+me.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+me.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case me.ConnectivityState.READY:this.stopBackoff();break;case me.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case me.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case me.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,So.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([me.ConnectivityState.CONNECTING,me.ConnectivityState.READY],me.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===Vd.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([me.ConnectivityState.IDLE],me.ConnectivityState.CONNECTING)||this.connectivityState===me.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([me.ConnectivityState.TRANSIENT_FAILURE],me.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};qd.Subchannel=Py});var Vy=T(ri=>{"use strict";Object.defineProperty(ri,"__esModule",{value:!0});ri.setup=ri.DEFAULT_PORT=void 0;var oI=On(),lI=le("dns"),cI=le("util"),J2=Yg(),Fy=oe(),Ly=bt(),Z2=Oe(),eB=oe(),ti=Vt(),aI=le("net"),tB=ul(),nB="dns_resolver";function ni(n){Z2.trace(eB.LogVerbosity.DEBUG,nB,n)}ri.DEFAULT_PORT=443;var rB=3e4,iB=cI.promisify(lI.resolveTxt),sB=cI.promisify(lI.lookup);function oB(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var By=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,ni("Resolver constructed for target "+(0,ti.uriToString)(e));let a=(0,ti.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,aI.isIPv4)(a.host)||(0,aI.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:ri.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:ri.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:Fy.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,ti.uriToString)(this.target)}`,metadata:new Ly.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new tB.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:rB,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(ni("Returning IP address for target "+(0,ti.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)ni("Failed to parse DNS address "+(0,ti.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:Fy.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,ti.uriToString)(this.target)}`,metadata:new Ly.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;ni("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=sB(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=oB(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(ni("Resolved addresses for target "+(0,ti.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(ni("Resolution error for target "+(0,ti.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=iB(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,J2.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:Fy.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new Ly.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?ni('resolution update delayed by "min time between resolutions" rate limit'):ni("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function aB(){(0,oI.registerResolver)("dns",By),(0,oI.registerDefaultScheme)("dns")}ri.setup=aB});var qy=T(Eo=>{"use strict";Object.defineProperty(Eo,"__esModule",{value:!0});Eo.getProxiedConnection=Eo.mapProxyName=void 0;var Ol=Oe(),To=oe(),lB=On(),cB=le("http"),uB=le("tls"),dB=Oe(),uI=xn(),wo=Vt(),hB=le("url"),fB=Vy(),pB="proxy";function ii(n){dB.trace(To.LogVerbosity.DEBUG,pB,n)}function gB(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new hB.URL(n)}catch{return(0,Ol.log)(To.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,Ol.log)(To.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,Ol.log)(To.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),ii("Proxy server "+o.address+" set by environment variable "+e),o}function mB(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(ii("No proxy server list set by environment variable "+e),n.split(",")):[]}function yB(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=gB();if(!i.address)return r;let s=(0,wo.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of mB())if(l===o)return ii("Not using proxy for target in no_proxy list: "+(0,wo.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,wo.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}Eo.mapProxyName=yB;function vB(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,wo.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,wo.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:fB.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,uI.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,uI.subchannelAddressToString)(n);return ii("Using proxy "+u+" to connect to "+l.path),new Promise((d,h)=>{let p=cB.request(l);p.once("connect",(y,_,S)=>{var R;if(p.removeAllListeners(),_.removeAllListeners(),y.statusCode===200)if(ii("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let w=(0,lB.getDefaultAuthority)(s),N=(0,wo.splitHostPort)(w),k=(R=N?.host)!==null&&R!==void 0?R:w,V=uB.connect(Object.assign({host:k,servername:k,socket:_},t),()=>{ii("Successfully established a TLS connection to "+l.path+" through proxy "+u),d({socket:V,realTarget:s})});V.on("error",H=>{ii("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+H.message),h()})}else ii("Successfully established a plaintext connection to "+l.path+" through proxy "+u),d({socket:_,realTarget:s});else(0,Ol.log)(To.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+y.statusCode),h()}),p.once("error",y=>{p.removeAllListeners(),(0,Ol.log)(To.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+y.message),h()}),p.end()})}Eo.getProxiedConnection=vB});var zy=T(Ud=>{"use strict";Object.defineProperty(Ud,"__esModule",{value:!0});Ud.StreamDecoder=void 0;var pr=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(pr||{}),Uy=class{constructor(){this.readState=pr.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case pr.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=pr.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case pr.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0)if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=pr.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=pr.NO_DATA,i.push(s)}break;case pr.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=pr.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};Ud.StreamDecoder=Uy});var dI=T(zd=>{"use strict";Object.defineProperty(zd,"__esModule",{value:!0});zd.Http2SubchannelCall=void 0;var gr=le("http2"),_B=le("os"),he=oe(),si=bt(),SB=zy(),TB=Oe(),wB=oe(),EB="subchannel_call";function CB(n){for(let[e,t]of Object.entries(_B.constants.errno))if(t===n)return e;return"Unknown system error "+n}var jy=class{constructor(e,t,r,i,s){this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.decoder=new SB.StreamDecoder,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=he.Status.UNKNOWN,this.finalStatus=null,this.internalError=null,e.on("response",(o,a)=>{let l="";for(let c of Object.keys(o))l+="		"+c+": "+o[c]+`
`;switch(this.trace(`Received server headers:
`+l),o[":status"]){case 400:this.mappedStatusCode=he.Status.INTERNAL;break;case 401:this.mappedStatusCode=he.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=he.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=he.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=he.Status.UNAVAILABLE;break;default:this.mappedStatusCode=he.Status.UNKNOWN}if(a&gr.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(o);else{let c;try{c=si.Metadata.fromHttp2Headers(o)}catch(u){this.endCall({code:he.Status.UNKNOWN,details:u.message,metadata:new si.Metadata});return}this.listener.onReceiveMetadata(c)}}),e.on("trailers",o=>{this.handleTrailers(o)}),e.on("data",o=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+o.length);let a=this.decoder.write(o);for(let l of a)this.trace("parsed message of length "+l.length),this.callEventTracker.addMessageReceived(),this.tryPush(l)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var o;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((o=this.finalStatus)===null||o===void 0?void 0:o.code)===he.Status.OK)return;let a,l="";switch(e.rstCode){case gr.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;a=he.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`;break;case gr.constants.NGHTTP2_REFUSED_STREAM:a=he.Status.UNAVAILABLE,l="Stream refused by server";break;case gr.constants.NGHTTP2_CANCEL:a=he.Status.CANCELLED,l="Call cancelled";break;case gr.constants.NGHTTP2_ENHANCE_YOUR_CALM:a=he.Status.RESOURCE_EXHAUSTED,l="Bandwidth exhausted or memory limit exceeded";break;case gr.constants.NGHTTP2_INADEQUATE_SECURITY:a=he.Status.PERMISSION_DENIED,l="Protocol not secure enough";break;case gr.constants.NGHTTP2_INTERNAL_ERROR:a=he.Status.INTERNAL,this.internalError===null?l=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(a=he.Status.UNAVAILABLE,l=this.internalError.message):l=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:a=he.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:a,details:l,metadata:new si.Metadata,rstCode:e.rstCode})})}),e.on("error",o=>{o.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+o.message+" code="+o.code+" errno="+CB(o.errno)+" syscall="+o.syscall),this.internalError=o),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:he.Status.UNAVAILABLE,details:"Connection dropped",metadata:new si.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){TB.trace(wB.LogVerbosity.DEBUG,EB,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===he.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==he.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=si.Metadata.fromHttp2Headers(e)}catch{r=new si.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===he.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in he.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===he.Status.OK?t=gr.constants.NGHTTP2_NO_ERROR:t=gr.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new si.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==he.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=he.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=he.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:he.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new si.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};zd.Http2SubchannelCall=jy});var Gy=T(jd=>{"use strict";Object.defineProperty(jd,"__esModule",{value:!0});jd.getNextCallNumber=void 0;var bB=0;function AB(){return bB++}jd.getNextCallNumber=AB});var pI=T(Hd=>{"use strict";Object.defineProperty(Hd,"__esModule",{value:!0});Hd.Http2SubchannelConnector=void 0;var Qy=le("http2"),hI=le("tls"),Hy=Xi(),Ml=oe(),IB=qy(),bo=Oe(),fI=On(),Gd=xn(),Co=Vt(),DB=le("net"),RB=dI(),NB=Gy(),Ky="transport",kB="transport_flowctrl",OB=Og().version,{HTTP2_HEADER_AUTHORITY:MB,HTTP2_HEADER_CONTENT_TYPE:xB,HTTP2_HEADER_METHOD:PB,HTTP2_HEADER_PATH:FB,HTTP2_HEADER_TE:LB,HTTP2_HEADER_USER_AGENT:BB}=Qy.constants,VB=2e4,qB=Buffer.from("too_many_pings","ascii"),$y=class{constructor(e,t,r,i){this.session=e,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=VB,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new Hy.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,Gd.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Hy.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${OB}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===Qy.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(qB)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),bo.isTracerEnabled(Ky)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,Gd.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,Gd.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let c=i,u=c.getCipher(),d=c.getCertificate(),h=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:h&&"raw"in h?h.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){bo.trace(Ml.LogVerbosity.DEBUG,Ky,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){bo.trace(Ml.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){bo.trace(Ml.LogVerbosity.DEBUG,kB,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){bo.trace(Ml.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[MB]=t,o[BB]=this.userAgent,o[xB]="application/grpc",o[PB]="POST",o[FB]=r,o[LB]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}},c=new RB.Http2SubchannelCall(a,l,i,this,(0,NB.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}shutdown(){this.session.close(),(0,Hy.unregisterChannelzRef)(this.channelzRef)}},Wy=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){bo.trace(Ml.LogVerbosity.DEBUG,Ky,(0,Co.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;i.realTarget?(u=(0,Co.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,Co.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,Gd.subchannelAddressToString)(e)));let d=(0,fI.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),h=t._getConnectionOptions()||{};h.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?h.maxSessionMemory=r["grpc-node.max_session_memory"]:h.maxSessionMemory=Number.MAX_SAFE_INTEGER;let p="http://";if("secureContext"in h){if(p="https://",r["grpc.ssl_target_name_override"]){let S=r["grpc.ssl_target_name_override"];h.checkServerIdentity=(R,w)=>(0,hI.checkServerIdentity)(S,w),h.servername=S}else{let S=(c=(l=(0,Co.splitHostPort)(d))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";h.servername=S}i.socket&&(h.createConnection=(S,R)=>i.socket)}else h.createConnection=(S,R)=>i.socket?i.socket:DB.connect(e);h=Object.assign(Object.assign(Object.assign({},h),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let y=Qy.connect(p+d,h);this.session=y;let _="Failed to connect";y.unref(),y.once("connect",()=>{y.removeAllListeners(),s(new $y(y,e,r,u)),this.session=null}),y.once("close",()=>{this.session=null,setImmediate(()=>{o(`${_} (${new Date().toISOString()})`)})}),y.once("error",S=>{_=S.message,this.trace("connection failed with error "+_)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,hI.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,fI.getDefaultAuthority)((i=(0,Co.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,Co.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,IB.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};Hd.Http2SubchannelConnector=Wy});var gI=T(Ao=>{"use strict";Object.defineProperty(Ao,"__esModule",{value:!0});Ao.getSubchannelPool=Ao.SubchannelPool=void 0;var UB=Z0(),zB=sI(),jB=xn(),GB=Vt(),HB=pI(),KB=1e4,xl=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},KB),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,GB.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,jB.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,UB.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new zB.Subchannel(e,t,r,i,new HB.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};Ao.SubchannelPool=xl;var $B=new xl;function WB(n){return n?$B:new xl}Ao.getSubchannelPool=WB});var Xy=T(Io=>{"use strict";Object.defineProperty(Io,"__esModule",{value:!0});Io.FilterStackFactory=Io.FilterStack=void 0;var Kd=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};Io.FilterStack=Kd;var Yy=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new Kd(this.factories.map(e=>e.createFilter()))}};Io.FilterStackFactory=Yy});var Jy=T($d=>{"use strict";Object.defineProperty($d,"__esModule",{value:!0});$d.CompressionAlgorithms=void 0;var mI=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(mI||($d.CompressionAlgorithms=mI={}))});var Qd=T(Wd=>{"use strict";Object.defineProperty(Wd,"__esModule",{value:!0});Wd.BaseFilter=void 0;var Zy=class{sendMetadata(e){return g(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return g(this,null,function*(){return e})}receiveMessage(e){return g(this,null,function*(){return e})}receiveTrailers(e){return e}};Wd.BaseFilter=Zy});var _I=T(Ro=>{"use strict";Object.defineProperty(Ro,"__esModule",{value:!0});Ro.CompressionFilterFactory=Ro.CompressionFilter=void 0;var Yd=le("zlib"),vI=Jy(),QB=oe(),YB=Qd(),XB=Oe(),JB=n=>typeof n=="number"&&typeof vI.CompressionAlgorithms[n]=="string",Do=class{writeMessage(e,t){return g(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return g(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},Ji=class extends Do{compressMessage(e){return g(this,null,function*(){return e})}writeMessage(e,t){return g(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},ev=class extends Do{compressMessage(e){return new Promise((t,r)=>{Yd.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{Yd.inflate(e,(i,s)=>{i?r(i):t(s)})})}},tv=class extends Do{compressMessage(e){return new Promise((t,r)=>{Yd.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{Yd.unzip(e,(i,s)=>{i?r(i):t(s)})})}},nv=class extends Do{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function yI(n){switch(n){case"identity":return new Ji;case"deflate":return new ev;case"gzip":return new tv;default:return new nv(n)}}var Xd=class extends YB.BaseFilter{constructor(e,t){var r;super(),this.sharedFilterConfig=t,this.sendCompression=new Ji,this.receiveCompression=new Ji,this.currentCompressionAlgorithm="identity";let i=e["grpc.default_compression_algorithm"];if(i!==void 0)if(JB(i)){let s=vI.CompressionAlgorithms[i],o=(r=t.serverSupportedEncodingHeader)===null||r===void 0?void 0:r.split(",");(!o||o.includes(s))&&(this.currentCompressionAlgorithm=s,this.sendCompression=yI(this.currentCompressionAlgorithm))}else XB.log(QB.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${i}`)}sendMetadata(e){return g(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=yI(i))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new Ji,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return g(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof Ji?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return g(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};Ro.CompressionFilter=Xd;var rv=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new Xd(this.options,this.sharedFilterConfig)}};Ro.CompressionFilterFactory=rv});var TI=T(No=>{"use strict";Object.defineProperty(No,"__esModule",{value:!0});No.MaxMessageSizeFilterFactory=No.MaxMessageSizeFilter=void 0;var ZB=Qd(),Jd=oe(),SI=bt(),Zd=class extends ZB.BaseFilter{constructor(e){super(),this.maxSendMessageSize=Jd.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Jd.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,"grpc.max_send_message_length"in e&&(this.maxSendMessageSize=e["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in e&&(this.maxReceiveMessageSize=e["grpc.max_receive_message_length"])}sendMessage(e){return g(this,null,function*(){if(this.maxSendMessageSize===-1)return e;{let t=yield e;if(t.message.length>this.maxSendMessageSize)throw{code:Jd.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${t.message.length} vs. ${this.maxSendMessageSize})`,metadata:new SI.Metadata};return t}})}receiveMessage(e){return g(this,null,function*(){if(this.maxReceiveMessageSize===-1)return e;{let t=yield e;if(t.length>this.maxReceiveMessageSize)throw{code:Jd.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${t.length} vs. ${this.maxReceiveMessageSize})`,metadata:new SI.Metadata};return t}})}};No.MaxMessageSizeFilter=Zd;var iv=class{constructor(e){this.options=e}createFilter(){return new Zd(this.options)}};No.MaxMessageSizeFilterFactory=iv});var eh=T(Gn=>{"use strict";Object.defineProperty(Gn,"__esModule",{value:!0});Gn.deadlineToString=Gn.getRelativeTimeout=Gn.getDeadlineTimeoutString=Gn.minDeadline=void 0;function eV(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}Gn.minDeadline=eV;var tV=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function nV(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of tV){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}Gn.getDeadlineTimeoutString=nV;var rV=2147483647;function iV(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>rV?1/0:r}Gn.getRelativeTimeout=iV;function sV(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}Gn.deadlineToString=sV});var nh=T(th=>{"use strict";Object.defineProperty(th,"__esModule",{value:!0});th.restrictControlPlaneStatusCode=void 0;var Hn=oe(),oV=[Hn.Status.OK,Hn.Status.INVALID_ARGUMENT,Hn.Status.NOT_FOUND,Hn.Status.ALREADY_EXISTS,Hn.Status.FAILED_PRECONDITION,Hn.Status.ABORTED,Hn.Status.OUT_OF_RANGE,Hn.Status.DATA_LOSS];function aV(n,e){return oV.includes(n)?{code:Hn.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${Hn.Status[n]} ${e}`}:{code:n,details:e}}th.restrictControlPlaneStatusCode=aV});var EI=T(sh=>{"use strict";Object.defineProperty(sh,"__esModule",{value:!0});sh.LoadBalancingCall=void 0;var wI=Wt(),rh=oe(),lV=eh(),ih=bt(),Pl=jr(),cV=Vt(),uV=Oe(),sv=nh(),dV=le("http2"),hV="load_balancing_call",ov=class{constructor(e,t,r,i,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),d="";u.length>=2&&(d=u[1]);let h=(c=(l=(0,cV.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${h}/${d}`}trace(e){uV.trace(rh.LogVerbosity.DEBUG,hV,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+Pl.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case Pl.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let d=this.metadata.clone();if(d.merge(a),d.get("authorization").length>1&&this.outputStatus({code:rh.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new ih.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==wI.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+wI.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&d.set("grpc-timeout",(0,lV.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(d,this.host,this.methodName,{onReceiveMetadata:h=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(h)},onReceiveMessage:h=>{this.trace("Received message"),this.listener.onReceiveMessage(h)},onReceiveStatus:h=>{this.trace("Received status"),h.rstCode===dV.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(h,"REFUSED"):this.outputStatus(h,"PROCESSED")}})}catch(h){this.trace("Failed to start call on picked subchannel "+i+" with error "+h.message),this.outputStatus({code:rh.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+h.message,metadata:new ih.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,sv.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:rh.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new ih.Metadata},"PROCESSED")});break;case Pl.PickResultType.DROP:let{code:s,details:o}=(0,sv.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case Pl.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,sv.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case Pl.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new ih.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};sh.LoadBalancingCall=ov});var bI=T(ah=>{"use strict";Object.defineProperty(ah,"__esModule",{value:!0});ah.ResolvingCall=void 0;var ko=oe(),oh=eh(),CI=bt(),fV=Oe(),pV=nh(),gV="resolving_call",av=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&ko.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(ko.Status.CANCELLED,"Cancelled by parent call")}),r.flags&ko.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,oh.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){fV.trace(ko.LogVerbosity.DEBUG,gV,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,oh.deadlineToString)(this.deadline));let e=(0,oh.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(ko.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==ko.Status.OK){let{code:r,details:i}=(0,pV.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new CI.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,oh.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new CI.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};ah.ResolvingCall=av});var AI=T(oi=>{"use strict";Object.defineProperty(oi,"__esModule",{value:!0});oi.RetryingCall=oi.MessageBufferTracker=oi.RetryThrottler=void 0;var lh=oe(),mV=bt(),yV=Oe(),vV="retrying_call",cv=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};oi.RetryThrottler=cv;var uv=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};oi.MessageBufferTracker=uv;var lv="grpc-previous-rpc-attempts",dv=class{constructor(e,t,r,i,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){yV.trace(lh.LogVerbosity.DEBUG,vV,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new mV.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(lh.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===lh.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===lh.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(lv,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set(lv,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set(lv,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};oi.RetryingCall=dv});var uh=T(ch=>{"use strict";Object.defineProperty(ch,"__esModule",{value:!0});ch.BaseSubchannelWrapper=void 0;var hv=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};ch.BaseSubchannelWrapper=hv});var RI=T(fh=>{"use strict";Object.defineProperty(fh,"__esModule",{value:!0});fh.InternalChannel=void 0;var _V=$u(),SV=J0(),TV=gI(),II=jr(),Fl=oe(),wV=Xy(),EV=_I(),DI=On(),fv=Oe(),CV=TI(),bV=qy(),dh=Vt(),Kn=Wt(),Ll=Xi(),AV=EI(),IV=eh(),DV=bI(),pv=Gy(),RV=nh(),gv=AI(),NV=uh(),kV=2147483647,OV=1e3,MV=30*60*1e3,hh=new Map,xV=1<<24,PV=1<<20,mv=class extends NV.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},yv=class{constructor(e,t,r){var i,s,o,a,l,c,u,d;if(this.credentials=t,this.options=r,this.connectivityState=Kn.ConnectivityState.IDLE,this.currentPicker=new II.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new Ll.ChannelzCallTracker,this.childrenTracker=new Ll.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof _V.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let h=(0,dh.parseUri)(e);if(h===null)throw new Error(`Could not parse target name "${e}"`);let p=(0,DI.mapUriDefaultScheme)(h);if(p===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},kV),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Ll.ChannelzTrace,this.channelzRef=(0,Ll.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,DI.getDefaultAuthority)(p);let y=(0,bV.mapProxyName)(p,r);this.target=y.target,this.options=Object.assign({},this.options,y.extraOptions),this.subchannelPool=(0,TV.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new gv.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:xV,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:PV),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:MV,OV);let _={createSubchannel:(R,w)=>{let N=this.subchannelPool.getOrCreateSubchannel(this.target,R,Object.assign({},this.options,w),this.credentials);N.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",N.getChannelzRef());let k=new mv(N,this);return this.wrappedSubchannels.add(k),k},updateState:(R,w)=>{this.currentPicker=w;let N=this.pickQueue.slice();this.pickQueue=[],N.length>0&&this.callRefTimerUnref();for(let k of N)k.doPick();this.updateState(R)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:R=>{this.channelzEnabled&&this.childrenTracker.refChild(R)},removeChannelzChild:R=>{this.channelzEnabled&&this.childrenTracker.unrefChild(R)}};this.resolvingLoadBalancer=new SV.ResolvingLoadBalancer(this.target,_,r,(R,w)=>{R.retryThrottling?hh.set(this.getTarget(),new gv.RetryThrottler(R.retryThrottling.maxTokens,R.retryThrottling.tokenRatio,hh.get(this.getTarget()))):hh.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=w,this.currentResolutionError=null,process.nextTick(()=>{let N=this.configSelectionQueue;this.configSelectionQueue=[],N.length>0&&this.callRefTimerUnref();for(let k of N)k.getConfig()})},R=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+R.code+' and details "'+R.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,RV.restrictControlPlaneStatusCode)(R.code,R.details)),{metadata:R.metadata}));let w=this.configSelectionQueue;this.configSelectionQueue=[],w.length>0&&this.callRefTimerUnref();for(let N of w)N.reportResolverError(R)}),this.filterStackFactory=new wV.FilterStackFactory([new CV.MaxMessageSizeFilterFactory(this.options),new EV.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let S=new Error;(0,fv.trace)(Fl.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((d=S.stack)===null||d===void 0?void 0:d.substring(S.stack.indexOf(`
`)+1))),this.lastActivityTimestamp=new Date}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,fv.trace)(t??Fl.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,dh.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,fv.trace)(Fl.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,dh.uriToString)(this.target)+" "+Kn.ConnectivityState[this.connectivityState]+" -> "+Kn.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Kn.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==Kn.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(Kn.ConnectivityState.IDLE),this.currentPicker=new II.QueuePicker(this.resolvingLoadBalancer),this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}startIdleTimeout(e){var t,r;this.idleTimer=setTimeout(()=>{if(this.callCount>0){this.startIdleTimeout(this.idleTimeoutMs);return}let s=new Date().valueOf()-this.lastActivityTimestamp.valueOf();s>=this.idleTimeoutMs?(this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()):this.startIdleTimeout(this.idleTimeoutMs-s)},e),(r=(t=this.idleTimer).unref)===null||r===void 0||r.call(t)}maybeStartIdleTimer(){this.connectivityState!==Kn.ConnectivityState.SHUTDOWN&&!this.idleTimer&&this.startIdleTimeout(this.idleTimeoutMs)}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1}onCallEnd(e){this.channelzEnabled&&(e.code===Fl.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,pv.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new AV.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,pv.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new gv.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,hh.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,pv.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,IV.deadlineToString)(t));let a={deadline:t,flags:s??Fl.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new DV.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(Kn.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,Ll.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,dh.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.lastActivityTimestamp=new Date,this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===Kn.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===Kn.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};fh.InternalChannel=yv});var Tm=T(ph=>{"use strict";Object.defineProperty(ph,"__esModule",{value:!0});ph.ChannelImplementation=void 0;var FV=$u(),LV=RI(),vv=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof FV.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new LV.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};ph.ChannelImplementation=vv});var VI=T(rn=>{"use strict";Object.defineProperty(rn,"__esModule",{value:!0});rn.Http2ServerCallStream=rn.ServerDuplexStreamImpl=rn.ServerWritableStreamImpl=rn.ServerReadableStreamImpl=rn.ServerUnaryCallImpl=void 0;var xI=le("events"),Oo=le("http2"),Tv=le("stream"),PI=le("zlib"),FI=le("util"),Ce=oe(),wv=bt(),BV=zy(),LI=Oe(),Vl=Uu(),BI="server_call",VV=(0,FI.promisify)(PI.unzip),qV=(0,FI.promisify)(PI.inflate);function Bl(n){LI.trace(Ce.LogVerbosity.DEBUG,BI,n)}var UV="grpc-accept-encoding",zV="grpc-encoding",NI="grpc-message",kI="grpc-status",OI="grpc-timeout",jV=/(\d{1,8})\s*([HMSmun])/,GV={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},HV={[UV]:"identity,deflate,gzip",[zV]:"identity"},MI={[Oo.constants.HTTP2_HEADER_STATUS]:Oo.constants.HTTP_STATUS_OK,[Oo.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},KV={waitForTrailers:!0},_v=class extends xI.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};rn.ServerUnaryCallImpl=_v;var gh=class extends Tv.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};rn.ServerReadableStreamImpl=gh;var ql=class extends Tv.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new wv.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,Vl.getErrorMessage)(i),code:Ce.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:Ce.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};rn.ServerWritableStreamImpl=ql;var Mo=class extends Tv.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new wv.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};rn.ServerDuplexStreamImpl=Mo;Mo.prototype._read=gh.prototype._read;Mo.prototype._write=ql.prototype._write;Mo.prototype._final=ql.prototype._final;var Sv=class extends xI.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=Ce.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Ce.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;Bl("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:Ce.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){return t==="deflate"?qV(e.subarray(5)):t==="gzip"?VV(e.subarray(5)):t==="identity"?e.subarray(5):Promise.reject({code:Ce.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},MI),HV),t);this.stream.respond(r,KV)}receiveMetadata(e){let t=wv.Metadata.fromHttp2Headers(e);LI.isTracerEnabled(BI)&&Bl("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get(OI);if(r.length>0){let i=r[0].toString().match(jV);if(i===null){let a=new Error("Invalid deadline");return a.code=Ce.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*GV[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout($V,s,this),t.remove(OI)}return t.remove(Oo.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(Oo.constants.HTTP2_HEADER_TE),t.remove(Oo.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(d){if(s+=d.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:Ce.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(d)}function u(d){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),d!==void 0){r({code:Ce.Status.INTERNAL,details:d.message});return}if(s===0){r({code:Ce.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let h=Buffer.concat(a,s),y=h.readUInt8(0)===1?e:"identity",_=o.getDecompressedMessage(h,y);if(Buffer.isBuffer(_)){t(o.deserializeMessageWithInternalError(_));return}_.then(S=>t(o.deserializeMessageWithInternalError(S)),S=>r(S.code?S:{code:Ce.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return g(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,Vl.getErrorMessage)(t),code:Ce.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return g(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:Ce.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,Vl.getErrorMessage)(s),code:Ce.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===Ce.Status.OK),!this.checkCancelled())if(Bl("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+Ce.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[kI]:e.code,[NI]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[kI]:e.code,[NI]:encodeURI(e.details)},MI),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:Ce.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:Ce.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new BV.StreamDecoder,i=!1,s=!1,o=!1,a=()=>g(this,null,function*(){!o&&i&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>g(this,null,function*(){let c=r.write(l);s=!0,this.stream.pause();for(let u of c){if(this.maxReceiveMessageSize!==-1&&u.length>this.maxReceiveMessageSize){this.sendError({code:Ce.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${u.length} vs. ${this.maxReceiveMessageSize})`});return}this.emit("receiveMessage");let h=u.readUInt8(0)===1?t:"identity",p=yield this.getDecompressedMessage(u,h);if(!p)return;yield this.pushOrBufferMessage(e,p)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>g(this,null,function*(){i=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return g(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return g(this,null,function*(){if(t===null){Bl("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}Bl("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,Vl.getErrorCode)(r);(i===null||i<Ce.Status.OK||i>Ce.Status.UNAUTHENTICATED)&&(i=Ce.Status.INTERNAL),e.emit("error",{details:(0,Vl.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};rn.Http2ServerCallStream=Sv;function $V(n){let e=new Error("Deadline exceeded");e.code=Ce.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var bv=T(mh=>{"use strict";Object.defineProperty(mh,"__esModule",{value:!0});mh.ServerCredentials=void 0;var qI=Hg(),Ul=class{static createInsecure(){return new Ev}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new Cv({ca:e||(0,qI.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:qI.CIPHER_SUITES})}};mh.ServerCredentials=Ul;var Ev=class extends Ul{_isSecure(){return!1}_getSettings(){return null}},Cv=class extends Ul{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var jI=T(_h=>{"use strict";Object.defineProperty(_h,"__esModule",{value:!0});_h.Server=void 0;var ai=le("http2"),mr=oe(),Zi=VI(),WV=bv(),UI=On(),yh=Oe(),_n=xn(),QV=Vt(),xt=Xi(),vh=~(1<<31),YV=~(1<<31),XV=2e4,{HTTP2_HEADER_PATH:zI}=ai.constants,JV="server";function ZV(){}function Av(n){return{code:mr.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function eq(n,e){let t=Av(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var Iv=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new xt.ChannelzTrace,this.callTracker=new xt.ChannelzCallTracker,this.listenerChildrenTracker=new xt.ChannelzChildrenTracker,this.sessionChildrenTracker=new xt.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,xt.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:vh,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:vh,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:YV,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:XV,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,_n.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,_n.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let d=o,h=d.getCipher(),p=d.getCertificate(),y=d.getPeerCertificate();c={cipherSuiteStandardName:(t=h.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:h.standardName?null:h.name,localCertificate:p&&"raw"in p?p.raw:null,remoteCertificate:y&&"raw"in y?y.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){yh.trace(mr.LogVerbosity.DEBUG,JV,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=eq(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof WV.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,QV.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,UI.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(p,y)=>{process.nextTick(()=>r(p,y))},l=()=>{let p;if(t._isSecure()){let y=Object.assign(o,t._getSettings());y.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,p=ai.createSecureServer(y),p.on("secureConnection",_=>{_.on("error",S=>{this.trace("An incoming TLS connection closed with error: "+S.message)})})}else p=ai.createServer(o);return p.setTimeout(0,ZV),this._setupHandlers(p),p},c=(p,y,_)=>p.length===0?Promise.resolve({port:y,count:_}):Promise.all(p.map(S=>{this.trace("Attempting to bind "+(0,_n.subchannelAddressToString)(S));let R;(0,_n.isTcpSubchannelAddress)(S)?R={host:S.host,port:y}:R=S;let w=l();return new Promise((N,k)=>{let V=H=>{this.trace("Failed to bind "+(0,_n.subchannelAddressToString)(S)+" with error "+H.message),N(H)};w.once("error",V),w.listen(R,()=>{if(this.shutdown){w.close(),N(new Error("bindAsync failed because server is shutdown"));return}let H=w.address(),X;typeof H=="string"?X={path:H}:X={host:H.address,port:H.port};let We=(0,xt.registerChannelzSocket)((0,_n.subchannelAddressToString)(X),()=>({localAddress:X,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(We),this.http2ServerList.push({server:w,channelzRef:We}),this.trace("Successfully bound "+(0,_n.subchannelAddressToString)(X)),N("port"in X?X.port:y),w.removeListener("error",V)})})})).then(S=>{let R=0;for(let w of S)if(typeof w=="number"&&(R+=1,w!==y))throw new Error("Invalid state: multiple port numbers added from single address");return{port:y,count:R+_}}),u=p=>{if(p.length===0)return Promise.resolve({port:0,count:0});let y=p[0],_=l();return new Promise((S,R)=>{let w=N=>{this.trace("Failed to bind "+(0,_n.subchannelAddressToString)(y)+" with error "+N.message),S(u(p.slice(1)))};_.once("error",w),_.listen(y,()=>{if(this.shutdown){_.close(),S({port:0,count:0});return}let N=_.address(),k={host:N.address,port:N.port},V=(0,xt.registerChannelzSocket)((0,_n.subchannelAddressToString)(k),()=>({localAddress:k,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(V),this.http2ServerList.push({server:_,channelzRef:V}),this.trace("Successfully bound "+(0,_n.subchannelAddressToString)(k)),S(c(p.slice(1),N.port,1)),_.removeListener("error",w)})})},d={onSuccessfulResolution:(p,y,_)=>{if(d.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),p.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let S;(0,_n.isTcpSubchannelAddress)(p[0])?p[0].port===0?S=u(p):S=c(p,p[0].port,0):S=c(p,1,0),S.then(R=>{if(R.count===0){let w=`No address added out of total ${p.length} resolved`;yh.log(mr.LogVerbosity.ERROR,w),a(new Error(w),0)}else R.count<p.length&&yh.log(mr.LogVerbosity.INFO,`WARNING Only ${R.count} addresses added out of total ${p.length} resolved`),a(null,R.port)},R=>{let w=`No address added out of total ${p.length} resolved`;yh.log(mr.LogVerbosity.ERROR,w),a(new Error(w),0)})},onError:p=>{a(new Error(p.details),0)}};(0,UI.createResolver)(s,d,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,xt.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(ai.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,xt.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,xt.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,xt.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[ai.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[ai.constants.HTTP2_HEADER_STATUS]:ai.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new Zi.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=mr.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[zI],s=this._retrieveHandler(i);if(!s){this._respondWithError(Av(i),e,r);return}let o=new Zi.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===mr.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:mr.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[zI],i=this._retrieveHandler(r);if(!i){this._respondWithError(Av(r),e,null);return}let s=new Zi.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:mr.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")tq(e,t,s,o);else if(a==="clientStream")nq(e,t,s,o);else if(a==="serverStream")rq(e,t,s,o);else if(a==="bidi")iq(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let d=(0,xt.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),h={ref:d,streamTracker:new xt.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,h);let p=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+p),this.sessionChildrenTracker.refChild(d));let y=null,_=null,S=!1;if(this.maxConnectionAgeMs!==vh){let w=this.maxConnectionAgeMs/10,N=Math.random()*w*2-w;y=(l=(a=setTimeout(()=>{var k,V;S=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+p);try{s.goaway(ai.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==vh&&(_=(V=(k=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||V===void 0?void 0:V.call(k))},this.maxConnectionAgeMs+N)).unref)===null||l===void 0?void 0:l.call(a)}let R=(u=(c=setInterval(()=>{var w,N;let k=(N=(w=setTimeout(()=>{S=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+p),s.close()},this.keepaliveTimeoutMs)).unref)===null||N===void 0?void 0:N.call(w);try{s.ping((V,H,X)=>{clearTimeout(k)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(S||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+p),this.sessionChildrenTracker.unrefChild(d),(0,xt.unregisterChannelzRef)(d)),y&&clearTimeout(y),_&&clearTimeout(_),R&&clearTimeout(R),this.sessions.delete(s)})})}};_h.Server=Iv;function tq(n,e,t,r){return g(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Zi.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(i){n.sendError(i)}})}function nq(n,e,t,r){let i=new Zi.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,c){i.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function rq(n,e,t,r){return g(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new Zi.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function iq(n,e,t,r){let i=new Zi.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var GI=T(Sh=>{"use strict";Object.defineProperty(Sh,"__esModule",{value:!0});Sh.StatusBuilder=void 0;var Dv=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};Sh.StatusBuilder=Dv});var Rv=T(li=>{"use strict";Object.defineProperty(li,"__esModule",{value:!0});li.isDuration=li.durationToMs=li.msToDuration=void 0;function sq(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}li.msToDuration=sq;function oq(n){return n.seconds*1e3+n.nanos/1e6|0}li.durationToMs=oq;function aq(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}li.isDuration=aq});var Lv=T(ci=>{"use strict";var Nv;Object.defineProperty(ci,"__esModule",{value:!0});ci.setup=ci.OutlierDetectionLoadBalancer=ci.OutlierDetectionLoadBalancingConfig=void 0;var wh=Wt(),KI=oe(),es=Rv(),$I=Bv(),WI=Vr(),lq=ed(),cq=jr(),HI=xn(),uq=uh(),dq=Oe(),hq="outlier_detection";function et(n){dq.trace(KI.LogVerbosity.DEBUG,hq,n)}var Fv="outlier_detection",fq=((Nv=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&Nv!==void 0?Nv:"true")==="true",pq={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},gq={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function xo(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function kv(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,es.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function Th(n,e,t){let r=t?`${t}.${e}`:e;if(xo(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var zl=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},pq),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},gq),o):null}getLoadBalancerName(){return Fv}toJsonObject(){return{interval:(0,es.msToDuration)(this.intervalMs),base_ejection_time:(0,es.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,es.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(kv(e,"interval"),kv(e,"base_ejection_time"),kv(e,"max_ejection_time"),Th(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");xo(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),Th(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),xo(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),xo(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");Th(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),Th(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),xo(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),xo(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,es.durationToMs)(e.interval):null,e.base_ejection_time?(0,es.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,es.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(WI.validateLoadBalancingConfig))}};ci.OutlierDetectionLoadBalancingConfig=zl;var Mv=class extends uq.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?wh.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,wh.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,wh.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function Ov(){return{success:0,failure:0}}var xv=class{constructor(){this.activeBucket=Ov(),this.inactiveBucket=Ov()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=Ov()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},Pv=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===cq.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===KI.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},Eh=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new lq.ChildLoadBalancerHandler((0,$I.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,HI.subchannelAddressToString)(t)),o=new Mv(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===wh.ConnectivityState.READY?e.updateState(t,new Pv(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;et("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[d,h]of this.addressMap){let p=h.counter.getLastSuccesses(),y=h.counter.getLastFailures();et("Stats for "+d+": successes="+p+" failures="+y+" targetRequestVolume="+r),p+y>=r&&(i+=1,s.push(p/(p+y)))}if(et("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((d,h)=>d+h)/s.length,a=0;for(let d of s){let h=d-o;a+=h*h}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);et("stdev="+c+" ejectionThreshold="+u);for(let[d,h]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let p=h.counter.getLastSuccesses(),y=h.counter.getLastFailures();if(p+y<r)continue;let _=p/(p+y);if(et("Checking candidate "+d+" successRate="+_),_<u){let S=Math.random()*100;et("Candidate "+d+" randomNumber="+S+" enforcement_percentage="+t.enforcement_percentage),S<t.enforcement_percentage&&(et("Ejecting candidate "+d),this.eject(h,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;et("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(et("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;et("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(et("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(et("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(et("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof zl))return;let i=new Set;for(let o of e)i.add((0,HI.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(et("Adding map entry for "+o),this.addressMap.set(o,{counter:new xv,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(et("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,WI.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){et("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else et("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{et("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return Fv}};ci.OutlierDetectionLoadBalancer=Eh;function mq(){fq&&(0,$I.registerLoadBalancerType)(Fv,Eh,zl)}ci.setup=mq});var Bv=T($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.OutlierDetectionLoadBalancingConfig=$.BaseSubchannelWrapper=$.registerAdminService=$.FilterStackFactory=$.BaseFilter=$.PickResultType=$.QueuePicker=$.UnavailablePicker=$.ChildLoadBalancerHandler=$.subchannelAddressToString=$.validateLoadBalancingConfig=$.getFirstUsableConfig=$.registerLoadBalancerType=$.createChildChannelControlHelper=$.BackoffTimeout=$.durationToMs=$.uriToString=$.createResolver=$.registerResolver=$.log=$.trace=void 0;var QI=Oe();Object.defineProperty($,"trace",{enumerable:!0,get:function(){return QI.trace}});Object.defineProperty($,"log",{enumerable:!0,get:function(){return QI.log}});var YI=On();Object.defineProperty($,"registerResolver",{enumerable:!0,get:function(){return YI.registerResolver}});Object.defineProperty($,"createResolver",{enumerable:!0,get:function(){return YI.createResolver}});var yq=Vt();Object.defineProperty($,"uriToString",{enumerable:!0,get:function(){return yq.uriToString}});var vq=Rv();Object.defineProperty($,"durationToMs",{enumerable:!0,get:function(){return vq.durationToMs}});var _q=ul();Object.defineProperty($,"BackoffTimeout",{enumerable:!0,get:function(){return _q.BackoffTimeout}});var Ch=Vr();Object.defineProperty($,"createChildChannelControlHelper",{enumerable:!0,get:function(){return Ch.createChildChannelControlHelper}});Object.defineProperty($,"registerLoadBalancerType",{enumerable:!0,get:function(){return Ch.registerLoadBalancerType}});Object.defineProperty($,"getFirstUsableConfig",{enumerable:!0,get:function(){return Ch.getFirstUsableConfig}});Object.defineProperty($,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return Ch.validateLoadBalancingConfig}});var Sq=xn();Object.defineProperty($,"subchannelAddressToString",{enumerable:!0,get:function(){return Sq.subchannelAddressToString}});var Tq=ed();Object.defineProperty($,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return Tq.ChildLoadBalancerHandler}});var Vv=jr();Object.defineProperty($,"UnavailablePicker",{enumerable:!0,get:function(){return Vv.UnavailablePicker}});Object.defineProperty($,"QueuePicker",{enumerable:!0,get:function(){return Vv.QueuePicker}});Object.defineProperty($,"PickResultType",{enumerable:!0,get:function(){return Vv.PickResultType}});var wq=Qd();Object.defineProperty($,"BaseFilter",{enumerable:!0,get:function(){return wq.BaseFilter}});var Eq=Xy();Object.defineProperty($,"FilterStackFactory",{enumerable:!0,get:function(){return Eq.FilterStackFactory}});var Cq=nd();Object.defineProperty($,"registerAdminService",{enumerable:!0,get:function(){return Cq.registerAdminService}});var bq=uh();Object.defineProperty($,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return bq.BaseSubchannelWrapper}});var Aq=Lv();Object.defineProperty($,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return Aq.OutlierDetectionLoadBalancingConfig}})});var XI=T(bh=>{"use strict";Object.defineProperty(bh,"__esModule",{value:!0});bh.setup=void 0;var Iq=On(),qv=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function Dq(){(0,Iq.registerResolver)("unix",qv)}bh.setup=Dq});var nD=T(Dh=>{"use strict";Object.defineProperty(Dh,"__esModule",{value:!0});Dh.setup=void 0;var JI=le("net"),Ah=oe(),Uv=bt(),ZI=On(),eD=Vt(),Rq=Oe(),Nq="ip_resolver";function tD(n){Rq.trace(Ah.LogVerbosity.DEBUG,Nq,n)}var zv="ipv4",jv="ipv6",kq=443,Ih=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,tD("Resolver constructed for target "+(0,eD.uriToString)(e));let s=[];if(!(e.scheme===zv||e.scheme===jv)){this.error={code:Ah.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new Uv.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,eD.splitHostPort)(a);if(l===null){this.error={code:Ah.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Uv.Metadata};return}if(e.scheme===zv&&!(0,JI.isIPv4)(l.host)||e.scheme===jv&&!(0,JI.isIPv6)(l.host)){this.error={code:Ah.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new Uv.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:kq})}this.addresses=s,tD("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function Oq(){(0,ZI.registerResolver)(zv,Ih),(0,ZI.registerResolver)(jv,Ih)}Dh.setup=Oq});var sD=T($n=>{"use strict";Object.defineProperty($n,"__esModule",{value:!0});$n.setup=$n.PickFirstLoadBalancer=$n.shuffled=$n.PickFirstLoadBalancingConfig=void 0;var rD=Vr(),yt=Wt(),Rh=jr(),Mq=Oe(),xq=oe(),Pq="pick_first";function Gv(n){Mq.trace(xq.LogVerbosity.DEBUG,Pq,n)}var jl="pick_first",Fq=250,Gl=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return jl}toJsonObject(){return{[jl]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};$n.PickFirstLoadBalancingConfig=Gl;var Hv=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:Rh.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function iD(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}$n.shuffled=iD;var Nh=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=yt.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(yt.ConnectivityState.READY,new Hv(this.currentPick)):this.children.length===0?this.updateState(yt.ConnectivityState.IDLE,new Rh.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(yt.ConnectivityState.TRANSIENT_FAILURE,new Rh.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(yt.ConnectivityState.CONNECTING,new Rh.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==yt.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===yt.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===yt.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===yt.ConnectivityState.IDLE||i===yt.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===yt.ConnectivityState.IDLE&&(Gv("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},Fq)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(Gv("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){Gv(yt.ConnectivityState[this.currentState]+" -> "+yt.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===yt.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===yt.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof Gl&&(t.getShuffleAddressList()&&(e=iD(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===yt.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return jl}};$n.PickFirstLoadBalancer=Nh;function Lq(){(0,rD.registerLoadBalancerType)(jl,Nh,Gl),(0,rD.registerDefaultLoadBalancerType)(jl)}$n.setup=Lq});var aD=T(Po=>{"use strict";Object.defineProperty(Po,"__esModule",{value:!0});Po.setup=Po.RoundRobinLoadBalancer=void 0;var Bq=Vr(),vt=Wt(),kh=jr(),Vq=xn(),qq=Oe(),Uq=oe(),zq="round_robin";function oD(n){qq.trace(Uq.LogVerbosity.DEBUG,zq,n)}var Oh="round_robin",Kv=class n{getLoadBalancerName(){return Oh}constructor(){}toJsonObject(){return{[Oh]:{}}}static createFromJson(e){return new n}},$v=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:kh.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},Mh=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=vt.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===vt.ConnectivityState.TRANSIENT_FAILURE||i===vt.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(vt.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===vt.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(vt.ConnectivityState.READY,new $v(e,t))}else this.countSubchannelsWithState(vt.ConnectivityState.CONNECTING)>0?this.updateState(vt.ConnectivityState.CONNECTING,new kh.QueuePicker(this)):this.countSubchannelsWithState(vt.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(vt.ConnectivityState.TRANSIENT_FAILURE,new kh.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(vt.ConnectivityState.IDLE,new kh.QueuePicker(this))}updateState(e,t){oD(vt.ConnectivityState[this.currentState]+" -> "+vt.ConnectivityState[e]),e===vt.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),oD("Connect to address list "+e.map(r=>(0,Vq.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===vt.ConnectivityState.IDLE||i===vt.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return Oh}};Po.RoundRobinLoadBalancer=Mh;function jq(){(0,Bq.registerLoadBalancerType)(Oh,Mh,Kv)}Po.setup=jq});var dD=T(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});B.experimental=B.addAdminServicesToServer=B.getChannelzHandlers=B.getChannelzServiceDefinition=B.InterceptorConfigurationError=B.InterceptingCall=B.RequesterBuilder=B.ListenerBuilder=B.StatusBuilder=B.getClientChannel=B.ServerCredentials=B.Server=B.setLogVerbosity=B.setLogger=B.load=B.loadObject=B.CallCredentials=B.ChannelCredentials=B.waitForClientReady=B.closeClient=B.Channel=B.makeGenericClientConstructor=B.makeClientConstructor=B.loadPackageDefinition=B.Client=B.compressionAlgorithms=B.propagate=B.connectivityState=B.status=B.logVerbosity=B.Metadata=B.credentials=void 0;var xh=jg();Object.defineProperty(B,"CallCredentials",{enumerable:!0,get:function(){return xh.CallCredentials}});var Gq=Tm();Object.defineProperty(B,"Channel",{enumerable:!0,get:function(){return Gq.ChannelImplementation}});var Hq=Jy();Object.defineProperty(B,"compressionAlgorithms",{enumerable:!0,get:function(){return Hq.CompressionAlgorithms}});var Kq=Wt();Object.defineProperty(B,"connectivityState",{enumerable:!0,get:function(){return Kq.ConnectivityState}});var Ph=$u();Object.defineProperty(B,"ChannelCredentials",{enumerable:!0,get:function(){return Ph.ChannelCredentials}});var lD=Sm();Object.defineProperty(B,"Client",{enumerable:!0,get:function(){return lD.Client}});var Wv=oe();Object.defineProperty(B,"logVerbosity",{enumerable:!0,get:function(){return Wv.LogVerbosity}});Object.defineProperty(B,"status",{enumerable:!0,get:function(){return Wv.Status}});Object.defineProperty(B,"propagate",{enumerable:!0,get:function(){return Wv.Propagate}});var cD=Oe(),Qv=Em();Object.defineProperty(B,"loadPackageDefinition",{enumerable:!0,get:function(){return Qv.loadPackageDefinition}});Object.defineProperty(B,"makeClientConstructor",{enumerable:!0,get:function(){return Qv.makeClientConstructor}});Object.defineProperty(B,"makeGenericClientConstructor",{enumerable:!0,get:function(){return Qv.makeClientConstructor}});var $q=bt();Object.defineProperty(B,"Metadata",{enumerable:!0,get:function(){return $q.Metadata}});var Wq=jI();Object.defineProperty(B,"Server",{enumerable:!0,get:function(){return Wq.Server}});var Qq=bv();Object.defineProperty(B,"ServerCredentials",{enumerable:!0,get:function(){return Qq.ServerCredentials}});var Yq=GI();Object.defineProperty(B,"StatusBuilder",{enumerable:!0,get:function(){return Yq.StatusBuilder}});B.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:Ph.ChannelCredentials.createInsecure,createSsl:Ph.ChannelCredentials.createSsl,createFromSecureContext:Ph.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:xh.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:xh.CallCredentials.createFromGoogleCredential,createEmpty:xh.CallCredentials.createEmpty};var Xq=n=>n.close();B.closeClient=Xq;var Jq=(n,e,t)=>n.waitForReady(e,t);B.waitForClientReady=Jq;var Zq=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};B.loadObject=Zq;var eU=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};B.load=eU;var tU=n=>{cD.setLogger(n)};B.setLogger=tU;var nU=n=>{cD.setLoggerVerbosity(n)};B.setLogVerbosity=nU;var rU=n=>lD.Client.prototype.getChannel.call(n);B.getClientChannel=rU;var Fh=ym();Object.defineProperty(B,"ListenerBuilder",{enumerable:!0,get:function(){return Fh.ListenerBuilder}});Object.defineProperty(B,"RequesterBuilder",{enumerable:!0,get:function(){return Fh.RequesterBuilder}});Object.defineProperty(B,"InterceptingCall",{enumerable:!0,get:function(){return Fh.InterceptingCall}});Object.defineProperty(B,"InterceptorConfigurationError",{enumerable:!0,get:function(){return Fh.InterceptorConfigurationError}});var uD=Xi();Object.defineProperty(B,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return uD.getChannelzServiceDefinition}});Object.defineProperty(B,"getChannelzHandlers",{enumerable:!0,get:function(){return uD.getChannelzHandlers}});var iU=nd();Object.defineProperty(B,"addAdminServicesToServer",{enumerable:!0,get:function(){return iU.addAdminServicesToServer}});var sU=Bv();B.experimental=sU;var oU=Vy(),aU=XI(),lU=nD(),cU=sD(),uU=aD(),dU=Lv(),hU=Xi();oU.setup(),aU.setup(),lU.setup(),cU.setup(),uU.setup(),dU.setup(),hU.setup()});var Bw=(()=>{let e=class e{constructor(r,i){this._renderer=r,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(r,i){this._renderer.setProperty(this._elementRef.nativeElement,r,i)}registerOnTouched(r){this.onTouched=r}registerOnChange(r){this.onChange=r}setDisabledState(r){this.setProperty("disabled",r)}};e.\u0275fac=function(i){return new(i||e)(_e(Oa),_e(ka))},e.\u0275dir=Lt({type:e});let n=e;return n})(),su=(()=>{let e=class e extends Bw{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Na(e)))(s||e)}})(),e.\u0275dir=Lt({type:e,features:[In]});let n=e;return n})(),Va=new Fe(""),Dk={provide:Va,useExisting:Rr(()=>Rk),multi:!0},Rk=(()=>{let e=class e extends su{writeValue(r){this.setProperty("checked",r)}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Na(e)))(s||e)}})(),e.\u0275dir=Lt({type:e,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(i,s){i&1&&Pi("change",function(a){return s.onChange(a.target.checked)})("blur",function(){return s.onTouched()})},features:[kr([Dk]),In]});let n=e;return n})(),Nk={provide:Va,useExisting:Rr(()=>Vw),multi:!0};function kk(){let n=gp()?gp().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var Ok=new Fe(""),Vw=(()=>{let e=class e extends Bw{constructor(r,i,s){super(r,i),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!kk())}writeValue(r){let i=r??"";this.setProperty("value",i)}_handleInput(r){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(r)}_compositionStart(){this._composing=!0}_compositionEnd(r){this._composing=!1,this._compositionMode&&this.onChange(r)}};e.\u0275fac=function(i){return new(i||e)(_e(Oa),_e(ka),_e(Ok,8))},e.\u0275dir=Lt({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&Pi("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[kr([Nk]),In]});let n=e;return n})();function Mr(n){return n==null||(typeof n=="string"||Array.isArray(n))&&n.length===0}function qw(n){return n!=null&&typeof n.length=="number"}var Tp=new Fe(""),wp=new Fe(""),Mk=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Rw=class{static min(e){return xk(e)}static max(e){return Pk(e)}static required(e){return Fk(e)}static requiredTrue(e){return Lk(e)}static email(e){return Bk(e)}static minLength(e){return Vk(e)}static maxLength(e){return qk(e)}static pattern(e){return Uk(e)}static nullValidator(e){return Uw(e)}static compose(e){return $w(e)}static composeAsync(e){return Ww(e)}};function xk(n){return e=>{if(Mr(e.value)||Mr(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t<n?{min:{min:n,actual:e.value}}:null}}function Pk(n){return e=>{if(Mr(e.value)||Mr(n))return null;let t=parseFloat(e.value);return!isNaN(t)&&t>n?{max:{max:n,actual:e.value}}:null}}function Fk(n){return Mr(n.value)?{required:!0}:null}function Lk(n){return n.value===!0?null:{required:!0}}function Bk(n){return Mr(n.value)||Mk.test(n.value)?null:{email:!0}}function Vk(n){return e=>Mr(e.value)||!qw(e.value)?null:e.value.length<n?{minlength:{requiredLength:n,actualLength:e.value.length}}:null}function qk(n){return e=>qw(e.value)&&e.value.length>n?{maxlength:{requiredLength:n,actualLength:e.value.length}}:null}function Uk(n){if(!n)return Uw;let e,t;return typeof n=="string"?(t="",n.charAt(0)!=="^"&&(t+="^"),t+=n,n.charAt(n.length-1)!=="$"&&(t+="$"),e=new RegExp(t)):(t=n.toString(),e=n),r=>{if(Mr(r.value))return null;let i=r.value;return e.test(i)?null:{pattern:{requiredPattern:t,actualValue:i}}}}function Uw(n){return null}function zw(n){return n!=null}function jw(n){return Sw(n)?An(n):n}function Gw(n){let e={};return n.forEach(t=>{e=t!=null?Ht(Ht({},e),t):e}),Object.keys(e).length===0?null:e}function Hw(n,e){return e.map(t=>t(n))}function zk(n){return!n.validate}function Kw(n){return n.map(e=>zk(e)?e:t=>e.validate(t))}function $w(n){if(!n)return null;let e=n.filter(zw);return e.length==0?null:function(t){return Gw(Hw(t,e))}}function Ep(n){return n!=null?$w(Kw(n)):null}function Ww(n){if(!n)return null;let e=n.filter(zw);return e.length==0?null:function(t){let r=Hw(t,e).map(jw);return hw(r).pipe(st(Gw))}}function Cp(n){return n!=null?Ww(Kw(n)):null}function Nw(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function Qw(n){return n._rawValidators}function Yw(n){return n._rawAsyncValidators}function _p(n){return n?Array.isArray(n)?n:[n]:[]}function Xc(n,e){return Array.isArray(n)?n.includes(e):n===e}function kw(n,e){let t=_p(e);return _p(n).forEach(i=>{Xc(t,i)||t.push(i)}),t}function Ow(n,e){return _p(e).filter(t=>!Xc(n,t))}var Jc=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=Ep(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Cp(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},Li=class extends Jc{get formDirective(){return null}get path(){return null}},Ba=class extends Jc{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},Sp=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},jk={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},b5=rr(Ht({},jk),{"[class.ng-submitted]":"isSubmitted"}),A5=(()=>{let e=class e extends Sp{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(_e(Ba,2))},e.\u0275dir=Lt({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&vw("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[In]});let n=e;return n})();var Pa="VALID",Yc="INVALID",Vs="PENDING",Fa="DISABLED";function Xw(n){return(ou(n)?n.validators:n)||null}function Gk(n){return Array.isArray(n)?Ep(n):n||null}function Jw(n,e){return(ou(e)?e.asyncValidators:n)||null}function Hk(n){return Array.isArray(n)?Cp(n):n||null}function ou(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function Kk(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new Kc(1e3,"");if(!r[t])throw new Kc(1001,"")}function $k(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new Kc(1002,"")})}var Zc=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Pa}get invalid(){return this.status===Yc}get pending(){return this.status==Vs}get disabled(){return this.status===Fa}get enabled(){return this.status!==Fa}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(kw(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(kw(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(Ow(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(Ow(e,this._rawAsyncValidators))}hasValidator(e){return Xc(this._rawValidators,e)}hasAsyncValidator(e){return Xc(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Vs,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Fa,this.errors=null,this._forEachChild(r=>{r.disable(rr(Ht({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(rr(Ht({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Pa,this._forEachChild(r=>{r.enable(rr(Ht({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(rr(Ht({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Pa||this.status===Vs)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Fa:Pa}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Vs,this._hasOwnPendingAsyncValidator=!0;let t=jw(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new Ls,this.statusChanges=new Ls}_calculateStatus(){return this._allControlsDisabled()?Fa:this.errors?Yc:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Vs)?Vs:this._anyControlsHaveStatus(Yc)?Yc:Pa}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){ou(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=Gk(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=Hk(this._rawAsyncValidators)}},eu=class extends Zc{constructor(e,t,r){super(Xw(t),Jw(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){$k(this,!0,e),Object.keys(e).forEach(r=>{Kk(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var au=new Fe("CallSetDisabledState",{providedIn:"root",factory:()=>bp}),bp="always";function Wk(n,e){return[...e.path,n]}function tu(n,e,t=bp){Ap(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),Yk(n,e),Jk(n,e),Xk(n,e),Qk(n,e)}function Mw(n,e,t=!0){let r=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(r),e.valueAccessor.registerOnTouched(r)),ru(n,e),n&&(e._invokeOnDestroyCallbacks(),n._registerOnCollectionChange(()=>{}))}function nu(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function Qk(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function Ap(n,e){let t=Qw(n);e.validator!==null?n.setValidators(Nw(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=Yw(n);e.asyncValidator!==null?n.setAsyncValidators(Nw(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();nu(e._rawValidators,i),nu(e._rawAsyncValidators,i)}function ru(n,e){let t=!1;if(n!==null){if(e.validator!==null){let i=Qw(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.validator);s.length!==i.length&&(t=!0,n.setValidators(s))}}if(e.asyncValidator!==null){let i=Yw(n);if(Array.isArray(i)&&i.length>0){let s=i.filter(o=>o!==e.asyncValidator);s.length!==i.length&&(t=!0,n.setAsyncValidators(s))}}}let r=()=>{};return nu(e._rawValidators,r),nu(e._rawAsyncValidators,r),t}function Yk(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&Zw(n,e)})}function Xk(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&Zw(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function Zw(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function Jk(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function eE(n,e){n==null,Ap(n,e)}function Zk(n,e){return ru(n,e)}function eO(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function tO(n){return Object.getPrototypeOf(n.constructor)===su}function tE(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function nO(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===Vw?t=s:tO(s)?r=s:i=s}),i||r||t||null}function rO(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}var iO={provide:Li,useExisting:Rr(()=>sO)},La=Promise.resolve(),sO=(()=>{let e=class e extends Li{constructor(r,i,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._directives=new Set,this.ngSubmit=new Ls,this.form=new eu({},Ep(r),Cp(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(r){La.then(()=>{let i=this._findContainer(r.path);r.control=i.registerControl(r.name,r.control),tu(r.control,r,this.callSetDisabledState),r.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(r)})}getControl(r){return this.form.get(r.path)}removeControl(r){La.then(()=>{let i=this._findContainer(r.path);i&&i.removeControl(r.name),this._directives.delete(r)})}addFormGroup(r){La.then(()=>{let i=this._findContainer(r.path),s=new eu({});eE(s,r),i.registerControl(r.name,s),s.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(r){La.then(()=>{let i=this._findContainer(r.path);i&&i.removeControl(r.name)})}getFormGroup(r){return this.form.get(r.path)}updateModel(r,i){La.then(()=>{this.form.get(r.path).setValue(i)})}setValue(r){this.control.setValue(r)}onSubmit(r){return this.submitted=!0,tE(this.form,this._directives),this.ngSubmit.emit(r),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(r){return r.pop(),r.length?this.form.get(r):this.form}};e.\u0275fac=function(i){return new(i||e)(_e(Tp,10),_e(wp,10),_e(au,8))},e.\u0275dir=Lt({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,s){i&1&&Pi("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{options:[Fs.None,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[kr([iO]),In]});let n=e;return n})();function xw(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function Pw(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var nE=class extends Zc{constructor(e=null,t,r){super(Xw(t),Jw(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),ou(t)&&(t.nonNullable||t.initialValueIsDefault)&&(Pw(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){xw(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){xw(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){Pw(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var oO=n=>n instanceof nE;var aO={provide:Ba,useExisting:Rr(()=>lO)},Fw=Promise.resolve(),lO=(()=>{let e=class e extends Ba{constructor(r,i,s,o,a,l){super(),this._changeDetectorRef=a,this.callSetDisabledState=l,this.control=new nE,this._registered=!1,this.name="",this.update=new Ls,this._parent=r,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=nO(this,o)}ngOnChanges(r){if(this._checkForErrors(),!this._registered||"name"in r){if(this._registered&&(this._checkName(),this.formDirective)){let i=r.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in r&&this._updateDisabled(r),eO(r,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){tu(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(r){Fw.then(()=>{this.control.setValue(r,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(r){let i=r.isDisabled.currentValue,s=i!==0&&ww(i);Fw.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(r){return this._parent?Wk(r,this._parent):[r]}};e.\u0275fac=function(i){return new(i||e)(_e(Li,9),_e(Tp,10),_e(wp,10),_e(Va,10),_e(Tw,8),_e(au,8))},e.\u0275dir=Lt({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[Fs.None,"disabled","isDisabled"],model:[Fs.None,"ngModel","model"],options:[Fs.None,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[kr([aO]),In,hp]});let n=e;return n})();var cO={provide:Li,useExisting:Rr(()=>uO)},uO=(()=>{let e=class e extends Li{constructor(r,i,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Ls,this._setValidators(r),this._setAsyncValidators(i)}ngOnChanges(r){this._checkFormPresent(),r.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(ru(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(r){let i=this.form.get(r.path);return tu(i,r,this.callSetDisabledState),i.updateValueAndValidity({emitEvent:!1}),this.directives.push(r),i}getControl(r){return this.form.get(r.path)}removeControl(r){Mw(r.control||null,r,!1),rO(this.directives,r)}addFormGroup(r){this._setUpFormContainer(r)}removeFormGroup(r){this._cleanUpFormContainer(r)}getFormGroup(r){return this.form.get(r.path)}addFormArray(r){this._setUpFormContainer(r)}removeFormArray(r){this._cleanUpFormContainer(r)}getFormArray(r){return this.form.get(r.path)}updateModel(r,i){this.form.get(r.path).setValue(i)}onSubmit(r){return this.submitted=!0,tE(this.form,this.directives),this.ngSubmit.emit(r),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1}_updateDomValue(){this.directives.forEach(r=>{let i=r.control,s=this.form.get(r.path);i!==s&&(Mw(i||null,r),oO(s)&&(tu(s,r,this.callSetDisabledState),r.control=s))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(r){let i=this.form.get(r.path);eE(i,r),i.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(r){if(this.form){let i=this.form.get(r.path);i&&Zk(i,r)&&i.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Ap(this.form,this),this._oldForm&&ru(this._oldForm,this)}_checkFormPresent(){this.form}};e.\u0275fac=function(i){return new(i||e)(_e(Tp,10),_e(wp,10),_e(au,8))},e.\u0275dir=Lt({type:e,selectors:[["","formGroup",""]],hostBindings:function(i,s){i&1&&Pi("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{form:[Fs.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[kr([cO]),In,hp]});let n=e;return n})();var dO={provide:Va,useExisting:Rr(()=>iE),multi:!0};function rE(n,e){return n==null?`${e}`:(e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function hO(n){return n.split(":")[0]}var iE=(()=>{let e=class e extends su{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(r){this._compareWith=r}writeValue(r){this.value=r;let i=this._getOptionId(r),s=rE(i,r);this.setProperty("value",s)}registerOnChange(r){this.onChange=i=>{this.value=this._getOptionValue(i),r(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(r){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i),r))return i;return null}_getOptionValue(r){let i=hO(r);return this._optionMap.has(i)?this._optionMap.get(i):r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Na(e)))(s||e)}})(),e.\u0275dir=Lt({type:e,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(i,s){i&1&&Pi("change",function(a){return s.onChange(a.target.value)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[kr([dO]),In]});let n=e;return n})(),D5=(()=>{let e=class e{constructor(r,i,s){this._element=r,this._renderer=i,this._select=s,this._select&&(this.id=this._select._registerOption())}set ngValue(r){this._select!=null&&(this._select._optionMap.set(this.id,r),this._setElementValue(rE(this.id,r)),this._select.writeValue(this._select.value))}set value(r){this._setElementValue(r),this._select&&this._select.writeValue(this._select.value)}_setElementValue(r){this._renderer.setProperty(this._element.nativeElement,"value",r)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};e.\u0275fac=function(i){return new(i||e)(_e(ka),_e(Oa),_e(iE,9))},e.\u0275dir=Lt({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let n=e;return n})(),fO={provide:Va,useExisting:Rr(()=>sE),multi:!0};function Lw(n,e){return n==null?`${e}`:(typeof e=="string"&&(e=`'${e}'`),e&&typeof e=="object"&&(e="Object"),`${n}: ${e}`.slice(0,50))}function pO(n){return n.split(":")[0]}var sE=(()=>{let e=class e extends su{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(r){this._compareWith=r}writeValue(r){this.value=r;let i;if(Array.isArray(r)){let s=r.map(o=>this._getOptionId(o));i=(o,a)=>{o._setSelected(s.indexOf(a.toString())>-1)}}else i=(s,o)=>{s._setSelected(!1)};this._optionMap.forEach(i)}registerOnChange(r){this.onChange=i=>{let s=[],o=i.selectedOptions;if(o!==void 0){let a=o;for(let l=0;l<a.length;l++){let c=a[l],u=this._getOptionValue(c.value);s.push(u)}}else{let a=i.options;for(let l=0;l<a.length;l++){let c=a[l];if(c.selected){let u=this._getOptionValue(c.value);s.push(u)}}}this.value=s,r(s)}}_registerOption(r){let i=(this._idCounter++).toString();return this._optionMap.set(i,r),i}_getOptionId(r){for(let i of this._optionMap.keys())if(this._compareWith(this._optionMap.get(i)._value,r))return i;return null}_getOptionValue(r){let i=pO(r);return this._optionMap.has(i)?this._optionMap.get(i)._value:r}};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Na(e)))(s||e)}})(),e.\u0275dir=Lt({type:e,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(i,s){i&1&&Pi("change",function(a){return s.onChange(a.target)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[kr([fO]),In]});let n=e;return n})(),R5=(()=>{let e=class e{constructor(r,i,s){this._element=r,this._renderer=i,this._select=s,this._select&&(this.id=this._select._registerOption(this))}set ngValue(r){this._select!=null&&(this._value=r,this._setElementValue(Lw(this.id,r)),this._select.writeValue(this._select.value))}set value(r){this._select?(this._value=r,this._setElementValue(Lw(this.id,r)),this._select.writeValue(this._select.value)):this._setElementValue(r)}_setElementValue(r){this._renderer.setProperty(this._element.nativeElement,"value",r)}_setSelected(r){this._renderer.setProperty(this._element.nativeElement,"selected",r)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};e.\u0275fac=function(i){return new(i||e)(_e(ka),_e(Oa),_e(sE,9))},e.\u0275dir=Lt({type:e,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let n=e;return n})();var gO=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=sr({type:e}),e.\u0275inj=ir({});let n=e;return n})();var N5=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:[{provide:au,useValue:r.callSetDisabledState??bp}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=sr({type:e}),e.\u0275inj=ir({imports:[gO]});let n=e;return n})();var mO="firebase",yO="10.9.0";Or(mO,yO,"app");var Vi=new fp("ANGULARFIRE2_VERSION");var vO=(n,e)=>{let t=e?[e]:Dw(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},Bi=class{constructor(){return vO(_O)}},_O="app-check";function Ip(){}var lu=class{zone;delegate;constructor(e,t=dw){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},Dp=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Ip,{},Ip,Ip)),t.pipe(mw({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},cu=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new lu(Zone.current)),this.insideAngular=t.run(()=>new lu(Zone.current,zc)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(ee(Nr))};static \u0275prov=xi({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function oE(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function U5(n){return n.pipe(Ir(oE().outsideAngular))}function kt(n){return SO(oE())(n)}function SO(n){return function(t){return t=t.lift(new Dp(n.ngZone)),t.pipe(Ps(n.outsideAngular),Ir(n.insideAngular))}}var EO=new Map,CO={activated:!1,tokenObservers:[]},bO={initialized:!1,enabled:!1};function cn(n){return EO.get(n)||Object.assign({},CO)}function hE(){return bO}var AO="https://content-firebaseappcheck.googleapis.com/v1";var IO="exchangeDebugToken",lE={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},Y5=24*60*60*1e3;var Np=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return g(this,null,function*(){this.stop();try{this.pending=new mp,this.pending.promise.catch(t=>{}),yield DO(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new mp,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function DO(n){return new Promise(e=>{setTimeout(e,n)})}var RO={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},xr=new Aw("appCheck","AppCheck",RO);function fE(n){if(!cn(n).activated)throw xr.create("use-before-activation",{appName:n.name})}function pE(r,i){return g(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let p=yield o.getHeartbeatsHeader();p&&(s["X-Firebase-Client"]=p)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(p){throw xr.create("fetch-network-error",{originalErrorMessage:p?.message})}if(l.status!==200)throw xr.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(p){throw xr.create("fetch-parse-error",{originalErrorMessage:p?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw xr.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let d=Number(u[1])*1e3,h=Date.now();return{token:c.token,expireTimeMillis:h+d,issuedAtTimeMillis:h}})}function gE(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${AO}/projects/${t}/apps/${r}:${IO}?key=${i}`,body:{debug_token:e}}}var NO="firebase-app-check-database",kO=1,kp="firebase-app-check-store";var uu=null;function OO(){return uu||(uu=new Promise((n,e)=>{try{let t=indexedDB.open(NO,kO);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(xr.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(kp,{keyPath:"compositeKey"})}}}catch(t){e(xr.create("storage-open",{originalErrorMessage:t?.message}))}}),uu)}function MO(n,e){return xO(PO(n),e)}function xO(n,e){return g(this,null,function*(){let r=(yield OO()).transaction(kp,"readwrite"),s=r.objectStore(kp).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},r.onerror=l=>{var c;a(xr.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function PO(n){return`${n.options.appId}-${n.name}`}var Op=new Qc("@firebase/app-check");function Rp(n,e){return Wc()?MO(n,e).catch(t=>{Op.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function mE(){return hE().enabled}function yE(){return g(this,null,function*(){let n=hE();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var FO={error:"UNKNOWN_ERROR"};function LO(n){return Ew.encodeString(JSON.stringify(n),!1)}function Mp(n,e=!1){return g(this,null,function*(){let t=n.app;fE(t);let r=cn(t),i=r.token,s;if(i&&!qa(i)&&(r.token=void 0,i=void 0),!i){let l=yield r.cachedTokenPromise;l&&(qa(l)?i=l:yield Rp(t,void 0))}if(!e&&i&&qa(i))return{token:i.token};let o=!1;if(mE()){r.exchangeTokenPromise||(r.exchangeTokenPromise=pE(gE(t,yield yE()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let l=yield r.exchangeTokenPromise;return yield Rp(t,l),r.token=l,{token:l.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield cn(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?Op.warn(l.message):Op.error(l),s=l}let a;return i?s?qa(i)?a={token:i.token,internalError:s}:a=uE(s):(a={token:i.token},r.token=i,yield Rp(t,i)):a=uE(s),o&&UO(t,a),a})}function BO(n){return g(this,null,function*(){let e=n.app;fE(e);let{provider:t}=cn(e);if(mE()){let r=yield yE(),{token:i}=yield pE(gE(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function VO(n,e,t,r){let{app:i}=n,s=cn(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&qa(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),cE(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>cE(n))}function vE(n,e){let t=cn(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function cE(n){let{app:e}=n,t=cn(e),r=t.tokenRefresher;r||(r=qO(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function qO(n){let{app:e}=n;return new Np(()=>g(this,null,function*(){let t=cn(e),r;if(t.token?r=yield Mp(n,!0):r=yield Mp(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=cn(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},lE.RETRIAL_MIN_WAIT,lE.RETRIAL_MAX_WAIT)}function UO(n,e){let t=cn(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function qa(n){return n.expireTimeMillis-Date.now()>0}function uE(n){return{token:LO(FO),error:n}}var xp=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=cn(this.app);for(let t of e)vE(this.app,t.next);return Promise.resolve()}};function zO(n,e){return new xp(n,e)}function jO(n){return{getToken:e=>Mp(n,e),getLimitedUseToken:()=>BO(n),addTokenListener:e=>VO(n,"INTERNAL",e),removeTokenListener:e=>vE(n.app,e)}}var GO="@firebase/app-check",HO="0.8.2";var KO="app-check",dE="app-check-internal";function $O(){xa(new Fi(KO,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return zO(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(dE).initialize()})),xa(new Fi(dE,n=>{let e=n.getProvider("app-check").getImmediate();return jO(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Or(GO,HO)}$O();var WO=["localhost","0.0.0.0","127.0.0.1"],lH=typeof window<"u"&&WO.includes(window.location.hostname);var QO="firebase",YO="10.9.0";wt.registerVersion(QO,YO,"app-compat");var XO=["ngOnDestroy"],TE=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(XO.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let d=u?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,d),d})})})});var du=class{constructor(e){return e}},qs=new Fe("angularfire2.app.options"),Us=new Fe("angularfire2.app.name");function Ua(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=wt.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>wt.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;JO("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new du(o)}var JO=(n,...e)=>{pp()&&typeof console<"u"&&console[n](...e)},ZO={provide:du,useFactory:Ua,deps:[qs,Nr,[new yw,Us]]},_H=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:qs,useValue:t},{provide:Us,useValue:r}]}}constructor(t){wt.registerVersion("angularfire",Vi.full,"core"),wt.registerVersion("angularfire",Vi.full,"app-compat"),wt.registerVersion("angular",_w.full,t.toString())}static \u0275fac=function(r){return new(r||n)(ee(Bs))};static \u0275mod=sr({type:n});static \u0275inj=ir({providers:[ZO]})}return n})();function hu(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return eM(i,o)||(SE("error",`${e} was already initialized on the ${t} Firebase App with different settings.${tM?" You may need to reload as Firebase is not HMR aware.":""}`),SE("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function eM(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var tM=typeof module<"u"&&!!module.hot,SE=(n,...e)=>{pp()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var Pp=new Fe("angularfire2.auth.use-emulator"),Fp=new Fe("angularfire2.auth.settings"),Lp=new Fe("angularfire2.auth.tenant-id"),Bp=new Fe("angularfire2.auth.langugage-code"),Vp=new Fe("angularfire2.auth.use-device-language"),qp=new Fe("angularfire.auth.persistence"),Up=(n,e,t,r,i,s,o,a)=>hu(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),r&&(l.tenantId=r),l.languageCode=i,s&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,r,i,s,o,a]),zp=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,l,c,u,d,h,p){let y=new uw,_=Dr(void 0).pipe(Ir(o.outsideAngular),Mi(()=>s.runOutsideAngular(()=>import("./chunk-MYQ7CT2O.mjs"))),st(()=>Ua(t,s,r)),st(S=>Up(S,s,a,c,u,d,l,h)),up({bufferSize:1,refCount:!1}));if($c(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Dr(null);else{_.pipe(gw()).subscribe();let S=_.pipe(Mi(N=>N.getRedirectResult().then(k=>k,()=>null)),kt,up({bufferSize:1,refCount:!1})),R=_.pipe(Mi(N=>new xs(k=>({unsubscribe:s.runOutsideAngular(()=>N.onAuthStateChanged(V=>k.next(V),V=>k.error(V),()=>k.complete()))})))),w=_.pipe(Mi(N=>new xs(k=>({unsubscribe:s.runOutsideAngular(()=>N.onIdTokenChanged(V=>k.next(V),V=>k.error(V),()=>k.complete()))}))));this.authState=S.pipe(dp(R),Ps(o.outsideAngular),Ir(o.insideAngular)),this.user=S.pipe(dp(w),Ps(o.outsideAngular),Ir(o.insideAngular)),this.idToken=this.user.pipe(Mi(N=>N?An(N.getIdToken()):Dr(null))),this.idTokenResult=this.user.pipe(Mi(N=>N?An(N.getIdTokenResult()):Dr(null))),this.credential=fw(S,y,this.authState.pipe(Ra(N=>!N))).pipe(st(N=>N?.user?N:null),Ps(o.outsideAngular),Ir(o.insideAngular))}return TE(this,_,s,{spy:{apply:(S,R,w)=>{(S.startsWith("signIn")||S.startsWith("createUser"))&&w.then(N=>y.next(N))}}})}static \u0275fac=function(r){return new(r||n)(ee(qs),ee(Us,8),ee(Bs),ee(Nr),ee(cu),ee(Pp,8),ee(Fp,8),ee(Lp,8),ee(Bp,8),ee(Vp,8),ee(qp,8),ee(Bi,8))};static \u0275prov=xi({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),xH=(()=>{class n{constructor(){wt.registerVersion("angularfire",Vi.full,"auth-compat")}static \u0275fac=function(r){return new(r||n)};static \u0275mod=sr({type:n});static \u0275inj=ir({providers:[zp]})}return n})();import{inspect as fU,TextEncoder as pU,TextDecoder as gU}from"util";import{randomBytes as mU}from"crypto";var rM=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},dn={},P,ug=ug||{},K=rM||self;function Au(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function tl(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function iM(n){return Object.prototype.hasOwnProperty.call(n,jp)&&n[jp]||(n[jp]=++sM)}var jp="closure_uid_"+(1e9*Math.random()>>>0),sM=0;function oM(n,e,t){return n.call.apply(n.bind,arguments)}function aM(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function ht(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?ht=oM:ht=aM,ht.apply(null,arguments)}function fu(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function Xe(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function Pr(){this.s=this.s,this.o=this.o}var lM=0;Pr.prototype.s=!1;Pr.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),lM!=0)&&iM(this)};Pr.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var xE=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function dg(n){let e=n.length;if(0<e){let t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function wE(n,e){for(let t=1;t<arguments.length;t++){let r=arguments[t];if(Au(r)){let i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function ft(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}ft.prototype.h=function(){this.defaultPrevented=!0};var cM=function(){if(!K.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let t=()=>{};K.addEventListener("test",t,e),K.removeEventListener("test",t,e)}catch{}return n}();function $a(n){return/^[\s\xa0]*$/.test(n)}function Iu(){var n=K.navigator;return n&&(n=n.userAgent)?n:""}function Rn(n){return Iu().indexOf(n)!=-1}function hg(n){return hg[" "](n),n}hg[" "]=function(){};function uM(n,e){var t=JM;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var dM=Rn("Opera"),Hs=Rn("Trident")||Rn("MSIE"),PE=Rn("Edge"),Wp=PE||Hs,FE=Rn("Gecko")&&!(Iu().toLowerCase().indexOf("webkit")!=-1&&!Rn("Edge"))&&!(Rn("Trident")||Rn("MSIE"))&&!Rn("Edge"),hM=Iu().toLowerCase().indexOf("webkit")!=-1&&!Rn("Edge");function LE(){var n=K.document;return n?n.documentMode:void 0}var Qp;e:{if(pu="",gu=function(){var n=Iu();if(FE)return/rv:([^\);]+)(\)|;)/.exec(n);if(PE)return/Edge\/([\d\.]+)/.exec(n);if(Hs)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(hM)return/WebKit\/(\S+)/.exec(n);if(dM)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),gu&&(pu=gu?gu[1]:""),Hs&&(mu=LE(),mu!=null&&mu>parseFloat(pu))){Qp=String(mu);break e}Qp=pu}var pu,gu,mu,Yp;K.document&&Hs?(Gp=LE(),Yp=Gp||parseInt(Qp,10)||void 0):Yp=void 0;var Gp,fM=Yp;function Wa(n,e){if(ft.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(FE){e:{try{hg(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:pM[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Wa.$.h.call(this)}}Xe(Wa,ft);var pM={2:"touch",3:"pen",4:"mouse"};Wa.prototype.h=function(){Wa.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var nl="closure_listenable_"+(1e6*Math.random()|0),gM=0;function mM(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++gM,this.fa=this.ia=!1}function Du(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function fg(n,e,t){for(let r in n)e.call(t,n[r],r,n)}function yM(n,e){for(let t in n)e.call(void 0,n[t],t,n)}function BE(n){let e={};for(let t in n)e[t]=n[t];return e}var EE="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function VE(n,e){let t,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(t in r)n[t]=r[t];for(let s=0;s<EE.length;s++)t=EE[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Ru(n){this.src=n,this.g={},this.h=0}Ru.prototype.add=function(n,e,t,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=Jp(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new mM(e,this.src,s,!!r,i),e.ia=t,n.push(e)),e};function Xp(n,e){var t=e.type;if(t in n.g){var r=n.g[t],i=xE(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Du(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function Jp(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}var pg="closure_lm_"+(1e6*Math.random()|0),Hp={};function qE(n,e,t,r,i){if(r&&r.once)return zE(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)qE(n,e[s],t,r,i);return null}return t=yg(t),n&&n[nl]?n.O(e,t,tl(r)?!!r.capture:!!r,i):UE(n,e,t,!1,r,i)}function UE(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=tl(i)?!!i.capture:!!i,a=mg(n);if(a||(n[pg]=a=new Ru(n)),t=a.add(e,t,r,o,s),t.proxy)return t;if(r=vM(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)cM||(i=o),i===void 0&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(GE(e.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function vM(){function n(t){return e.call(n.src,n.listener,t)}let e=_M;return n}function zE(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)zE(n,e[s],t,r,i);return null}return t=yg(t),n&&n[nl]?n.P(e,t,tl(r)?!!r.capture:!!r,i):UE(n,e,t,!0,r,i)}function jE(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)jE(n,e[s],t,r,i);else r=tl(r)?!!r.capture:!!r,t=yg(t),n&&n[nl]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=Jp(s,t,r,i),-1<t&&(Du(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=mg(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Jp(e,t,r,i)),(t=-1<n?e[n]:null)&&gg(t))}function gg(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[nl])Xp(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(GE(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=mg(e))?(Xp(t,n),t.h==0&&(t.src=null,e[pg]=null)):Du(n)}}}function GE(n){return n in Hp?Hp[n]:Hp[n]="on"+n}function _M(n,e){if(n.fa)n=!0;else{e=new Wa(e,this);var t=n.listener,r=n.la||n.src;n.ia&&gg(n),n=t.call(r,e)}return n}function mg(n){return n=n[pg],n instanceof Ru?n:null}var Kp="__closure_events_fn_"+(1e9*Math.random()>>>0);function yg(n){return typeof n=="function"?n:(n[Kp]||(n[Kp]=function(e){return n.handleEvent(e)}),n[Kp])}function Ye(){Pr.call(this),this.i=new Ru(this),this.S=this,this.J=null}Xe(Ye,Pr);Ye.prototype[nl]=!0;Ye.prototype.removeEventListener=function(n,e,t,r){jE(this,n,e,t,r)};function at(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,typeof e=="string")e=new ft(e,n);else if(e instanceof ft)e.target=e.target||n;else{var i=e;e=new ft(r,n),VE(e,i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=yu(o,r,!0,e)&&i}if(o=e.g=n,i=yu(o,r,!0,e)&&i,i=yu(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)o=e.g=t[s],i=yu(o,r,!1,e)&&i}Ye.prototype.N=function(){if(Ye.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Du(t[r]);delete n.g[e],n.h--}}this.J=null};Ye.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)};Ye.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};function yu(n,e,t,r){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,l=o.la||o.src;o.ia&&Xp(n.i,o),i=a.call(l,r)!==!1&&i}}return i&&!r.defaultPrevented}var vg=K.JSON.stringify,Zp=class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function SM(){var n=_g;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var eg=class{constructor(){this.h=this.g=null}add(e,t){let r=HE.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},HE=new Zp(()=>new tg,n=>n.reset()),tg=class{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}};function TM(n){var e=1;n=n.split(":");let t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function wM(n){K.setTimeout(()=>{throw n},0)}var Qa,Ya=!1,_g=new eg,KE=()=>{let n=K.Promise.resolve(void 0);Qa=()=>{n.then(EM)}},EM=()=>{for(var n;n=SM();){try{n.h.call(n.g)}catch(t){wM(t)}var e=HE;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Ya=!1};function Nu(n,e){Ye.call(this),this.h=n||1,this.g=e||K,this.j=ht(this.qb,this),this.l=Date.now()}Xe(Nu,Ye);P=Nu.prototype;P.ga=!1;P.T=null;P.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),at(this,"tick"),this.ga&&(Sg(this),this.start()))}};P.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Sg(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}P.N=function(){Nu.$.N.call(this),Sg(this),delete this.g};function Tg(n,e,t){if(typeof n=="function")t&&(n=ht(n,t));else if(n&&typeof n.handleEvent=="function")n=ht(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:K.setTimeout(n,e||0)}function $E(n){n.g=Tg(()=>{n.g=null,n.i&&(n.i=!1,$E(n))},n.j);let e=n.h;n.h=null,n.m.apply(null,e)}var ng=class extends Pr{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:$E(this)}N(){super.N(),this.g&&(K.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function Xa(n){Pr.call(this),this.h=n,this.g={}}Xe(Xa,Pr);var CE=[];function WE(n,e,t,r){Array.isArray(t)||(t&&(CE[0]=t.toString()),t=CE);for(var i=0;i<t.length;i++){var s=qE(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function QE(n){fg(n.g,function(e,t){this.g.hasOwnProperty(t)&&gg(e)},n),n.g={}}Xa.prototype.N=function(){Xa.$.N.call(this),QE(this)};Xa.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function ku(){this.g=!0}ku.prototype.Ea=function(){this.g=!1};function CM(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var d=u.split("_");o=2<=d.length&&d[1]=="type"?o+(u+"="+c+"&"):o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+t+`
`+o})}function bM(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+t+`
`+s+" "+o})}function js(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+IM(n,t)+(r?" "+r:"")})}function AM(n,e){n.info(function(){return"TIMEOUT: "+e})}ku.prototype.info=function(){};function IM(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return vg(t)}catch{return e}}var ji={},bE=null;function Ou(){return bE=bE||new Ye}ji.Ta="serverreachability";function YE(n){ft.call(this,ji.Ta,n)}Xe(YE,ft);function Ja(n){let e=Ou();at(e,new YE(e))}ji.STAT_EVENT="statevent";function XE(n,e){ft.call(this,ji.STAT_EVENT,n),this.stat=e}Xe(XE,ft);function Et(n){let e=Ou();at(e,new XE(e,n))}ji.Ua="timingevent";function JE(n,e){ft.call(this,ji.Ua,n),this.size=e}Xe(JE,ft);function rl(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return K.setTimeout(function(){n()},e)}var Mu={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},ZE={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function wg(){}wg.prototype.h=null;function AE(n){return n.h||(n.h=n.i())}function e0(){}var il={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Eg(){ft.call(this,"d")}Xe(Eg,ft);function Cg(){ft.call(this,"c")}Xe(Cg,ft);var rg;function xu(){}Xe(xu,wg);xu.prototype.g=function(){return new XMLHttpRequest};xu.prototype.i=function(){return{}};rg=new xu;function sl(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new Xa(this),this.P=DM,n=Wp?125:void 0,this.V=new Nu(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new t0}function t0(){this.i=null,this.g="",this.h=!1}var DM=45e3,n0={},ig={};P=sl.prototype;P.setTimeout=function(n){this.P=n};function sg(n,e,t){n.L=1,n.A=Fu(ar(e)),n.u=t,n.S=!0,r0(n,null)}function r0(n,e){n.G=Date.now(),ol(n),n.B=ar(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),d0(t.i,"t",r),n.o=0,t=n.l.J,n.h=new t0,n.g=O0(n.l,t?e:null,!n.u),0<n.O&&(n.M=new ng(ht(n.Pa,n,n.g),n.O)),WE(n.U,n.g,"readystatechange",n.nb),e=n.I?BE(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),Ja(),CM(n.j,n.v,n.B,n.m,n.W,n.u)}P.nb=function(n){n=n.target;let e=this.M;e&&Nn(n)==3?e.l():this.Pa(n)};P.Pa=function(n){try{if(n==this.g)e:{let u=Nn(this.g);var e=this.g.Ia();let d=this.g.da();if(!(3>u)&&(u!=3||Wp||this.g&&(this.h.h||this.g.ja()||NE(this.g)))){this.J||u!=4||e==7||(e==8||0>=d?Ja(3):Ja(2)),Pu(this);var t=this.g.da();this.ca=t;t:if(i0(this)){var r=NE(this.g);n="";var i=r.length,s=Nn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){qi(this),Ka(this);var o="";break t}this.h.i=new K.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,bM(this.j,this.v,this.B,this.m,this.W,u,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!$a(a)){var c=a;break t}}c=null}if(t=c)js(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,og(this,t);else{this.i=!1,this.s=3,Et(12),qi(this),Ka(this);break e}}this.S?(s0(this,u,o),Wp&&this.i&&u==3&&(WE(this.U,this.V,"tick",this.mb),this.V.start())):(js(this.j,this.m,o,null),og(this,o)),u==4&&qi(this),this.i&&!this.J&&(u==4?D0(this.l,this):(this.i=!1,ol(this)))}else QM(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,Et(12)):(this.s=0,Et(13)),qi(this),Ka(this)}}}catch{}finally{}};function i0(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function s0(n,e,t){let r=!0,i;for(;!n.J&&n.o<t.length;)if(i=RM(n,t),i==ig){e==4&&(n.s=4,Et(14),r=!1),js(n.j,n.m,null,"[Incomplete Response]");break}else if(i==n0){n.s=4,Et(15),js(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}else js(n.j,n.m,i,null),og(n,i);i0(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,Et(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Ng(e),e.M=!0,Et(11))):(js(n.j,n.m,t,"[Invalid Chunked Response]"),qi(n),Ka(n))}P.mb=function(){if(this.g){var n=Nn(this.g),e=this.g.ja();this.o<e.length&&(Pu(this),s0(this,n,e),this.i&&n!=4&&ol(this))}};function RM(n,e){var t=n.o,r=e.indexOf(`
`,t);return r==-1?ig:(t=Number(e.substring(t,r)),isNaN(t)?n0:(r+=1,r+t>e.length?ig:(e=e.slice(r,r+t),n.o=r+t,e)))}P.cancel=function(){this.J=!0,qi(this)};function ol(n){n.Y=Date.now()+n.P,o0(n,n.P)}function o0(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=rl(ht(n.lb,n),e)}function Pu(n){n.C&&(K.clearTimeout(n.C),n.C=null)}P.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(AM(this.j,this.B),this.L!=2&&(Ja(),Et(17)),qi(this),this.s=2,Ka(this)):o0(this,this.Y-n)};function Ka(n){n.l.H==0||n.J||D0(n.l,n)}function qi(n){Pu(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,Sg(n.V),QE(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function og(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||ag(t.i,n))){if(!n.K&&ag(t.i,n)&&t.H==3){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)wu(t),Vu(t);else break e;Rg(t),Et(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&t.A==0&&!t.v&&(t.v=rl(ht(t.ib,t),6e3));if(1>=p0(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Ui(t,11)}else if((n.K||t.g==n)&&wu(t),!$a(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],t.H==2)if(c[0]=="c"){t.K=c[1],t.pa=c[2];let u=c[3];u!=null&&(t.ra=u,t.l.info("VER="+t.ra));let d=c[4];d!=null&&(t.Ga=d,t.l.info("SVER="+t.Ga));let h=c[5];h!=null&&typeof h=="number"&&0<h&&(r=1.5*h,t.L=r,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;let p=n.g;if(p){let y=p.g?p.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(y){var s=r.i;s.g||y.indexOf("spdy")==-1&&y.indexOf("quic")==-1&&y.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(bg(s,s.h),s.h=null))}if(r.F){let _=p.g?p.g.getResponseHeader("X-HTTP-Session-Id"):null;_&&(r.Da=_,Se(r.I,r.F,_))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),r=t;var o=n;if(r.wa=k0(r,r.J?r.pa:null,r.Y),o.K){g0(r.i,o);var a=o,l=r.L;l&&a.setTimeout(l),a.C&&(Pu(a),ol(a)),r.g=o}else A0(r);0<t.j.length&&qu(t)}else c[0]!="stop"&&c[0]!="close"||Ui(t,7);else t.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?Ui(t,7):Dg(t):c[0]!="noop"&&t.h&&t.h.Aa(c),t.A=0)}}Ja(4)}catch{}}function NM(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(Au(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}e=[],t=0;for(r in n)e[t++]=n[r];return e}function kM(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Au(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(let r in n)e[t++]=r;return e}}}function a0(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(Au(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=kM(n),r=NM(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}var l0=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function OM(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function zi(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof zi){this.h=n.h,Su(this,n.j),this.s=n.s,this.g=n.g,Tu(this,n.m),this.l=n.l;var e=n.i,t=new Za;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),IE(this,t),this.o=n.o}else n&&(e=String(n).match(l0))?(this.h=!1,Su(this,e[1]||"",!0),this.s=Ga(e[2]||""),this.g=Ga(e[3]||"",!0),Tu(this,e[4]),this.l=Ga(e[5]||"",!0),IE(this,e[6]||"",!0),this.o=Ga(e[7]||"")):(this.h=!1,this.i=new Za(null,this.h))}zi.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Ha(e,DE,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(Ha(e,DE,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(Ha(t,t.charAt(0)=="/"?PM:xM,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Ha(t,LM)),n.join("")};function ar(n){return new zi(n)}function Su(n,e,t){n.j=t?Ga(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Tu(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function IE(n,e,t){e instanceof Za?(n.i=e,BM(n.i,n.h)):(t||(e=Ha(e,FM)),n.i=new Za(e,n.h))}function Se(n,e,t){n.i.set(e,t)}function Fu(n){return Se(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Ga(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Ha(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,MM),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function MM(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var DE=/[#\/\?@]/g,xM=/[#\?:]/g,PM=/[#\?]/g,FM=/[#\?@]/g,LM=/#/g;function Za(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Fr(n){n.g||(n.g=new Map,n.h=0,n.i&&OM(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}P=Za.prototype;P.add=function(n,e){Fr(this),this.i=null,n=Ks(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function c0(n,e){Fr(n),e=Ks(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function u0(n,e){return Fr(n),e=Ks(n,e),n.g.has(e)}P.forEach=function(n,e){Fr(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)};P.ta=function(){Fr(this);let n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){let i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t};P.Z=function(n){Fr(this);let e=[];if(typeof n=="string")u0(this,n)&&(e=e.concat(this.g.get(Ks(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};P.set=function(n,e){return Fr(this),this.i=null,n=Ks(this,n),u0(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};P.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function d0(n,e,t){c0(n,e),0<t.length&&(n.i=null,n.g.set(Ks(n,e),dg(t)),n.h+=t.length)}P.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function Ks(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function BM(n,e){e&&!n.j&&(Fr(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(c0(this,r),d0(this,i,t))},n)),n.j=e}var VM=class{constructor(n,e){this.g=n,this.map=e}};function h0(n){this.l=n||qM,K.PerformanceNavigationTiming?(n=K.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!(K.g&&K.g.Ka&&K.g.Ka()&&K.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var qM=10;function f0(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function p0(n){return n.h?1:n.g?n.g.size:0}function ag(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function bg(n,e){n.g?n.g.add(e):n.h=e}function g0(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}h0.prototype.cancel=function(){if(this.i=m0(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function m0(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(let t of n.g.values())e=e.concat(t.F);return e}return dg(n.i)}var UM=class{stringify(n){return K.JSON.stringify(n,void 0)}parse(n){return K.JSON.parse(n,void 0)}};function zM(){this.g=new UM}function jM(n,e,t){let r=t||"";try{a0(n,function(i,s){let o=i;tl(i)&&(o=vg(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function GM(n,e){let t=new ku;if(K.Image){let r=new Image;r.onload=fu(vu,t,r,"TestLoadImage: loaded",!0,e),r.onerror=fu(vu,t,r,"TestLoadImage: error",!1,e),r.onabort=fu(vu,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=fu(vu,t,r,"TestLoadImage: timeout",!1,e),K.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}function vu(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function al(n){this.l=n.ec||null,this.j=n.ob||!1}Xe(al,wg);al.prototype.g=function(){return new Lu(this.l,this.j)};al.prototype.i=function(n){return function(){return n}}({});function Lu(n,e){Ye.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Ag,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Xe(Lu,Ye);var Ag=0;P=Lu.prototype;P.open=function(n,e){if(this.readyState!=Ag)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,el(this)};P.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||K).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};P.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,ll(this)),this.readyState=Ag};P.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,el(this)),this.g&&(this.readyState=3,el(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof K.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;y0(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function y0(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}P.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?ll(this):el(this),this.readyState==3&&y0(this)}};P.Za=function(n){this.g&&(this.response=this.responseText=n,ll(this))};P.Ya=function(n){this.g&&(this.response=n,ll(this))};P.ka=function(){this.g&&ll(this)};function ll(n){n.readyState=4,n.l=null,n.j=null,n.A=null,el(n)}P.setRequestHeader=function(n,e){this.v.append(n,e)};P.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};P.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function el(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(Lu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var HM=K.JSON.parse;function ke(n){Ye.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=v0,this.L=this.M=!1}Xe(ke,Ye);var v0="",KM=/^https?$/i,$M=["POST","PUT"];P=ke.prototype;P.Oa=function(n){this.M=n};P.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():rg.g(),this.C=this.u?AE(this.u):AE(rg),this.g.onreadystatechange=ht(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){RE(this,s);return}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())t.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),i=K.FormData&&n instanceof K.FormData,!(0<=xE($M,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{T0(this),0<this.B&&((this.L=WM(this.g))?(this.g.timeout=this.B,this.g.ontimeout=ht(this.ua,this)):this.A=Tg(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){RE(this,s)}};function WM(n){return Hs&&typeof n.timeout=="number"&&n.ontimeout!==void 0}P.ua=function(){typeof ug<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,at(this,"timeout"),this.abort(8))};function RE(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,_0(n),Bu(n)}function _0(n){n.F||(n.F=!0,at(n,"complete"),at(n,"error"))}P.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,at(this,"complete"),at(this,"abort"),Bu(this))};P.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Bu(this,!0)),ke.$.N.call(this)};P.La=function(){this.s||(this.G||this.v||this.l?S0(this):this.kb())};P.kb=function(){S0(this)};function S0(n){if(n.h&&typeof ug<"u"&&(!n.C[1]||Nn(n)!=4||n.da()!=2)){if(n.v&&Nn(n)==4)Tg(n.La,0,n);else if(at(n,"readystatechange"),Nn(n)==4){n.h=!1;try{let o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=o===0){var i=String(n.I).match(l0)[1]||null;!i&&K.self&&K.self.location&&(i=K.self.location.protocol.slice(0,-1)),r=!KM.test(i?i.toLowerCase():"")}t=r}if(t)at(n,"complete"),at(n,"success");else{n.m=6;try{var s=2<Nn(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",_0(n)}}finally{Bu(n)}}}}function Bu(n,e){if(n.g){T0(n);let t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||at(n,"ready");try{t.onreadystatechange=r}catch{}}}function T0(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&(K.clearTimeout(n.A),n.A=null)}P.isActive=function(){return!!this.g};function Nn(n){return n.g?n.g.readyState:0}P.da=function(){try{return 2<Nn(this)?this.g.status:-1}catch{return-1}};P.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};P.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),HM(e)}};function NE(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case v0:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function QM(n){let e={};n=(n.g&&2<=Nn(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if($a(n[r]))continue;var t=TM(n[r]);let i=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();let s=e[i]||[];e[i]=s,s.push(t)}yM(e,function(r){return r.join(", ")})}P.Ia=function(){return this.m};P.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function w0(n){let e="";return fg(n,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function Ig(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=w0(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):Se(n,e,t))}function za(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function E0(n){this.Ga=0,this.j=[],this.l=new ku,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=za("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=za("baseRetryDelayMs",5e3,n),this.hb=za("retryDelaySeedMs",1e4,n),this.eb=za("forwardChannelMaxRetries",2,n),this.xa=za("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new h0(n&&n.concurrentRequestLimit),this.Ja=new zM,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}P=E0.prototype;P.ra=8;P.H=1;function Dg(n){if(C0(n),n.H==3){var e=n.W++,t=ar(n.I);if(Se(t,"SID",n.K),Se(t,"RID",e),Se(t,"TYPE","terminate"),cl(n,t),e=new sl(n,n.l,e),e.L=2,e.A=Fu(ar(t)),t=!1,K.navigator&&K.navigator.sendBeacon)try{t=K.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&K.Image&&(new Image().src=e.A,t=!0),t||(e.g=O0(e.l,null),e.g.ha(e.A)),e.G=Date.now(),ol(e)}N0(n)}function Vu(n){n.g&&(Ng(n),n.g.cancel(),n.g=null)}function C0(n){Vu(n),n.u&&(K.clearTimeout(n.u),n.u=null),wu(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&K.clearTimeout(n.m),n.m=null)}function qu(n){if(!f0(n.i)&&!n.m){n.m=!0;var e=n.Na;Qa||KE(),Ya||(Qa(),Ya=!0),_g.add(e,n),n.C=0}}function YM(n,e){return p0(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=rl(ht(n.Na,n,e),R0(n,n.C)),n.C++,!0)}P.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let i=new sl(this,this.l,n),s=this.s;if(this.U&&(s?(s=BE(s),VE(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var r=this.j[t];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=b0(this,i,e),t=ar(this.I),Se(t,"RID",n),Se(t,"CVER",22),this.F&&Se(t,"X-HTTP-Session-Id",this.F),cl(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(w0(s)))+"&"+e:this.o&&Ig(t,this.o,s)),bg(this.i,i),this.bb&&Se(t,"TYPE","init"),this.P?(Se(t,"$req",e),Se(t,"SID","null"),i.aa=!0,sg(i,t,null)):sg(i,t,e),this.H=2}}else this.H==3&&(n?kE(this,n):this.j.length==0||f0(this.i)||kE(this))};function kE(n,e){var t;e?t=e.m:t=n.W++;let r=ar(n.I);Se(r,"SID",n.K),Se(r,"RID",t),Se(r,"AID",n.V),cl(n,r),n.o&&n.s&&Ig(r,n.o,n.s),t=new sl(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=b0(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),bg(n.i,t),sg(t,r,e)}function cl(n,e){n.na&&fg(n.na,function(t,r){Se(e,r,t)}),n.h&&a0({},function(t,r){Se(e,r,t)})}function b0(n,e,t){t=Math.min(n.j.length,t);var r=n.h?ht(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){let o=["count="+t];s==-1?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let l=0;l<t;l++){let c=i[l].g,u=i[l].map;if(c-=s,0>c)s=Math.max(0,i[l].g-100),a=!1;else try{jM(u,o,"req"+c+"_")}catch{r&&r(u)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function A0(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;Qa||KE(),Ya||(Qa(),Ya=!0),_g.add(e,n),n.A=0}}function Rg(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=rl(ht(n.Ma,n),R0(n,n.A)),n.A++,!0)}P.Ma=function(){if(this.u=null,I0(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=rl(ht(this.jb,this),n)}};P.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Et(10),Vu(this),I0(this))};function Ng(n){n.B!=null&&(K.clearTimeout(n.B),n.B=null)}function I0(n){n.g=new sl(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=ar(n.wa);Se(e,"RID","rpc"),Se(e,"SID",n.K),Se(e,"AID",n.V),Se(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&Se(e,"TO",n.qa),Se(e,"TYPE","xmlhttp"),cl(n,e),n.o&&n.s&&Ig(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=Fu(ar(e)),t.u=null,t.S=!0,r0(t,n)}P.ib=function(){this.v!=null&&(this.v=null,Vu(this),Rg(this),Et(19))};function wu(n){n.v!=null&&(K.clearTimeout(n.v),n.v=null)}function D0(n,e){var t=null;if(n.g==e){wu(n),Ng(n),n.g=null;var r=2}else if(ag(n.i,e))t=e.F,g0(n.i,e),r=1;else return;if(n.H!=0){if(e.i)if(r==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;r=Ou(),at(r,new JE(r,t)),qu(n)}else A0(n);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&YM(n,e)||r==2&&Rg(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:Ui(n,5);break;case 4:Ui(n,10);break;case 3:Ui(n,6);break;default:Ui(n,2)}}}function R0(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Ui(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var r=ht(n.pb,n);t||(t=new zi("//www.google.com/images/cleardot.gif"),K.location&&K.location.protocol=="http"||Su(t,"https"),Fu(t)),GM(t.toString(),r)}else Et(2);n.H=0,n.h&&n.h.za(e),N0(n),C0(n)}P.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Et(2)):(this.l.info("Failed to ping google.com"),Et(1))};function N0(n){if(n.H=0,n.ma=[],n.h){let e=m0(n.i);(e.length!=0||n.j.length!=0)&&(wE(n.ma,e),wE(n.ma,n.j),n.i.i.length=0,dg(n.j),n.j.length=0),n.h.ya()}}function k0(n,e,t){var r=t instanceof zi?ar(t):new zi(t);if(r.g!="")e&&(r.g=e+"."+r.g),Tu(r,r.m);else{var i=K.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new zi(null);r&&Su(s,r),e&&(s.g=e),i&&Tu(s,i),t&&(s.l=t),r=s}return t=n.F,e=n.Da,t&&e&&Se(r,t,e),Se(r,"VER",n.ra),cl(n,r),r}function O0(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new ke(new al({ob:t})):new ke(n.va),e.Oa(n.J),e}P.isActive=function(){return!!this.h&&this.h.isActive(this)};function M0(){}P=M0.prototype;P.Ba=function(){};P.Aa=function(){};P.za=function(){};P.ya=function(){};P.isActive=function(){return!0};P.Va=function(){};function Eu(){if(Hs&&!(10<=Number(fM)))throw Error("Environmental error: no available transport.")}Eu.prototype.g=function(n,e){return new Bt(n,e)};function Bt(n,e){Ye.call(this),this.g=new E0(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!$a(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!$a(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new $s(this)}Xe(Bt,Ye);Bt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Et(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=k0(n,null,n.Y),qu(n)};Bt.prototype.close=function(){Dg(this.g)};Bt.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=vg(n),n=t);e.j.push(new VM(e.fb++,n)),e.H==3&&qu(e)};Bt.prototype.N=function(){this.g.h=null,delete this.j,Dg(this.g),delete this.g,Bt.$.N.call(this)};function x0(n){Eg.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(let t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}Xe(x0,Eg);function P0(){Cg.call(this),this.status=1}Xe(P0,Cg);function $s(n){this.g=n}Xe($s,M0);$s.prototype.Ba=function(){at(this.g,"a")};$s.prototype.Aa=function(n){at(this.g,new x0(n))};$s.prototype.za=function(n){at(this.g,new P0)};$s.prototype.ya=function(){at(this.g,"b")};function XM(){this.blockSize=-1}function un(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}Xe(un,XM);un.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function $p(n,e,t){t||(t=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],i=n.g[2];var s=n.g[3],o=e+(s^t&(i^s))+r[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[3]+3250441966&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[7]+4249261313&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[11]+2304563134&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[15]+1236535329&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(t^i))+r[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[0]+3921069994&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[4]+3889429448&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[8]+1163531501&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[12]+2368359562&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(t^i^s)+r[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[14]+4259657740&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[10]+3200236656&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[6]+76029189&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[2]+3299628645&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(i^(t|~s))+r[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[5]+4237533241&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[1]+2240044497&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[13]+1309151649&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}un.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=t;)$p(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){$p(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){$p(this,r),i=0;break}}this.h=i,this.i+=e};un.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};function ce(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==e||(t[i]=s,r=!1)}this.g=t}var JM={};function kg(n){return-128<=n&&128>n?uM(n,function(e){return new ce([e|0],0>e?-1:0)}):new ce([n|0],0>n?-1:0)}function kn(n){if(isNaN(n)||!isFinite(n))return Gs;if(0>n)return ot(kn(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=lg;return new ce(e,0)}function F0(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return ot(F0(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=kn(Math.pow(e,8)),r=Gs,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=kn(Math.pow(e,s)),r=r.R(s).add(kn(o))):(r=r.R(t),r=r.add(kn(o)))}return r}var lg=4294967296,Gs=kg(0),cg=kg(1),OE=kg(16777216);P=ce.prototype;P.ea=function(){if(Kt(this))return-ot(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:lg+r)*e,e*=lg}return n};P.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(or(this))return"0";if(Kt(this))return"-"+ot(this).toString(n);for(var e=kn(Math.pow(n,6)),t=this,r="";;){var i=bu(t,e).g;t=Cu(t,i.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=i,or(t))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};P.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function or(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function Kt(n){return n.h==-1}P.X=function(n){return n=Cu(this,n),Kt(n)?-1:or(n)?0:1};function ot(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new ce(t,~n.h).add(cg)}P.abs=function(){return Kt(this)?ot(this):this};P.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,t[i]=o<<16|s}return new ce(t,t[t.length-1]&-2147483648?-1:0)};function Cu(n,e){return n.add(ot(e))}P.R=function(n){if(or(this)||or(n))return Gs;if(Kt(this))return Kt(n)?ot(this).R(ot(n)):ot(ot(this).R(n));if(Kt(n))return ot(this.R(ot(n)));if(0>this.X(OE)&&0>n.X(OE))return kn(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,l=n.D(i)&65535;t[2*r+2*i]+=o*l,_u(t,2*r+2*i),t[2*r+2*i+1]+=s*l,_u(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,_u(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,_u(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new ce(t,0)};function _u(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function ja(n,e){this.g=n,this.h=e}function bu(n,e){if(or(e))throw Error("division by zero");if(or(n))return new ja(Gs,Gs);if(Kt(n))return e=bu(ot(n),e),new ja(ot(e.g),ot(e.h));if(Kt(e))return e=bu(n,ot(e)),new ja(ot(e.g),e.h);if(30<n.g.length){if(Kt(n)||Kt(e))throw Error("slowDivide_ only works with positive integers.");for(var t=cg,r=e;0>=r.X(n);)t=ME(t),r=ME(r);var i=zs(t,1),s=zs(r,1);for(r=zs(r,2),t=zs(t,2);!or(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=zs(r,1),t=zs(t,1)}return e=Cu(n,i.R(e)),new ja(i,e)}for(i=Gs;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=Math.ceil(Math.log(t)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=kn(t),o=s.R(e);Kt(o)||0<o.X(n);)t-=r,s=kn(t),o=s.R(e);or(s)&&(s=cg),i=i.add(s),n=Cu(n,o)}return new ja(i,n)}P.gb=function(n){return bu(this,n).h};P.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new ce(t,this.h&n.h)};P.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new ce(t,this.h|n.h)};P.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new ce(t,this.h^n.h)};function ME(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new ce(t,n.h)}function zs(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new ce(i,n.h)}Eu.prototype.createWebChannel=Eu.prototype.g;Bt.prototype.send=Bt.prototype.u;Bt.prototype.open=Bt.prototype.m;Bt.prototype.close=Bt.prototype.close;Mu.NO_ERROR=0;Mu.TIMEOUT=8;Mu.HTTP_ERROR=6;ZE.COMPLETE="complete";e0.EventType=il;il.OPEN="a";il.CLOSE="b";il.ERROR="c";il.MESSAGE="d";Ye.prototype.listen=Ye.prototype.O;ke.prototype.listenOnce=ke.prototype.P;ke.prototype.getLastError=ke.prototype.Sa;ke.prototype.getLastErrorCode=ke.prototype.Ia;ke.prototype.getStatus=ke.prototype.da;ke.prototype.getResponseJson=ke.prototype.Wa;ke.prototype.getResponseText=ke.prototype.ja;ke.prototype.send=ke.prototype.ha;ke.prototype.setWithCredentials=ke.prototype.Oa;un.prototype.digest=un.prototype.l;un.prototype.reset=un.prototype.reset;un.prototype.update=un.prototype.j;ce.prototype.add=ce.prototype.add;ce.prototype.multiply=ce.prototype.R;ce.prototype.modulo=ce.prototype.gb;ce.prototype.compare=ce.prototype.X;ce.prototype.toNumber=ce.prototype.ea;ce.prototype.toString=ce.prototype.toString;ce.prototype.getBits=ce.prototype.D;ce.fromNumber=kn;ce.fromString=F0;var PH=dn.createWebChannelTransport=function(){return new Eu},FH=dn.getStatEventTarget=function(){return Ou()},LH=dn.ErrorCode=Mu,BH=dn.EventType=ZE,VH=dn.Event=ji,qH=dn.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},UH=dn.FetchXmlHttpFactory=al,zH=dn.WebChannel=e0,jH=dn.XhrIo=ke,L0=dn.Md5=un,Gi=dn.Integer=ce;var us=cw(dD(),1),ER=cw(Ay(),1);var hD="@firebase/firestore",fD="4.5.0";var $e=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};$e.UNAUTHENTICATED=new $e(null);$e.GOOGLE_CREDENTIALS=new $e("google-credentials-uid");$e.FIRST_PARTY=new $e("first-party-uid");$e.MOCK_USER=new $e("mock-user");var yU="10.9.0";var ga=yU;function vU(n){ga=n}function _U(n){return fU(n,{depth:100})}var yi=new Qc("@firebase/firestore");function jo(){return yi.logLevel}function CR(n){yi.setLogLevel(n)}function D(n,...e){if(yi.logLevel<=Dn.DEBUG){let t=e.map(iT);yi.debug(`Firestore (${ga}): ${n}`,...t)}}function Ie(n,...e){if(yi.logLevel<=Dn.ERROR){let t=e.map(iT);yi.error(`Firestore (${ga}): ${n}`,...t)}}function on(n,...e){if(yi.logLevel<=Dn.WARN){let t=e.map(iT);yi.warn(`Firestore (${ga}): ${n}`,...t)}}function iT(n){if(typeof n=="string")return n;try{return _U(n)}catch{return n}}function L(n="Unexpected state"){let e=`FIRESTORE (${ga}) INTERNAL ASSERTION FAILED: `+n;throw Ie(e),new Error(e)}function q(n,e){n||L()}function bR(n,e){n||L()}function x(n,e){return n}var v={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},E=class extends bw{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var Ve=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var $h=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},s_=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t($e.UNAUTHENTICATED))}shutdown(){}},o_=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},a_=class{constructor(e){this.authProvider=e,this.currentUser=$e.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new Ve;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new Ve,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>g(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.tokenListener),o()};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Ve)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(q(typeof r.accessToken=="string"),new $h(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener)}getUser(){let e=this.auth&&this.auth.getUid();return q(e===null||typeof e=="string"),new $e(e)}},l_=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=$e.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},c_=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new l_(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t($e.FIRST_PARTY))}shutdown(){}invalidateToken(){}},u_=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},d_=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){let r=s=>{s.error!=null&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,D("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(q(typeof t.token=="string"),this.latestAppCheckToken=t.token,new u_(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.tokenListener)}};function SU(n){if(!n)return new s_;switch(n.type){case"firstParty":return new c_(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new E(v.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function TU(n){return mU(n)}var Wh=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=TU(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function W(n,e){return n<e?-1:n>e?1:0}function ds(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}function AR(n){return n+"\0"}var pD=-62135596800,gD=1e6,De=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new E(v.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new E(v.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<pD)throw new E(v.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new E(v.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*gD);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/gD}_compareTo(e){return this.seconds===e.seconds?W(this.nanoseconds,e.nanoseconds):W(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-pD,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var j=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new De(0,0))}static max(){return new n(new De(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var mD="__name__",Qh=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&L(),r===void 0?r=e.length-t:r>e.length-t&&L(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},ne=class n extends Qh{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new E(v.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},wU=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Ue=class n extends Qh{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return wU.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===mD}static keyField(){return new n([mD])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new E(v.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new E(v.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new E(v.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new E(v.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var M=class n{constructor(e){this.path=e}static fromPath(e){return new n(ne.fromString(e))}static fromName(e){return new n(ne.fromString(e).popFirst(5))}static empty(){return new n(ne.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ne.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ne.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new ne(e.slice()))}};var Jo=-1,EU=0,h_=(()=>{class n{constructor(t,r,i,s){this.indexId=t,this.collectionGroup=r,this.fields=i,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function sT(n){return n.fields.find(e=>e.kind===2)}function hs(n){return n.fields.filter(e=>e.kind!==2)}function CU(n){let e=hs(n);return e.length===0?0:e[e.length-1].kind}function bU(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var Qo=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var rc=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(EU,an.min())}};function IR(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=j.fromTimestamp(r===1e9?new De(t+1,0):new De(t,r));return new an(i,M.empty(),e)}function DR(n){return new an(n.readTime,n.key,Jo)}var an=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(j.min(),M.empty(),Jo)}static max(){return new n(j.max(),M.empty(),Jo)}};function oT(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=M.comparator(n.documentKey,e.documentKey),t!==0)?t:W(n.largestBatchId,e.largestBatchId)}var RR="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Yh=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Di(n){return g(this,null,function*(){if(n.code===v.FAILED_PRECONDITION&&n.message===RR)D("LocalStore","Unexpectedly lost primary lease");else throw n})}var m=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var zt="SimpleDb",AU=3,Xh=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new Ve,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new cs(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=r=>{let i=aT(r.target.error);this.completionDeferred.reject(new cs(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new cs(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(D(zt,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new p_(t)}},vr=class n{constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,n.getIOSVersion(Ma())===12.2&&Ie("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return D(zt,"Removing database:",e),ns(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!Wc())return!1;if(n.isMockPersistence())return!0;let e=Ma(),t=n.getIOSVersion(e),r=0<t&&t<10,i=n.getAndroidVersion(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static getAndroidVersion(e){let t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}ensureDb(e){return g(this,null,function*(){return this.db||(D(zt,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new cs(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new E(v.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new E(v.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new cs(e,o))},i.onupgradeneeded=s=>{D(zt,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.schemaConverter.createOrUpgrade(o,i.transaction,s.oldVersion,this.version).next(()=>{D(zt,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return g(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.ensureDb(e);let a=Xh.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(c=>(a.maybeCommit(),c)).catch(c=>(a.abort(c),m.reject(c))).toPromise();return l.catch(()=>{}),yield a.completionPromise,l}catch(a){let l=a,c=l.name!=="FirebaseError"&&o<AU;if(D(zt,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}},f_=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return ns(this.dbCursor.delete())}},cs=class extends E{constructor(e,t){super(v.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function Ri(n){return n.name==="IndexedDbTransactionError"}var p_=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(D(zt,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(D(zt,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ns(r)}add(e){D(zt,"ADD",this.store.name,e,e);let t=this.store.add(e);return ns(t)}get(e){let t=this.store.get(e);return ns(t).next(r=>(r===void 0&&(r=null),D(zt,"GET",this.store.name,e,r),r))}delete(e){D(zt,"DELETE",this.store.name,e);let t=this.store.delete(e);return ns(t)}count(){D(zt,"COUNT",this.store.name);let e=this.store.count();return ns(e)}loadAll(e,t){let r=this.options(e,t),i=r.index?this.store.index(r.index):this.store;if(typeof i.getAll=="function"){let s=i.getAll(r.range);return new m((o,a)=>{s.onerror=l=>{a(l.target.error)},s.onsuccess=l=>{o(l.target.result)}})}else{let s=this.cursor(r),o=[];return this.iterateCursor(s,(a,l)=>{o.push(l)}).next(()=>o)}}loadFirst(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new m((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}deleteAll(e,t){D(zt,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let i=this.cursor(r);return this.iterateCursor(i,(s,o,a)=>a.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.iterateCursor(i,t)}iterateSerial(e){let t=this.cursor({});return new m((r,i)=>{t.onerror=s=>{let o=aT(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;if(!o){r();return}e(o.primaryKey,o.value).next(a=>{a?o.continue():r()})}})}iterateCursor(e,t){let r=[];return new m((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a){i();return}let l=new f_(a),c=t(a.primaryKey,a.value,l);if(c instanceof m){let u=c.catch(d=>(l.done(),m.reject(d)));r.push(u)}l.isDone?i():l.skipToKey===null?a.continue():a.continue(l.skipToKey)}}).next(()=>m.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function ns(n){return new m((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=aT(r.target.error);t(i)}})}var yD=!1;function aT(n){let e=vr.getIOSVersion(Ma());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new E("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return yD||(yD=!0,setTimeout(()=>{throw r},0)),r}}return n}var Xl="IndexBackfiller",IU=15*1e3,DU=60*1e3,RU=50,g_=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(IU)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){D(Xl,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>g(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();D(Xl,`Documents written: ${t}`)}catch(t){Ri(t)?D(Xl,"Ignoring IndexedDB error during index backfill: ",t):yield Di(t)}yield this.schedule(DU)}))}},m_=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return g(this,arguments,function*(e=RU){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let r=new Set,i=t,s=!0;return m.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o===null||r.has(o))s=!1;else return D(Xl,`Processing collection: ${o}`),this.writeEntriesForCollectionGroup(e,o,i).next(a=>{i-=a,r.add(o)})})).next(()=>t-i)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.getNewOffset(i,s)).next(a=>(D(Xl,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=DR(s);oT(o,r)>0&&(r=o)}),new an(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var jt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),Yo="",y_="",NR="",kR="";function Dt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=vD(e)),e=NU(n.get(t),e);return vD(e)}function NU(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=Yo+NR;break;case Yo:t+=Yo+kR;break;default:t+=s}}return t}function vD(n){return n+Yo+y_}function Qn(n){let e=n.length;if(q(e>=2),e===2)return q(n.charAt(0)===Yo&&n.charAt(1)===y_),ne.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(Yo,s);switch((o<0||o>t)&&L(),n.charAt(o+1)){case y_:let l=n.substring(s,o),c;i.length===0?c=l:(i+=l,c=i,i=""),r.push(c);break;case NR:i+=n.substring(s,o),i+="\0";break;case kR:i+=n.substring(s,o+1);break;default:L()}s=o+2}return new ne(r)}var rs="remoteDocuments";var Dc="owner",Fo="owner",Rc="mutationQueues",kU="userId",Sn="mutations",OR="batchId",as="userMutationsIndex",MR=["userId","batchId"];function OU(n){return[n]}function Uh(n,e){return[n,Dt(e)]}function xR(n,e,t){return[n,Dt(e),t]}var MU={},ma="documentMutations",qf="remoteDocumentsV14",xU=["prefixPath","collectionGroup","readTime","documentId"],zh="documentKeyIndex",PU=["prefixPath","collectionGroup","documentId"],PR="collectionGroupIndex",FU=["collectionGroup","readTime","prefixPath","documentId"],Nc="remoteDocumentGlobal",v_="remoteDocumentGlobalKey",ya="targets",LU="targetId",FR="queryTargetsIndex",BU=["canonicalId","targetId"],va="targetDocuments",VU=["targetId","path"],lT="documentTargetsIndex",qU=["path","targetId"],Jh="targetGlobalKey",bs="targetGlobal",ic="collectionParents",UU=["collectionId","parent"],Zo="clientMetadata",zU="clientId",Uf="bundles",jU="bundleId",zf="namedQueries",GU="name",cT="indexConfiguration",HU="indexId",__="collectionGroupIndex",KU="collectionGroup",uT="indexState",$U=["indexId","uid"],LR="sequenceNumberIndex",WU=["uid","sequenceNumber"],dT="indexEntries",QU=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],BR="documentKeyIndex",YU=["indexId","uid","orderedDocumentKey"],jf="documentOverlays",XU=["userId","collectionPath","documentId"],S_="collectionPathOverlayIndex",JU=["userId","collectionPath","largestBatchId"],VR="collectionGroupOverlayIndex",ZU=["userId","collectionGroup","largestBatchId"],e4=[Rc,Sn,ma,rs,ya,Dc,bs,va],t4=e4,n4=[...t4,Zo],r4=[...n4,Nc],i4=[...r4,ic],qR=[...i4,Uf,zf],s4=[...qR,jf],UR=[Rc,Sn,ma,qf,ya,Dc,bs,va,Zo,Nc,ic,Uf,zf,jf],zR=UR,o4=[...zR,cT,uT,dT];function a4(n){if(n===15)return o4;if(n===14)return zR;if(n===13)return UR;if(n===12)return s4;if(n===11)return qR;L()}var sc=class extends Yh{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function rt(n,e){let t=x(n);return vr.getStore(t.simpleDbTransaction,e)}function _D(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function As(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function jR(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Te=class n{constructor(e,t){this.comparator=e,this.root=t||Jl.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Jl.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Jl.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new $o(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new $o(this.root,e,this.comparator,!1)}getReverseIterator(){return new $o(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new $o(this.root,e,this.comparator,!0)}},$o=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},Jl=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw L();let t=this.left.check();if(t!==this.right.check())throw L();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),T_=class{constructor(){this.size=0}get key(){throw L()}get value(){throw L()}get color(){throw L()}get left(){throw L()}get right(){throw L()}copy(e,t,r,i,s){return this}insert(e,t,r){return new Jl(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};Jl.EMPTY=new T_;var fe=class n{constructor(e){this.comparator=e,this.data=new Te(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Zh(this.data.getIterator())}getIteratorFrom(e){return new Zh(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},Zh=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function l4(n,e,t,r,i){let s=n.getIterator(),o=e.getIterator(),a=Lo(s),l=Lo(o);for(;a||l;){let c=!1,u=!1;if(a&&l){let d=t(a,l);d<0?u=!0:d>0&&(c=!0)}else a!=null?u=!0:c=!0;c?(r(l),l=Lo(o)):u?(i(a),a=Lo(s)):(a=Lo(s),l=Lo(o))}}function Lo(n){return n.hasNext()?n.getNext():void 0}var Gt=class n{constructor(e){this.fields=e,e.sort(Ue.comparator)}static empty(){return new n([])}unionWith(e){let t=new fe(Ue.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return ds(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function c4(n){return Buffer.from(n,"base64").toString("binary")}function u4(n){return Buffer.from(n,"binary").toString("base64")}function GR(){return!0}var nt=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=c4(e);return new n(t)}static fromUint8Array(e){let t=d4(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return u4(this.binaryString)}toUint8Array(){return h4(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return W(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};nt.EMPTY_BYTE_STRING=new nt("");function d4(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function h4(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var f4=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function vi(n){if(q(!!n),typeof n=="string"){let e=0,t=f4.exec(n);if(q(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=xe(n.seconds),t=xe(n.nanos);return{seconds:e,nanos:t}}}function xe(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function _i(n){return typeof n=="string"?nt.fromBase64String(n):nt.fromUint8Array(n)}var HR="server_timestamp",KR="__type__",$R="__previous_value__",WR="__local_write_time__";function Gf(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[KR])===null||t===void 0?void 0:t.stringValue)===HR}function p4(n,e){let t={fields:{[KR]:{stringValue:HR},[WR]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&Gf(e)&&(e=hT(e)),e&&(t.fields[$R]=e),{mapValue:t}}function hT(n){let e=n.mapValue.fields[$R];return Gf(e)?hT(e):e}function oc(n){let e=vi(n.mapValue.fields[WR].timestampValue);return new De(e.seconds,e.nanos)}var w_=class{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},SD="(default)",Si=class n{constructor(e,t){this.projectId=e,this.database=t||SD}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===SD}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function g4(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new E(v.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Si(n.options.projectId,e)}var mi=-1;function kc(n){return n==null}function ac(n){return n===0&&1/n===-1/0}function QR(n){return typeof n=="number"&&Number.isInteger(n)&&!ac(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var YR="__max__",pi={mapValue:{fields:{__type__:{stringValue:YR}}}},jh={nullValue:"NULL_VALUE"};function fs(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Gf(n)?4:XR(n)?9007199254740991:10:L()}function Tn(n,e){if(n===e)return!0;let t=fs(n),r=fs(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return oc(n).isEqual(oc(e));case 3:return m4(n,e);case 5:return n.stringValue===e.stringValue;case 6:return v4(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return y4(n,e);case 2:return _4(n,e);case 9:return ds(n.arrayValue.values||[],e.arrayValue.values||[],Tn);case 10:return S4(n,e);case 9007199254740991:return!0;default:return L()}}function m4(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=vi(n.timestampValue),r=vi(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function y4(n,e){return xe(n.geoPointValue.latitude)===xe(e.geoPointValue.latitude)&&xe(n.geoPointValue.longitude)===xe(e.geoPointValue.longitude)}function v4(n,e){return _i(n.bytesValue).isEqual(_i(e.bytesValue))}function _4(n,e){if("integerValue"in n&&"integerValue"in e)return xe(n.integerValue)===xe(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=xe(n.doubleValue),r=xe(e.doubleValue);return t===r?ac(t)===ac(r):isNaN(t)&&isNaN(r)}return!1}function S4(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(_D(t)!==_D(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!Tn(t[i],r[i])))return!1;return!0}function lc(n,e){return(n.values||[]).find(t=>Tn(t,e))!==void 0}function Ti(n,e){if(n===e)return 0;let t=fs(n),r=fs(e);if(t!==r)return W(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return W(n.booleanValue,e.booleanValue);case 2:return T4(n,e);case 3:return TD(n.timestampValue,e.timestampValue);case 4:return TD(oc(n),oc(e));case 5:return W(n.stringValue,e.stringValue);case 6:return C4(n.bytesValue,e.bytesValue);case 7:return w4(n.referenceValue,e.referenceValue);case 8:return E4(n.geoPointValue,e.geoPointValue);case 9:return b4(n.arrayValue,e.arrayValue);case 10:return A4(n.mapValue,e.mapValue);default:throw L()}}function T4(n,e){let t=xe(n.integerValue||n.doubleValue),r=xe(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function TD(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return W(n,e);let t=vi(n),r=vi(e),i=W(t.seconds,r.seconds);return i!==0?i:W(t.nanos,r.nanos)}function w4(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=W(t[i],r[i]);if(s!==0)return s}return W(t.length,r.length)}function E4(n,e){let t=W(xe(n.latitude),xe(e.latitude));return t!==0?t:W(xe(n.longitude),xe(e.longitude))}function C4(n,e){let t=_i(n),r=_i(e);return t.compareTo(r)}function b4(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Ti(t[i],r[i]);if(s)return s}return W(t.length,r.length)}function A4(n,e){if(n===pi.mapValue&&e===pi.mapValue)return 0;if(n===pi.mapValue)return 1;if(e===pi.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=W(r[o],s[o]);if(a!==0)return a;let l=Ti(t[r[o]],i[s[o]]);if(l!==0)return l}return W(r.length,s.length)}function ea(n){return fT(n)}function fT(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?D4(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?I4(n.bytesValue):"referenceValue"in n?N4(n.referenceValue):"geoPointValue"in n?R4(n.geoPointValue):"arrayValue"in n?O4(n.arrayValue):"mapValue"in n?k4(n.mapValue):L()}function I4(n){return _i(n).toBase64()}function D4(n){let e=vi(n);return`time(${e.seconds},${e.nanos})`}function R4(n){return`geo(${n.latitude},${n.longitude})`}function N4(n){return M.fromName(n).toString()}function k4(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${fT(n.fields[i])}`;return t+"}"}function O4(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=fT(r);return e+"]"}function ps(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function E_(n){return!!n&&"integerValue"in n}function M4(n){return!!n&&"doubleValue"in n}function x4(n){return E_(n)||M4(n)}function cc(n){return!!n&&"arrayValue"in n}function wD(n){return!!n&&"nullValue"in n}function ED(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Gh(n){return!!n&&"mapValue"in n}function Zl(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return As(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=Zl(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Zl(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function XR(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===YR}function P4(n){return"nullValue"in n?jh:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?ps(Si.empty(),M.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:L()}function F4(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?ps(Si.empty(),M.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?pi:L()}function CD(n,e){let t=Ti(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function bD(n,e){let t=Ti(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var _t=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Gh(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=Zl(t)}setAll(e){let t=Ue.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=Zl(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());Gh(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Tn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!Gh(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){As(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(Zl(this.value))}};function JR(n){let e=[];return As(n.fields,(t,r)=>{let i=new Ue([t]);if(Gh(r)){let o=JR(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new Gt(e)}var Ke=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,j.min(),j.min(),j.min(),_t.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,j.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,j.min(),j.min(),_t.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,j.min(),j.min(),_t.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(j.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=_t.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=_t.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=j.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function L4(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?Ti(r,i):L()}var Zn=class{constructor(e,t){this.position=e,this.inclusive=t}};function ZR(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=M.comparator(M.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=Ti(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function B4(n,e,t){let r=ZR(n,e,t);return n.inclusive?r>=0:r>0}function V4(n,e,t){let r=ZR(n,e,t);return n.inclusive?r<=0:r<0}function AD(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!Tn(r,i))return!1}return!0}var gs=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function q4(n){return n.field.canonicalString()+n.dir}function U4(n){return`${n.field.canonicalString()} (${n.dir})`}function z4(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var ef=class{},Z=class n extends ef{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new A_(e,t,r):t==="array-contains"?new R_(e,r):t==="in"?new tf(e,r):t==="not-in"?new N_(e,r):t==="array-contains-any"?new k_(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new I_(e,r):new D_(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Ti(t,this.value)):t!==null&&fs(this.value)===fs(t)&&this.matchesComparison(Ti(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return L()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},ue=class n extends ef{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return ta(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function ta(n){return n.op==="and"}function C_(n){return n.op==="or"}function pT(n){return e1(n)&&ta(n)}function e1(n){for(let e of n.filters)if(e instanceof ue)return!1;return!0}function b_(n){if(n instanceof Z)return n.field.canonicalString()+n.op.toString()+ea(n.value);if(pT(n))return n.filters.map(e=>b_(e)).join(",");{let e=n.filters.map(t=>b_(t)).join(",");return`${n.op}(${e})`}}function t1(n,e){if(n instanceof Z)return j4(n,e);if(n instanceof ue)return G4(n,e);L()}function j4(n,e){return e instanceof Z&&n.op===e.op&&n.field.isEqual(e.field)&&Tn(n.value,e.value)}function G4(n,e){return e instanceof ue&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&t1(i,e.filters[s]),!0):!1}function n1(n,e){let t=n.filters.concat(e);return ue.create(t,n.op)}function r1(n){return n instanceof Z?K4(n):n instanceof ue?H4(n):"Filter"}function H4(n){return n.op.toString()+" {"+n.getFilters().map(r1).join(" ,")+"}"}function K4(n){return`${n.field.canonicalString()} ${n.op} ${ea(n.value)}`}var A_=class extends Z{constructor(e,t,r){super(e,t,r),this.key=M.fromName(r.referenceValue)}matches(e){let t=M.comparator(e.key,this.key);return this.matchesComparison(t)}},I_=class extends Z{constructor(e,t){super(e,"in",t),this.keys=i1("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},D_=class extends Z{constructor(e,t){super(e,"not-in",t),this.keys=i1("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function i1(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>M.fromName(r.referenceValue))}var R_=class extends Z{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return cc(t)&&lc(t.arrayValue,this.value)}},tf=class extends Z{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&lc(this.value.arrayValue,t)}},N_=class extends Z{constructor(e,t){super(e,"not-in",t)}matches(e){if(lc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!lc(this.value.arrayValue,t)}},k_=class extends Z{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!cc(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>lc(this.value.arrayValue,r))}};var O_=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function M_(n,e=null,t=[],r=[],i=null,s=null,o=null){return new O_(n,e,t,r,i,s,o)}function ms(n){let e=x(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>b_(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>q4(r)).join(","),kc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>ea(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>ea(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function $4(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>r1(t)).join(", ")}]`),kc(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>U4(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>ea(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>ea(t)).join(",")),`Target(${e})`}function Oc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!z4(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!t1(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!AD(n.startAt,e.startAt)?!1:AD(n.endAt,e.endAt)}function nf(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function Hf(n,e){return n.filters.filter(t=>t instanceof Z&&t.field.isEqual(e))}function W4(n,e){let t=sT(e);if(t===void 0)return null;for(let r of Hf(n,t.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}function Q4(n,e){let t=new Map;for(let r of hs(e))for(let i of Hf(n,r.fieldPath))switch(i.op){case"==":case"in":t.set(r.fieldPath.canonicalString(),i.value);break;case"not-in":case"!=":return t.set(r.fieldPath.canonicalString(),i.value),Array.from(t.values())}return null}function Y4(n,e){let t=[],r=!0;for(let i of hs(e)){let s=i.kind===0?s1(n,i.fieldPath,n.startAt):o1(n,i.fieldPath,n.startAt);t.push(s.value),r&&(r=s.inclusive)}return new Zn(t,r)}function X4(n,e){let t=[],r=!0;for(let i of hs(e)){let s=i.kind===0?o1(n,i.fieldPath,n.endAt):s1(n,i.fieldPath,n.endAt);t.push(s.value),r&&(r=s.inclusive)}return new Zn(t,r)}function s1(n,e,t){let r=jh,i=!0;for(let s of Hf(n,e)){let o=jh,a=!0;switch(s.op){case"<":case"<=":o=P4(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=jh;break}CD({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];CD({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function o1(n,e,t){let r=pi,i=!0;for(let s of Hf(n,e)){let o=pi,a=!0;switch(s.op){case">=":case">":o=F4(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=pi;break}bD({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];bD({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function J4(n){let e=new fe(Ue.comparator),t=!1;for(let r of n.filters)for(let i of r.getFlattenedFilters())i.field.isKeyField()||(i.op==="array-contains"||i.op==="array-contains-any"?t=!0:e=e.add(i.field));for(let r of n.orderBy)r.field.isKeyField()||(e=e.add(r.field));return e.size+(t?1:0)}function Z4(n){return n.limit!==null}var wn=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function a1(n,e,t,r,i,s,o,a){return new wn(n,e,t,r,i,s,o,a)}function _a(n){return new wn(n)}function e3(n,e){return new wn(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function ID(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function t3(n){let e=new fe(Ue.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function n3(n){return new wn(ne.emptyPath(),n)}function r3(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function gT(n){return n.collectionGroup!==null}function na(n){let e=x(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";t3(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new gs(s,r))}),t.has(Ue.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new gs(Ue.keyField(),r))}return e.memoizedNormalizedOrderBy}function Rt(n){let e=x(n);return e.memoizedTarget||(e.memoizedTarget=i3(e,na(n))),e.memoizedTarget}function i3(n,e){if(n.limitType==="F")return M_(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new gs(i.field,s)});let t=n.endAt?new Zn(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Zn(n.startAt.position,n.startAt.inclusive):null;return M_(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function mT(n,e){let t=n.filters.concat([e]);return new wn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function s3(n,e){let t=n.explicitOrderBy.concat([e]);return new wn(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function rf(n,e,t){return new wn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function o3(n,e){return new wn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function a3(n,e){return new wn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function Mc(n,e){return Oc(Rt(n),Rt(e))&&n.limitType===e.limitType}function l1(n){return`${ms(Rt(n))}|lt:${n.limitType}`}function Go(n){return`Query(target=${$4(Rt(n))}; limitType=${n.limitType})`}function xc(n,e){return e.isFoundDocument()&&l3(n,e)&&c3(n,e)&&u3(n,e)&&d3(n,e)}function l3(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):M.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function c3(n,e){for(let t of na(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function u3(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function d3(n,e){return!(n.startAt&&!V4(n.startAt,na(n),e)||n.endAt&&!B4(n.endAt,na(n),e))}function c1(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function u1(n){return(e,t)=>{let r=!1;for(let i of na(n)){let s=h3(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function h3(n,e,t){let r=n.field.isKeyField()?M.comparator(e.key,t.key):L4(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return L()}}var er=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){As(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return jR(this.inner)}size(){return this.innerSize}};var f3=new Te(M.comparator);function Pt(){return f3}var d1=new Te(M.comparator);function Ql(...n){let e=d1;for(let t of n)e=e.insert(t.key,t);return e}function p3(){return uc()}function h1(n){let e=d1;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function Yn(){return uc()}function f1(){return uc()}function uc(){return new er(n=>n.toString(),(n,e)=>n.isEqual(e))}var g3=new Te(M.comparator);function m3(){return g3}var y3=new fe(M.comparator);function Q(...n){let e=y3;for(let t of n)e=e.add(t);return e}var v3=new fe(W);function yT(){return v3}function p1(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ac(e)?"-0":e}}function g1(n){return{integerValue:""+n}}function m1(n,e){return QR(e)?g1(e):p1(n,e)}var ra=class{constructor(){this._=void 0}};function _3(n,e,t){return n instanceof wi?p4(t,e):n instanceof _r?v1(n,e):n instanceof Sr?_1(n,e):w3(n,e)}function S3(n,e,t){return n instanceof _r?v1(n,e):n instanceof Sr?_1(n,e):t}function y1(n,e){return n instanceof Ei?x4(e)?e:{integerValue:0}:null}function T3(n,e){return n instanceof _r&&e instanceof _r||n instanceof Sr&&e instanceof Sr?ds(n.elements,e.elements,Tn):n instanceof Ei&&e instanceof Ei?Tn(n.operand,e.operand):n instanceof wi&&e instanceof wi}var wi=class extends ra{},_r=class extends ra{constructor(e){super(),this.elements=e}};function v1(n,e){let t=S1(e);for(let r of n.elements)t.some(i=>Tn(i,r))||t.push(r);return{arrayValue:{values:t}}}var Sr=class extends ra{constructor(e){super(),this.elements=e}};function _1(n,e){let t=S1(e);for(let r of n.elements)t=t.filter(i=>!Tn(i,r));return{arrayValue:{values:t}}}var Ei=class extends ra{constructor(e,t){super(),this.serializer=e,this.operand=t}};function w3(n,e){let t=y1(n,e),r=DD(t)+DD(n.operand);return E_(t)&&E_(n.operand)?g1(r):p1(n.serializer,r)}function DD(n){return xe(n.integerValue||n.doubleValue)}function S1(n){return cc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var ys=class{constructor(e,t){this.field=e,this.transform=t}};function E3(n,e){return n.field.isEqual(e.field)&&T3(n.transform,e.transform)}function C3(n,e){return n===void 0&&e===void 0?!0:n&&e?ds(n,e,(t,r)=>E3(t,r)):!1}var x_=class{constructor(e,t){this.version=e,this.transformResults=t}},Me=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function Kf(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var ia=class{};function T1(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new bi(n.key,Me.none()):new Ci(n.key,n.data,Me.none());{let t=n.data,r=_t.empty(),i=new fe(Ue.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new En(n.key,r,new Gt(i.toArray()),Me.none())}}function b3(n,e,t){n instanceof Ci?I3(n,e,t):n instanceof En?R3(n,e,t):k3(n,e,t)}function ec(n,e,t,r){return n instanceof Ci?D3(n,e,t,r):n instanceof En?N3(n,e,t,r):O3(n,e,t)}function A3(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=y1(r.transform,i||null);s!=null&&(t===null&&(t=_t.empty()),t.set(r.field,s))}return t||null}function RD(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!C3(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var Ci=class extends ia{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function I3(n,e,t){let r=n.value.clone(),i=E1(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function D3(n,e,t,r){if(!Kf(n.precondition,e))return t;let i=n.value.clone(),s=C1(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var En=class extends ia{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function R3(n,e,t){if(!Kf(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=E1(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(w1(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function N3(n,e,t,r){if(!Kf(n.precondition,e))return t;let i=C1(n.fieldTransforms,r,e),s=e.data;return s.setAll(w1(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function w1(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function E1(n,e,t){let r=new Map;q(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,S3(o,a,t[i]))}return r}function C1(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,_3(s,o,e))}return r}var bi=class extends ia{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function k3(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function O3(n,e,t){return Kf(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var dc=class extends ia{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var hc=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];b3(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=ec(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=ec(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=f1();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=T1(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(j.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),Q())}isEqual(e){return this.batchId===e.batchId&&ds(this.mutations,e.mutations,(t,r)=>RD(t,r))&&ds(this.baseMutations,e.baseMutations,(t,r)=>RD(t,r))}},P_=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){q(e.mutations.length===r.length);let i=m3(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var fc=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var F_=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var tt=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(tt||{});function b1(n){switch(n){case v.OK:return L();case v.CANCELLED:case v.UNKNOWN:case v.DEADLINE_EXCEEDED:case v.RESOURCE_EXHAUSTED:case v.INTERNAL:case v.UNAVAILABLE:case v.UNAUTHENTICATED:return!1;case v.INVALID_ARGUMENT:case v.NOT_FOUND:case v.ALREADY_EXISTS:case v.PERMISSION_DENIED:case v.FAILED_PRECONDITION:case v.ABORTED:case v.OUT_OF_RANGE:case v.UNIMPLEMENTED:case v.DATA_LOSS:return!0;default:return L()}}function M3(n){return b1(n)&&n!==v.ABORTED}function Hh(n){if(n===void 0)return Ie("GRPC error has no .code"),v.UNKNOWN;switch(n){case tt.OK:return v.OK;case tt.CANCELLED:return v.CANCELLED;case tt.UNKNOWN:return v.UNKNOWN;case tt.DEADLINE_EXCEEDED:return v.DEADLINE_EXCEEDED;case tt.RESOURCE_EXHAUSTED:return v.RESOURCE_EXHAUSTED;case tt.INTERNAL:return v.INTERNAL;case tt.UNAVAILABLE:return v.UNAVAILABLE;case tt.UNAUTHENTICATED:return v.UNAUTHENTICATED;case tt.INVALID_ARGUMENT:return v.INVALID_ARGUMENT;case tt.NOT_FOUND:return v.NOT_FOUND;case tt.ALREADY_EXISTS:return v.ALREADY_EXISTS;case tt.PERMISSION_DENIED:return v.PERMISSION_DENIED;case tt.FAILED_PRECONDITION:return v.FAILED_PRECONDITION;case tt.ABORTED:return v.ABORTED;case tt.OUT_OF_RANGE:return v.OUT_OF_RANGE;case tt.UNIMPLEMENTED:return v.UNIMPLEMENTED;case tt.DATA_LOSS:return v.DATA_LOSS;default:return L()}}var L_=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var Yv=null;function A1(){return new pU}function x3(){return new gU("utf-8")}var P3=new Gi([4294967295,4294967295],0);function ND(n){let e=A1().encode(n),t=new L0;return t.update(e),new Uint8Array(t.digest())}function kD(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new Gi([t,r],0),a=new Gi([i,s],0);return[o,a]}var B_=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ls(`Invalid padding: ${t}`);if(r<0)throw new ls(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ls(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ls(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=Gi.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(Gi.fromNumber(r)));return i.compare(P3)===1&&(i=new Gi([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=ND(e),[r,i]=kD(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=ND(e),[r,i]=kD(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},ls=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var pc=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,gc.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(j.min(),i,new Te(W),Pt(),Q())}},gc=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,Q(),Q(),Q())}};var Xo=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},sf=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},of=class{constructor(e,t,r=nt.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},af=class{constructor(){this.pendingResponses=0,this.documentChanges=MD(),this._resumeToken=nt.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=Q(),t=Q(),r=Q();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:L()}}),new gc(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=MD()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,q(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},F3="WatchChangeAggregator",V_=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=Pt(),this.pendingDocumentTargetMapping=OD(),this.pendingTargetResets=new Te(W)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:L()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(nf(s))if(r===0){let o=new M(s.path);this.removeDocumentFromTarget(t,o,Ke.newNoDocument(o,j.min()))}else q(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}Yv?.notifyOnExistenceFilterMismatch(L3(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=_i(r).toUint8Array()}catch(l){if(l instanceof L_)return on("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new B_(o,i,s)}catch(l){return l instanceof ls?on("BloomFilter error: ",l):on("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&nf(a.target)){let l=new M(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,Ke.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=Q();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new pc(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Pt(),this.pendingDocumentTargetMapping=OD(),this.pendingTargetResets=new Te(W),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new af,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new fe(W),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||D(F3,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new af),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function OD(){return new Te(M.comparator)}function MD(){return new Te(M.comparator)}function L3(n,e,t,r,i){var s,o,a,l,c,u;let d={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},h=e.unchangedNames;return h&&(d.bloomFilter={applied:i===0,hashCount:(s=h?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=h?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=h?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:p=>{var y;return(y=r?.mightContain(p))!==null&&y!==void 0?y:!1}}),d}var B3=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),V3=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),q3=(()=>{let n={};return n.and="AND",n.or="OR",n})();var q_=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function U3(n){let e=n.code===void 0?v.UNKNOWN:Hh(n.code);return new E(e,n.message||"")}function U_(n,e){return n.useProto3Json||kc(e)?e:{value:e}}function z3(n){let e;return typeof n=="object"?e=n.value:e=n,kc(e)?null:e}function sa(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function j3(n){let e=vi(n);return new De(e.seconds,e.nanos)}function I1(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function G3(n,e){return n.useProto3Json?(q(e===void 0||typeof e=="string"),nt.fromBase64String(e||"")):(q(e===void 0||e instanceof Uint8Array),nt.fromUint8Array(e||new Uint8Array))}function H3(n,e){return sa(n,e.toTimestamp())}function qe(n){return q(!!n),j.fromTimestamp(j3(n))}function vT(n,e){return z_(n,e).canonicalString()}function z_(n,e){let t=K3(n).child("documents");return e===void 0?t:t.child(e)}function D1(n){let e=ne.fromString(n);return q(B1(e)),e}function mc(n,e){return vT(n.databaseId,e.path)}function Xn(n,e){let t=D1(e);if(t.get(1)!==n.databaseId.projectId)throw new E(v.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new E(v.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new M(k1(t))}function R1(n,e){return vT(n.databaseId,e)}function N1(n){let e=D1(n);return e.length===4?ne.emptyPath():k1(e)}function j_(n){return new ne(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function K3(n){return new ne(["projects",n.projectId,"databases",n.database])}function k1(n){return q(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function xD(n,e,t){return{name:mc(n,e),fields:t.value.mapValue.fields}}function $3(n,e){return{name:mc(n,e.key),fields:e.data.value.mapValue.fields,updateTime:sa(n,e.version.toTimestamp()),createTime:sa(n,e.createTime.toTimestamp())}}function O1(n,e,t){let r=Xn(n,e.name),i=qe(e.updateTime),s=e.createTime?qe(e.createTime):j.min(),o=new _t({mapValue:{fields:e.fields}}),a=Ke.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function W3(n,e){q(!!e.found),e.found.name,e.found.updateTime;let t=Xn(n,e.found.name),r=qe(e.found.updateTime),i=e.found.createTime?qe(e.found.createTime):j.min(),s=new _t({mapValue:{fields:e.found.fields}});return Ke.newFoundDocument(t,r,i,s)}function Q3(n,e){q(!!e.missing),q(!!e.readTime);let t=Xn(n,e.missing),r=qe(e.readTime);return Ke.newNoDocument(t,r)}function Y3(n,e){return"found"in e?W3(n,e):"missing"in e?Q3(n,e):L()}function X3(n,e){let t;if("targetChange"in e){e.targetChange;let r=J3(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=G3(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&U3(o);t=new of(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=Xn(n,r.document.name),s=qe(r.document.updateTime),o=r.document.createTime?qe(r.document.createTime):j.min(),a=new _t({mapValue:{fields:r.document.fields}}),l=Ke.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new Xo(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=Xn(n,r.document),s=r.readTime?qe(r.readTime):j.min(),o=Ke.newNoDocument(i,s),a=r.removedTargetIds||[];t=new Xo([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=Xn(n,r.document),s=r.removedTargetIds||[];t=new Xo([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new F_(i,s),a=r.targetId;t=new sf(a,o)}else return L();return t}function J3(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:L()}function Z3(n){if(!("targetChange"in n))return j.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?j.min():qe(e.readTime)}function yc(n,e){let t;if(e instanceof Ci)t={update:xD(n,e.key,e.value)};else if(e instanceof bi)t={delete:mc(n,e.key)};else if(e instanceof En)t={update:xD(n,e.key,e.data),updateMask:Oz(e.fieldMask)};else if(e instanceof dc)t={verify:mc(n,e.key)};else return L();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>iz(n,r))),e.precondition.isNone||(t.currentDocument=ez(n,e.precondition)),t}function G_(n,e){let t=e.currentDocument?tz(e.currentDocument):Me.none(),r=e.updateTransforms?e.updateTransforms.map(i=>sz(n,i)):[];if(e.update){e.update.name;let i=Xn(n,e.update.name),s=new _t({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=Mz(e.updateMask);return new En(i,s,o,t,r)}else return new Ci(i,s,t,r)}else if(e.delete){let i=Xn(n,e.delete);return new bi(i,t)}else if(e.verify){let i=Xn(n,e.verify);return new dc(i,t)}else return L()}function ez(n,e){return e.updateTime!==void 0?{updateTime:H3(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:L()}function tz(n){return n.updateTime!==void 0?Me.updateTime(qe(n.updateTime)):n.exists!==void 0?Me.exists(n.exists):Me.none()}function nz(n,e){let t=n.updateTime?qe(n.updateTime):qe(e);return t.isEqual(j.min())&&(t=qe(e)),new x_(t,n.transformResults||[])}function rz(n,e){return n&&n.length>0?(q(e!==void 0),n.map(t=>nz(t,e))):[]}function iz(n,e){let t=e.transform;if(t instanceof wi)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof _r)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Sr)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof Ei)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw L()}function sz(n,e){let t=null;if("setToServerValue"in e)q(e.setToServerValue==="REQUEST_TIME"),t=new wi;else if("appendMissingElements"in e){let i=e.appendMissingElements.values||[];t=new _r(i)}else if("removeAllFromArray"in e){let i=e.removeAllFromArray.values||[];t=new Sr(i)}else"increment"in e?t=new Ei(n,e.increment):L();let r=Ue.fromServerFormat(e.fieldPath);return new ys(r,t)}function M1(n,e){return{documents:[R1(n,e.path)]}}function oz(n){let e=n.documents.length;q(e===1);let t=n.documents[0];return Rt(_a(N1(t)))}function x1(n,e){let t={structuredQuery:{}},r=e.path,i;e.collectionGroup!==null?(i=r,t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),t.structuredQuery.from=[{collectionId:r.lastSegment()}]),t.parent=R1(n,i);let s=dz(e.filters);s&&(t.structuredQuery.where=s);let o=fz(e.orderBy);o&&(t.structuredQuery.orderBy=o);let a=U_(n,e.limit);return a!==null&&(t.structuredQuery.limit=a),e.startAt&&(t.structuredQuery.startAt=gz(e.startAt)),e.endAt&&(t.structuredQuery.endAt=mz(e.endAt)),{queryTarget:t,parent:i}}function P1(n){let e=N1(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){q(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=hz(t.where));let o=[];t.orderBy&&(o=pz(t.orderBy));let a=null;t.limit&&(a=z3(t.limit));let l=null;t.startAt&&(l=yz(t.startAt));let c=null;return t.endAt&&(c=vz(t.endAt)),a1(e,i,o,s,a,"F",l,c)}function az(n){return Rt(P1(n))}function lz(n,e){let t=cz(e.purpose);return t==null?null:{"goog-listen-tags":t}}function cz(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L()}}function uz(n,e){let t,r=e.target;if(nf(r)?t={documents:M1(n,r)}:t={query:x1(n,r).queryTarget},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=I1(n,e.resumeToken);let i=U_(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(j.min())>0){t.readTime=sa(n,e.snapshotVersion.toTimestamp());let i=U_(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function dz(n){if(n.length!==0)return L1(ue.create(n,"and"))}function hz(n){let e=F1(n);return e instanceof ue&&pT(e)?e.getFilters():[e]}function F1(n){return n.unaryFilter!==void 0?Rz(n):n.fieldFilter!==void 0?Nz(n):n.compositeFilter!==void 0?kz(n):L()}function fz(n){if(n.length!==0)return n.map(e=>bz(e))}function pz(n){return n.map(e=>Az(e))}function gz(n){return{before:n.inclusive,values:n.position}}function mz(n){return{before:!n.inclusive,values:n.position}}function yz(n){let e=!!n.before,t=n.values||[];return new Zn(t,e)}function vz(n){let e=!n.before,t=n.values||[];return new Zn(t,e)}function _z(n){return B3[n]}function Sz(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function Tz(n){return V3[n]}function wz(n){return q3[n]}function Ez(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L();default:return L()}}function Cz(n){switch(n){case"AND":return"and";case"OR":return"or";default:return L()}}function Ho(n){return{fieldPath:n.canonicalString()}}function Wo(n){return Ue.fromServerFormat(n.fieldPath)}function bz(n){return{field:Ho(n.field),direction:_z(n.dir)}}function Az(n){return new gs(Wo(n.field),Sz(n.direction))}function L1(n){return n instanceof Z?Dz(n):n instanceof ue?Iz(n):L()}function Iz(n){let e=n.getFilters().map(t=>L1(t));return e.length===1?e[0]:{compositeFilter:{op:wz(n.op),filters:e}}}function Dz(n){if(n.op==="=="){if(ED(n.value))return{unaryFilter:{field:Ho(n.field),op:"IS_NAN"}};if(wD(n.value))return{unaryFilter:{field:Ho(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(ED(n.value))return{unaryFilter:{field:Ho(n.field),op:"IS_NOT_NAN"}};if(wD(n.value))return{unaryFilter:{field:Ho(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ho(n.field),op:Tz(n.op),value:n.value}}}function Rz(n){switch(n.unaryFilter.op){case"IS_NAN":let e=Wo(n.unaryFilter.field);return Z.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=Wo(n.unaryFilter.field);return Z.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=Wo(n.unaryFilter.field);return Z.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=Wo(n.unaryFilter.field);return Z.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L();default:return L()}}function Nz(n){return Z.create(Wo(n.fieldFilter.field),Ez(n.fieldFilter.op),n.fieldFilter.value)}function kz(n){return ue.create(n.compositeFilter.filters.map(e=>F1(e)),Cz(n.compositeFilter.op))}function Oz(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Mz(n){let e=n.fieldPaths||[];return new Gt(e.map(t=>Ue.fromServerFormat(t)))}function B1(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var oa=class n{constructor(e,t,r,i,s=j.min(),o=j.min(),a=nt.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var lf=class{constructor(e){this.remoteSerializer=e}};function xz(n,e){let t;if(e.document)t=O1(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=M.fromSegments(e.noDocument.path),i=_s(e.noDocument.readTime);t=Ke.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let r=M.fromSegments(e.unknownDocument.path),i=_s(e.unknownDocument.version);t=Ke.newUnknownDocument(r,i)}else return L();return e.readTime&&t.setReadTime(Pz(e.readTime)),t}function PD(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:$f(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=$3(n.remoteSerializer,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:vs(e.version)};else if(e.isUnknownDocument())r.unknownDocument={path:t.path.toArray(),version:vs(e.version)};else return L();return r}function $f(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Pz(n){let e=new De(n[0],n[1]);return j.fromTimestamp(e)}function vs(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function _s(n){let e=new De(n.seconds,n.nanoseconds);return j.fromTimestamp(e)}function Fz(n,e,t){let r=t.baseMutations.map(s=>yc(n.remoteSerializer,s)),i=t.mutations.map(s=>yc(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function is(n,e){let t=(e.baseMutations||[]).map(s=>G_(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>G_(n.remoteSerializer,s)),i=De.fromMillis(e.localWriteTimeMs);return new hc(e.batchId,i,t,r)}function Yl(n){let e=_s(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?_s(n.lastLimboFreeSnapshotVersion):j.min(),r;return Lz(n.query)?r=oz(n.query):r=az(n.query),new oa(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,nt.fromBase64String(n.resumeToken))}function V1(n,e){let t=vs(e.snapshotVersion),r=vs(e.lastLimboFreeSnapshotVersion),i;nf(e.target)?i=M1(n.remoteSerializer,e.target):i=x1(n.remoteSerializer,e.target).queryTarget;let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:ms(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Lz(n){return n.documents!==void 0}function Bz(n){return{id:n.bundleId,createTime:_s(n.createTime),version:n.version}}function Vz(n){return{bundleId:n.id,createTime:vs(qe(n.createTime)),version:n.version}}function qz(n){return{name:n.name,query:_T(n.bundledQuery),readTime:_s(n.readTime)}}function Uz(n){return{name:n.name,readTime:vs(qe(n.readTime)),bundledQuery:n.bundledQuery}}function _T(n){let e=P1({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?rf(e,e.limit,"L"):e}function zz(n){return{name:n.name,query:_T(n.bundledQuery),readTime:qe(n.readTime)}}function jz(n){return{id:n.id,version:n.version,createTime:qe(n.createTime)}}function Xv(n,e){return new fc(e.largestBatchId,G_(n.remoteSerializer,e.overlayMutation))}function Gz(n,e,t){let[r,i,s]=q1(e,t.mutation.key);return{userId:e,collectionPath:i,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:yc(n.remoteSerializer,t.mutation)}}function q1(n,e){let t=e.path.lastSegment(),r=Dt(e.path.popLast());return[n,r,t]}function Hz(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function Kz(n,e){let t=e?new rc(e.sequenceNumber,new an(_s(e.readTime),new M(Qn(e.documentKey)),e.largestBatchId)):rc.empty(),r=n.fields.map(([i,s])=>new Qo(Ue.fromServerFormat(i),s));return new h_(n.indexId,n.collectionGroup,r,t)}function FD(n,e,t,r){return{indexId:n,uid:e,sequenceNumber:t,readTime:vs(r.readTime),documentKey:Dt(r.documentKey.path),largestBatchId:r.largestBatchId}}var H_=class{getBundleMetadata(e,t){return LD(e).get(t).next(r=>{if(r)return Bz(r)})}saveBundleMetadata(e,t){return LD(e).put(Vz(t))}getNamedQuery(e,t){return BD(e).get(t).next(r=>{if(r)return qz(r)})}saveNamedQuery(e,t){return BD(e).put(Uz(t))}};function LD(n){return rt(n,Uf)}function BD(n){return rt(n,zf)}var cf=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Hl(e).get(q1(this.userId,t)).next(r=>r?Xv(this.serializer,r):null)}getOverlays(e,t){let r=Yn();return m.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new fc(t,o);i.push(this.saveOverlay(e,a))}),m.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(Dt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Hl(e).deleteAll(S_,a))}),m.waitFor(s)}getOverlaysForCollection(e,t,r){let i=Yn(),s=Dt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Hl(e).loadAll(S_,o).next(a=>{for(let l of a){let c=Xv(this.serializer,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=Yn(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Hl(e).iterate({index:VR,range:a},(l,c,u)=>{let d=Xv(this.serializer,c);s.size()<i||d.largestBatchId===o?(s.set(d.getKey(),d),o=d.largestBatchId):u.done()}).next(()=>s)}saveOverlay(e,t){return Hl(e).put(Gz(this.serializer,this.userId,t))}};function Hl(n){return rt(n,jf)}var $z=5,Wz=10,Qz=13,VD=15,Yz=20,Xz=25,Jz=30,Zz=37,e6=45,t6=50,n6=55,r6=60,i6=2,yr=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,$z);else if("booleanValue"in e)this.writeValueTypeLabel(t,Wz),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,VD),t.writeNumber(xe(e.integerValue));else if("doubleValue"in e){let r=xe(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,Qz):(this.writeValueTypeLabel(t,VD),ac(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,Yz),typeof r=="string"?t.writeString(r):(t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0))}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,Jz),t.writeBytes(_i(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,e6),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?XR(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):L()}writeIndexString(e,t){this.writeValueTypeLabel(t,Xz),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,n6);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,t6);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,Zz),M.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,r6),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(i6)}};yr.INSTANCE=new yr;var qD="\uD800",UD="\uDBFF",Bo=0,zD=255,jD=1,Vo=255,GD=255,HD=0,s6=64,o6=8,a6=1024;function l6(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function c6(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function u6(n){let e=0;for(let t=0;t<8;++t){let r=c6(n[t]&255);if(e+=r,r!==8)break}return e}function KD(n){let e=s6-u6(n);return Math.ceil(e/o6)}var K_=class{constructor(){this.buffer=new Uint8Array(a6),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteAscending(r);else if(r<2048)this.writeByteAscending(960|r>>>6),this.writeByteAscending(128|63&r);else if(t<qD||UD<t)this.writeByteAscending(480|r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r);else{let i=t.codePointAt(0);this.writeByteAscending(240|i>>>18),this.writeByteAscending(128|63&i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteDescending(r);else if(r<2048)this.writeByteDescending(960|r>>>6),this.writeByteDescending(128|63&r);else if(t<qD||UD<t)this.writeByteDescending(480|r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r);else{let i=t.codePointAt(0);this.writeByteDescending(240|i>>>18),this.writeByteDescending(128|63&i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=KD(t);this.ensureAvailable(1+r),this.buffer[this.position++]=r&255;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=t[i]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),r=KD(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(r&255);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(t[i]&255)}writeInfinityAscending(){this.writeEscapedByteAscending(Vo),this.writeEscapedByteAscending(GD)}writeInfinityDescending(){this.writeEscapedByteDescending(Vo),this.writeEscapedByteDescending(GD)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=l6(e),r=(t[0]&128)!==0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}writeByteAscending(e){let t=e&255;t===Bo?(this.writeEscapedByteAscending(Bo),this.writeEscapedByteAscending(zD)):t===Vo?(this.writeEscapedByteAscending(Vo),this.writeEscapedByteAscending(HD)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===Bo?(this.writeEscapedByteDescending(Bo),this.writeEscapedByteDescending(zD)):t===Vo?(this.writeEscapedByteDescending(Vo),this.writeEscapedByteDescending(HD)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(Bo),this.writeEscapedByteAscending(jD)}writeSeparatorDescending(){this.writeEscapedByteDescending(Bo),this.writeEscapedByteDescending(jD)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=this.buffer.length*2;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},$_=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},W_=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},ss=class{constructor(){this.orderedCode=new K_,this.ascending=new $_(this.orderedCode),this.descending=new W_(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var os=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function ui(n,e){let t=n.indexId-e.indexId;return t!==0||(t=$D(n.arrayValue,e.arrayValue),t!==0)||(t=$D(n.directionalValue,e.directionalValue),t!==0)?t:M.comparator(n.documentKey,e.documentKey)}function $D(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var uf=class{constructor(e){this.inequalityFilters=new fe((t,r)=>Ue.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let r=t;r.isInequality()?this.inequalityFilters=this.inequalityFilters.add(r):this.equalityFilters.push(r)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(q(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=sT(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let r=hs(e),i=new Set,s=0,o=0;for(;s<r.length&&this.hasMatchingEqualityFilter(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!i.has(a.field.canonicalString())){let l=r[s];if(!this.matchesFilter(a,l)||!this.matchesOrderBy(this.orderBys[o++],l))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[o++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new fe(Ue.comparator),t=[];for(let r of this.equalityFilters){if(r.field.isKeyField())continue;if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new Qo(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new Qo(r.field,0))}}for(let r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new Qo(r.field,r.dir==="asc"?0:1)));return new h_(h_.UNKNOWN_ID,this.collectionId,t,rc.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function U1(n){var e,t;if(q(n instanceof Z||n instanceof ue),n instanceof Z)if(n instanceof tf){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>Z.create(n.field,"==",s)))||[];return ue.create(i,"or")}else return n;let r=n.filters.map(i=>U1(i));return ue.create(r,n.op)}function d6(n){if(n.getFilters().length===0)return[];let e=Q_(U1(n));return q(z1(e)),ST(e)||TT(e)?[e]:e.getFilters()}function ST(n){return n instanceof Z}function TT(n){return n instanceof ue&&pT(n)}function z1(n){return ST(n)||TT(n)||h6(n)}function h6(n){if(n instanceof ue&&C_(n)){for(let e of n.getFilters())if(!ST(e)&&!TT(e))return!1;return!0}return!1}function Q_(n){if(q(n instanceof Z||n instanceof ue),n instanceof Z)return n;if(n.filters.length===1)return Q_(n.filters[0]);let e=n.filters.map(r=>Q_(r)),t=ue.create(e,n.op);return t=df(t),z1(t)?t:(q(t instanceof ue),q(ta(t)),q(t.filters.length>1),t.filters.reduce((r,i)=>wT(r,i)))}function wT(n,e){q(n instanceof Z||n instanceof ue),q(e instanceof Z||e instanceof ue);let t;return n instanceof Z?e instanceof Z?t=f6(n,e):t=WD(n,e):e instanceof Z?t=WD(e,n):t=p6(n,e),df(t)}function f6(n,e){return ue.create([n,e],"and")}function p6(n,e){if(q(n.filters.length>0&&e.filters.length>0),ta(n)&&ta(e))return n1(n,e.getFilters());let t=C_(n)?n:e,r=C_(n)?e:n,i=t.filters.map(s=>wT(s,r));return ue.create(i,"or")}function WD(n,e){if(ta(e))return n1(e,n.getFilters());{let t=e.filters.map(r=>wT(n,r));return ue.create(t,"or")}}function df(n){if(q(n instanceof Z||n instanceof ue),n instanceof Z)return n;let e=n.getFilters();if(e.length===1)return df(e[0]);if(e1(n))return n;let t=e.map(i=>df(i)),r=[];return t.forEach(i=>{i instanceof Z?r.push(i):i instanceof ue&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:ue.create(r,n.op)}var Y_=class{constructor(){this.collectionParentIndex=new vc}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),m.resolve()}getCollectionParents(e,t){return m.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return m.resolve()}deleteFieldIndex(e,t){return m.resolve()}deleteAllFieldIndexes(e){return m.resolve()}createTargetIndexes(e,t){return m.resolve()}getDocumentsMatchingTarget(e,t){return m.resolve(null)}getIndexType(e,t){return m.resolve(0)}getFieldIndexes(e,t){return m.resolve([])}getNextCollectionGroupToUpdate(e){return m.resolve(null)}getMinOffset(e,t){return m.resolve(an.min())}getMinOffsetFromCollectionGroup(e,t){return m.resolve(an.min())}updateCollectionGroup(e,t,r){return m.resolve()}updateIndexEntries(e,t){return m.resolve()}},vc=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new fe(ne.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new fe(ne.comparator)).toArray()}};var QD="IndexedDbIndexManager",Lh=new Uint8Array(0),X_=class{constructor(e,t){this.databaseId=t,this.collectionParentsCache=new vc,this.targetToDnfSubTargets=new er(r=>ms(r),(r,i)=>Oc(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:r,parent:Dt(i)};return YD(e).put(s)}return m.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[AR(t),""],!1,!0);return YD(e).loadAll(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(Qn(o.parent))}return r})}addFieldIndex(e,t){let r=Kl(e),i=Hz(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Uo(e);return s.next(a=>{o.put(FD(a,this.uid,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let r=Kl(e),i=Uo(e),s=qo(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Kl(e),r=qo(e),i=Uo(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>i.deleteAll())}createTargetIndexes(e,t){return m.forEach(this.getSubTargets(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let o=new uf(r).buildTargetIndex();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let r=qo(e),i=!0,s=new Map;return m.forEach(this.getSubTargets(t),o=>this.getFieldIndex(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=Q(),a=[];return m.forEach(s,(l,c)=>{D(QD,`Using index ${bU(l)} to execute ${ms(t)}`);let u=W4(c,l),d=Q4(c,l),h=Y4(c,l),p=X4(c,l),y=this.encodeBound(l,c,h),_=this.encodeBound(l,c,p),S=this.encodeValues(l,c,d),R=this.generateIndexRanges(l.indexId,u,y,h.inclusive,_,p.inclusive,S);return m.forEach(R,w=>r.loadFirst(w,t.limit).next(N=>{N.forEach(k=>{let V=M.fromSegments(k.documentKey);o.has(V)||(o=o.add(V),a.push(V))})}))}).next(()=>a)}else return m.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=d6(ue.create(e.filters,"and")).map(i=>M_(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,r,i,s,o,a){let l=(t!=null?t.length:1)*Math.max(r.length,s.length),c=l/(t!=null?t.length:1),u=[];for(let d=0;d<l;++d){let h=t?this.encodeSingleElement(t[d/c]):Lh,p=this.generateLowerBound(e,h,r[d%c],i),y=this.generateUpperBound(e,h,s[d%c],o),_=a.map(S=>this.generateLowerBound(e,h,S,!0));u.push(...this.createRange(p,y,_))}return u}generateLowerBound(e,t,r,i){let s=new os(e,M.empty(),t,r);return i?s:s.successor()}generateUpperBound(e,t,r,i){let s=new os(e,M.empty(),t,r);return i?s.successor():s}getFieldIndex(e,t){let r=new uf(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.servedByIndex(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.getSubTargets(t);return m.forEach(i,s=>this.getFieldIndex(e,s).next(o=>{o?r!==0&&o.fields.length<J4(s)&&(r=1):r=0})).next(()=>Z4(t)&&i.length>1&&r===2?1:r)}encodeDirectionalElements(e,t){let r=new ss;for(let i of hs(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.forKind(i.kind);yr.INSTANCE.writeIndexValue(s,o)}return r.encodedBytes()}encodeSingleElement(e){let t=new ss;return yr.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new ss;return yr.INSTANCE.writeIndexValue(ps(this.databaseId,t),r.forKind(CU(e))),r.encodedBytes()}encodeValues(e,t,r){if(r===null)return[];let i=[];i.push(new ss);let s=0;for(let o of hs(e)){let a=r[s++];for(let l of i)if(this.isInFilter(t,o.fieldPath)&&cc(a))i=this.expandIndexValues(i,o,a);else{let c=l.forKind(o.kind);yr.INSTANCE.writeIndexValue(a,c)}}return this.getEncodedBytes(i)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let l=new ss;l.seed(a.encodedBytes()),yr.INSTANCE.writeIndexValue(o,l.forKind(t.kind)),s.push(l)}return s}isInFilter(e,t){return!!e.filters.find(r=>r instanceof Z&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Kl(e),i=Uo(e);return(t?r.loadAll(__,IDBKeyRange.bound(t,t)):r.loadAll()).next(s=>{let o=[];return m.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push(Kz(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:W(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Kl(e),s=Uo(e);return this.getNextSequenceNumber(e).next(o=>i.loadAll(__,IDBKeyRange.bound(t,t)).next(a=>m.forEach(a,l=>s.put(FD(l.indexId,this.uid,o,r)))))}updateIndexEntries(e,t){let r=new Map;return m.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?m.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),m.forEach(l,c=>this.getExistingIndexEntries(e,i,c).next(u=>{let d=this.computeIndexEntries(s,c);return u.isEqual(d)?m.resolve():this.updateEntries(e,s,c,u,d)}))))})}addIndexEntry(e,t,r,i){return qo(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(r,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,r,i){return qo(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.encodeDirectionalKey(r,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,r){let i=qo(e),s=new fe(ui);return i.iterate({index:BR,range:IDBKeyRange.only([r.indexId,this.uid,this.encodeDirectionalKey(r,t)])},(o,a)=>{s=s.add(new os(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let r=new fe(ui),i=this.encodeDirectionalElements(t,e);if(i==null)return r;let s=sT(t);if(s!=null){let o=e.data.field(s.fieldPath);if(cc(o))for(let a of o.arrayValue.values||[])r=r.add(new os(t.indexId,e.key,this.encodeSingleElement(a),i))}else r=r.add(new os(t.indexId,e.key,Lh,i));return r}updateEntries(e,t,r,i,s){D(QD,"Updating index entries for document '%s'",t.key);let o=[];return l4(i,s,ui,a=>{o.push(this.addIndexEntry(e,t,r,a))},a=>{o.push(this.deleteIndexEntry(e,t,r,a))}),m.waitFor(o)}getNextSequenceNumber(e){let t=1;return Uo(e).iterate({index:LR,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,o)=>{o.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>ui(o,a)).filter((o,a,l)=>!a||ui(o,l[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=ui(o,e),l=ui(o,t);if(a===0)i[0]=e.successor();else if(a>0&&l<0)i.push(o),i.push(o.successor());else if(l>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.isRangeMatchable(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Lh,[]],l=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Lh,[]];s.push(IDBKeyRange.bound(a,l))}return s}isRangeMatchable(e,t){return ui(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(XD)}getMinOffset(e,t){return m.mapArray(this.getSubTargets(t),r=>this.getFieldIndex(e,r).next(i=>i||L())).next(XD)}};function YD(n){return rt(n,ic)}function qo(n){return rt(n,dT)}function Kl(n){return rt(n,cT)}function Uo(n){return rt(n,uT)}function XD(n){q(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;oT(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new an(e.readTime,e.documentKey,t)}function j1(n,e,t){let r=n.store(Sn),i=n.store(ma),s=[],o=IDBKeyRange.only(t.batchId),a=0,l=r.iterate({range:o},(u,d,h)=>(a++,h.delete()));s.push(l.next(()=>{q(a===1)}));let c=[];for(let u of t.mutations){let d=xR(e,u.key.path,t.batchId);s.push(i.delete(d)),c.push(u.key)}return m.waitFor(s).next(()=>c)}function hf(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw L();return JSON.stringify(e).length}var ff=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.documentKeysByBatchId={}}static forUser(e,t,r,i){q(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return di(e).iterate({index:as,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=Ko(e),o=di(e);return o.add({}).next(a=>{q(typeof a=="number");let l=new hc(a,t,r,i),c=Fz(this.serializer,this.userId,l),u=[],d=new fe((h,p)=>W(h.canonicalString(),p.canonicalString()));for(let h of i){let p=xR(this.userId,h.key.path,a);d=d.add(h.key.path.popLast()),u.push(o.put(c)),u.push(s.put(p,MU))}return d.forEach(h=>{u.push(this.indexManager.addToCollectionParentIndex(e,h))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=l.keys()}),m.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return di(e).get(t).next(r=>r?(q(r.userId===this.userId),is(this.serializer,r)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?m.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.documentKeysByBatchId[t]=i,i}else return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return di(e).iterate({index:as,range:i},(o,a,l)=>{a.userId===this.userId&&(q(a.batchId>=r),s=is(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=mi;return di(e).iterate({index:as,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,mi],[this.userId,Number.POSITIVE_INFINITY]);return di(e).loadAll(as,t).next(r=>r.map(i=>is(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=Uh(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Ko(e).iterate({range:i},(o,a,l)=>{let[c,u,d]=o,h=Qn(u);if(c!==this.userId||!t.path.isEqual(h)){l.done();return}return di(e).get(d).next(p=>{if(!p)throw L();q(p.userId===this.userId),s.push(is(this.serializer,p))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new fe(W),i=[];return t.forEach(s=>{let o=Uh(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=Ko(e).iterate({range:a},(c,u,d)=>{let[h,p,y]=c,_=Qn(p);if(h!==this.userId||!s.path.isEqual(_)){d.done();return}r=r.add(y)});i.push(l)}),m.waitFor(i).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=Uh(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new fe(W);return Ko(e).iterate({range:o},(l,c,u)=>{let[d,h,p]=l,y=Qn(h);if(d!==this.userId||!r.isPrefixOf(y)){u.done();return}y.length===i&&(a=a.add(p))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],i=[];return t.forEach(s=>{i.push(di(e).get(s).next(o=>{if(o===null)throw L();q(o.userId===this.userId),r.push(is(this.serializer,o))}))}),m.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return j1(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),m.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return m.resolve();let r=IDBKeyRange.lowerBound(OU(this.userId)),i=[];return Ko(e).iterate({range:r},(s,o,a)=>{if(s[0]!==this.userId){a.done();return}else{let c=Qn(s[1]);i.push(c)}}).next(()=>{q(i.length===0)})})}containsKey(e,t){return G1(e,this.userId,t)}getMutationQueueMetadata(e){return H1(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:mi,lastStreamToken:""})}};function G1(n,e,t){let r=Uh(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return Ko(n).iterate({range:s,keysOnly:!0},(a,l,c)=>{let[u,d,h]=a;u===e&&d===i&&(o=!0),c.done()}).next(()=>o)}function g6(n,e){let t=!1;return H1(n).iterateSerial(r=>G1(n,r,e).next(i=>(i&&(t=!0),m.resolve(!i)))).next(()=>t)}function di(n){return rt(n,Sn)}function Ko(n){return rt(n,ma)}function H1(n){return rt(n,Rc)}var Jv=2,aa=class n{constructor(e){this.lastId=e}next(){return this.lastId+=Jv,this.lastId}static forTargetCache(){return new n(2-Jv)}static forSyncEngine(){return new n(1-Jv)}};var J_=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new aa(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>j.fromTimestamp(new De(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.saveMetadata(e,i)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>zo(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(r=>(q(r.targetCount>0),r.targetCount-=1,this.saveMetadata(e,r)))}removeTargets(e,t,r){let i=0,s=[];return zo(e).iterate((o,a)=>{let l=Yl(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>m.waitFor(s)).next(()=>i)}forEachTarget(e,t){return zo(e).iterate((r,i)=>{let s=Yl(i);t(s)})}retrieveMetadata(e){return JD(e).get(Jh).next(t=>(q(t!==null),t))}saveMetadata(e,t){return JD(e).put(Jh,t)}saveTargetData(e,t){return zo(e).put(V1(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let r=ms(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return zo(e).iterate({range:i,index:FR},(o,a,l)=>{let c=Yl(a);Oc(t,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=fi(e);return t.forEach(o=>{let a=Dt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),m.waitFor(i)}removeMatchingKeys(e,t,r){let i=fi(e);return m.forEach(t,s=>{let o=Dt(s.path);return m.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=fi(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=fi(e),s=Q();return i.iterate({range:r,keysOnly:!0},(o,a,l)=>{let c=Qn(o[1]),u=new M(c);s=s.add(u)}).next(()=>s)}containsKey(e,t){let r=Dt(t.path),i=IDBKeyRange.bound([r],[AR(r)],!1,!0),s=0;return fi(e).iterate({index:lT,keysOnly:!0,range:i},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return zo(e).get(t).next(r=>r?Yl(r):null)}};function zo(n){return rt(n,ya)}function JD(n){return rt(n,bs)}function fi(n){return rt(n,va)}var ZD={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Pc=-1,K1=40*1024*1024,sn=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};sn.DEFAULT_COLLECTION_PERCENTILE=10;sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;sn.DEFAULT=new sn(K1,sn.DEFAULT_COLLECTION_PERCENTILE,sn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);sn.DISABLED=new sn(Pc,0,0);var eR="LruGarbageCollector",tR=1*1024*1024,m6=1*60*1e3,y6=5*60*1e3;function nR([n,e],[t,r]){let i=W(n,t);return i===0?W(e,r):i}var Z_=class{constructor(e){this.maxElements=e,this.buffer=new fe(nR),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();nR(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},eS=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==Pc&&this.scheduleGC(m6)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){D(eR,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>g(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ri(t)?D(eR,"Ignoring IndexedDB error during garbage collection: ",t):yield Di(t)}yield this.scheduleGC(y6)}))}},tS=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return m.resolve(jt.INVALID);let r=new Z_(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===Pc?(D("LruGarbageCollector","Garbage collection skipped; disabled"),m.resolve(ZD)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ZD):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,o,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),i=this.params.maximumSequenceNumbersToCollect):i=d,o=Date.now(),this.nthSequenceNumber(e,i))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(s=d,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>{if(c=Date.now(),jo()<=Dn.DEBUG){let h=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${d} documents in ${c-l}ms
Total Duration: ${c-u}ms`;D("LruGarbageCollector",h)}return m.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:d})})}};function v6(n,e){return new tS(n,e)}var nS=class{constructor(e,t){this.db=e,this.garbageCollector=v6(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(r,i)=>t(i))}addReference(e,t,r){return Bh(e,r)}removeReference(e,t,r){return Bh(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Bh(e,t)}isPinned(e,t){return g6(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],o=0;return this.forEachOrphanedDocument(e,(l,c)=>{if(c<=t){let u=this.isPinned(e,l).next(d=>{if(!d)return o++,i.getEntry(e,l).next(()=>(i.removeEntry(l,j.min()),fi(e).delete(_6(l))))});s.push(u)}}).next(()=>m.waitFor(s)).next(()=>i.apply(e)).next(()=>o)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Bh(e,t)}forEachOrphanedDocument(e,t){let r=fi(e),i=jt.INVALID,s;return r.iterate({index:lT},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==jt.INVALID&&t(new M(Qn(s)),i),i=c,s=l):i=jt.INVALID}).next(()=>{i!==jt.INVALID&&t(new M(Qn(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function _6(n){return[0,Dt(n.path)]}function S6(n,e){return{targetId:0,path:Dt(n.path),sequenceNumber:e}}function Bh(n,e){return fi(n).put(S6(e,n.currentSequenceNumber))}var pf=class{constructor(){this.changes=new er(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ke.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?m.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var rS=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return ts(e).put(r)}removeEntry(e,t,r){return ts(e).delete(T6(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=Ke.newInvalidDocument(t);return ts(e).iterate({index:zh,range:IDBKeyRange.only($l(t))},(i,s)=>{r=this.maybeDecodeDocument(t,s)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:Ke.newInvalidDocument(t)};return ts(e).iterate({index:zh,range:IDBKeyRange.only($l(t))},(i,s)=>{r={document:this.maybeDecodeDocument(t,s),size:hf(s)}}).next(()=>r)}getEntries(e,t){let r=Pt();return this.forEachDbEntry(e,t,(i,s)=>{let o=this.maybeDecodeDocument(i,s);r=r.insert(i,o)}).next(()=>r)}getSizedEntries(e,t){let r=Pt(),i=new Te(M.comparator);return this.forEachDbEntry(e,t,(s,o)=>{let a=this.maybeDecodeDocument(s,o);r=r.insert(s,a),i=i.insert(s,hf(o))}).next(()=>({documents:r,sizeMap:i}))}forEachDbEntry(e,t,r){if(t.isEmpty())return m.resolve();let i=new fe(sR);t.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound($l(i.first()),$l(i.last())),o=i.getIterator(),a=o.getNext();return ts(e).iterate({index:zh,range:s},(l,c,u)=>{let d=M.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&sR(a,d)<0;)r(a,null),a=o.getNext();a&&a.isEqual(d)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.skip($l(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),$f(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return ts(e).loadAll(IDBKeyRange.bound(a,l,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let u=Pt();for(let d of c){let h=this.maybeDecodeDocument(M.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);h.isFoundDocument()&&(xc(t,h)||i.has(h.key))&&(u=u.insert(h.key,h))}return u})}getAllFromCollectionGroup(e,t,r,i){let s=Pt(),o=iR(t,r),a=iR(t,an.max());return ts(e).iterate({index:PR,range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{let d=this.maybeDecodeDocument(M.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(d.key,d),s.size===i&&u.done()}).next(()=>s)}newChangeBuffer(e){return new iS(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return rR(e).get(v_).next(t=>(q(!!t),t))}setMetadata(e,t){return rR(e).put(v_,t)}maybeDecodeDocument(e,t){if(t){let r=xz(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(j.min())))return r}return Ke.newInvalidDocument(e)}};function $1(n){return new rS(n)}var iS=class extends pf{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new er(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new fe((s,o)=>W(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,a.readTime)),o.isValidDocument()){let l=PD(this.documentCache.serializer,o);i=i.add(s.path.popLast());let c=hf(l);r+=c-a.size,t.push(this.documentCache.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){let l=PD(this.documentCache.serializer,o.convertToNoDocument(j.min()));t.push(this.documentCache.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,r)),m.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(r=>(this.documentStates.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:r,sizeMap:i})=>(i.forEach((s,o)=>{this.documentStates.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function rR(n){return rt(n,Nc)}function ts(n){return rt(n,qf)}function $l(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function T6(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],$f(e),t[t.length-1]]}function iR(n,e){let t=e.documentKey.path.toArray();return[n,$f(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function sR(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=W(t[s],r[s]),i)return i;return i=W(t.length,r.length),i||(i=W(t[t.length-2],r[r.length-2]),i)?i:W(t[t.length-1],r[r.length-1])}var w6=15;var sS=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var gf=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&ec(r.mutation,i,Gt.empty(),De.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,Q()).next(()=>r))}getLocalViewOfDocuments(e,t,r=Q()){let i=Yn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=Ql();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=Yn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,Q()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Pt(),o=uc(),a=p3();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof En)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),ec(u.mutation,c,u.mutation.getFieldMask(),De.now())):o.set(c.key,Gt.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var d;return a.set(c,new sS(u,(d=o.get(c))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,t){let r=uc(),i=new Te((o,a)=>o-a),s=Q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||Gt.empty();u=a.applyToLocalView(c,u),r.set(l,u);let d=(i.get(a.batchId)||Q()).add(l);i=i.insert(a.batchId,d)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,d=f1();u.forEach(h=>{if(!s.has(h)){let p=T1(t.get(h),r.get(h));p!==null&&d.set(h,p),s=s.add(h)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return m.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return r3(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):gT(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):m.resolve(Yn()),a=Jo,l=s;return o.next(c=>m.forEach(c,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(u)?m.resolve():this.remoteDocumentCache.getEntry(e,u).next(h=>{l=l.insert(u,h)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,Q())).next(u=>({batchId:a,changes:h1(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new M(t)).next(r=>{let i=Ql();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=Ql();return this.indexManager.getCollectionParents(e,s).next(a=>m.forEach(a,l=>{let c=e3(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((d,h)=>{o=o.insert(d,h)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,Ke.newInvalidDocument(u)))});let a=Ql();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&ec(u.mutation,c,Gt.empty(),De.now()),xc(t,c)&&(a=a.insert(l,c))}),a})}};var oS=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return m.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,jz(t)),m.resolve()}getNamedQuery(e,t){return m.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,zz(t)),m.resolve()}};var aS=class{constructor(){this.overlays=new Te(M.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return m.resolve(this.overlays.get(t))}getOverlays(e,t){let r=Yn();return m.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),m.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),m.resolve()}getOverlaysForCollection(e,t,r){let i=Yn(),s=t.length+1,o=new M(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return m.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Te((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=s.get(u.largestBatchId);h===null&&(h=Yn(),s=s.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}let a=Yn(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,h)=>a.set(d,h)),!(a.size()>=i)););return m.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new fc(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=Q(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var _c=class{constructor(){this.refsByKey=new fe(He.compareByKey),this.refsByTarget=new fe(He.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new He(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new He(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new M(new ne([])),r=new He(t,e),i=new He(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new M(new ne([])),r=new He(t,e),i=new He(t,e+1),s=Q();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new He(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},He=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return M.comparator(e.key,t.key)||W(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return W(e.targetOrBatchId,t.targetOrBatchId)||M.comparator(e.key,t.key)}};var lS=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new fe(He.compareByKey)}checkEmpty(e){return m.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new hc(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new He(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return m.resolve(o)}lookupMutationBatch(e,t){return m.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return m.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return m.resolve(this.mutationQueue.length===0?mi:this.nextBatchId-1)}getAllMutationBatches(e){return m.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new He(t,0),i=new He(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),m.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new fe(W);return t.forEach(i=>{let s=new He(i,0),o=new He(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),m.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;M.isDocumentKey(s)||(s=s.child(""));let o=new He(new M(s),0),a=new fe(W);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),m.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");q(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return m.forEach(t.mutations,s=>{let o=new He(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new He(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return m.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,m.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function E6(){return new Te(M.comparator)}var cS=class{constructor(e){this.sizer=e,this.docs=E6(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return m.resolve(r?r.document.mutableCopy():Ke.newInvalidDocument(t))}getEntries(e,t){let r=Pt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ke.newInvalidDocument(i))}),m.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Pt(),o=t.path,a=new M(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||oT(DR(u),r)<=0||!i.has(u.key)&&!xc(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return m.resolve(s)}getAllFromCollectionGroup(e,t,r,i){L()}forEachDocumentKey(e,t){return m.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new uS(this)}getSize(e){return m.resolve(this.size)}};function C6(n){return new cS(n)}var uS=class extends pf{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),m.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var dS=class{constructor(e){this.persistence=e,this.targets=new er(t=>ms(t),Oc),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new _c,this.targetCount=0,this.targetIdGenerator=aa.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),m.resolve()}getLastRemoteSnapshotVersion(e){return m.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return m.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),m.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),m.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new aa(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,m.resolve()}updateTargetData(e,t){return this.saveTargetData(t),m.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,m.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),m.waitFor(s).next(()=>i)}getTargetCount(e){return m.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return m.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),m.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),m.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),m.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return m.resolve(r)}containsKey(e,t){return m.resolve(this.references.containsKey(t))}};var b6="MemoryPersistence",mf=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new jt(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new dS(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new Y_,this.remoteDocumentCache=C6(r),this.serializer=new lf(t),this.bundleCache=new oS(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new aS,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new lS(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){D(b6,"Starting transaction:",e);let i=new hS(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return m.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},hS=class extends Yh{constructor(e){super(),this.currentSequenceNumber=e}},yf=class n{constructor(e){this.persistence=e,this.localViewReferences=new _c,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw L()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),m.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),m.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),m.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return m.forEach(this.orphanedDocuments,i=>{let s=M.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,j.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return m.or([()=>m.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var fS=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,i){let s=new Xh("createOrUpgrade",t);r<1&&i>=1&&(I6(e),D6(e),oR(e),N6(e));let o=m.resolve();return r<3&&i>=3&&(r!==0&&(M6(e),oR(e)),o=o.next(()=>P6(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>R6(e,s))),o=o.next(()=>{F6(e)})),r<5&&i>=5&&(o=o.next(()=>this.removeAcknowledgedMutations(s))),r<6&&i>=6&&(o=o.next(()=>(O6(e),this.addDocumentGlobal(s)))),r<7&&i>=7&&(o=o.next(()=>this.ensureSequenceNumbers(s))),r<8&&i>=8&&(o=o.next(()=>this.createCollectionParentIndex(e,s))),r<9&&i>=9&&(o=o.next(()=>{x6(e)})),r<10&&i>=10&&(o=o.next(()=>this.rewriteCanonicalIds(s))),r<11&&i>=11&&(o=o.next(()=>{L6(e),B6(e)})),r<12&&i>=12&&(o=o.next(()=>{q6(e)})),r<13&&i>=13&&(o=o.next(()=>k6(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(rs))),r<14&&i>=14&&(o=o.next(()=>this.runOverlayMigration(e,s))),r<15&&i>=15&&(o=o.next(()=>V6(e))),o}addDocumentGlobal(e){let t=0;return e.store(rs).iterate((r,i)=>{t+=hf(i)}).next(()=>{let r={byteSize:t};return e.store(Nc).put(v_,r)})}removeAcknowledgedMutations(e){let t=e.store(Rc),r=e.store(Sn);return t.loadAll().next(i=>m.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,mi],[s.userId,s.lastAcknowledgedBatchId]);return r.loadAll(as,o).next(a=>m.forEach(a,l=>{q(l.userId===s.userId);let c=is(this.serializer,l);return j1(e,s.userId,c).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(va),r=e.store(rs);return e.store(bs).get(Jh).next(s=>{let o=l=>t.put({targetId:0,path:Dt(l),sequenceNumber:s.highestListenSequenceNumber}),a=[];return r.iterate((l,c)=>{let u=new ne(l),d=A6(u);a.push(t.get(d).next(h=>h?m.resolve():o(u)))}).next(()=>m.waitFor(a))})}createCollectionParentIndex(e,t){e.createObjectStore(ic,{keyPath:UU});let r=t.store(ic),i=new vc,s=o=>{if(i.add(o)){let a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Dt(l)})}};return t.store(rs).iterate({keysOnly:!0},(o,a)=>{let l=new ne(o);return s(l.popLast())}).next(()=>t.store(ma).iterate({keysOnly:!0},([o,a,l],c)=>{let u=Qn(a);return s(u.popLast())}))}rewriteCanonicalIds(e){let t=e.store(ya);return t.iterate((r,i)=>{let s=Yl(i),o=V1(this.serializer,s);return t.put(o)})}rewriteRemoteDocumentCache(e,t){let r=t.store(rs),i=[];return r.iterate((s,o)=>{let a=t.store(qf),l=U6(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>m.waitFor(i))}runOverlayMigration(e,t){let r=t.store(Sn),i=$1(this.serializer),s=new mf(yf.factory,this.serializer.remoteSerializer);return r.loadAll().next(o=>{let a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:Q();is(this.serializer,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),m.forEach(a,(l,c)=>{let u=new $e(c),d=cf.forUser(this.serializer,u),h=s.getIndexManager(u),p=ff.forUser(u,this.serializer,h,s.referenceDelegate);return new gf(i,p,d,h).recalculateAndSaveOverlaysForDocumentKeys(new sc(t,jt.INVALID),l).next()})})}};function A6(n){return[0,Dt(n)]}function I6(n){n.createObjectStore(Dc)}function D6(n){n.createObjectStore(Rc,{keyPath:kU}),n.createObjectStore(Sn,{keyPath:OR,autoIncrement:!0}).createIndex(as,MR,{unique:!0}),n.createObjectStore(ma)}function R6(n,e){return e.store(Sn).loadAll().next(r=>{n.deleteObjectStore(Sn),n.createObjectStore(Sn,{keyPath:OR,autoIncrement:!0}).createIndex(as,MR,{unique:!0});let s=e.store(Sn),o=r.map(a=>s.put(a));return m.waitFor(o)})}function N6(n){n.createObjectStore(rs)}function k6(n){let e=n.createObjectStore(qf,{keyPath:xU});e.createIndex(zh,PU),e.createIndex(PR,FU)}function O6(n){n.createObjectStore(Nc)}function oR(n){n.createObjectStore(va,{keyPath:VU}).createIndex(lT,qU,{unique:!0}),n.createObjectStore(ya,{keyPath:LU}).createIndex(FR,BU,{unique:!0}),n.createObjectStore(bs)}function M6(n){n.deleteObjectStore(va),n.deleteObjectStore(ya),n.deleteObjectStore(bs)}function x6(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function P6(n){let e=n.store(bs),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:j.min().toTimestamp(),targetCount:0};return e.put(Jh,t)}function F6(n){n.createObjectStore(Zo,{keyPath:zU})}function L6(n){n.createObjectStore(Uf,{keyPath:jU})}function B6(n){n.createObjectStore(zf,{keyPath:GU})}function V6(n){n.createObjectStore(cT,{keyPath:HU,autoIncrement:!0}).createIndex(__,KU,{unique:!1}),n.createObjectStore(uT,{keyPath:$U}).createIndex(LR,WU,{unique:!1}),n.createObjectStore(dT,{keyPath:QU}).createIndex(BR,YU,{unique:!1})}function q6(n){let e=n.createObjectStore(jf,{keyPath:XU});e.createIndex(S_,JU,{unique:!1}),e.createIndex(VR,ZU,{unique:!1})}function U6(n){return n.document?new M(ne.fromString(n.document.name).popFirst(5)):n.noDocument?M.fromSegments(n.noDocument.path):n.unknownDocument?M.fromSegments(n.unknownDocument.path):L()}var hi="IndexedDbPersistence",Zv=30*60*1e3,e_=5e3,z6=4e3,t_="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",j6="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",G6="firestore_zombie",W1="main",pS=class n{constructor(e,t,r,i,s,o,a,l,c,u,d=w6){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=s,this.window=o,this.document=a,this.sequenceNumberSyncer=c,this.forceOwningTab=u,this.schemaVersion=d,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=h=>Promise.resolve(),!n.isAvailable())throw new E(v.UNIMPLEMENTED,j6);this.referenceDelegate=new nS(this,i),this.dbName=t+W1,this.serializer=new lf(l),this.simpleDb=new vr(this.dbName,this.schemaVersion,new fS(this.serializer)),this.targetCache=new J_(this.referenceDelegate,this.serializer),this.remoteDocumentCache=$1(this.serializer),this.bundleCache=new H_,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,u===!1&&Ie(hi,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new E(v.FAILED_PRECONDITION,t_);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new jt(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>g(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>g(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>g(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Vh(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(r=>{r||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(r=>this.isPrimary&&!r?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):r?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(Ri(e))return D(hi,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return D(hi,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return Wl(e).get(Fo).next(r=>m.resolve(this.isLocalClient(r)))}removeClientMetadata(e){return Vh(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return g(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,Zv)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=rt(t,Zo);return r.loadAll().next(i=>{let s=this.filterActiveClients(i,Zv),o=i.filter(a=>s.indexOf(a)===-1);return m.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",z6,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?m.resolve(!0):Wl(e).get(Fo).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,e_)&&!this.isClientZombied(r.ownerId)){if(this.isLocalClient(r)&&this.networkEnabled)return!0;if(!this.isLocalClient(r)){if(!r.allowTabSynchronization)throw new E(v.FAILED_PRECONDITION,t_);return!1}}return this.networkEnabled&&this.inForeground?!0:Vh(e).loadAll().next(s=>this.filterActiveClients(s,e_).find(a=>{if(this.clientId!==a.clientId){let l=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(l||c&&u)return!0}return!1})===void 0)}).next(r=>(this.isPrimary!==r&&D(hi,`Client ${r?"is":"is not"} eligible for a primary lease.`),r))}shutdown(){return g(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[Dc,Zo],e=>{let t=new sc(e,jt.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(r=>this.isWithinAge(r.updateTimeMs,t)&&!this.isClientZombied(r.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>Vh(e).loadAll().next(t=>this.filterActiveClients(t,Zv).map(r=>r.clientId)))}get started(){return this._started}getMutationQueue(e,t){return ff.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new X_(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return cf.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){D(hi,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=a4(this.schemaVersion),o;return this.simpleDb.runTransaction(e,i,s,a=>(o=new sc(a,this.listenSequence?this.listenSequence.next():jt.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(o).next(l=>l?!0:this.canActAsPrimary(o)).next(l=>{if(!l)throw Ie(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new E(v.FAILED_PRECONDITION,RR);return r(o)}).next(l=>this.acquireOrExtendPrimaryLease(o).next(()=>l)):this.verifyAllowTabSynchronization(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(e){return Wl(e).get(Fo).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,e_)&&!this.isClientZombied(r.ownerId)&&!this.isLocalClient(r)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!r.allowTabSynchronization))throw new E(v.FAILED_PRECONDITION,t_)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Wl(e).put(Fo,t)}static isAvailable(){return vr.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=Wl(e);return t.get(Fo).next(r=>this.isLocalClient(r)?(D(hi,"Releasing primary lease."),t.delete(Fo)):m.resolve())}isWithinAge(e,t){let r=Date.now(),i=r-t,s=r;return e<i?!1:e>s?(Ie(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;yp()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let r=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return D(hi,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ie(hi,"Failed to get zombied client id.",r),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){Ie("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${G6}_${this.persistenceKey}_${e}`}};function Wl(n){return rt(n,Dc)}function Vh(n){return rt(n,Zo)}function ET(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function H6(n){return g(this,null,function*(){if(!vr.isAvailable())return Promise.resolve();let e=n+W1;yield vr.delete(e)})}var CT="LocalStore",K6=5*60*1e6,Sc=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new Te(W),this.targetIdByTarget=new er(s=>ms(s),Oc),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new gf(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function Q1(n,e,t,r){return new Sc(n,e,t,r)}function Y1(n,e){return g(this,null,function*(){let t=x(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=Q();for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of o){l.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function $6(n,e){let t=x(n),r=De.now(),i=e.reduce((a,l)=>a.add(l.key),Q()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=Pt(),c=Q();return t.remoteDocuments.getEntries(a,i).next(u=>{l=u,l.forEach((d,h)=>{h.isValidDocument()||(c=c.add(d))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let d=[];for(let h of e){let p=A3(h,s.get(h.key).overlayedDocument);p!=null&&d.push(new En(h.key,p,JR(p.value.mapValue),Me.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,d,e)}).next(u=>{o=u;let d=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,d)})}).then(()=>({batchId:o.batchId,changes:h1(s)}))}function W6(n,e){let t=x(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return ij(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,Q6(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Q6(n){let e=Q();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function Y6(n,e){let t=x(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>(q(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function X6(n){let e=x(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function X1(n){let e=x(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function J6(n,e){let t=x(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,d)=>{let h=i.get(d);if(!h)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,d).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,d)));let p=h.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?p=p.withResumeToken(nt.EMPTY_BYTE_STRING,j.min()).withLastLimboFreeSnapshotVersion(j.min()):u.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(u.resumeToken,r)),i=i.insert(d,p),Z6(h,p,u)&&a.push(t.targetCache.updateTargetData(s,p))});let l=Pt(),c=Q();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(J1(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual(j.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(d=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return m.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function J1(n,e,t){let r=Q(),i=Q();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Pt();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(j.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):D(CT,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function Z6(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=K6?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function ej(n,e){return g(this,null,function*(){let t=x(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>m.forEach(e,i=>m.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>m.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(Ri(r))D(CT,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function tj(n,e){let t=x(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=mi),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function nj(n,e){let t=x(n);return t.persistence.runTransaction("read document","readonly",r=>t.localDocuments.getDocument(r,e))}function la(n,e){let t=x(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,m.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new oa(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function rj(n,e,t){let r=x(n),i=r.targetIdByTarget.get(t);return i!==void 0?m.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function ca(n,e,t){return g(this,null,function*(){let r=x(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(Ri(o))D(CT,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function Wf(n,e,t){let r=x(n),i=j.min(),s=Q();return r.persistence.runTransaction("Execute query","readwrite",o=>rj(r,o,Rt(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:j.min(),t?s:Q())).next(a=>(tN(r,c1(e),a),{documents:a,remoteKeys:s})))}function ij(n,e,t,r){let i=t.batch,s=i.keys(),o=m.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);q(c!==null),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function sj(n,e){let t=x(n),r=x(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",i=>r.lookupMutationKeys(i,e).next(s=>s?t.localDocuments.getDocuments(i,s):m.resolve(null)))}function oj(n,e){x(x(n,Sc).mutationQueue).removeCachedMutationKeys(e)}function aj(n){return x(x(n,Sc).persistence).getActiveClients()}function Z1(n,e){let t=x(n),r=x(t.targetCache),i=t.targetDataByTarget.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.getTargetDataForTarget(s,e).next(o=>o?o.target:null))}function eN(n,e){let t=x(n),r=t.collectionGroupReadTime.get(e)||j.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.remoteDocuments.getAllFromCollectionGroup(i,e,IR(r,Jo),Number.MAX_SAFE_INTEGER)).then(i=>(tN(t,e,i),i))}function tN(n,e,t){let r=n.collectionGroupReadTime.get(e)||j.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}function lj(n){return Rt(_a(ne.fromString(`__bundle__/docs/${n}`)))}function cj(n,e,t,r){return g(this,null,function*(){let i=x(n),s=Q(),o=Pt();for(let c of t){let u=e.toDocumentKey(c.metadata.name);c.document&&(s=s.add(u));let d=e.toMutableDocument(c);d.setReadTime(e.toSnapshotVersion(c.metadata.readTime)),o=o.insert(u,d)}let a=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=yield la(i,lj(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>J1(c,a,o).next(u=>(a.apply(c),u)).next(u=>i.targetCache.removeMatchingKeysForTargetId(c,l.targetId).next(()=>i.targetCache.addMatchingKeys(c,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,u.changedDocuments,u.existenceChangedKeys)).next(()=>u.changedDocuments)))})}function uj(n,e){let t=x(n),r=qe(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",i=>t.bundleCache.getBundleMetadata(i,e.id)).then(i=>!!i&&i.createTime.compareTo(r)>=0)}function dj(n,e){let t=x(n);return t.persistence.runTransaction("Save bundle","readwrite",r=>t.bundleCache.saveBundleMetadata(r,e))}function hj(n,e){let t=x(n);return t.persistence.runTransaction("Get named query","readonly",r=>t.bundleCache.getNamedQuery(r,e))}function fj(r,i){return g(this,arguments,function*(n,e,t=Q()){let s=yield la(n,Rt(_T(e.bundledQuery))),o=x(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let l=qe(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return o.bundleCache.saveNamedQuery(a,e);let c=s.withResumeToken(nt.EMPTY_BYTE_STRING,l);return o.targetDataByTarget=o.targetDataByTarget.insert(c.targetId,c),o.targetCache.updateTargetData(a,c).next(()=>o.targetCache.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.targetCache.addMatchingKeys(a,t,s.targetId)).next(()=>o.bundleCache.saveNamedQuery(a,e))})})}var gS=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var pj=100;function gj(){return yp()?8:vr.getAndroidVersion(Ma())>0?6:4}var vf=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=pj,this.relativeIndexReadCostPerDocument=gj()}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new gS;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(jo()<=Dn.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",Go(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),m.resolve()):(jo()<=Dn.DEBUG&&D("QueryEngine","Query:",Go(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(jo()<=Dn.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",Go(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Rt(t))):m.resolve())}performQueryUsingIndex(e,t){if(ID(t))return m.resolve(null);let r=Rt(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=rf(t,null,"F"),r=Rt(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=Q(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,rf(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return ID(t)||i.isEqual(j.min())?m.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?m.resolve(null):(jo()<=Dn.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Go(t)),this.appendRemainingResults(e,o,t,IR(i,Jo)).next(a=>a))})}applyQuery(e,t){let r=new fe(u1(e));return t.forEach((i,s)=>{xc(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return jo()<=Dn.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",Go(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,an.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var nN="firestore_clients";function aR(n,e){return`${nN}_${n}_${e}`}var rN="firestore_mutations";function lR(n,e,t){let r=`${rN}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var iN="firestore_targets";function n_(n,e){return`${iN}_${n}_${e}`}var mj="firestore_online_state";function yj(n){return`${mj}_${n}`}var vj="firestore_bundle_loaded_v2";function _j(n){return`${vj}_${n}`}var Sj="firestore_sequence_number";function Tj(n){return`${Sj}_${n}`}var Wn="SharedClientState",_f=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static fromWebStorageEntry(e,t,r){let i=JSON.parse(r),s=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),o;return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(o=new E(i.error.code,i.error.message))),s?new n(e,t,i.state,o):(Ie(Wn,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},tc=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),s;return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new E(r.error.code,r.error.message))),i?new n(e,r.state,s):(Ie(Wn,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Sf=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=yT();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=QR(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Ie(Wn,`Failed to parse client data for instance '${e}': ${t}`),null)}},mS=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Ie(Wn,`Failed to parse online state: ${e}`),null)}},Tc=class{constructor(){this.activeTargetIds=yT()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},nc=class{constructor(e,t,r,i,s){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new Te(W),this.started=!1,this.earlyEvents=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=aR(this.persistenceKey,this.localClientId),this.sequenceNumberKey=Tj(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new Tc),this.clientStateKeyRe=new RegExp(`^${nN}_${o}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${rN}_${o}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${iN}_${o}_(\\d+)$`),this.onlineStateKey=yj(this.persistenceKey),this.bundleLoadedKey=_j(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return g(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let r of e){if(r===this.localClientId)continue;let i=this.getItem(aR(this.persistenceKey,r));if(i){let s=Sf.fromWebStorageEntry(r,i);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let r=this.fromWebStorageOnlineState(t);r&&this.handleOnlineStateEvent(r)}for(let r of this.earlyEvents)this.handleWebStorageEvent(r);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(n_(this.persistenceKey,e));if(r){let i=tc.fromWebStorageEntry(e,r);i&&(t=i.state)}}return this.localClientState.addQueryTarget(e),this.persistClientState(),t}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(n_(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.removeMutationState(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return D(Wn,"READ",e,t),t}setItem(e,t){D(Wn,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){D(Wn,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(D(Wn,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){Ie("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>g(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let r=this.fromWebStorageClientState(t.key,t.newValue);if(r)return this.handleClientStateEvent(r.clientId,r)}else{let r=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(r,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(r)return this.handleMutationBatchEvent(r)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(r)return this.handleQueryTargetEvent(r)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let r=this.fromWebStorageOnlineState(t.newValue);if(r)return this.handleOnlineStateEvent(r)}}else if(t.key===this.sequenceNumberKey){let r=wj(t.newValue);r!==jt.INVALID&&this.sequenceNumberHandler(r)}else if(t.key===this.bundleLoadedKey){let r=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.synchronizeWithChangedDocuments(i)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let i=new _f(this.currentUser,e,t,r),s=lR(this.persistenceKey,this.currentUser,e);this.setItem(s,i.toWebStorageJSON())}removeMutationState(e){let t=lR(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let i=n_(this.persistenceKey,e),s=new tc(e,t,r);this.setItem(i,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return Sf.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return _f.fromWebStorageEntry(new $e(s),i,t)}fromWebStorageQueryTargetMetadata(e,t){let r=this.queryTargetKeyRe.exec(e),i=Number(r[1]);return tc.fromWebStorageEntry(i,t)}fromWebStorageOnlineState(e){return mS.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return g(this,null,function*(){if(e.user.uid!==this.currentUser.uid){D(Wn,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),i=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(r),o=[],a=[];return s.forEach(l=>{i.has(l)||o.push(l)}),i.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.applyActiveTargetsChange(o,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=yT();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}};function wj(n){let e=jt.INVALID;if(n!=null)try{let t=JSON.parse(n);q(typeof t=="number"),e=t}catch(t){Ie(Wn,"Failed to read sequence number from WebStorage",t)}return e}var Tf=class{constructor(){this.localState=new Tc,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new Tc,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var yS=class{addCallback(e){}shutdown(){}};var vS=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var qh=null;function Ej(){return 268435456+Math.round(2147483648*Math.random())}function r_(){return qh===null?qh=Ej():qh++,"0x"+qh.toString(16)}function Cj(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var bj="1.9.1",It="GrpcConnection",Aj=`gl-node/${process.versions.node} fire/${ga} grpc/${bj}`;function i_(n,e,t,r){q(e===null||e.type==="OAuth");let i=new us.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",Aj),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var _S=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){D(It,"Creating Firestore stub.");let e=this.databaseInfo.ssl?us.credentials.createSsl():us.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=r_(),a=this.ensureActiveStub(),l=i_(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return Cj(u=>(D(It,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(d,h)=>{d?(D(It,`RPC '${e}' ${o} failed with error:`,d),u(new E(Hh(d.code),d.message))):(D(It,`RPC '${e}' ${o} completed with response:`,h),u(void 0,h))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=r_(),l=[],c=new Ve;D(It,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),d=i_(this.databasePath,i,s,this.databaseInfo.appId),h=Object.assign(Object.assign({},r),{database:this.databasePath}),p=u[e](h,d),y=!1;return p.on("data",_=>{D(It,`RPC ${e} ${a} received result:`,_),l.push(_),o!==void 0&&l.length===o&&(y=!0,c.resolve(l))}),p.on("end",()=>{D(It,`RPC '${e}' ${a} completed.`),y||(y=!0,c.resolve(l))}),p.on("error",_=>{D(It,`RPC '${e}' ${a} failed with error:`,_);let S=Hh(_.code);c.reject(new E(S,_.message))}),c.promise}openStream(e,t,r){let i=r_(),s=this.ensureActiveStub(),o=i_(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=d=>{l||(l=!0,u.callOnClose(d),a.end())},u=new vS({sendFn:d=>{if(l)D(It,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,d);else{D(It,`RPC '${e}' stream ${i} sending:`,d);try{a.write(d)}catch(h){throw Ie("Failure sending:",d),Ie("Error:",h),h}}},closeFn:()=>{D(It,`RPC '${e}' stream ${i} closed locally via close().`),c()}});return a.on("data",d=>{l||(D(It,`RPC '${e}' stream ${i} received:`,d),u.callOnMessage(d))}),a.on("end",()=>{D(It,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",d=>{if(!l){on(It,`RPC '${e}' stream ${i} error. Code:`,d.code,"Message:",d.message);let h=Hh(d.code);c(new E(h,d.message))}}),D(It,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}terminate(){this.cachedStub&&(this.cachedStub.close(),this.cachedStub=void 0)}},sN={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},Ij={nested:sN},Dj=Object.freeze({__proto__:null,nested:sN,default:Ij});var Rj={longs:String,enums:String,defaults:!0,oneofs:!1};function Nj(){let n=ER.fromJSON(Dj,Rj);return us.loadPackageDefinition(n)}function kj(n){let e=Nj();return new _S(e,n)}function Oj(){return new yS}function oN(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function Mj(){return null}function Fc(n){return new q_(n,!1)}var xj="ExponentialBackoff",Pj=1e3,Fj=1.5,Lj=60*1e3,wc=class{constructor(e,t,r=Pj,i=Fj,s=Lj){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&D(xj,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var cR="PersistentStream",Bj=60*1e3,Vj=10*1e3,wf=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.backoff=new wc(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.state===4){this.performBackoff();return}this.auth()}stop(){return g(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,Bj,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return g(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return g(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===v.RESOURCE_EXHAUSTED?(Ie(t.toString()),Ie("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===v.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new E(v.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,Vj,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>g(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return D(cR,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(D(cR,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},SS=class extends wf{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onMessage(e){this.backoff.reset();let t=X3(this.serializer,e),r=Z3(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=j_(this.serializer),t.addTarget=uz(this.serializer,e);let r=lz(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=j_(this.serializer),t.removeTarget=e,this.sendRequest(t)}},TS=class extends wf{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.handshakeComplete_=!1}get handshakeComplete(){return this.handshakeComplete_}start(){this.handshakeComplete_=!1,this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete_&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onMessage(e){if(q(!!e.streamToken),this.lastStreamToken=e.streamToken,this.handshakeComplete_){this.backoff.reset();let t=rz(e.writeResults,e.commitTime),r=qe(e.commitTime);return this.listener.onMutationResult(r,t)}else return q(!e.writeResults||e.writeResults.length===0),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()}writeHandshake(){let e={};e.database=j_(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>yc(this.serializer,r))};this.sendRequest(t)}};var wS=class{},ES=class extends wS{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new E(v.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeRPC(e,z_(t,r),i,s,o)).catch(s=>{throw s.name==="FirebaseError"?(s.code===v.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new E(v.UNKNOWN,s.toString())})}invokeStreamingRPC(e,t,r,i,s){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([o,a])=>this.connection.invokeStreamingRPC(e,z_(t,r),i,o,a,s)).catch(o=>{throw o.name==="FirebaseError"?(o.code===v.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new E(v.UNKNOWN,o.toString())})}terminate(){this.terminated=!0,this.connection.terminate()}};function qj(n,e,t,r){return new ES(n,e,t,r)}function Uj(n,e){return g(this,null,function*(){let t=x(n),r={writes:e.map(i=>yc(t.serializer,i))};yield t.invokeRPC("Commit",t.serializer.databaseId,ne.emptyPath(),r)})}function zj(n,e){return g(this,null,function*(){let t=x(n),r={documents:e.map(a=>mc(t.serializer,a))},i=yield t.invokeStreamingRPC("BatchGetDocuments",t.serializer.databaseId,ne.emptyPath(),r,e.length),s=new Map;i.forEach(a=>{let l=Y3(t.serializer,a);s.set(l.key.toString(),l)});let o=[];return e.forEach(a=>{let l=s.get(a.toString());q(!!l),o.push(l)}),o})}function jj(n,e,t){let r=x(n);return r.verifyInitialized(),new TS(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function Gj(n,e,t){let r=x(n);return r.verifyInitialized(),new SS(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var Hj="OnlineStateTracker",uR=1,dR=10*1e3,CS=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",dR,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${dR/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=uR&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${uR} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(Ie(t),this.shouldWarnClientIsOffline=!1):D(Hj,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var Ss="RemoteStore",Kj=10,bS=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>g(this,null,function*(){Ni(this)&&(D(Ss,"Restarting streams for network reachability change."),yield cG(this))}))}),this.onlineStateTracker=new CS(r,i)}};function $j(n,e,t,r,i){return new bS(n,e,t,r,i)}function Wj(n){let e=x(n);return e.offlineCauses.delete(0),Lc(e)}function Lc(n){return g(this,null,function*(){if(Ni(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function Qj(n){return g(this,null,function*(){let e=x(n);e.offlineCauses.add(0),yield Sa(e),e.onlineStateTracker.set("Offline")})}function Sa(n){return g(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function Yj(n){return g(this,null,function*(){let e=x(n);D(Ss,"RemoteStore shutting down."),e.offlineCauses.add(5),yield Sa(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function Qf(n,e){let t=x(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),IT(t)?AT(t):Ea(t).isOpen()&&bT(t,e))}function Ta(n,e){let t=x(n),r=Ea(t);t.listenTargets.delete(e),r.isOpen()&&aN(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():Ni(t)&&t.onlineStateTracker.set("Unknown"))}function bT(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(j.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}Ea(n).watch(e)}function aN(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),Ea(n).unwatch(e)}function AT(n){n.watchChangeAggregator=new V_({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),Ea(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function IT(n){return Ni(n)&&!Ea(n).isStarted()&&n.listenTargets.size>0}function Ni(n){return x(n).offlineCauses.size===0}function lN(n){n.watchChangeAggregator=void 0}function Xj(n){return g(this,null,function*(){n.listenTargets.forEach((e,t)=>{bT(n,e)})})}function Jj(n,e){return g(this,null,function*(){lN(n),IT(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),AT(n)):n.onlineStateTracker.set("Unknown")})}function Zj(n,e,t){return g(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof of&&e.state===2&&e.cause){try{yield tG(n,e)}catch(r){D(Ss,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Ef(n,r)}return}if(e instanceof Xo?n.watchChangeAggregator.handleDocumentChange(e):e instanceof sf?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(j.min()))try{let r=yield X1(n.localStore);t.compareTo(r)>=0&&(yield eG(n,t))}catch(r){D(Ss,"Failed to raise snapshot:",r),yield Ef(n,r)}})}function Ef(n,e,t){return g(this,null,function*(){if(Ri(e))n.offlineCauses.add(1),yield Sa(n),n.onlineStateTracker.set("Offline"),t||(t=()=>X1(n.localStore)),n.asyncQueue.enqueueRetryable(()=>g(this,null,function*(){D(Ss,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield Lc(n)}));else throw e})}function cN(n,e){return e().catch(t=>Ef(n,t,e))}function eG(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(nt.EMPTY_BYTE_STRING,s.snapshotVersion)),aN(n,r);let o=new oa(s.target,r,i,s.sequenceNumber);bT(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function tG(n,e){return g(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function wa(n){return g(this,null,function*(){let e=x(n),t=ki(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:mi;for(;nG(e);)try{let i=yield tj(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,rG(e,i)}catch(i){yield Ef(e,i)}uN(e)&&dN(e)})}function nG(n){return Ni(n)&&n.writePipeline.length<Kj}function rG(n,e){n.writePipeline.push(e);let t=ki(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function uN(n){return Ni(n)&&!ki(n).isStarted()&&n.writePipeline.length>0}function dN(n){ki(n).start()}function iG(n){return g(this,null,function*(){ki(n).writeHandshake()})}function sG(n){return g(this,null,function*(){let e=ki(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function oG(n,e,t){return g(this,null,function*(){let r=n.writePipeline.shift(),i=P_.from(r,e,t);yield cN(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield wa(n)})}function aG(n,e){return g(this,null,function*(){e&&ki(n).handshakeComplete&&(yield lG(n,e)),uN(n)&&dN(n)})}function lG(n,e){return g(this,null,function*(){if(M3(e.code)){let t=n.writePipeline.shift();ki(n).inhibitBackoff(),yield cN(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield wa(n)}})}function cG(n){return g(this,null,function*(){let e=x(n);e.offlineCauses.add(4),yield Sa(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield Lc(e)})}function hR(n,e){return g(this,null,function*(){let t=x(n);t.asyncQueue.verifyOperationInProgress(),D(Ss,"RemoteStore received new credentials");let r=Ni(t);t.offlineCauses.add(3),yield Sa(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield Lc(t)})}function AS(n,e){return g(this,null,function*(){let t=x(n);e?(t.offlineCauses.delete(2),yield Lc(t)):e||(t.offlineCauses.add(2),yield Sa(t),t.onlineStateTracker.set("Unknown"))})}function Ea(n){return n.watchStream||(n.watchStream=Gj(n.datastore,n.asyncQueue,{onOpen:Xj.bind(null,n),onClose:Jj.bind(null,n),onWatchChange:Zj.bind(null,n)}),n.onNetworkStatusChange.push(e=>g(this,null,function*(){e?(n.watchStream.inhibitBackoff(),IT(n)?AT(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),lN(n))}))),n.watchStream}function ki(n){return n.writeStream||(n.writeStream=jj(n.datastore,n.asyncQueue,{onOpen:iG.bind(null,n),onClose:aG.bind(null,n),onHandshakeComplete:sG.bind(null,n),onMutationResult:oG.bind(null,n)}),n.onNetworkStatusChange.push(e=>g(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield wa(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(D(Ss,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var uG="AsyncQueue",IS=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ve,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new E(v.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Ca(n,e){if(Ie(uG,`${e}: ${n}`),Ri(n))return new E(v.UNAVAILABLE,`${e}: ${n}`);throw n}var Cf=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||M.comparator(t.key,r.key):this.comparator=(t,r)=>M.comparator(t.key,r.key),this.keyedMap=Ql(),this.sortedSet=new Te(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var bf=class{constructor(){this.changeMap=new Te(M.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):L()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},ua=class n{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Cf.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!Mc(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var DS=class{constructor(){this.viewSnap=void 0,this.listeners=[]}hasRemoteListeners(){return this.listeners.some(e=>e.listensToRemoteStore())}};function dG(){return new RS}var RS=class{constructor(){this.queries=new er(e=>l1(e),Mc),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}};function DT(n,e){return g(this,null,function*(){let t=x(n),r=3,i=e.query,s=t.queries.get(i);s?!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(r=2):(s=new DS,r=e.listensToRemoteStore()?0:1);try{switch(r){case 0:s.viewSnap=yield t.onListen(i,!0);break;case 1:s.viewSnap=yield t.onListen(i,!1);break;case 2:yield t.onFirstRemoteStoreListen(i);break;default:break}}catch(o){let a=Ca(o,`Initialization of query '${Go(e.query)}' failed`);e.onError(a);return}t.queries.set(i,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&NT(t)})}function RT(n,e){return g(this,null,function*(){let t=x(n),r=e.query,i=3,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),s.listeners.length===0?i=e.listensToRemoteStore()?0:1:!s.hasRemoteListeners()&&e.listensToRemoteStore()&&(i=2))}switch(i){case 0:return t.queries.delete(r),t.onUnlisten(r,!0);case 1:return t.queries.delete(r),t.onUnlisten(r,!1);case 2:return t.onLastRemoteStoreUnlisten(r);default:return}})}function hG(n,e){let t=x(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&NT(t)}function fG(n,e,t){let r=x(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function pG(n,e){let t=x(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&NT(t)}function gG(n,e){x(n).snapshotsInSyncListeners.add(e),e.next()}function mG(n,e){x(n).snapshotsInSyncListeners.delete(e)}function NT(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var hN=function(n){return n.Default="default",n.Cache="cache",n}(hN||{}),Ec=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new ua(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache||!this.listensToRemoteStore())return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=ua.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}listensToRemoteStore(){return this.options.source!==hN.Cache}};var NS=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=Q(),i=Q();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var Af=class{constructor(e){this.serializer=e}toDocumentKey(e){return Xn(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?O1(this.serializer,e.document,!1):Ke.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return qe(e)}},kS=class{constructor(e,t,r){this.bundleMetadata=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=fN(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let r=ne.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,r=new Af(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.toDocumentKey(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||Q()).add(s);t.set(o,a)}}return t}complete(){return g(this,null,function*(){let e=yield cj(this.localStore,new Af(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let r of this.queries)yield fj(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function fN(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function yG(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var If=class{constructor(e){this.key=e}},Df=class{constructor(e){this.key=e}},Rf=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=Q(),this.mutatedKeys=Q(),this.docComparator=u1(e),this.documentSet=new Cf(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new bf,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,d)=>{let h=i.get(u),p=xc(this.query,d)?d:null,y=h?this.mutatedKeys.has(h.key):!1,_=p?p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations:!1,S=!1;h&&p?h.data.isEqual(p.data)?y!==_&&(r.track({type:3,doc:p}),S=!0):this.shouldWaitForSyncedDocument(h,p)||(r.track({type:2,doc:p}),S=!0,(l&&this.docComparator(p,l)>0||c&&this.docComparator(p,c)<0)&&(a=!0)):!h&&p?(r.track({type:0,doc:p}),S=!0):h&&!p&&(r.track({type:1,doc:h}),S=!0,(l||c)&&(a=!0)),S&&(p?(o=o.add(p),_?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((d,h)=>vG(d.type,h.type)||this.docComparator(d.doc,h.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new ua(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new bf,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=Q(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new Df(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new If(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=Q();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return ua.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function vG(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return L()}};return t(n)-t(e)}var Oi="SyncEngine",OS=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},MS=class{constructor(e){this.key=e,this.receivedDocument=!1}},xS=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new er(a=>l1(a),Mc),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new Te(M.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new _c,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=aa.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function _G(n,e,t,r,i,s,o){let a=new xS(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function SG(n,e,t=!0){return g(this,null,function*(){let r=Yf(n),i,s=r.queryViewsByQuery.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.computeInitialSnapshot()):i=yield pN(r,e,t,!0),i})}function TG(n,e){return g(this,null,function*(){let t=Yf(n);yield pN(t,e,!0,!1)})}function pN(n,e,t,r){return g(this,null,function*(){let i=yield la(n.localStore,Rt(e)),s=i.targetId,o=t?n.sharedClientState.addLocalQueryTarget(s):"not-current",a;return r&&(a=yield kT(n,e,s,o==="current",i.resumeToken)),n.isPrimaryClient&&t&&Qf(n.remoteStore,i),a})}function kT(n,e,t,r,i){return g(this,null,function*(){n.applyDocChanges=(d,h,p)=>OG(n,d,h,p);let s=yield Wf(n.localStore,e,!0),o=new Rf(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=gc.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);xT(n,t,c.limboChanges);let u=new OS(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function wG(n,e,t){return g(this,null,function*(){let r=x(n),i=r.queryViewsByQuery.get(e),s=r.queriesByTarget.get(i.targetId);if(s.length>1){r.queriesByTarget.set(i.targetId,s.filter(o=>!Mc(o,e))),r.queryViewsByQuery.delete(e);return}r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||(yield ca(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),t&&Ta(r.remoteStore,i.targetId),da(r,i.targetId)}).catch(Di))):(da(r,i.targetId),yield ca(r.localStore,i.targetId,!0))})}function EG(n,e){return g(this,null,function*(){let t=x(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);t.isPrimaryClient&&i.length===1&&(t.sharedClientState.removeLocalQueryTarget(r.targetId),Ta(t.remoteStore,r.targetId))})}function CG(n,e,t){return g(this,null,function*(){let r=FT(n);try{let i=yield $6(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),NG(r,i.batchId,t),yield Cr(r,i.changes),yield wa(r.remoteStore)}catch(i){let s=Ca(i,"Failed to persist write");t.reject(s)}})}function gN(n,e){return g(this,null,function*(){let t=x(n);try{let r=yield J6(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&(q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?q(o.receivedDocument):i.removedDocuments.size>0&&(q(o.receivedDocument),o.receivedDocument=!1))}),yield Cr(t,r,e)}catch(r){yield Di(r)}})}function fR(n,e,t){let r=x(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),pG(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function bG(n,e,t){return g(this,null,function*(){let r=x(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new Te(M.comparator);o=o.insert(s,Ke.newNoDocument(s,j.min()));let a=Q().add(s),l=new pc(j.min(),new Map,new Te(W),o,a);yield gN(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),PT(r)}else yield ca(r.localStore,e,!1).then(()=>da(r,e,t)).catch(Di)})}function AG(n,e){return g(this,null,function*(){let t=x(n),r=e.batch.batchId;try{let i=yield W6(t.localStore,e);MT(t,r,null),OT(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield Cr(t,i)}catch(i){yield Di(i)}})}function IG(n,e,t){return g(this,null,function*(){let r=x(n);try{let i=yield Y6(r.localStore,e);MT(r,e,t),OT(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield Cr(r,i)}catch(i){yield Di(i)}})}function DG(n,e){return g(this,null,function*(){let t=x(n);Ni(t.remoteStore)||D(Oi,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield X6(t.localStore);if(r===mi){e.resolve();return}let i=t.pendingWritesCallbacks.get(r)||[];i.push(e),t.pendingWritesCallbacks.set(r,i)}catch(r){let i=Ca(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function OT(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function RG(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new E(v.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function NG(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new Te(W)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function MT(n,e,t){let r=x(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function da(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||mN(n,i)})}function mN(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(Ta(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),PT(n))}function xT(n,e,t){for(let r of t)r instanceof If?(n.limboDocumentRefs.addReference(r.key,e),kG(n,r)):r instanceof Df?(D(Oi,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||mN(n,r.key)):L()}function kG(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(D(Oi,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),PT(n))}function PT(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new M(ne.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new MS(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),Qf(n.remoteStore,new oa(Rt(_a(t.path)),r,"TargetPurposeLimboResolution",jt.INVALID))}}function Cr(n,e,t){return g(this,null,function*(){let r=x(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(l.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let u=NS.fromSnapshot(l.targetId,c);s.push(u)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield ej(r.localStore,s))})}function OG(n,e,t,r){return g(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield Wf(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return xT(n,e.targetId,a.limboChanges),a.snapshot})}function MG(n,e){return g(this,null,function*(){let t=x(n);if(!t.currentUser.isEqual(e)){D(Oi,"User change. New user:",e.toKey());let i=yield Y1(t.localStore,e);t.currentUser=e,RG(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield Cr(t,i.affectedDocuments)}})}function xG(n,e){let t=x(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return Q().add(r.key);{let i=Q(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function PG(n,e){return g(this,null,function*(){let t=x(n),r=yield Wf(t.localStore,e.query,!0),i=e.view.synchronizeWithPersistedState(r);return t.isPrimaryClient&&xT(t,e.targetId,i.limboChanges),i})}function FG(n,e){return g(this,null,function*(){let t=x(n);return eN(t.localStore,e).then(r=>Cr(t,r))})}function LG(n,e,t,r){return g(this,null,function*(){let i=x(n),s=yield sj(i.localStore,e);if(s===null){D(Oi,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield wa(i.remoteStore):t==="acknowledged"||t==="rejected"?(MT(i,e,r||null),OT(i,e),oj(i.localStore,e)):L(),yield Cr(i,s)})}function BG(n,e){return g(this,null,function*(){let t=x(n);if(Yf(t),FT(t),e===!0&&t._isPrimaryClient!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield pR(t,r.toArray());t._isPrimaryClient=!0,yield AS(t.remoteStore,!0);for(let s of i)Qf(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let r=[],i=Promise.resolve();t.queriesByTarget.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(da(t,o),ca(t.localStore,o,!0))),Ta(t.remoteStore,o)}),yield i,yield pR(t,r),VG(t),t._isPrimaryClient=!1,yield AS(t.remoteStore,!1)}})}function VG(n){let e=x(n);e.activeLimboResolutionsByTarget.forEach((t,r)=>{Ta(e.remoteStore,r)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new Te(M.comparator)}function pR(n,e,t){return g(this,null,function*(){let r=x(n),i=[],s=[];for(let o of e){let a,l=r.queriesByTarget.get(o);if(l&&l.length!==0){a=yield la(r.localStore,Rt(l[0]));for(let c of l){let u=r.queryViewsByQuery.get(c),d=yield PG(r,u);d.snapshot&&s.push(d.snapshot)}}else{let c=yield Z1(r.localStore,o);a=yield la(r.localStore,c),yield kT(r,yN(c),o,!1,a.resumeToken)}i.push(a)}return r.syncEngineListener.onWatchChange(s),i})}function yN(n){return a1(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function qG(n){let e=x(n);return aj(e.localStore)}function UG(n,e,t,r){return g(this,null,function*(){let i=x(n);if(i._isPrimaryClient){D(Oi,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield eN(i.localStore,c1(s[0])),a=pc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",nt.EMPTY_BYTE_STRING);yield Cr(i,o,a);break}case"rejected":{yield ca(i.localStore,e,!0),da(i,e,r);break}default:L()}})}function zG(n,e,t){return g(this,null,function*(){let r=Yf(n);if(r._isPrimaryClient){for(let i of e){if(r.queriesByTarget.has(i)&&r.sharedClientState.isActiveQueryTarget(i)){D(Oi,"Adding an already active target "+i);continue}let o=yield Z1(r.localStore,i),a=yield la(r.localStore,o);yield kT(r,yN(o),a.targetId,!1,a.resumeToken),Qf(r.remoteStore,a)}for(let i of t)r.queriesByTarget.has(i)&&(yield ca(r.localStore,i,!1).then(()=>{Ta(r.remoteStore,i),da(r,i)}).catch(Di))}})}function Yf(n){let e=x(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=gN.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=xG.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=bG.bind(null,e),e.syncEngineListener.onWatchChange=hG.bind(null,e.eventManager),e.syncEngineListener.onWatchError=fG.bind(null,e.eventManager),e}function FT(n){let e=x(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=AG.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=IG.bind(null,e),e}function jG(n,e,t){let r=x(n);GG(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}function GG(n,e,t){return g(this,null,function*(){try{let r=yield e.getMetadata();if(yield uj(n.localStore,r))return yield e.close(),t._completeWith(yG(r)),Promise.resolve(new Set);t._updateProgress(fN(r));let s=new kS(r,n.localStore,e.serializer),o=yield e.nextElement();for(;o;){let l=yield s.addSizedElement(o);l&&t._updateProgress(l),o=yield e.nextElement()}let a=yield s.complete();return yield Cr(n,a.changedDocs,void 0),yield dj(n.localStore,r),t._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(r){return on(Oi,`Loading bundle failed with ${r}`),t._failWith(r),Promise.resolve(new Set)}})}var Cc=class{constructor(){this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){this.serializer=Fc(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return Q1(this.persistence,new vf,e.initialUser,this.serializer)}createPersistence(e){return new mf(yf.factory,this.serializer)}createSharedClientState(e){return new Tf}terminate(){return g(this,null,function*(){var e,t;(e=this.gcScheduler)===null||e===void 0||e.stop(),(t=this.indexBackfillerScheduler)===null||t===void 0||t.stop(),this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var Nf=class n extends Cc{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){yield cp(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield FT(this.onlineComponentProvider.syncEngine),yield wa(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return Q1(this.persistence,new vf,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new eS(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new m_(t,this.persistence);return new g_(e.asyncQueue,r)}createPersistence(e){let t=ET(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?sn.withCacheSize(this.cacheSizeBytes):sn.DEFAULT;return new pS(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,oN(),Mj(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new Tf}},PS=class n extends Nf{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return g(this,null,function*(){yield cp(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof nc&&(this.sharedClientState.syncEngine={applyBatchState:LG.bind(null,t),applyTargetState:UG.bind(null,t),applyActiveTargetsChange:zG.bind(null,t),getActiveClients:qG.bind(null,t),synchronizeWithChangedDocuments:FG.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(r=>g(this,null,function*(){yield BG(this.onlineComponentProvider.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=oN();if(!nc.isAvailable(t))throw new E(v.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=ET(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new nc(t,e.asyncQueue,r,e.clientId,e.initialUser)}},bc=class{initialize(e,t){return g(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>fR(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=MG.bind(null,this.syncEngine),yield AS(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return dG()}createDatastore(e){let t=Fc(e.databaseInfo.databaseId),r=kj(e.databaseInfo);return qj(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return $j(this.localStore,this.datastore,e.asyncQueue,t=>fR(this.syncEngine,t,0),Oj())}createSyncEngine(e,t){return _G(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return g(this,null,function*(){var e;yield Yj(this.remoteStore),(e=this.datastore)===null||e===void 0||e.terminate()})}};var HG=10240;function KG(n,e=HG){let t=0;return{read(){return g(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return g(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function LT(n,e,t){if(!t)throw new E(v.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function BT(n,e,t,r){if(e===!0&&r===!0)throw new E(v.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function gR(n){if(!M.isDocumentKey(n))throw new E(v.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function mR(n){if(M.isDocumentKey(n))throw new E(v.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function $G(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Bc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=WG(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":L()}function WG(n){return n.constructor?n.constructor.name:null}function re(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new E(v.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Bc(n);throw new E(v.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function vN(n,e){if(e<=0)throw new E(v.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function QG(n,e){if(!(n instanceof Uint8Array))throw new E(v.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${Bc(n)}`);return KG(n,e)}var ha=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.observer.error?this.scheduleEvent(this.observer.error,e):Ie("Uncaught Error in snapshot listener:",e.toString())}mute(){this.muted=!0}scheduleEvent(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var FS=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var LS=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new Ve,this.buffer=new Uint8Array,this.textDecoder=x3(),this.nextElementImpl().then(r=>{r&&r.isBundleMetadata()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.payload)}`))},r=>this.metadata.reject(r))}close(){return this.reader.cancel()}getMetadata(){return g(this,null,function*(){return this.metadata.promise})}nextElement(){return g(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return g(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),r=Number(t);isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`);let i=yield this.readJsonString(r);return new FS(JSON.parse(i),e.length+r)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e===123)}readLength(){return g(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return g(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return g(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function YG(n,e){return new LS(n,e)}var BS=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}lookup(e){return g(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new E(v.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;let t=yield zj(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastTransactionError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new bi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return g(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=M.fromPath(r);this.mutations.push(new dc(i,this.precondition(i)))}),yield Uj(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=j.min();else throw L();let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new E(v.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(j.min())?Me.exists(!1):Me.updateTime(t):Me.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(j.min()))throw new E(v.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Me.updateTime(t)}else return Me.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var VS=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.attemptsRemaining=r.maxAttempts,this.backoff=new wc(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>g(this,null,function*(){let e=new BS(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.handleTransactionError(i)}))}).catch(r=>{this.handleTransactionError(r)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return kc(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!b1(t)}return!1}};var Ai="FirestoreClient",XG=100,JG=11,ZG=20,e9=22,qS=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=$e.UNAUTHENTICATED,this.clientId=Wh.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>g(this,null,function*(){D(Ai,"Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(D(Ai,"Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:XG}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new E(v.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new Ve;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Ca(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function Kh(n,e){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),D(Ai,"Initializing OfflineComponentProvider");let t=n.configuration;yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>g(this,null,function*(){r.isEqual(i)||(yield Y1(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function US(n,e){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield VT(n);D(Ai,"Initializing OnlineComponentProvider"),yield e.initialize(t,n.configuration),n.setCredentialChangeListener(r=>hR(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,i)=>hR(e.remoteStore,i)),n._onlineComponents=e})}function _N(n){return n.name==="FirebaseError"?n.code===v.FAILED_PRECONDITION||n.code===v.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===e9||n.code===ZG||n.code===JG:!0}function VT(n){return g(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){D(Ai,"Using user provided OfflineComponentProvider");try{yield Kh(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!_N(t))throw t;on("Error using user provided cache. Falling back to memory cache: "+t),yield Kh(n,new Cc)}}else D(Ai,"Using default OfflineComponentProvider"),yield Kh(n,new Cc);return n._offlineComponents})}function Xf(n){return g(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(D(Ai,"Using user provided OnlineComponentProvider"),yield US(n,n._uninitializedComponentsProvider._online)):(D(Ai,"Using default OnlineComponentProvider"),yield US(n,new bc))),n._onlineComponents})}function SN(n){return VT(n).then(e=>e.persistence)}function qT(n){return VT(n).then(e=>e.localStore)}function TN(n){return Xf(n).then(e=>e.remoteStore)}function UT(n){return Xf(n).then(e=>e.syncEngine)}function t9(n){return Xf(n).then(e=>e.datastore)}function fa(n){return g(this,null,function*(){let e=yield Xf(n),t=e.eventManager;return t.onListen=SG.bind(null,e.syncEngine),t.onUnlisten=wG.bind(null,e.syncEngine),t.onFirstRemoteStoreListen=TG.bind(null,e.syncEngine),t.onLastRemoteStoreUnlisten=EG.bind(null,e.syncEngine),t})}function n9(n){return n.asyncQueue.enqueue(()=>g(this,null,function*(){let e=yield SN(n),t=yield TN(n);return e.setNetworkEnabled(!0),Wj(t)}))}function r9(n){return n.asyncQueue.enqueue(()=>g(this,null,function*(){let e=yield SN(n),t=yield TN(n);return e.setNetworkEnabled(!1),Qj(t)}))}function i9(n){let e=new Ve;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let t=yield UT(n);return DG(t,e)})),e.promise}function s9(n,e,t,r){let i=new ha(r),s=new Ec(e,i,t);return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let o=yield fa(n);return DT(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let o=yield fa(n);return RT(o,s)}))}}function o9(n,e){let t=new Ve;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield qT(n);return d9(r,e,t)})),t.promise}function wN(n,e,t={}){let r=new Ve;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let i=yield fa(n);return h9(i,n.asyncQueue,e,t,r)})),r.promise}function a9(n,e){let t=new Ve;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield qT(n);return f9(r,e,t)})),t.promise}function EN(n,e,t={}){let r=new Ve;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let i=yield fa(n);return p9(i,n.asyncQueue,e,t,r)})),r.promise}function l9(n,e){let t=new Ve;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield UT(n);return CG(r,e,t)})),t.promise}function c9(n,e){let t=new ha(e);return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield fa(n);return gG(r,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield fa(n);return mG(r,t)}))}}function u9(n,e,t){let r=new Ve;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let i=yield t9(n);new VS(n.asyncQueue,i,t,e,r).run()})),r.promise}function d9(n,e,t){return g(this,null,function*(){try{let r=yield nj(n,e);r.isFoundDocument()?t.resolve(r):r.isNoDocument()?t.resolve(null):t.reject(new E(v.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let i=Ca(r,`Failed to get document '${e} from cache`);t.reject(i)}})}function h9(n,e,t,r,i){let s=new ha({next:a=>{e.enqueueAndForget(()=>RT(n,o));let l=a.docs.has(t);!l&&a.fromCache?i.reject(new E(v.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&r&&r.source==="server"?i.reject(new E(v.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new Ec(_a(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return DT(n,o)}function f9(n,e,t){return g(this,null,function*(){try{let r=yield Wf(n,e,!0),i=new Rf(e,r.remoteKeys),s=i.computeDocChanges(r.documents),o=i.applyChanges(s,!1);t.resolve(o.snapshot)}catch(r){let i=Ca(r,`Failed to execute query '${e} against cache`);t.reject(i)}})}function p9(n,e,t,r,i){let s=new ha({next:a=>{e.enqueueAndForget(()=>RT(n,o)),a.fromCache&&r.source==="server"?i.reject(new E(v.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new Ec(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return DT(n,o)}function g9(n,e,t,r){let i=y9(t,Fc(e));n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){jG(yield UT(n),i,r)}))}function m9(n,e){return n.asyncQueue.enqueue(()=>g(this,null,function*(){return hj(yield qT(n),e)}))}function y9(n,e){let t;return typeof n=="string"?t=A1().encode(n):t=n,YG(QG(t),e)}function v9(n,e){return n.timeoutSeconds===e.timeoutSeconds}function CN(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var _9="ComponentProvider",yR=new Map;function S9(n){let e=yR.get(n);e&&(D(_9,"Removing Datastore"),yR.delete(n),e.terminate())}function T9(n,e,t,r){return new w_(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,CN(r.experimentalLongPollingOptions),r.useFetchStreams)}var bN="firestore.googleapis.com",vR=!0,_R=5,SR=30,w9=!0,kf=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new E(v.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=bN,this.ssl=vR}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:vR;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=K1;else{if(e.cacheSizeBytes!==Pc&&e.cacheSizeBytes<tR)throw new E(v.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${tR}`);this.cacheSizeBytes=e.cacheSizeBytes}BT("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=w9:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=CN((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),E9(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&v9(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function E9(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new E(v.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<_R)throw new E(v.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${_R})`);if(n.timeoutSeconds>SR)throw new E(v.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${SR})`)}}var Ts=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new kf({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new E(v.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new E(v.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new kf(e),e.credentials!==void 0&&(this._authCredentials=SU(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return S9(this),Promise.resolve()}};function AN(n,e,t,r={}){var i;n=re(n,Ts);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==bN&&s.host!==o&&on("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=$e.MOCK_USER;else{a=Cw(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new E(v.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new $e(c)}n._authCredentials=new o_(new $h(a,l))}}var lt=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},ye=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Jn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},Jn=class n extends lt{constructor(e,t,r){super(e,t,_a(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ye(this.firestore,null,new M(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function zT(n,e,...t){if(n=Ae(n),LT("collection","path",e),n instanceof Ts){let r=ne.fromString(e,...t);return mR(r),new Jn(n,null,r)}else{if(!(n instanceof ye)&&!(n instanceof Jn))throw new E(v.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ne.fromString(e,...t));return mR(r),new Jn(n.firestore,null,r)}}function IN(n,e){if(n=re(n,Ts),LT("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new E(v.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new lt(n,null,n3(e))}function Vc(n,e,...t){if(n=Ae(n),arguments.length===1&&(e=Wh.newId()),LT("doc","path",e),n instanceof Ts){let r=ne.fromString(e,...t);return gR(r),new ye(n,null,new M(r))}else{if(!(n instanceof ye)&&!(n instanceof Jn))throw new E(v.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ne.fromString(e,...t));return gR(r),new ye(n.firestore,n instanceof Jn?n.converter:null,new M(r))}}function jT(n,e){return n=Ae(n),e=Ae(e),(n instanceof ye||n instanceof Jn)&&(e instanceof ye||e instanceof Jn)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function GT(n,e){return n=Ae(n),e=Ae(e),n instanceof lt&&e instanceof lt?n.firestore===e.firestore&&Mc(n._query,e._query)&&n.converter===e.converter:!1}var C9="AsyncQueue",zS=class{constructor(){this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new wc(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()}}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new Ve;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return g(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(Ri(e))D(C9,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=A9(r);throw Ie("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=IS.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&L()}verifyOperationInProgress(){}drain(){return g(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function b9(){return new zS}function A9(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var jS=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ve,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var DN=Pc,be=class extends Ts{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=b9(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||RN(this),this._firestoreClient.terminate()}};function Qe(n){return n._firestoreClient||RN(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function RN(n){var e,t,r;let i=n._freezeSettings(),s=T9(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new qS(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function NN(n,e){n=re(n,be),VN(n);let t=Qe(n);if(t._uninitializedComponentsProvider)throw new E(v.FAILED_PRECONDITION,"SDK cache is already specified.");on("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new bc,s=new Nf(i,r.cacheSizeBytes,e?.forceOwnership);return ON(t,i,s)}function kN(n){n=re(n,be),VN(n);let e=Qe(n);if(e._uninitializedComponentsProvider)throw new E(v.FAILED_PRECONDITION,"SDK cache is already specified.");on("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new bc,i=new PS(r,t.cacheSizeBytes);return ON(e,r,i)}function ON(n,e,t){let r=new Ve;return n.asyncQueue.enqueue(()=>g(this,null,function*(){try{yield Kh(n,t),yield US(n,e),r.resolve()}catch(i){let s=i;if(!_N(s))throw s;on("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function MN(n){if(n._initialized&&!n._terminated)throw new E(v.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new Ve;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{yield H6(ET(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function xN(n){n=re(n,be);let e=Qe(n);return i9(e)}function PN(n){n=re(n,be);let e=Qe(n);return n9(e)}function FN(n){n=re(n,be);let e=Qe(n);return r9(e)}function LN(n,e){n=re(n,be);let t=Qe(n),r=new jS;return g9(t,n._databaseId,e,r),r}function BN(n,e){n=re(n,be);let t=Qe(n);return m9(t,e).then(r=>r?new lt(n,null,r.query):null)}function VN(n){if(n._initialized||n._terminated)throw new E(v.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}function I9(n,e=!0){vU(Iw),xa(new Fi("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new be(new a_(t.getProvider("auth-internal")),new d_(t.getProvider("app-check-internal")),g4(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),Or(hD,fD,n),Or(hD,fD,"esm2017")}var tr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(nt.fromBase64String(e))}catch(t){throw new E(v.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(nt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var Cn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new E(v.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ue(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var Tr=class{constructor(e){this._methodName=e}};var ws=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new E(v.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new E(v.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return W(this._lat,e._lat)||W(this._long,e._long)}};var D9=/^__.*__$/,GS=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new En(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ci(e,this.data,t,this.fieldTransforms)}},Of=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new En(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function qN(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L()}}var Mf=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return xf(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(qN(this.dataSource)&&D9.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},HS=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Fc(e)}createContext(e,t,r,i=!1){return new Mf({dataSource:e,methodName:t,targetDoc:r,path:Ue.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Is(n){let e=n._freezeSettings(),t=Fc(n._databaseId);return new HS(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Jf(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);$T("Data must be an object, but it was:",o,r);let a=jN(r,o),l,c;if(s.merge)l=new Gt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let d of s.mergeFields){let h=YS(e,d,t);if(!o.contains(h))throw new E(v.INVALID_ARGUMENT,`Field '${h}' is specified in your field mask but missing from your input data.`);HN(u,h)||u.push(h)}l=new Gt(u),c=o.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,c=o.fieldTransforms;return new GS(new _t(a),l,c)}var Ac=class n extends Tr{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function UN(n,e,t){return new Mf({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var KS=class n extends Tr{_toFieldTransform(e){return new ys(e.path,new wi)}isEqual(e){return e instanceof n}},$S=class n extends Tr{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=UN(this,e,!0),r=this._elements.map(s=>Ds(s,t)),i=new _r(r);return new ys(e.path,i)}isEqual(e){return e instanceof n&&vp(this._elements,e._elements)}},WS=class n extends Tr{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=UN(this,e,!0),r=this._elements.map(s=>Ds(s,t)),i=new Sr(r);return new ys(e.path,i)}isEqual(e){return e instanceof n&&vp(this._elements,e._elements)}},QS=class n extends Tr{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new Ei(e.serializer,m1(e.serializer,this._operand));return new ys(e.path,t)}isEqual(e){return e instanceof n&&this._operand===e._operand}};function HT(n,e,t,r){let i=n.createContext(1,e,t);$T("Data must be an object, but it was:",i,r);let s=[],o=_t.empty();As(r,(l,c)=>{let u=WT(e,l,t);c=Ae(c);let d=i.childContextForFieldPath(u);if(c instanceof Ac)s.push(u);else{let h=Ds(c,d);h!=null&&(s.push(u),o.set(u,h))}});let a=new Gt(s);return new Of(o,a,i.fieldTransforms)}function KT(n,e,t,r,i,s){let o=n.createContext(1,e,t),a=[YS(e,r,t)],l=[i];if(s.length%2!==0)throw new E(v.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<s.length;h+=2)a.push(YS(e,s[h])),l.push(s[h+1]);let c=[],u=_t.empty();for(let h=a.length-1;h>=0;--h)if(!HN(c,a[h])){let p=a[h],y=l[h];y=Ae(y);let _=o.childContextForFieldPath(p);if(y instanceof Ac)c.push(p);else{let S=Ds(y,_);S!=null&&(c.push(p),u.set(p,S))}}let d=new Gt(c);return new Of(u,d,o.fieldTransforms)}function zN(n,e,t,r=!1){let i=n.createContext(r?4:3,e);return Ds(t,i)}function Ds(n,e){if(n=Ae(n),GN(n))return $T("Unsupported field value:",e,n),jN(n,e);if(n instanceof Tr)return N9(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return R9(n,e)}else return k9(n,e)}function jN(n,e){let t={};return jR(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):As(n,(r,i)=>{let s=Ds(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function R9(n,e){let t=[],r=0;for(let i of n){let s=Ds(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function N9(n,e){if(!qN(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function k9(n,e){if(n=Ae(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return m1(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=De.fromDate(n);return{timestampValue:sa(e.serializer,t)}}else if(n instanceof De){let t=new De(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:sa(e.serializer,t)}}else{if(n instanceof ws)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof tr)return{bytesValue:I1(e.serializer,n._byteString)};if(n instanceof ye){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:vT(n.firestore._databaseId||e.databaseId,n._key.path)}}else throw e.createError(`Unsupported field value: ${Bc(n)}`)}}function GN(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof De)&&!(n instanceof ws)&&!(n instanceof tr)&&!(n instanceof ye)&&!(n instanceof Tr)}function $T(n,e,t){if(!GN(t)||!$G(t)){let r=Bc(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function YS(n,e,t){if(e=Ae(e),e instanceof Cn)return e._internalPath;if(typeof e=="string")return WT(n,e);throw xf("Field path arguments must be of type string or ",n,!1,void 0,t)}var O9=new RegExp("[~\\*/\\[\\]]");function WT(n,e,t){if(e.search(O9)>=0)throw xf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Cn(...e.split("."))._internalPath}catch{throw xf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function xf(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new E(v.INVALID_ARGUMENT,a+n+l)}function HN(n,e){return n.some(t=>t.isEqual(e))}var Es=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ye(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new XS(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(Zf("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},XS=class extends Es{data(){return super.data()}};function Zf(n,e){return typeof e=="string"?WT(n,e):e instanceof Cn?e._internalPath:e._delegate._internalPath}function KN(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new E(v.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Ic=class{},Cs=class extends Ic{};function br(n,e,...t){let r=[];e instanceof Ic&&r.push(e),r=r.concat(t),q9(r);for(let i of r)n=i._apply(n);return n}var Pf=class n extends Cs{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return nk(e._query,t),new lt(e.firestore,e.converter,mT(e._query,t))}_parse(e){let t=Is(e.firestore);return M9(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function $N(n,e,t){let r=e,i=Zf("where",n);return Pf._create(i,r,t)}var JS=class n extends Ic{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:ue.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(B9(e._query,t),new lt(e.firestore,e.converter,mT(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var ZS=class n extends Cs{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=x9(e._query,this._field,this._direction);return new lt(e.firestore,e.converter,s3(e._query,t))}};function WN(n,e="asc"){let t=e,r=Zf("orderBy",n);return ZS._create(r,t)}var Ff=class n extends Cs{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new lt(e.firestore,e.converter,rf(e._query,this._limit,this._limitType))}};function QN(n){return vN("limit",n),Ff._create("limit",n,"F")}function YN(n){return vN("limitToLast",n),Ff._create("limitToLast",n,"L")}var Lf=class n extends Cs{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=tk(e,this.type,this._docOrFields,this._inclusive);return new lt(e.firestore,e.converter,o3(e._query,t))}};function XN(...n){return Lf._create("startAt",n,!0)}function JN(...n){return Lf._create("startAfter",n,!1)}var Bf=class n extends Cs{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=tk(e,this.type,this._docOrFields,this._inclusive);return new lt(e.firestore,e.converter,a3(e._query,t))}};function ZN(...n){return Bf._create("endBefore",n,!1)}function ek(...n){return Bf._create("endAt",n,!0)}function tk(n,e,t,r){if(t[0]=Ae(t[0]),t[0]instanceof Es)return P9(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Is(n.firestore);return F9(n._query,n.firestore._databaseId,i,e,t,r)}}function M9(n,e,t,r,i,s,o){let a;if(i.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new E(v.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){wR(o,s);let c=[];for(let u of o)c.push(TR(r,n,u));a={arrayValue:{values:c}}}else a=TR(r,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&wR(o,s),a=zN(t,e,o,s==="in"||s==="not-in");return Z.create(i,s,a)}function x9(n,e,t){if(n.startAt!==null)throw new E(v.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new E(v.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new gs(e,t)}function P9(n,e,t,r,i){if(!r)throw new E(v.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let o of na(n))if(o.field.isKeyField())s.push(ps(e,r.key));else{let a=r.data.field(o.field);if(Gf(a))throw new E(v.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(a!==null)s.push(a);else{let l=o.field.canonicalString();throw new E(v.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}}return new Zn(s,i)}function F9(n,e,t,r,i,s){let o=n.explicitOrderBy;if(i.length>o.length)throw new E(v.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let l=0;l<i.length;l++){let c=i[l];if(o[l].field.isKeyField()){if(typeof c!="string")throw new E(v.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!gT(n)&&c.indexOf("/")!==-1)throw new E(v.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);let d=n.path.child(ne.fromString(c));if(!M.isDocumentKey(d))throw new E(v.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${d}' is not because it contains an odd number of segments.`);let h=new M(d);a.push(ps(e,h))}else{let d=zN(t,r,c);a.push(d)}}return new Zn(a,s)}function TR(n,e,t){if(t=Ae(t),typeof t=="string"){if(t==="")throw new E(v.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!gT(e)&&t.indexOf("/")!==-1)throw new E(v.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(ne.fromString(t));if(!M.isDocumentKey(r))throw new E(v.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return ps(n,new M(r))}else{if(t instanceof ye)return ps(n,t._key);throw new E(v.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Bc(t)}.`)}}function wR(n,e){if(!Array.isArray(n)||n.length===0)throw new E(v.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function L9(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function nk(n,e){let t=V9(n.filters,L9(e.op));if(t!==null)throw t===e.op?new E(v.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new E(v.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function B9(n,e){let t=n,r=e.getFlattenedFilters();for(let i of r)nk(t,i),t=mT(t,i)}function V9(n,e){for(let t of n)for(let r of t.getFlattenedFilters())if(e.indexOf(r.op)>=0)return r.op;return null}function q9(n){let e=n.filter(r=>r instanceof JS).length,t=n.filter(r=>r instanceof Pf).length;if(e>1||e>0&&t>0)throw new E(v.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var pa=class{convertValue(e,t="none"){switch(fs(e)){case 0:return null;case 1:return e.booleanValue;case 2:return xe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(_i(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw L()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return As(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new ws(xe(e.latitude),xe(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=hT(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(oc(e));default:return null}}convertTimestamp(e){let t=vi(e);return new De(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ne.fromString(e);q(B1(r));let i=new Si(r.get(1),r.get(3)),s=new M(r.popFirst(5));return i.isEqual(t)||Ie(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function ep(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}var eT=class extends pa{constructor(e){super(),this.firestore=e}convertBytes(e){return new tr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ye(this.firestore,null,t)}};function tT(n){return U9(n,["next","error","complete"])}function U9(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var wr=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},ln=class extends Es{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new Ii(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(Zf("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Ii=class extends ln{data(e={}){return super.data(e)}},bn=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new wr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Ii(this._firestore,this._userDataWriter,r.key,r,new wr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new E(v.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=z9(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function z9(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new Ii(n._firestore,n._userDataWriter,r.doc.key,r.doc,new wr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new Ii(n._firestore,n._userDataWriter,r.doc.key,r.doc,new wr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:j9(r.type),doc:i,oldIndex:s,newIndex:o}})}}function j9(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L()}}function QT(n,e){return n instanceof ln&&e instanceof ln?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof bn&&e instanceof bn?n._firestore===e._firestore&&GT(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function rk(n){n=re(n,ye);let e=re(n.firestore,be),t=Qe(e);return wN(t,n._key).then(r=>ZT(e,n,r))}var Er=class extends pa{constructor(e){super(),this.firestore=e}convertBytes(e){return new tr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ye(this.firestore,null,t)}};function ik(n){n=re(n,ye);let e=re(n.firestore,be),t=Qe(e),r=new Er(e);return o9(t,n._key).then(i=>new ln(e,r,n._key,i,new wr(i!==null&&i.hasLocalMutations,!0),n.converter))}function sk(n){n=re(n,ye);let e=re(n.firestore,be),t=Qe(e);return wN(t,n._key,{source:"server"}).then(r=>ZT(e,n,r))}function ok(n){n=re(n,lt);let e=re(n.firestore,be),t=Qe(e),r=new Er(e);return KN(n._query),EN(t,n._query).then(i=>new bn(e,r,n,i))}function ak(n){n=re(n,lt);let e=re(n.firestore,be),t=Qe(e),r=new Er(e);return a9(t,n._query).then(i=>new bn(e,r,n,i))}function lk(n){n=re(n,lt);let e=re(n.firestore,be),t=Qe(e),r=new Er(e);return EN(t,n._query,{source:"server"}).then(i=>new bn(e,r,n,i))}function YT(n,e,t){n=re(n,ye);let r=re(n.firestore,be),i=ep(n.converter,e,t),s=Is(r),a=Jf(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Me.none());return ba(r,[a])}function XT(n,e,t,...r){n=re(n,ye);let i=re(n.firestore,be),s=Is(i);e=Ae(e);let o;typeof e=="string"||e instanceof Cn?o=KT(s,"updateDoc",n._key,e,t,r):o=HT(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,Me.exists(!0));return ba(i,[a])}function ck(n){let e=re(n.firestore,be),t=[new bi(n._key,Me.none())];return ba(e,t)}function uk(n,e){let t=re(n.firestore,be),r=Vc(n),i=ep(n.converter,e),s=Is(n.firestore),a=Jf(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Me.exists(!1));return ba(t,[a]).then(()=>r)}function JT(n,...e){var t,r,i;n=Ae(n);let s={includeMetadataChanges:!1,source:"default"},o=0;typeof e[o]=="object"&&!tT(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(tT(e[o])){let h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),e[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let l,c,u;if(n instanceof ye)c=re(n.firestore,be),u=_a(n._key.path),l={next:h=>{e[o]&&e[o](ZT(c,n,h))},error:e[o+1],complete:e[o+2]};else{let h=re(n,lt);c=re(h.firestore,be),u=h._query;let p=new Er(c);l={next:y=>{e[o]&&e[o](new bn(c,p,h,y))},error:e[o+1],complete:e[o+2]},KN(n._query)}let d=Qe(c);return s9(d,u,a,l)}function dk(n,e){n=re(n,be);let t=Qe(n),r=tT(e)?e:{next:e};return c9(t,r)}function ba(n,e){let t=Qe(n);return l9(t,e)}function ZT(n,e,t){let r=t.docs.get(e._key),i=new Er(n);return new ln(n,i,e._key,r,new wr(t.hasPendingWrites,t.fromCache),e.converter)}var G9={maxAttempts:5};function H9(n){if(n.maxAttempts<1)throw new E(v.INVALID_ARGUMENT,"Max attempts must be at least 1")}var Vf=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Is(e)}set(e,t,r){this._verifyNotCommitted();let i=gi(e,this._firestore),s=ep(i.converter,t,r),o=Jf(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,Me.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=gi(e,this._firestore);t=Ae(t);let o;return typeof t=="string"||t instanceof Cn?o=KT(this._dataReader,"WriteBatch.update",s._key,t,r,i):o=HT(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Me.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=gi(e,this._firestore);return this._mutations=this._mutations.concat(new bi(t._key,Me.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new E(v.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function gi(n,e){if(n=Ae(n),n.firestore!==e)throw new E(v.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var nT=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Is(e)}get(e){let t=gi(e,this._firestore),r=new eT(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return L();let s=i[0];if(s.isFoundDocument())return new Es(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new Es(this._firestore,r,t._key,null,t.converter);throw L()})}set(e,t,r){let i=gi(e,this._firestore),s=ep(i.converter,t,r),o=Jf(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=gi(e,this._firestore);t=Ae(t);let o;return typeof t=="string"||t instanceof Cn?o=KT(this._dataReader,"Transaction.update",s._key,t,r,i):o=HT(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=gi(e,this._firestore);return this._transaction.delete(t._key),this}};var rT=class extends nT{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=gi(e,this._firestore),r=new Er(this._firestore);return super.get(e).then(i=>new ln(this._firestore,r,t._key,i._document,new wr(!1,!1),t.converter))}};function hk(n,e,t){n=re(n,be);let r=Object.assign(Object.assign({},G9),t);H9(r);let i=Qe(n);return u9(i,s=>e(new rT(n,s)),r)}function fk(){return new Ac("deleteField")}function pk(){return new KS("serverTimestamp")}function gk(...n){return new $S("arrayUnion",n)}function mk(...n){return new WS("arrayRemove",n)}function yk(n){return new QS("increment",n)}I9("node");var K9="@firebase/firestore-compat",$9="0.3.27";function sw(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new E("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function vk(){if(typeof Uint8Array>"u")throw new E("unimplemented","Uint8Arrays are not available in this environment.")}function _k(){if(!GR())throw new E("unimplemented","Blobs are unavailable in Firestore in this environment.")}var tp=class n{constructor(e){this._delegate=e}static fromBase64String(e){return _k(),new n(tr.fromBase64String(e))}static fromUint8Array(e){return vk(),new n(tr.fromUint8Array(e))}toBase64(){return _k(),this._delegate.toBase64()}toUint8Array(){return vk(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function ew(n){return W9(n,["next","error","complete"])}function W9(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var tw=class{enableIndexedDbPersistence(e,t){return NN(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return kN(e._delegate)}clearIndexedDbPersistence(e){return MN(e._delegate)}},np=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof Si||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&on("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){AN(this._delegate,e,t,r)}enableNetwork(){return PN(this._delegate)}disableNetwork(){return FN(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,BT("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return xN(this._delegate)}onSnapshotsInSync(e){return dk(this._delegate,e)}get app(){if(!this._appCompat)throw new E("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Da(this,zT(this._delegate,e))}catch(t){throw Nt(t,"collection()","Firestore.collection()")}}doc(e){try{return new nr(this,Vc(this._delegate,e))}catch(t){throw Nt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Os(this,IN(this._delegate,e))}catch(t){throw Nt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return hk(this._delegate,t=>e(new rp(this,t)))}batch(){return Qe(this._delegate),new ip(new Vf(this._delegate,e=>ba(this._delegate,e)))}loadBundle(e){return LN(this._delegate,e)}namedQuery(e){return BN(this._delegate,e).then(t=>t?new Os(this,t):null)}},Aa=class extends pa{constructor(e){super(),this.firestore=e}convertBytes(e){return new tp(new tr(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return nr.forKey(t,this.firestore,null)}};function Q9(n){CR(n)}var rp=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Aa(e)}get(e){let t=Rs(e);return this._delegate.get(t).then(r=>new Ns(this._firestore,new ln(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Rs(e);return r?(sw("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Rs(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Rs(e);return this._delegate.delete(t),this}},ip=class{constructor(e){this._delegate=e}set(e,t,r){let i=Rs(e);return r?(sw("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Rs(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Rs(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Ia=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new Ii(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new ks(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new Aa(e),t),i.set(t,s)),s}};Ia.INSTANCES=new WeakMap;var nr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Aa(e)}static forPath(e,t,r){if(e.length%2!==0)throw new E("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new ye(t._delegate,r,new M(e)))}static forKey(e,t,r){return new n(t,new ye(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Da(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Da(this.firestore,zT(this._delegate,e))}catch(t){throw Nt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=Ae(e),e instanceof ye?jT(this._delegate,e):!1}set(e,t){t=sw("DocumentReference.set",t);try{return t?YT(this._delegate,e,t):YT(this._delegate,e)}catch(r){throw Nt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?XT(this._delegate,e):XT(this._delegate,e,t,...r)}catch(i){throw Nt(i,"updateDoc()","DocumentReference.update()")}}delete(){return ck(this._delegate)}onSnapshot(...e){let t=Sk(e),r=Tk(e,i=>new Ns(this.firestore,new ln(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return JT(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=ik(this._delegate):e?.source==="server"?t=sk(this._delegate):t=rk(this._delegate),t.then(r=>new Ns(this.firestore,new ln(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ia.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Nt(n,e,t){return n.message=n.message.replace(e,t),n}function Sk(n){for(let e of n)if(typeof e=="object"&&!ew(e))return e;return{}}function Tk(n,e){var t,r;let i;return ew(n[0])?i=n[0]:ew(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Ns=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new nr(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return QT(this._delegate,e._delegate)}},ks=class extends Ns{data(e){let t=this._delegate.data(e);return this._delegate._converter||bR(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Os=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Aa(e)}where(e,t,r){try{return new n(this.firestore,br(this._delegate,$N(e,t,r)))}catch(i){throw Nt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,br(this._delegate,WN(e,t)))}catch(r){throw Nt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,br(this._delegate,QN(e)))}catch(t){throw Nt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,br(this._delegate,YN(e)))}catch(t){throw Nt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,br(this._delegate,XN(...e)))}catch(t){throw Nt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,br(this._delegate,JN(...e)))}catch(t){throw Nt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,br(this._delegate,ZN(...e)))}catch(t){throw Nt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,br(this._delegate,ek(...e)))}catch(t){throw Nt(t,"endAt()","Query.endAt()")}}isEqual(e){return GT(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=ak(this._delegate):e?.source==="server"?t=lk(this._delegate):t=ok(this._delegate),t.then(r=>new qc(this.firestore,new bn(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=Sk(e),r=Tk(e,i=>new qc(this.firestore,new bn(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return JT(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ia.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},nw=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new ks(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},qc=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Os(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new ks(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new nw(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new ks(this._firestore,r))})}isEqual(e){return QT(this._delegate,e._delegate)}},Da=class n extends Os{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new nr(this.firestore,e):null}doc(e){try{return e===void 0?new nr(this.firestore,Vc(this._delegate)):new nr(this.firestore,Vc(this._delegate,e))}catch(t){throw Nt(t,"doc()","CollectionReference.doc()")}}add(e){return uk(this._delegate,e).then(t=>new nr(this.firestore,t))}isEqual(e){return jT(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Ia.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Rs(n){return re(n,ye)}var rw=class n{constructor(...e){this._delegate=new Cn(...e)}static documentId(){return new n(Ue.keyField().canonicalString())}isEqual(e){return e=Ae(e),e instanceof Cn?this._delegate._internalPath.isEqual(e._internalPath):!1}};var iw=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=pk();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=fk();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=gk(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=mk(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=yk(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var Y9={Firestore:np,GeoPoint:ws,Timestamp:De,Blob:tp,Transaction:rp,WriteBatch:ip,DocumentReference:nr,DocumentSnapshot:Ns,Query:Os,QueryDocumentSnapshot:ks,QuerySnapshot:qc,CollectionReference:Da,FieldPath:rw,FieldValue:iw,setLogLevel:Q9,CACHE_SIZE_UNLIMITED:DN};function X9(n,e){n.INTERNAL.registerComponent(new Fi("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},Y9)))}function J9(n){X9(n,(e,t)=>new np(e,t,new tw)),n.registerVersion(K9,$9,"node")}J9(wt);function Z9(n,e=zc){return new xs(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function wk(n,e){return Z9(n,e)}function e5(n,e){return wk(n,e).pipe(Hc(void 0),jc(),st(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function lw(n,e){return wk(n,e).pipe(st(t=>({payload:t,type:"query"})))}var sp=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=Ik(r,t);return new ap(i,s,this.afs)}snapshotChanges(){return e5(this.ref,this.afs.schedulers.outsideAngular).pipe(kt)}valueChanges(e={}){return this.snapshotChanges().pipe(st(({payload:t})=>e.idField?rr(Ht({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return An(this.ref.get(e)).pipe(kt)}};function op(n,e){return lw(n,e).pipe(Hc(void 0),jc(),st(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,l)=>{let c=s.find(d=>d.doc.ref.isEqual(a.ref)),u=r?.payload.docs.find(d=>d.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&u&&JSON.stringify(u.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function Ek(n,e,t){return op(n,t).pipe(Gc((r,i)=>t5(r,i.map(s=>s.payload),e),[]),pw(),st(r=>r.map(i=>({type:i.type,payload:i}))))}function t5(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=n5(n,r))}),n}function ow(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function n5(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return ow(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return ow(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return ow(n,e.oldIndex,1);break}return n}function Ck(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var ap=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=op(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(st(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(Hc(void 0),jc(),Ra(([r,i])=>i.length>0||!r),st(([,r])=>r),kt)}auditTrail(e){return this.stateChanges(e).pipe(Gc((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=Ck(e);return Ek(this.query,t,this.afs.schedulers.outsideAngular).pipe(kt)}valueChanges(e={}){return lw(this.query,this.afs.schedulers.outsideAngular).pipe(st(t=>t.payload.docs.map(r=>e.idField?rr(Ht({},r.data()),{[e.idField]:r.id}):r.data())),kt)}get(e){return An(this.query.get(e)).pipe(kt)}add(e){return this.ref.add(e)}doc(e){return new sp(this.ref.doc(e),this.afs)}},aw=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?op(this.query,this.afs.schedulers.outsideAngular).pipe(kt):op(this.query,this.afs.schedulers.outsideAngular).pipe(st(t=>t.filter(r=>e.indexOf(r.type)>-1)),Ra(t=>t.length>0),kt)}auditTrail(e){return this.stateChanges(e).pipe(Gc((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=Ck(e);return Ek(this.query,t,this.afs.schedulers.outsideAngular).pipe(kt)}valueChanges(e={}){return lw(this.query,this.afs.schedulers.outsideAngular).pipe(st(r=>r.payload.docs.map(i=>e.idField?Ht({[e.idField]:i.id},i.data()):i.data())),kt)}get(e){return An(this.query.get(e)).pipe(kt)}},bk=new Fe("angularfire2.enableFirestorePersistence"),Ak=new Fe("angularfire2.firestore.persistenceSettings"),r5=new Fe("angularfire2.firestore.settings"),i5=new Fe("angularfire2.firestore.use-emulator");function Ik(n,e=t=>t){return{query:e(n),ref:n}}var s5=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,l,c,u,d,h,p,y,_,S,R,w){this.schedulers=l;let N=Ua(t,a,r),k=u;d&&Up(N,a,h,y,_,S,p,R),[this.firestore,this.persistenceEnabled$]=hu(`${N.name}.firestore`,"AngularFirestore",N.name,()=>{let V=a.runOutsideAngular(()=>N.firestore());if(s&&V.settings(s),k&&V.useEmulator(...k),i&&!$c(o)){let H=()=>{try{return An(V.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(X){return typeof console<"u"&&console.warn(X),Dr(!1)}};return[V,a.runOutsideAngular(H)]}else return[V,Dr(!1)]},[s,k,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=Ik(i,r),a=this.schedulers.ngZone.run(()=>s);return new ap(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new aw(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new sp(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(ee(qs),ee(Us,8),ee(bk,8),ee(r5,8),ee(Bs),ee(Nr),ee(cu),ee(Ak,8),ee(i5,8),ee(zp,8),ee(Pp,8),ee(Fp,8),ee(Lp,8),ee(Bp,8),ee(Vp,8),ee(qp,8),ee(Bi,8))};static \u0275prov=xi({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),MW=(()=>{class n{constructor(){wt.registerVersion("angularfire",Vi.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:bk,useValue:!0},{provide:Ak,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=sr({type:n});static \u0275inj=ir({providers:[s5]})}return n})();export{Vi as a,Bi as b,cu as c,U5 as d,kt as e,qs as f,Us as g,Ua as h,_H as i,hu as j,Pp as k,Fp as l,Lp as m,Bp as n,Vp as o,qp as p,Up as q,zp as r,xH as s,s5 as t,MW as u,Rk as v,Vw as w,Rw as x,Ba as y,A5 as z,sO as A,lO as B,uO as C,iE as D,D5 as E,R5 as F,N5 as G};

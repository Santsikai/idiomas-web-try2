import{D as b,F as h,i as m}from"./chunk-LPSJYQ4T.js";import{Ya as g,ba as c,ga as o}from"./chunk-5J3ZMGMD.js";import{f as l}from"./chunk-CQCHLVVT.js";var U=(()=>{let a=class a{constructor(t,e,s,r,d){this.afStore=t,this.ngFireAuth=e,this.router=s,this.ngZone=r,this.dbf=d,this.ngFireAuth.authState.subscribe(i=>{i&&(this.userData=i,localStorage.setItem("user",JSON.stringify(this.userData)),JSON.parse(localStorage.getItem("user")))})}getListUsersBloq(){return this.dbf.collection("/users",e=>e.where("bloqued","==",1)).valueChanges()}getListUsersNoBloq(){return this.dbf.collection("/users",e=>e.where("bloqued","==",0)).valueChanges()}getListUsersAdmin(){return this.dbf.collection("/users",e=>e.where("role_id","==","1")).valueChanges()}getListUsersNoAdmin(){return this.dbf.collection("/users",e=>e.where("role_id","==","2")).valueChanges()}getUserByEmailandPass(t,e){return this.dbf.collection("/users",r=>r.where("email","==",t).where("password","==",e).limit(1)).valueChanges()}getUser(t){let e=new u;return this.dbf.doc(`users/${t}`).snapshotChanges().subscribe(r=>{e.id=r.payload.data().id,e.email=r.payload.data().email,e.password=r.payload.data().password,e.bloqued=r.payload.data().bloqued,e.role_id=r.payload.data().role_id}),e}getLoggedUser(){return this.ngFireAuth.currentUser}login(t,e){return this.ngFireAuth.signInWithEmailAndPassword(t,e)}ForgotPassword(t){return this.ngFireAuth.sendPasswordResetEmail(t).then(()=>{window.alert("Password reset email sent, check your inbox.")}).catch(e=>{window.alert(e)})}changePass(t){return l(this,null,function*(){(yield this.ngFireAuth.currentUser).updatePassword(t)})}bloquearUser(t,e){this.dbf.doc(`users/${t}`).set({bloqued:e},{merge:!0})}AdminUser(t,e){this.dbf.doc(`users/${t}`).set({role_id:e},{merge:!0})}editUser(t,e,s){this.dbf.doc(`users/${t}`).set({password:e,email:s},{merge:!0})}deleteUser(t){return l(this,null,function*(){(yield this.ngFireAuth.currentUser).delete(),this.dbf.doc(`users/${t}`).delete()})}createUser(t,e,s){return l(this,null,function*(){let r=yield this.ngFireAuth.createUserWithEmailAndPassword(e,t);var d={password:t,email:r.user.email,id:r.user.uid,role_id:s};let i=new u;return i.email=e,i.password=t,i.id=r.user.uid,i.bloqued=0,i.role_id=s,this.SetUserData(d),i})}get isLoggedIn(){return JSON.parse(localStorage.getItem("user"))!==null}AuthLogin(t){return this.ngFireAuth.signInWithPopup(t).then(e=>{this.ngZone.run(()=>{this.router.navigate(["dashboard"])}),this.SetUserData(e.user)}).catch(e=>{window.alert(e)})}SetUserData(t){let e=this.afStore.doc(`users/${t.id}`),s={id:t.id,email:t.email,password:t.password,bloqued:0,role_id:t.role_id};return e.set(s,{merge:!0})}SignOut(){return this.ngFireAuth.signOut().then(()=>{localStorage.removeItem("user"),localStorage.removeItem("isLoginRegister"),localStorage.removeItem("rol_Id"),this.router.navigate(["login"])})}};a.\u0275fac=function(e){return new(e||a)(o(h),o(b),o(m),o(g),o(h))},a.\u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"});let n=a;return n})(),u=class{constructor(){this.id="",this.password="",this.email="",this.bloqued=0,this.role_id=""}};export{U as a,u as b};
